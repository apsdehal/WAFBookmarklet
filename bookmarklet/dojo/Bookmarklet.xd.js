/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
	This is an optimized version of Dojo, built for deployment and not for
	development. To get sources and documentation, please visit:

		http://dojotoolkit.org
*/

dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojo.Bookmarklet"],["provide","dojo.io.iframe"],["provide","pundit.BaseComponent"],["provide","pundit.Crypto"],["provide","pundit.BasePanel"],["provide","pundit.NamespaceHelper"],["provide","dojo.io.script"],["provide","dojo.dnd.common"],["provide","dojo.window"],["provide","dojo.dnd.autoscroll"],["provide","dojo.dnd.Mover"],["provide","dojo.dnd.Moveable"],["provide","dojo.dnd.move"],["provide","dojo.dnd.TimedMoveable"],["provide","dojo.fx.Toggler"],["provide","dojo.fx"],["provide","dijit._base.manager"],["provide","dojo.Stateful"],["provide","dijit._WidgetBase"],["provide","dijit._base.focus"],["provide","dojo.AdapterRegistry"],["provide","dijit._base.place"],["provide","dijit._base.window"],["provide","dijit._base.popup"],["provide","dijit._base.scroll"],["provide","dojo.uacss"],["provide","dijit._base.sniff"],["provide","dijit._base.typematic"],["provide","dijit._base.wai"],["provide","dijit._base"],["provide","dijit._Widget"],["provide","dojo.string"],["provide","dojo.date.stamp"],["provide","dojo.parser"],["provide","dojo.cache"],["provide","dijit._Templated"],["provide","dijit._CssStateMixin"],["provide","dijit.form._FormMixin"],["provide","dijit._DialogMixin"],["provide","dijit.DialogUnderlay"],["provide","dijit._Contained"],["provide","dijit._Container"],["provide","dijit.layout._LayoutWidget"],["provide","dijit.layout._ContentPaneResizeMixin"],["provide","dojo.html"],["provide","dijit.layout.ContentPane"],["provide","dijit.TooltipDialog"],["provide","dijit.Dialog"],["provide","dojo.regexp"],["provide","dojo.cookie"],["provide","dijit.layout.BorderContainer"],["provide","dojo.behavior"],["provide","dojo.NodeList-traverse"],["provide","dojo.dnd.Container"],["provide","dojo.dnd.Selector"],["provide","dojo.dnd.Avatar"],["provide","dojo.dnd.Manager"],["provide","dojo.dnd.Source"],["provide","dojox.fx._base"],["provide","dojox.fx"],["provide","dojo.DeferredList"],["provide","pundit.TripleComposer"],["provide","pundit.AnnotationReader"],["provide","pundit.AnnotationWriter"],["provide","dojo.NodeList-manipulate"],["provide","pundit.TextFragmentHandler"],["provide","dojox.layout.DragPane"],["provide","dojox.fx._core"],["provide","dojox.fx.scroll"],["provide","pundit.TooltipAnnotationViewer"],["provide","pundit.TriplesBucket"],["provide","dojo.data.util.filter"],["provide","dojo.data.util.sorter"],["provide","dojo.data.util.simpleFetch"],["provide","dojo.data.ItemFileReadStore"],["provide","dojo.store.util.QueryResults"],["provide","dojo.store.util.SimpleQueryEngine"],["provide","dojo.store.Memory"],["provide","dojo.data.ObjectStore"],["provide","dijit.tree.TreeStoreModel"],["provide","dijit.tree._dndContainer"],["provide","dijit.tree._dndSelector"],["provide","dijit.tree.dndSource"],["provide","dijit.tree.ForestStoreModel"],["provide","dijit.Tree"],["provide","dojox.html._base"],["provide","dojox.layout.ContentPane"],["provide","dojox.layout.ResizeHandle"],["provide","dojox.layout.FloatingPane"],["provide","pundit.XpointersHelper"],["provide","pundit.RemoteStorageHandler"],["provide","pundit.LocalStorageHandler"],["provide","pundit.CookiesStorageHandler"],["provide","pundit.GUI"],["provide","pundit.Items"],["provide","pundit.MyItems"],["provide","pundit.PageItems"],["provide","pundit.ItemContainerManager"],["provide","pundit.Literals"],["provide","pundit.DbpediaSpotlight"],["provide","pundit.DataTxt"],["provide","pundit.Civet"],["provide","pundit.ResourcesPanel"],["provide","pundit.RecognizerPanel"],["provide","dojox.xml.DomParser"],["provide","pundit.CommentTagPanel"],["provide","pundit.AuthenticatedRequests"],["provide","dijit.form._FormWidget"],["provide","dijit._HasDropDown"],["provide","dijit.form.Button"],["provide","dijit.form.DropDownButton"],["provide","dijit._KeyNavContainer"],["provide","dijit.MenuItem"],["provide","dijit.PopupMenuItem"],["provide","dijit.CheckedMenuItem"],["provide","dijit.MenuSeparator"],["provide","dijit.Menu"],["provide","pundit.MyPundit"],["provide","pundit.ContextualMenu"],["provide","pundit.Previewer"],["provide","pundit.LoadingBox"],["provide","pundit.Configuration"],["provide","pundit.annotators.AnnotatorsConductor"],["provide","pundit.annotators.AnnotatorsBase"],["provide","pundit.AnalyticsHelper"],["provide","pundit.FastTextHandler"],["provide","pundit.PageHandler"],["provide","pundit.annotators.TextFragmentAnnotator"],["provide","pundit.selectors.SelectorBase"],["provide","pundit.selectors.VocabSelector"],["provide","pundit.selectors.DBPediaSelector"],["provide","pundit.selectors.FreebaseSelector"],["provide","pundit.selectors.KorboBasketSelector"],["provide","pundit.selectors.MurucaSelector"],["provide","pundit.selectors.WordnetSelector"],["provide","pundit.selectors.EuropeanaSelector"],["provide","pundit.selectors.EuropeanaEDMSelector"],["provide","pundit.selectors.BibServerSelector"],["provide","pundit.selectors.DandelionGeoSelector"],["provide","pundit.selectors.DandelionPOISelector"],["provide","pundit.selectors.WikidataItemsSelector"],["provide","pundit.selectors.WikidataPropertiesSelector"],["provide","pundit.ImageFragmentHandler"],["provide","pundit.NotebookManager"],["provide","pundit.Recognizer"],["provide","pundit.ImageAnnotationPanel"],["provide","pundit.Help"],["provide","pundit.NamedContentHandler"],["provide","pundit.ContactHelper"],["provide","pundit.ng.ImageAnnotatorHelper"],["provide","pundit.ng.EntityEditorHelper"],["provide","pundit.Init"],["i18n._preloadLocalizations","dojo.nls.Bookmarklet",["ROOT","ar","ca","cs","da","de","de-de","el","en","en-gb","en-us","es","es-es","fi","fi-fi","fr","fr-fr","he","he-il","hu","it","it-it","ja","ja-jp","ko","ko-kr","nb","nl","nl-nl","pl","pt","pt-br","pt-pt","ru","sk","sl","sv","th","tr","xx","zh","zh-cn","zh-tw"]]],defineResource:function(_4,_5,_6){_4.provide("dojo.Bookmarklet");if(!_4._hasResource["dojo.io.iframe"]){_4._hasResource["dojo.io.iframe"]=true;_4.provide("dojo.io.iframe");_4.getObject("io",true,_4);_4.io.iframe={create:function(_7,_8,_9){if(window[_7]){return window[_7];}if(window.frames[_7]){return window.frames[_7];}var _a=null;var _b=_9;if(!_b){if(_4.config["useXDomain"]&&!_4.config["dojoBlankHtmlUrl"]){console.warn("dojo.io.iframe.create: When using cross-domain Dojo builds,"+" please save dojo/resources/blank.html to your domain and set djConfig.dojoBlankHtmlUrl"+" to the path on your domain to blank.html");}_b=(_4.config["dojoBlankHtmlUrl"]||_4.moduleUrl("dojo","resources/blank.html"));}var _a=_4.place("<iframe id=\""+_7+"\" name=\""+_7+"\" src=\""+_b+"\" onload=\""+_8+"\" style=\"position: absolute; left: 1px; top: 1px; height: 1px; width: 1px; visibility: hidden\">",_4.body());window[_7]=_a;return _a;},setSrc:function(_c,_d,_e){try{if(!_e){if(_4.isWebKit){_c.location=_d;}else{frames[_c.name].location=_d;}}else{var _f;if(_4.isIE||_4.isWebKit){_f=_c.contentWindow.document;}else{_f=_c.contentWindow;}if(!_f){_c.location=_d;return;}else{_f.location.replace(_d);}}}catch(e){console.log("dojo.io.iframe.setSrc: ",e);}},doc:function(_10){var doc=_10.contentDocument||(((_10.name)&&(_10.document)&&(_4.doc.getElementsByTagName("iframe")[_10.name].contentWindow)&&(_4.doc.getElementsByTagName("iframe")[_10.name].contentWindow.document)))||((_10.name)&&(_4.doc.frames[_10.name])&&(_4.doc.frames[_10.name].document))||null;return doc;},send:function(_11){if(!this["_frame"]){this._frame=this.create(this._iframeName,_4._scopeName+".io.iframe._iframeOnload();");}var dfd=_4._ioSetArgs(_11,function(dfd){dfd.canceled=true;dfd.ioArgs._callNext();},function(dfd){var _12=null;try{var _13=dfd.ioArgs;var dii=_4.io.iframe;var ifd=dii.doc(dii._frame);var _14=_13.handleAs;_12=ifd;if(_14!="html"){if(_14=="xml"){if(_4.isIE<9||(_4.isIE&&_4.isQuirks)){_4.query("a",dii._frame.contentWindow.document.documentElement).orphan();var _15=(dii._frame.contentWindow.document).documentElement.innerText;_15=_15.replace(/>\s+</g,"><");_15=_4.trim(_15);var _16={responseText:_15};_12=_4._contentHandlers["xml"](_16);}}else{_12=ifd.getElementsByTagName("textarea")[0].value;if(_14=="json"){_12=_4.fromJson(_12);}else{if(_14=="javascript"){_12=_4.eval(_12);}}}}}catch(e){_12=e;}finally{_13._callNext();}return _12;},function(_17,dfd){dfd.ioArgs._hasError=true;dfd.ioArgs._callNext();return _17;});dfd.ioArgs._callNext=function(){if(!this["_calledNext"]){this._calledNext=true;_4.io.iframe._currentDfd=null;_4.io.iframe._fireNextRequest();}};this._dfdQueue.push(dfd);this._fireNextRequest();_4._ioWatch(dfd,function(dfd){return !dfd.ioArgs["_hasError"];},function(dfd){return (!!dfd.ioArgs["_finished"]);},function(dfd){if(dfd.ioArgs._finished){dfd.callback(dfd);}else{dfd.errback(new Error("Invalid dojo.io.iframe request state"));}});return dfd;},_currentDfd:null,_dfdQueue:[],_iframeName:_4._scopeName+"IoIframe",_fireNextRequest:function(){try{if((this._currentDfd)||(this._dfdQueue.length==0)){return;}do{var dfd=this._currentDfd=this._dfdQueue.shift();}while(dfd&&dfd.canceled&&this._dfdQueue.length);if(!dfd||dfd.canceled){this._currentDfd=null;return;}var _18=dfd.ioArgs;var _19=_18.args;_18._contentToClean=[];var fn=_4.byId(_19["form"]);var _1a=_19["content"]||{};if(fn){if(_1a){var _1b=function(_1c,_1d){_4.create("input",{type:"hidden",name:_1c,value:_1d},fn);_18._contentToClean.push(_1c);};for(var x in _1a){var val=_1a[x];if(_4.isArray(val)&&val.length>1){var i;for(i=0;i<val.length;i++){_1b(x,val[i]);}}else{if(!fn[x]){_1b(x,val);}else{fn[x].value=val;}}}}var _1e=fn.getAttributeNode("action");var _1f=fn.getAttributeNode("method");var _20=fn.getAttributeNode("target");if(_19["url"]){_18._originalAction=_1e?_1e.value:null;if(_1e){_1e.value=_19.url;}else{fn.setAttribute("action",_19.url);}}if(!_1f||!_1f.value){if(_1f){_1f.value=(_19["method"])?_19["method"]:"post";}else{fn.setAttribute("method",(_19["method"])?_19["method"]:"post");}}_18._originalTarget=_20?_20.value:null;if(_20){_20.value=this._iframeName;}else{fn.setAttribute("target",this._iframeName);}fn.target=this._iframeName;_4._ioNotifyStart(dfd);fn.submit();}else{var _21=_19.url+(_19.url.indexOf("?")>-1?"&":"?")+_18.query;_4._ioNotifyStart(dfd);this.setSrc(this._frame,_21,true);}}catch(e){dfd.errback(e);}},_iframeOnload:function(){var dfd=this._currentDfd;if(!dfd){this._fireNextRequest();return;}var _22=dfd.ioArgs;var _23=_22.args;var _24=_4.byId(_23.form);if(_24){var _25=_22._contentToClean;for(var i=0;i<_25.length;i++){var key=_25[i];for(var j=0;j<_24.childNodes.length;j++){var _26=_24.childNodes[j];if(_26.name==key){_4.destroy(_26);break;}}}if(_22["_originalAction"]){_24.setAttribute("action",_22._originalAction);}if(_22["_originalTarget"]){_24.setAttribute("target",_22._originalTarget);_24.target=_22._originalTarget;}}_22._finished=true;}};}if(!_4._hasResource["pundit.BaseComponent"]){_4._hasResource["pundit.BaseComponent"]=true;_4.provide("pundit.BaseComponent");_4.declare("pundit.BaseComponent",null,{defaultOpts:{debug:false,libName:""},constructor:function(_27){var _28=this,i;var _29=_4.clone(_28.opts)||{};_4.mixin(_29,_28.defaultOpts);if(typeof (_PUNDIT)!=="undefined"&&typeof (_PUNDIT.config)!=="undefined"&&typeof (_PUNDIT.config.modules[_28.declaredClass])!=="undefined"){var _2a=_PUNDIT.config.modules[_28.declaredClass];_4.mixin(_29,_2a);}_4.mixin(_29,_27);_28.opts=_4.clone(_29);_28.log("BaseConstructor built opts for "+_28.declaredClass);},createCallback:function(_2b){var _2c=this;if(typeof (_2b)==="string"){_2b=[_2b];}for(var n=_2b.length;n--;){var _2d=_2b[n].substr(0,1).toUpperCase()+_2b[n].substr(1),_2e="on"+_2d+"Callbacks",_2f="on"+_2d,_30="fireOn"+_2d;if(typeof (_2c[_2e])==="undefined"){_2c[_2e]=[];}_2c[_2f]=(function(_31){return function(f){if(typeof (f)==="function"){_2c[_31].push(f);}};})(_2e);_2c[_30]=(function(_32){return function(){for(var i=_2c[_32].length;i--;){_2c[_32][i].apply(_2c,arguments);}};})(_2e);}},log:function(w){var foo=this.opts.debug;if(typeof (_PUNDIT)!=="undefined"&&typeof (_PUNDIT.config)!=="undefined"&&_PUNDIT.config.debugAllModules===true){foo=true;}if(foo===false){return;}var _33=(this.opts.libName!=="")?this.opts.libName:this.declaredClass;if(typeof console==="undefined"){if(!_4.query("#debug_foo")){$("body").append("<div id='debug_foo' style=' border: 3px solid yellow; font-size: 0.9em;'></div>");}_4.query("#debug_foo").append("<div>#"+_33+"# "+w+"</div>");}else{console.log("#"+_33+"# "+w);}}});}if(!_4._hasResource["pundit.Crypto"]){_4._hasResource["pundit.Crypto"]=true;_4.provide("pundit.Crypto");_4.declare("pundit.Crypto",pundit.BaseComponent,{constructor:function(){this.hexcase=0;this.b64pad="";},hex_md5:function(s){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(s)));},b64_md5:function(s){return this.rstr2b64(this.rstr_md5(this.str2rstr_utf8(s)));},any_md5:function(s,e){return this.rstr2any(this.rstr_md5(this.str2rstr_utf8(s)),e);},hex_hmac_md5:function(k,d){return this.rstr2hex(this.rstr_hmac_md5(this.str2rstr_utf8(k),this.str2rstr_utf8(d)));},b64_hmac_md5:function(k,d){return this.rstr2b64(this.rstr_hmac_md5(this.str2rstr_utf8(k),this.str2rstr_utf8(d)));},any_hmac_md5:function(k,d,e){return this.rstr2any(this.rstr_hmac_md5(this.str2rstr_utf8(k),this.str2rstr_utf8(d)),e);},md5_vm_test:function(){return this.hex_md5("abc").toLowerCase()=="900150983cd24fb0d6963f7d28e17f72";},rstr_md5:function(s){return this.binl2rstr(this.binl_md5(this.rstr2binl(s),s.length*8));},rstr_hmac_md5:function(key,_34){var _35=this.rstr2binl(key);if(_35.length>16){_35=this.binl_md5(_35,key.length*8);}var _36=Array(16),_37=Array(16);for(var i=0;i<16;i++){_36[i]=_35[i]^909522486;_37[i]=_35[i]^1549556828;}var _38=this.binl_md5(_36.concat(this.rstr2binl(_34)),512+_34.length*8);return this.binl2rstr(this.binl_md5(_37.concat(_38),512+128));},rstr2hex:function(_39){try{this.hexcase;}catch(e){this.hexcase=0;}var _3a=this.hexcase?"0123456789ABCDEF":"0123456789abcdef";var _3b="";var x;for(var i=0;i<_39.length;i++){x=_39.charCodeAt(i);_3b+=_3a.charAt((x>>>4)&15)+_3a.charAt(x&15);}return _3b;},rstr2b64:function(_3c){try{this.b64pad;}catch(e){this.b64pad="";}var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var _3d="";var len=_3c.length;for(var i=0;i<len;i+=3){var _3e=(_3c.charCodeAt(i)<<16)|(i+1<len?_3c.charCodeAt(i+1)<<8:0)|(i+2<len?_3c.charCodeAt(i+2):0);for(var j=0;j<4;j++){if(i*8+j*6>_3c.length*8){_3d+=this.b64pad;}else{_3d+=tab.charAt((_3e>>>6*(3-j))&63);}}}return _3d;},rstr2any:function(_3f,_40){var _41=_40.length;var i,j,q,x,_42;var _43=Array(Math.ceil(_3f.length/2));for(i=0;i<_43.length;i++){_43[i]=(_3f.charCodeAt(i*2)<<8)|_3f.charCodeAt(i*2+1);}var _44=Math.ceil(_3f.length*8/(Math.log(_40.length)/Math.log(2)));var _45=Array(_44);for(j=0;j<_44;j++){_42=Array();x=0;for(i=0;i<_43.length;i++){x=(x<<16)+_43[i];q=Math.floor(x/_41);x-=q*_41;if(_42.length>0||q>0){_42[_42.length]=q;}}_45[j]=x;_43=_42;}var _46="";for(i=_45.length-1;i>=0;i--){_46+=_40.charAt(_45[i]);}return _46;},str2rstr_utf8:function(_47){var _48="";var i=-1;var x,y;while(++i<_47.length){x=_47.charCodeAt(i);y=i+1<_47.length?_47.charCodeAt(i+1):0;if(55296<=x&&x<=56319&&56320<=y&&y<=57343){x=65536+((x&1023)<<10)+(y&1023);i++;}if(x<=127){_48+=String.fromCharCode(x);}else{if(x<=2047){_48+=String.fromCharCode(192|((x>>>6)&31),128|(x&63));}else{if(x<=65535){_48+=String.fromCharCode(224|((x>>>12)&15),128|((x>>>6)&63),128|(x&63));}else{if(x<=2097151){_48+=String.fromCharCode(240|((x>>>18)&7),128|((x>>>12)&63),128|((x>>>6)&63),128|(x&63));}}}}}return _48;},str2rstr_utf16le:function(_49){var _4a="";for(var i=0;i<_49.length;i++){_4a+=String.fromCharCode(_49.charCodeAt(i)&255,(_49.charCodeAt(i)>>>8)&255);}return _4a;},str2rstr_utf16be:function(_4b){var _4c="";for(var i=0;i<_4b.length;i++){_4c+=String.fromCharCode((_4b.charCodeAt(i)>>>8)&255,_4b.charCodeAt(i)&255);}return _4c;},rstr2binl:function(_4d){var _4e=Array(_4d.length>>2);for(var i=0;i<_4e.length;i++){_4e[i]=0;}for(var i=0;i<_4d.length*8;i+=8){_4e[i>>5]|=(_4d.charCodeAt(i/8)&255)<<(i%32);}return _4e;},binl2rstr:function(_4f){var _50="";for(var i=0;i<_4f.length*32;i+=8){_50+=String.fromCharCode((_4f[i>>5]>>>(i%32))&255);}return _50;},binl_md5:function(x,len){x[len>>5]|=128<<((len)%32);x[(((len+64)>>>9)<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var _51=a;var _52=b;var _53=c;var _54=d;a=this.md5_ff(a,b,c,d,x[i+0],7,-680876936);d=this.md5_ff(d,a,b,c,x[i+1],12,-389564586);c=this.md5_ff(c,d,a,b,x[i+2],17,606105819);b=this.md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=this.md5_ff(a,b,c,d,x[i+4],7,-176418897);d=this.md5_ff(d,a,b,c,x[i+5],12,1200080426);c=this.md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=this.md5_ff(b,c,d,a,x[i+7],22,-45705983);a=this.md5_ff(a,b,c,d,x[i+8],7,1770035416);d=this.md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=this.md5_ff(c,d,a,b,x[i+10],17,-42063);b=this.md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=this.md5_ff(a,b,c,d,x[i+12],7,1804603682);d=this.md5_ff(d,a,b,c,x[i+13],12,-40341101);c=this.md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=this.md5_ff(b,c,d,a,x[i+15],22,1236535329);a=this.md5_gg(a,b,c,d,x[i+1],5,-165796510);d=this.md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=this.md5_gg(c,d,a,b,x[i+11],14,643717713);b=this.md5_gg(b,c,d,a,x[i+0],20,-373897302);a=this.md5_gg(a,b,c,d,x[i+5],5,-701558691);d=this.md5_gg(d,a,b,c,x[i+10],9,38016083);c=this.md5_gg(c,d,a,b,x[i+15],14,-660478335);b=this.md5_gg(b,c,d,a,x[i+4],20,-405537848);a=this.md5_gg(a,b,c,d,x[i+9],5,568446438);d=this.md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=this.md5_gg(c,d,a,b,x[i+3],14,-187363961);b=this.md5_gg(b,c,d,a,x[i+8],20,1163531501);a=this.md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=this.md5_gg(d,a,b,c,x[i+2],9,-51403784);c=this.md5_gg(c,d,a,b,x[i+7],14,1735328473);b=this.md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=this.md5_hh(a,b,c,d,x[i+5],4,-378558);d=this.md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=this.md5_hh(c,d,a,b,x[i+11],16,1839030562);b=this.md5_hh(b,c,d,a,x[i+14],23,-35309556);a=this.md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=this.md5_hh(d,a,b,c,x[i+4],11,1272893353);c=this.md5_hh(c,d,a,b,x[i+7],16,-155497632);b=this.md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=this.md5_hh(a,b,c,d,x[i+13],4,681279174);d=this.md5_hh(d,a,b,c,x[i+0],11,-358537222);c=this.md5_hh(c,d,a,b,x[i+3],16,-722521979);b=this.md5_hh(b,c,d,a,x[i+6],23,76029189);a=this.md5_hh(a,b,c,d,x[i+9],4,-640364487);d=this.md5_hh(d,a,b,c,x[i+12],11,-421815835);c=this.md5_hh(c,d,a,b,x[i+15],16,530742520);b=this.md5_hh(b,c,d,a,x[i+2],23,-995338651);a=this.md5_ii(a,b,c,d,x[i+0],6,-198630844);d=this.md5_ii(d,a,b,c,x[i+7],10,1126891415);c=this.md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=this.md5_ii(b,c,d,a,x[i+5],21,-57434055);a=this.md5_ii(a,b,c,d,x[i+12],6,1700485571);d=this.md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=this.md5_ii(c,d,a,b,x[i+10],15,-1051523);b=this.md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=this.md5_ii(a,b,c,d,x[i+8],6,1873313359);d=this.md5_ii(d,a,b,c,x[i+15],10,-30611744);c=this.md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=this.md5_ii(b,c,d,a,x[i+13],21,1309151649);a=this.md5_ii(a,b,c,d,x[i+4],6,-145523070);d=this.md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=this.md5_ii(c,d,a,b,x[i+2],15,718787259);b=this.md5_ii(b,c,d,a,x[i+9],21,-343485551);a=this.safe_add(a,_51);b=this.safe_add(b,_52);c=this.safe_add(c,_53);d=this.safe_add(d,_54);}return Array(a,b,c,d);},md5_cmn:function(q,a,b,x,s,t){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(a,q),this.safe_add(x,t)),s),b);},md5_ff:function(a,b,c,d,x,s,t){return this.md5_cmn((b&c)|((~b)&d),a,b,x,s,t);},md5_gg:function(a,b,c,d,x,s,t){return this.md5_cmn((b&d)|(c&(~d)),a,b,x,s,t);},md5_hh:function(a,b,c,d,x,s,t){return this.md5_cmn(b^c^d,a,b,x,s,t);},md5_ii:function(a,b,c,d,x,s,t){return this.md5_cmn(c^(b|(~d)),a,b,x,s,t);},safe_add:function(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return (msw<<16)|(lsw&65535);},bit_rol:function(num,cnt){return (num<<cnt)|(num>>>(32-cnt));}});}if(!_4._hasResource["pundit.BasePanel"]){_4._hasResource["pundit.BasePanel"]=true;_4.provide("pundit.BasePanel");_4.declare("pundit.BasePanel",pundit.BaseComponent,{constructor:function(_55){var _56=this;_56.log("Base Panel Contructor");_56.inShowing=false;_56.name=_55.name;_56.title=_55.title||"Panel";_56.drag=_55.drag||false;_56.preview=_55.preview||false;_56.width=_55.width||"400";_56.height=_55.height;_56.initBaseHTML();_4.style(_4.query("#"+_56._id+" ul.pundit-fp-content-list")[0],{width:parseInt(_56.width)+"px"});if(typeof _56.height!=="undefined"){_4.style(_4.query("#"+_56._id+" ul.pundit-fp-content-list")[0],{height:_56.height+"px"});}_4.style(_4.query("#"+_56._id+" .pundit-fp-content-container")[0],"width",_56.width-10+"px");if(_56.preview){_56.showPreview=function(uri){var _57=this;previewer.show(uri,"#"+_57._id+" .pundit-fp-preview");_4.addClass(_4.query("#"+_57._id+" .pundit-fp-content-list")[0],"pundit-preview");_4.style(_4.query("#"+_57._id+" ul.pundit-fp-content-list")[0],{width:parseInt(_57.width)+parseInt(250)+"px"});var h=_4.position(_4.query("#"+_57._id+" .pundit-fp-content-list")[0]).h;_4.style(_4.query("#"+_57._id+" .pundit-fp-preview")[0],"height",h+"px");};_56.hidePreview=function(){var _58=this;_4.removeClass(_4.query("#"+_58._id+" .pundit-fp-content-list")[0],"pundit-preview");_4.style(_4.query("#"+_58._id+" ul.pundit-fp-content-list")[0],{width:parseInt(_58.width)+"px"});};}_56.initBaseBehaviors();},initBaseHTML:function(){var _59=this;_59.log("Init HTML Base Panel");if(typeof _59.name!=="undefined"){_59._id="pundit-fp-"+_59.name;}else{_59._id="pundit-fp-"+Math.rand(100);}var c="<div id=\""+_59._id+"\" class=\"pundit-base pundit-fp pundit-hidden pundit-disable-annotation pundit-stop-wheel-propagation\">";c+="  <div class=\"pundit-fp-header\"><span class=\"pundit-fp-title\">"+_59.title+"</span>";c+="     <span class=\"pundit-fp-close pundit-icon-close\"></span>";c+="</div>";c+="  <ul class=\"pundit-fp-content-list pundit-horizontal-list\">";c+="      <li>";c+="          <div class=\"pundit-fp-content-container pundit-fp-container\">";c+="          </div>";c+="      </li>";c+="      <li class=\"pundit-fp-preview-list pundit-stop-wheel-propagation fillheight\">";c+="          <div class=\"pundit-fp-container fillheight pundit-stop-wheel-propagation\">";c+="              <span id=\""+_59._id+"-preview-hide\" style=\"cursor: pointer\">- [hide preview]</span><div id =\""+_59._id+"-preview\" class=\"pundit-fp-preview pundit-moreinfo-panel pundit-stop-wheel-propagation fillheight\"></div>";c+="          </div>";c+="      </li>";c+="  </ul>";c+="</div>";_4.query("body").append(c);},initBaseBehaviors:function(){var _5a=this;if(_5a.drag){var _5b=_4.byId(_5a._id+"-preview-hide");var _5c=_4.byId(_5a._id+"-preview");_4.connect(_5b,"onclick",function(evt){if(_5c.getAttribute("style")!=="visibility: hidden; cursor: pointer"){_5c.setAttribute("style","visibility: hidden; cursor: pointer");_5b.innerHTML="+ [show preview]";}else{_5c.setAttribute("style","");_5b.innerHTML="- [hide preview]";}});_4.connect(_4.query("#"+_5a._id+" .pundit-fp-header")[0],"onmousedown",function(e){_5a.moving=true;_5a.start={left:_4.style(_5a._id,"left"),top:_4.style(_5a._id,"top"),x:e.pageX,y:e.pageY};});_4.connect(window,"onmousemove",function(e){if(_5a.moving===true){if(e.clientY>0&&e.clientY<window.innerHeight-10){_4.stopEvent(e);_4.style(_5a._id,"left",_5a.start.left-_5a.start.x+e.pageX+"px");_4.style(_5a._id,"top",_5a.start.top-_5a.start.y+e.pageY+"px");}}});_4.connect(window,"onmouseup",function(e){_5a.moving=false;});}_4.connect(_4.query("#"+_5a._id+" .pundit-fp-close")[0],"onclick",function(){_5a.hide();});_4.connect(_4.query("#"+_5a._id+" .pundit-fp-fullscreen")[0],"onclick",function(){var _5d=600,_5e=400;});_4.behavior.apply();},hide:function(){var _5f=this;_4.style(_4.query("#"+_5f._id+".pundit-fp")[0],"opacity",0);_5f.inShowing=false;_5f.hideTimeout=setTimeout(function(){_4.addClass(_5f._id,"pundit-hidden");_5f.hidePreview();},1000);},show:function(x,y){var _60=this;if(_60.isVisible()){return;}_60.inShowing=true;clearTimeout(_60.hideTimeout);_4.removeClass(_60._id,"pundit-hidden");if(typeof x!=="undefined"&&typeof y!=="undefined"){if(_4.query("pundit-fp-notebook-sharePanel").length>0){_4.style("pundit-fp-notebook-sharePanel",{left:x,top:y});}}_4.style(_4.query("#"+_60._id+".pundit-fp")[0],"opacity",1);},isVisible:function(){return this.inShowing;},getPosition:function(){return _4.position(this._id);},showPreview:function(uri){var _61=this;previewer.show(uri);},hidePreview:function(){var _62=this;_4.removeClass(_4.query("#"+_62._id+" li.pundit-fp-preview-list")[0],"pundit-preview");},addHTMLContent:function(_63){var _64=this;_4.query("#"+_64._id+" .pundit-fp-content-container").append(_63);},emptyContent:function(){var _65=this;_4.empty(_4.query("#"+_65._id+" .pundit-fp-content-container")[0]);}});}if(!_4._hasResource["pundit.NamespaceHelper"]){_4._hasResource["pundit.NamespaceHelper"]=true;_4.provide("pundit.NamespaceHelper");_4.declare("pundit.NamespaceHelper",pundit.BaseComponent,{constructor:function(_66){var _67=this;_67.rdf_type="http://www.w3.org/1999/02/22-rdf-syntax-ns#type";_67.rdf_value="http://www.w3.org/1999/02/22-rdf-syntax-ns#value";_67.rdf_property="http://www.w3.org/1999/02/22-rdf-syntax-ns#Property";_67.rdf_XMLLiteral="http://www.w3.org/1999/02/22-rdf-syntax-ns#XMLLiteral";_67.rdfs_label="http://www.w3.org/2000/01/rdf-schema#label";_67.rdfs_comment="http://www.w3.org/2000/01/rdf-schema#comment";_67.rdfs_resource="http://www.w3.org/2000/01/rdf-schema#Resource";_67.rdfs_literal="http://www.w3.org/2000/01/rdf-schema#Literal";_67.rdfs_seeAlso="http://www.w3.org/2000/01/rdf-schema#seeAlso";_67.page="http://schema.org/WebPage";_67.image="http://xmlns.com/foaf/0.1/Image";_67.annotation="http://www.openannotation.org/ns/Annotation";_67.pundit_annotationId="http://purl.org/pundit/ont/ao#id";_67.pundit_annotationDate="http://purl.org/dc/terms/created";_67.pundit_authorName="http://purl.org/dc/elements/1.1/creator";_67.pundit_userName="http://xmlns.com/foaf/0.1/name";_67.pundit_authorURI="http://purl.org/dc/terms/creator";_67.pundit_hasTarget="http://www.openannotation.org/ns/hasTarget";_67.pundit_hasTag="http://purl.org/pundit/ont/ao#hasTag";_67.pundit_hasComment="http://schema.org/comment";_67.pundit_isIncludedIn="http://purl.org/pundit/ont/ao#isIncludedIn";_67.pundit_VocabCategory="http://purl.org/pundit/vocab/category";_67.annotationServer=_PUNDIT.config.annotationServerBaseURL;_67.annotationServerApi=_67.annotationServer+"api/";_67.annotationServerApiNotebooks=_67.annotationServer+"api/notebooks/";_67.annotationServerApiNotebooksGraph=_67.annotationServer+"api/notebooks/graph/";_67.annotationServerApiUsers=_67.annotationServer+"api/users/";_67.annotationServerApiCurrentNotebook=_67.annotationServer+"api/notebooks/current";_67.annotationServerApiAnnotations=_67.annotationServer+"api/annotations/";_67.annotationServerMetadataSearch=_67.annotationServer+"api/annotations/metadata/search";_67.annotationServerStorage=_67.annotationServer+"api/services/preferences/";_67.annotationServerVocabProxy=_67.annotationServer+"api/services/proxy";_67.annotationServerUsersCurrent=_67.annotationServer+"api/users/current";_67.annotationServerUsersLogout=_67.annotationServer+"api/users/logout";_67.annotationServerNotebooksActive=_67.annotationServer+"api/notebooks/active";_67.annotationServerApiOwnedNotebooks=_67.annotationServer+"api/notebooks/owned";_67.annotationServerContact=_67.annotationServer+"api/services/email";_67.wikimediaServerUsersCurrent="http://tools.wmflabs.org/wikidata-annotation-tool?action=getcurrentinfo";_67.wikimediaServerUsersLogout="http://tools.wmflabs.org/wikidata-annotation-tool?action=logout";_67.wikimediaServerUsersPush="http://tools.wmflabs.org/bajo";_67.lodLiveURL="http://thepund.it/lodlive/app_en.html";_67.notebooksNamespace="http://swickynotes.org/notebook/resource/";_67.usersNamespace="http://swickynotes.org/notebook/resource/";_67.dbpediaSpotlightAnnotate="http://spotlight.dbpedia.org/rest/annotate?text=";_67.dbpediaKeywordSearch="http://lookup.dbpedia.org/api/search.asmx/KeywordSearch";_67.items={label:_67.rdfs_label,prefLabel:"http://www.w3.org/2004/02/skos/core#prefLabel",altLabel:"http://www.w3.org/2004/02/skos/core#altLabel",description:"http://purl.org/dc/elements/1.1/description",image:"http://xmlns.com/foaf/0.1/depiction",type:_67.rdf_type,pageContext:"http://purl.org/pundit/ont/ao#hasPageContext",isPartOf:"http://purl.org/dc/terms/isPartOf",selector:"http://www.w3.org/ns/openannotation/core/hasSelector",parentItemXP:"http://purl.org/pundit/ont/ao#parentItemXP"},_67.fragments={image:"http://purl.org/pundit/ont/ao#fragment-image",text:"http://purl.org/pundit/ont/ao#fragment-text",named:"http://purl.org/pundit/ont/ao#named-content"},_67.selectors={polygon:{value:"http://purl.org/pundit/ont/ao#selector-polygon",label:"Polygonal Selector",description:"A polygonal selection described by the coordinates of the its points normalized according to the resource image and width"},rectangle:{vale:"http://purl.org/pundit/ont/ao#selector-rectangle",label:"Rectangular Selector",description:"A polygonal selection described by the coordinates of the top left vertex, width and height normalized according to the resource image and width"}};_67.fragmentBaseUri="http://purl.org/pundit/fragment/";_67.selectorBaseUri="http://purl.org/pundit/selector/";_67.notebooks={visibility:"http://open.vocab.org/terms/visibility",created:"http://purl.org/dc/terms/created",creator:"http://purl.org/dc/terms/creator",creatorName:"http://purl.org/dc/elements/1.1/creator",id:"http://purl.org/pundit/ont/ao#id",includes:"http://purl.org/pundit/ont/ao#includes",type:_67.rdf_type,label:_67.rdfs_label};_67.log("NamespaceHelper configured and ready!");},getLabelFromUri:function(uri){var _68;if(uri.match(/http:\/\/www\.freebase\.com\/schema\//)){_68=uri.substring(31).replace(/\//g,": ").replace(/_/g," ");return _68;}_68=uri.substring(uri.lastIndexOf("/")+1);if(_68.indexOf("#")!==-1){_68=_68.substring(_68.lastIndexOf("#")+1);}return _68;}});}if(!_4._hasResource["dojo.io.script"]){_4._hasResource["dojo.io.script"]=true;_4.provide("dojo.io.script");_4.getObject("io",true,_4);(function(){var _69=_4.isIE?"onreadystatechange":"load",_6a=/complete|loaded/;_4.io.script={get:function(_6b){var dfd=this._makeScriptDeferred(_6b);var _6c=dfd.ioArgs;_4._ioAddQueryToUrl(_6c);_4._ioNotifyStart(dfd);if(this._canAttach(_6c)){var _6d=this.attach(_6c.id,_6c.url,_6b.frameDoc);if(!_6c.jsonp&&!_6c.args.checkString){var _6e=_4.connect(_6d,_69,function(evt){if(evt.type=="load"||_6a.test(_6d.readyState)){_4.disconnect(_6e);_6c.scriptLoaded=evt;}});}}_4._ioWatch(dfd,this._validCheck,this._ioCheck,this._resHandle);return dfd;},attach:function(id,url,_6f){var doc=(_6f||_4.doc);var _70=doc.createElement("script");_70.type="text/javascript";_70.src=url;_70.id=id;_70.charset="utf-8";return doc.getElementsByTagName("head")[0].appendChild(_70);},remove:function(id,_71){_4.destroy(_4.byId(id,_71));if(this["jsonp_"+id]){delete this["jsonp_"+id];}},_makeScriptDeferred:function(_72){var dfd=_4._ioSetArgs(_72,this._deferredCancel,this._deferredOk,this._deferredError);var _73=dfd.ioArgs;_73.id=_4._scopeName+"IoScript"+(this._counter++);_73.canDelete=false;_73.jsonp=_72.callbackParamName||_72.jsonp;if(_73.jsonp){_73.query=_73.query||"";if(_73.query.length>0){_73.query+="&";}_73.query+=_73.jsonp+"="+(_72.frameDoc?"parent.":"")+_4._scopeName+".io.script.jsonp_"+_73.id+"._jsonpCallback";_73.frameDoc=_72.frameDoc;_73.canDelete=true;dfd._jsonpCallback=this._jsonpCallback;this["jsonp_"+_73.id]=dfd;}return dfd;},_deferredCancel:function(dfd){dfd.canceled=true;if(dfd.ioArgs.canDelete){_4.io.script._addDeadScript(dfd.ioArgs);}},_deferredOk:function(dfd){var _74=dfd.ioArgs;if(_74.canDelete){_4.io.script._addDeadScript(_74);}return _74.json||_74.scriptLoaded||_74;},_deferredError:function(_75,dfd){if(dfd.ioArgs.canDelete){if(_75.dojoType=="timeout"){_4.io.script.remove(dfd.ioArgs.id,dfd.ioArgs.frameDoc);}else{_4.io.script._addDeadScript(dfd.ioArgs);}}console.log("dojo.io.script error",_75);return _75;},_deadScripts:[],_counter:1,_addDeadScript:function(_76){_4.io.script._deadScripts.push({id:_76.id,frameDoc:_76.frameDoc});_76.frameDoc=null;},_validCheck:function(dfd){var _77=_4.io.script;var _78=_77._deadScripts;if(_78&&_78.length>0){for(var i=0;i<_78.length;i++){_77.remove(_78[i].id,_78[i].frameDoc);_78[i].frameDoc=null;}_4.io.script._deadScripts=[];}return true;},_ioCheck:function(dfd){var _79=dfd.ioArgs;if(_79.json||(_79.scriptLoaded&&!_79.args.checkString)){return true;}var _7a=_79.args.checkString;if(_7a&&eval("typeof("+_7a+") != 'undefined'")){return true;}return false;},_resHandle:function(dfd){if(_4.io.script._ioCheck(dfd)){dfd.callback(dfd);}else{dfd.errback(new Error("inconceivable dojo.io.script._resHandle error"));}},_canAttach:function(_7b){return true;},_jsonpCallback:function(_7c){this.ioArgs.json=_7c;}};})();}if(!_4._hasResource["dojo.dnd.common"]){_4._hasResource["dojo.dnd.common"]=true;_4.provide("dojo.dnd.common");_4.getObject("dnd",true,_4);_4.dnd.getCopyKeyState=_4.isCopyKey;_4.dnd._uniqueId=0;_4.dnd.getUniqueId=function(){var id;do{id=_4._scopeName+"Unique"+(++_4.dnd._uniqueId);}while(_4.byId(id));return id;};_4.dnd._empty={};_4.dnd.isFormElement=function(e){var t=e.target;if(t.nodeType==3){t=t.parentNode;}return " button textarea input select option ".indexOf(" "+t.tagName.toLowerCase()+" ")>=0;};}if(!_4._hasResource["dojo.window"]){_4._hasResource["dojo.window"]=true;_4.provide("dojo.window");_4.getObject("window",true,_4);_4.window.getBox=function(){var _7d=(_4.doc.compatMode=="BackCompat")?_4.body():_4.doc.documentElement;var _7e=_4._docScroll();return {w:_7d.clientWidth,h:_7d.clientHeight,l:_7e.x,t:_7e.y};};_4.window.get=function(doc){if(_4.isIE&&window!==document.parentWindow){doc.parentWindow.execScript("document._parentWindow = window;","Javascript");var win=doc._parentWindow;doc._parentWindow=null;return win;}return doc.parentWindow||doc.defaultView;};_4.window.scrollIntoView=function(_7f,pos){try{_7f=_4.byId(_7f);var doc=_7f.ownerDocument||_4.doc,_80=doc.body||_4.body(),_81=doc.documentElement||_80.parentNode,_82=_4.isIE,_83=_4.isWebKit;if((!(_4.isMoz||_82||_83||_4.isOpera)||_7f==_80||_7f==_81)&&(typeof _7f.scrollIntoView!="undefined")){_7f.scrollIntoView(false);return;}var _84=doc.compatMode=="BackCompat",_85=(_82>=9&&_7f.ownerDocument.parentWindow.frameElement)?((_81.clientHeight>0&&_81.clientWidth>0&&(_80.clientHeight==0||_80.clientWidth==0||_80.clientHeight>_81.clientHeight||_80.clientWidth>_81.clientWidth))?_81:_80):(_84?_80:_81),_86=_83?_80:_85,_87=_85.clientWidth,_88=_85.clientHeight,rtl=!_4._isBodyLtr(),_89=pos||_4.position(_7f),el=_7f.parentNode,_8a=function(el){return ((_82<=6||(_82&&_84))?false:(_4.style(el,"position").toLowerCase()=="fixed"));};if(_8a(_7f)){return;}while(el){if(el==_80){el=_86;}var _8b=_4.position(el),_8c=_8a(el);if(el==_86){_8b.w=_87;_8b.h=_88;if(_86==_81&&_82&&rtl){_8b.x+=_86.offsetWidth-_8b.w;}if(_8b.x<0||!_82){_8b.x=0;}if(_8b.y<0||!_82){_8b.y=0;}}else{var pb=_4._getPadBorderExtents(el);_8b.w-=pb.w;_8b.h-=pb.h;_8b.x+=pb.l;_8b.y+=pb.t;var _8d=el.clientWidth,_8e=_8b.w-_8d;if(_8d>0&&_8e>0){_8b.w=_8d;_8b.x+=(rtl&&(_82||el.clientLeft>pb.l))?_8e:0;}_8d=el.clientHeight;_8e=_8b.h-_8d;if(_8d>0&&_8e>0){_8b.h=_8d;}}if(_8c){if(_8b.y<0){_8b.h+=_8b.y;_8b.y=0;}if(_8b.x<0){_8b.w+=_8b.x;_8b.x=0;}if(_8b.y+_8b.h>_88){_8b.h=_88-_8b.y;}if(_8b.x+_8b.w>_87){_8b.w=_87-_8b.x;}}var l=_89.x-_8b.x,t=_89.y-Math.max(_8b.y,0),r=l+_89.w-_8b.w,bot=t+_89.h-_8b.h;if(r*l>0){var s=Math[l<0?"max":"min"](l,r);if(rtl&&((_82==8&&!_84)||_82>=9)){s=-s;}_89.x+=el.scrollLeft;el.scrollLeft+=s;_89.x-=el.scrollLeft;}if(bot*t>0){_89.y+=el.scrollTop;el.scrollTop+=Math[t<0?"max":"min"](t,bot);_89.y-=el.scrollTop;}el=(el!=_86)&&!_8c&&el.parentNode;}}catch(error){console.error("scrollIntoView: "+error);_7f.scrollIntoView(false);}};}if(!_4._hasResource["dojo.dnd.autoscroll"]){_4._hasResource["dojo.dnd.autoscroll"]=true;_4.provide("dojo.dnd.autoscroll");_4.getObject("dnd",true,_4);_4.dnd.getViewport=_4.window.getBox;_4.dnd.V_TRIGGER_AUTOSCROLL=32;_4.dnd.H_TRIGGER_AUTOSCROLL=32;_4.dnd.V_AUTOSCROLL_VALUE=16;_4.dnd.H_AUTOSCROLL_VALUE=16;_4.dnd.autoScroll=function(e){var v=_4.window.getBox(),dx=0,dy=0;if(e.clientX<_4.dnd.H_TRIGGER_AUTOSCROLL){dx=-_4.dnd.H_AUTOSCROLL_VALUE;}else{if(e.clientX>v.w-_4.dnd.H_TRIGGER_AUTOSCROLL){dx=_4.dnd.H_AUTOSCROLL_VALUE;}}if(e.clientY<_4.dnd.V_TRIGGER_AUTOSCROLL){dy=-_4.dnd.V_AUTOSCROLL_VALUE;}else{if(e.clientY>v.h-_4.dnd.V_TRIGGER_AUTOSCROLL){dy=_4.dnd.V_AUTOSCROLL_VALUE;}}window.scrollBy(dx,dy);};_4.dnd._validNodes={"div":1,"p":1,"td":1};_4.dnd._validOverflow={"auto":1,"scroll":1};_4.dnd.autoScrollNodes=function(e){for(var n=e.target;n;){if(n.nodeType==1&&(n.tagName.toLowerCase() in _4.dnd._validNodes)){var s=_4.getComputedStyle(n);if(s.overflow.toLowerCase() in _4.dnd._validOverflow){var b=_4._getContentBox(n,s),t=_4.position(n,true);var w=Math.min(_4.dnd.H_TRIGGER_AUTOSCROLL,b.w/2),h=Math.min(_4.dnd.V_TRIGGER_AUTOSCROLL,b.h/2),rx=e.pageX-t.x,ry=e.pageY-t.y,dx=0,dy=0;if(_4.isWebKit||_4.isOpera){rx+=_4.body().scrollLeft;ry+=_4.body().scrollTop;}if(rx>0&&rx<b.w){if(rx<w){dx=-w;}else{if(rx>b.w-w){dx=w;}}}if(ry>0&&ry<b.h){if(ry<h){dy=-h;}else{if(ry>b.h-h){dy=h;}}}var _8f=n.scrollLeft,_90=n.scrollTop;n.scrollLeft=n.scrollLeft+dx;n.scrollTop=n.scrollTop+dy;if(_8f!=n.scrollLeft||_90!=n.scrollTop){return;}}}try{n=n.parentNode;}catch(x){n=null;}}_4.dnd.autoScroll(e);};}if(!_4._hasResource["dojo.dnd.Mover"]){_4._hasResource["dojo.dnd.Mover"]=true;_4.provide("dojo.dnd.Mover");_4.declare("dojo.dnd.Mover",null,{constructor:function(_91,e,_92){this.node=_4.byId(_91);var pos=e.touches?e.touches[0]:e;this.marginBox={l:pos.pageX,t:pos.pageY};this.mouseButton=e.button;var h=(this.host=_92),d=_91.ownerDocument;this.events=[_4.connect(d,"onmousemove",this,"onFirstMove"),_4.connect(d,"ontouchmove",this,"onFirstMove"),_4.connect(d,"onmousemove",this,"onMouseMove"),_4.connect(d,"ontouchmove",this,"onMouseMove"),_4.connect(d,"onmouseup",this,"onMouseUp"),_4.connect(d,"ontouchend",this,"onMouseUp"),_4.connect(d,"ondragstart",_4.stopEvent),_4.connect(d.body,"onselectstart",_4.stopEvent)];if(h&&h.onMoveStart){h.onMoveStart(this);}},onMouseMove:function(e){_4.dnd.autoScroll(e);var m=this.marginBox,pos=e.touches?e.touches[0]:e;this.host.onMove(this,{l:m.l+pos.pageX,t:m.t+pos.pageY},e);_4.stopEvent(e);},onMouseUp:function(e){if(_4.isWebKit&&_4.isMac&&this.mouseButton==2?e.button==0:this.mouseButton==e.button){this.destroy();}_4.stopEvent(e);},onFirstMove:function(e){var s=this.node.style,l,t,h=this.host;switch(s.position){case "relative":case "absolute":l=Math.round(parseFloat(s.left))||0;t=Math.round(parseFloat(s.top))||0;break;default:s.position="absolute";var m=_4.marginBox(this.node);var b=_4.doc.body;var bs=_4.getComputedStyle(b);var bm=_4._getMarginBox(b,bs);var bc=_4._getContentBox(b,bs);l=m.l-(bc.l-bm.l);t=m.t-(bc.t-bm.t);break;}this.marginBox.l=l-this.marginBox.l;this.marginBox.t=t-this.marginBox.t;if(h&&h.onFirstMove){h.onFirstMove(this,e);}_4.disconnect(this.events.shift());_4.disconnect(this.events.shift());},destroy:function(){_4.forEach(this.events,_4.disconnect);var h=this.host;if(h&&h.onMoveStop){h.onMoveStop(this);}this.events=this.node=this.host=null;}});}if(!_4._hasResource["dojo.dnd.Moveable"]){_4._hasResource["dojo.dnd.Moveable"]=true;_4.provide("dojo.dnd.Moveable");_4.declare("dojo.dnd.Moveable",null,{handle:"",delay:0,skip:false,constructor:function(_93,_94){this.node=_4.byId(_93);if(!_94){_94={};}this.handle=_94.handle?_4.byId(_94.handle):null;if(!this.handle){this.handle=this.node;}this.delay=_94.delay>0?_94.delay:0;this.skip=_94.skip;this.mover=_94.mover?_94.mover:_4.dnd.Mover;this.events=[_4.connect(this.handle,"onmousedown",this,"onMouseDown"),_4.connect(this.handle,"ontouchstart",this,"onMouseDown"),_4.connect(this.handle,"ondragstart",this,"onSelectStart"),_4.connect(this.handle,"onselectstart",this,"onSelectStart")];},markupFactory:function(_95,_96){return new _4.dnd.Moveable(_96,_95);},destroy:function(){_4.forEach(this.events,_4.disconnect);this.events=this.node=this.handle=null;},onMouseDown:function(e){if(this.skip&&_4.dnd.isFormElement(e)){return;}if(this.delay){this.events.push(_4.connect(this.handle,"onmousemove",this,"onMouseMove"),_4.connect(this.handle,"ontouchmove",this,"onMouseMove"),_4.connect(this.handle,"onmouseup",this,"onMouseUp"),_4.connect(this.handle,"ontouchend",this,"onMouseUp"));var pos=e.touches?e.touches[0]:e;this._lastX=pos.pageX;this._lastY=pos.pageY;}else{this.onDragDetected(e);}_4.stopEvent(e);},onMouseMove:function(e){var pos=e.touches?e.touches[0]:e;if(Math.abs(pos.pageX-this._lastX)>this.delay||Math.abs(pos.pageY-this._lastY)>this.delay){this.onMouseUp(e);this.onDragDetected(e);}_4.stopEvent(e);},onMouseUp:function(e){for(var i=0;i<2;++i){_4.disconnect(this.events.pop());}_4.stopEvent(e);},onSelectStart:function(e){if(!this.skip||!_4.dnd.isFormElement(e)){_4.stopEvent(e);}},onDragDetected:function(e){new this.mover(this.node,e,this);},onMoveStart:function(_97){_4.publish("/dnd/move/start",[_97]);_4.addClass(_4.body(),"dojoMove");_4.addClass(this.node,"dojoMoveItem");},onMoveStop:function(_98){_4.publish("/dnd/move/stop",[_98]);_4.removeClass(_4.body(),"dojoMove");_4.removeClass(this.node,"dojoMoveItem");},onFirstMove:function(_99,e){},onMove:function(_9a,_9b,e){this.onMoving(_9a,_9b);var s=_9a.node.style;s.left=_9b.l+"px";s.top=_9b.t+"px";this.onMoved(_9a,_9b);},onMoving:function(_9c,_9d){},onMoved:function(_9e,_9f){}});}if(!_4._hasResource["dojo.dnd.move"]){_4._hasResource["dojo.dnd.move"]=true;_4.provide("dojo.dnd.move");_4.declare("dojo.dnd.move.constrainedMoveable",_4.dnd.Moveable,{constraints:function(){},within:false,markupFactory:function(_a0,_a1){return new _4.dnd.move.constrainedMoveable(_a1,_a0);},constructor:function(_a2,_a3){if(!_a3){_a3={};}this.constraints=_a3.constraints;this.within=_a3.within;},onFirstMove:function(_a4){var c=this.constraintBox=this.constraints.call(this,_a4);c.r=c.l+c.w;c.b=c.t+c.h;if(this.within){var mb=_4._getMarginSize(_a4.node);c.r-=mb.w;c.b-=mb.h;}},onMove:function(_a5,_a6){var c=this.constraintBox,s=_a5.node.style;this.onMoving(_a5,_a6);_a6.l=_a6.l<c.l?c.l:c.r<_a6.l?c.r:_a6.l;_a6.t=_a6.t<c.t?c.t:c.b<_a6.t?c.b:_a6.t;s.left=_a6.l+"px";s.top=_a6.t+"px";this.onMoved(_a5,_a6);}});_4.declare("dojo.dnd.move.boxConstrainedMoveable",_4.dnd.move.constrainedMoveable,{box:{},markupFactory:function(_a7,_a8){return new _4.dnd.move.boxConstrainedMoveable(_a8,_a7);},constructor:function(_a9,_aa){var box=_aa&&_aa.box;this.constraints=function(){return box;};}});_4.declare("dojo.dnd.move.parentConstrainedMoveable",_4.dnd.move.constrainedMoveable,{area:"content",markupFactory:function(_ab,_ac){return new _4.dnd.move.parentConstrainedMoveable(_ac,_ab);},constructor:function(_ad,_ae){var _af=_ae&&_ae.area;this.constraints=function(){var n=this.node.parentNode,s=_4.getComputedStyle(n),mb=_4._getMarginBox(n,s);if(_af=="margin"){return mb;}var t=_4._getMarginExtents(n,s);mb.l+=t.l,mb.t+=t.t,mb.w-=t.w,mb.h-=t.h;if(_af=="border"){return mb;}t=_4._getBorderExtents(n,s);mb.l+=t.l,mb.t+=t.t,mb.w-=t.w,mb.h-=t.h;if(_af=="padding"){return mb;}t=_4._getPadExtents(n,s);mb.l+=t.l,mb.t+=t.t,mb.w-=t.w,mb.h-=t.h;return mb;};}});_4.dnd.constrainedMover=_4.dnd.move.constrainedMover;_4.dnd.boxConstrainedMover=_4.dnd.move.boxConstrainedMover;_4.dnd.parentConstrainedMover=_4.dnd.move.parentConstrainedMover;}if(!_4._hasResource["dojo.dnd.TimedMoveable"]){_4._hasResource["dojo.dnd.TimedMoveable"]=true;_4.provide("dojo.dnd.TimedMoveable");(function(){var _b0=_4.dnd.Moveable.prototype.onMove;_4.declare("dojo.dnd.TimedMoveable",_4.dnd.Moveable,{timeout:40,constructor:function(_b1,_b2){if(!_b2){_b2={};}if(_b2.timeout&&typeof _b2.timeout=="number"&&_b2.timeout>=0){this.timeout=_b2.timeout;}},markupFactory:function(_b3,_b4){return new _4.dnd.TimedMoveable(_b4,_b3);},onMoveStop:function(_b5){if(_b5._timer){clearTimeout(_b5._timer);_b0.call(this,_b5,_b5._leftTop);}_4.dnd.Moveable.prototype.onMoveStop.apply(this,arguments);},onMove:function(_b6,_b7){_b6._leftTop=_b7;if(!_b6._timer){var _b8=this;_b6._timer=setTimeout(function(){_b6._timer=null;_b0.call(_b8,_b6,_b6._leftTop);},this.timeout);}}});})();}if(!_4._hasResource["dojo.fx.Toggler"]){_4._hasResource["dojo.fx.Toggler"]=true;_4.provide("dojo.fx.Toggler");_4.declare("dojo.fx.Toggler",null,{node:null,showFunc:_4.fadeIn,hideFunc:_4.fadeOut,showDuration:200,hideDuration:200,constructor:function(_b9){var _ba=this;_4.mixin(_ba,_b9);_ba.node=_b9.node;_ba._showArgs=_4.mixin({},_b9);_ba._showArgs.node=_ba.node;_ba._showArgs.duration=_ba.showDuration;_ba.showAnim=_ba.showFunc(_ba._showArgs);_ba._hideArgs=_4.mixin({},_b9);_ba._hideArgs.node=_ba.node;_ba._hideArgs.duration=_ba.hideDuration;_ba.hideAnim=_ba.hideFunc(_ba._hideArgs);_4.connect(_ba.showAnim,"beforeBegin",_4.hitch(_ba.hideAnim,"stop",true));_4.connect(_ba.hideAnim,"beforeBegin",_4.hitch(_ba.showAnim,"stop",true));},show:function(_bb){return this.showAnim.play(_bb||0);},hide:function(_bc){return this.hideAnim.play(_bc||0);}});}if(!_4._hasResource["dojo.fx"]){_4._hasResource["dojo.fx"]=true;_4.provide("dojo.fx");(function(){var d=_4,_bd={_fire:function(evt,_be){if(this[evt]){this[evt].apply(this,_be||[]);}return this;}};var _bf=function(_c0){this._index=-1;this._animations=_c0||[];this._current=this._onAnimateCtx=this._onEndCtx=null;this.duration=0;d.forEach(this._animations,function(a){this.duration+=a.duration;if(a.delay){this.duration+=a.delay;}},this);};d.extend(_bf,{_onAnimate:function(){this._fire("onAnimate",arguments);},_onEnd:function(){d.disconnect(this._onAnimateCtx);d.disconnect(this._onEndCtx);this._onAnimateCtx=this._onEndCtx=null;if(this._index+1==this._animations.length){this._fire("onEnd");}else{this._current=this._animations[++this._index];this._onAnimateCtx=d.connect(this._current,"onAnimate",this,"_onAnimate");this._onEndCtx=d.connect(this._current,"onEnd",this,"_onEnd");this._current.play(0,true);}},play:function(_c1,_c2){if(!this._current){this._current=this._animations[this._index=0];}if(!_c2&&this._current.status()=="playing"){return this;}var _c3=d.connect(this._current,"beforeBegin",this,function(){this._fire("beforeBegin");}),_c4=d.connect(this._current,"onBegin",this,function(arg){this._fire("onBegin",arguments);}),_c5=d.connect(this._current,"onPlay",this,function(arg){this._fire("onPlay",arguments);d.disconnect(_c3);d.disconnect(_c4);d.disconnect(_c5);});if(this._onAnimateCtx){d.disconnect(this._onAnimateCtx);}this._onAnimateCtx=d.connect(this._current,"onAnimate",this,"_onAnimate");if(this._onEndCtx){d.disconnect(this._onEndCtx);}this._onEndCtx=d.connect(this._current,"onEnd",this,"_onEnd");this._current.play.apply(this._current,arguments);return this;},pause:function(){if(this._current){var e=d.connect(this._current,"onPause",this,function(arg){this._fire("onPause",arguments);d.disconnect(e);});this._current.pause();}return this;},gotoPercent:function(_c6,_c7){this.pause();var _c8=this.duration*_c6;this._current=null;d.some(this._animations,function(a){if(a.duration<=_c8){this._current=a;return true;}_c8-=a.duration;return false;});if(this._current){this._current.gotoPercent(_c8/this._current.duration,_c7);}return this;},stop:function(_c9){if(this._current){if(_c9){for(;this._index+1<this._animations.length;++this._index){this._animations[this._index].stop(true);}this._current=this._animations[this._index];}var e=d.connect(this._current,"onStop",this,function(arg){this._fire("onStop",arguments);d.disconnect(e);});this._current.stop();}return this;},status:function(){return this._current?this._current.status():"stopped";},destroy:function(){if(this._onAnimateCtx){d.disconnect(this._onAnimateCtx);}if(this._onEndCtx){d.disconnect(this._onEndCtx);}}});d.extend(_bf,_bd);_4.fx.chain=function(_ca){return new _bf(_ca);};var _cb=function(_cc){this._animations=_cc||[];this._connects=[];this._finished=0;this.duration=0;d.forEach(_cc,function(a){var _cd=a.duration;if(a.delay){_cd+=a.delay;}if(this.duration<_cd){this.duration=_cd;}this._connects.push(d.connect(a,"onEnd",this,"_onEnd"));},this);this._pseudoAnimation=new d.Animation({curve:[0,1],duration:this.duration});var _ce=this;d.forEach(["beforeBegin","onBegin","onPlay","onAnimate","onPause","onStop","onEnd"],function(evt){_ce._connects.push(d.connect(_ce._pseudoAnimation,evt,function(){_ce._fire(evt,arguments);}));});};d.extend(_cb,{_doAction:function(_cf,_d0){d.forEach(this._animations,function(a){a[_cf].apply(a,_d0);});return this;},_onEnd:function(){if(++this._finished>this._animations.length){this._fire("onEnd");}},_call:function(_d1,_d2){var t=this._pseudoAnimation;t[_d1].apply(t,_d2);},play:function(_d3,_d4){this._finished=0;this._doAction("play",arguments);this._call("play",arguments);return this;},pause:function(){this._doAction("pause",arguments);this._call("pause",arguments);return this;},gotoPercent:function(_d5,_d6){var ms=this.duration*_d5;d.forEach(this._animations,function(a){a.gotoPercent(a.duration<ms?1:(ms/a.duration),_d6);});this._call("gotoPercent",arguments);return this;},stop:function(_d7){this._doAction("stop",arguments);this._call("stop",arguments);return this;},status:function(){return this._pseudoAnimation.status();},destroy:function(){d.forEach(this._connects,_4.disconnect);}});d.extend(_cb,_bd);_4.fx.combine=function(_d8){return new _cb(_d8);};_4.fx.wipeIn=function(_d9){var _da=_d9.node=d.byId(_d9.node),s=_da.style,o;var _db=d.animateProperty(d.mixin({properties:{height:{start:function(){o=s.overflow;s.overflow="hidden";if(s.visibility=="hidden"||s.display=="none"){s.height="1px";s.display="";s.visibility="";return 1;}else{var _dc=d.style(_da,"height");return Math.max(_dc,1);}},end:function(){return _da.scrollHeight;}}}},_d9));d.connect(_db,"onEnd",function(){s.height="auto";s.overflow=o;});return _db;};_4.fx.wipeOut=function(_dd){var _de=_dd.node=d.byId(_dd.node),s=_de.style,o;var _df=d.animateProperty(d.mixin({properties:{height:{end:1}}},_dd));d.connect(_df,"beforeBegin",function(){o=s.overflow;s.overflow="hidden";s.display="";});d.connect(_df,"onEnd",function(){s.overflow=o;s.height="auto";s.display="none";});return _df;};_4.fx.slideTo=function(_e0){var _e1=_e0.node=d.byId(_e0.node),top=null,_e2=null;var _e3=(function(n){return function(){var cs=d.getComputedStyle(n);var pos=cs.position;top=(pos=="absolute"?n.offsetTop:parseInt(cs.top)||0);_e2=(pos=="absolute"?n.offsetLeft:parseInt(cs.left)||0);if(pos!="absolute"&&pos!="relative"){var ret=d.position(n,true);top=ret.y;_e2=ret.x;n.style.position="absolute";n.style.top=top+"px";n.style.left=_e2+"px";}};})(_e1);_e3();var _e4=d.animateProperty(d.mixin({properties:{top:_e0.top||0,left:_e0.left||0}},_e0));d.connect(_e4,"beforeBegin",_e4,_e3);return _e4;};})();}if(!_4._hasResource["dijit._base.manager"]){_4._hasResource["dijit._base.manager"]=true;_4.provide("dijit._base.manager");_4.declare("dijit.WidgetSet",null,{constructor:function(){this._hash={};this.length=0;},add:function(_e5){if(this._hash[_e5.id]){throw new Error("Tried to register widget with id=="+_e5.id+" but that id is already registered");}this._hash[_e5.id]=_e5;this.length++;},remove:function(id){if(this._hash[id]){delete this._hash[id];this.length--;}},forEach:function(_e6,_e7){_e7=_e7||_4.global;var i=0,id;for(id in this._hash){_e6.call(_e7,this._hash[id],i++,this._hash);}return this;},filter:function(_e8,_e9){_e9=_e9||_4.global;var res=new _5.WidgetSet(),i=0,id;for(id in this._hash){var w=this._hash[id];if(_e8.call(_e9,w,i++,this._hash)){res.add(w);}}return res;},byId:function(id){return this._hash[id];},byClass:function(cls){var res=new _5.WidgetSet(),id,_ea;for(id in this._hash){_ea=this._hash[id];if(_ea.declaredClass==cls){res.add(_ea);}}return res;},toArray:function(){var ar=[];for(var id in this._hash){ar.push(this._hash[id]);}return ar;},map:function(_eb,_ec){return _4.map(this.toArray(),_eb,_ec);},every:function(_ed,_ee){_ee=_ee||_4.global;var x=0,i;for(i in this._hash){if(!_ed.call(_ee,this._hash[i],x++,this._hash)){return false;}}return true;},some:function(_ef,_f0){_f0=_f0||_4.global;var x=0,i;for(i in this._hash){if(_ef.call(_f0,this._hash[i],x++,this._hash)){return true;}}return false;}});(function(){_5.registry=new _5.WidgetSet();var _f1=_5.registry._hash,_f2=_4.attr,_f3=_4.hasAttr,_f4=_4.style;_5.byId=function(id){return typeof id=="string"?_f1[id]:id;};var _f5={};_5.getUniqueId=function(_f6){var id;do{id=_f6+"_"+(_f6 in _f5?++_f5[_f6]:_f5[_f6]=0);}while(_f1[id]);return _5._scopeName=="dijit"?id:_5._scopeName+"_"+id;};_5.findWidgets=function(_f7){var _f8=[];function _f9(_fa){for(var _fb=_fa.firstChild;_fb;_fb=_fb.nextSibling){if(_fb.nodeType==1){var _fc=_fb.getAttribute("widgetId");if(_fc){var _fd=_f1[_fc];if(_fd){_f8.push(_fd);}}else{_f9(_fb);}}}};_f9(_f7);return _f8;};_5._destroyAll=function(){_5._curFocus=null;_5._prevFocus=null;_5._activeStack=[];_4.forEach(_5.findWidgets(_4.body()),function(_fe){if(!_fe._destroyed){if(_fe.destroyRecursive){_fe.destroyRecursive();}else{if(_fe.destroy){_fe.destroy();}}}});};if(_4.isIE){_4.addOnWindowUnload(function(){_5._destroyAll();});}_5.byNode=function(_ff){return _f1[_ff.getAttribute("widgetId")];};_5.getEnclosingWidget=function(node){while(node){var id=node.getAttribute&&node.getAttribute("widgetId");if(id){return _f1[id];}node=node.parentNode;}return null;};var _100=(_5._isElementShown=function(elem){var s=_f4(elem);return (s.visibility!="hidden")&&(s.visibility!="collapsed")&&(s.display!="none")&&(_f2(elem,"type")!="hidden");});_5.hasDefaultTabStop=function(elem){switch(elem.nodeName.toLowerCase()){case "a":return _f3(elem,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return true;case "iframe":var body;try{var _101=elem.contentDocument;if("designMode" in _101&&_101.designMode=="on"){return true;}body=_101.body;}catch(e1){try{body=elem.contentWindow.document.body;}catch(e2){return false;}}return body.contentEditable=="true"||(body.firstChild&&body.firstChild.contentEditable=="true");default:return elem.contentEditable=="true";}};var _102=(_5.isTabNavigable=function(elem){if(_f2(elem,"disabled")){return false;}else{if(_f3(elem,"tabIndex")){return _f2(elem,"tabIndex")>=0;}else{return _5.hasDefaultTabStop(elem);}}});_5._getTabNavigable=function(root){var _103,last,_104,_105,_106,_107,_108={};function _109(node){return node&&node.tagName.toLowerCase()=="input"&&node.type&&node.type.toLowerCase()=="radio"&&node.name&&node.name.toLowerCase();};var _10a=function(_10b){_4.query("> *",_10b).forEach(function(_10c){if((_4.isIE&&_10c.scopeName!=="HTML")||!_100(_10c)){return;}if(_102(_10c)){var _10d=_f2(_10c,"tabIndex");if(!_f3(_10c,"tabIndex")||_10d==0){if(!_103){_103=_10c;}last=_10c;}else{if(_10d>0){if(!_104||_10d<_105){_105=_10d;_104=_10c;}if(!_106||_10d>=_107){_107=_10d;_106=_10c;}}}var rn=_109(_10c);if(_4.attr(_10c,"checked")&&rn){_108[rn]=_10c;}}if(_10c.nodeName.toUpperCase()!="SELECT"){_10a(_10c);}});};if(_100(root)){_10a(root);}function rs(node){return _108[_109(node)]||node;};return {first:rs(_103),last:rs(last),lowest:rs(_104),highest:rs(_106)};};_5.getFirstInTabbingOrder=function(root){var _10e=_5._getTabNavigable(_4.byId(root));return _10e.lowest?_10e.lowest:_10e.first;};_5.getLastInTabbingOrder=function(root){var _10f=_5._getTabNavigable(_4.byId(root));return _10f.last?_10f.last:_10f.highest;};_5.defaultDuration=_4.config["defaultDuration"]||200;})();}if(!_4._hasResource["dojo.Stateful"]){_4._hasResource["dojo.Stateful"]=true;_4.provide("dojo.Stateful");_4.declare("dojo.Stateful",null,{postscript:function(_110){if(_110){_4.mixin(this,_110);}},get:function(name){return this[name];},set:function(name,_111){if(typeof name==="object"){for(var x in name){this.set(x,name[x]);}return this;}var _112=this[name];this[name]=_111;if(this._watchCallbacks){this._watchCallbacks(name,_112,_111);}return this;},watch:function(name,_113){var _114=this._watchCallbacks;if(!_114){var self=this;_114=this._watchCallbacks=function(name,_115,_116,_117){var _118=function(_119){if(_119){_119=_119.slice();for(var i=0,l=_119.length;i<l;i++){try{_119[i].call(self,name,_115,_116);}catch(e){console.error(e);}}}};_118(_114["_"+name]);if(!_117){_118(_114["*"]);}};}if(!_113&&typeof name==="function"){_113=name;name="*";}else{name="_"+name;}var _11a=_114[name];if(typeof _11a!=="object"){_11a=_114[name]=[];}_11a.push(_113);return {unwatch:function(){_11a.splice(_4.indexOf(_11a,_113),1);}};}});}if(!_4._hasResource["dijit._WidgetBase"]){_4._hasResource["dijit._WidgetBase"]=true;_4.provide("dijit._WidgetBase");(function(){_4.declare("dijit._WidgetBase",_4.Stateful,{id:"",lang:"",dir:"","class":"",style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,attributeMap:{id:"",dir:"",lang:"","class":"",style:"",title:""},_blankGif:(_4.config.blankGif||_4.moduleUrl("dojo","resources/blank.gif")).toString(),postscript:function(_11b,_11c){this.create(_11b,_11c);},create:function(_11d,_11e){this.srcNodeRef=_4.byId(_11e);this._connects=[];this._subscribes=[];if(this.srcNodeRef&&(typeof this.srcNodeRef.id=="string")){this.id=this.srcNodeRef.id;}if(_11d){this.params=_11d;_4._mixin(this,_11d);}this.postMixInProperties();if(!this.id){this.id=_5.getUniqueId(this.declaredClass.replace(/\./g,"_"));}_5.registry.add(this);this.buildRendering();if(this.domNode){this._applyAttributes();var _11f=this.srcNodeRef;if(_11f&&_11f.parentNode&&this.domNode!==_11f){_11f.parentNode.replaceChild(this.domNode,_11f);}}if(this.domNode){this.domNode.setAttribute("widgetId",this.id);}this.postCreate();if(this.srcNodeRef&&!this.srcNodeRef.parentNode){delete this.srcNodeRef;}this._created=true;},_applyAttributes:function(){var _120=function(attr,_121){if((_121.params&&attr in _121.params)||_121[attr]){_121.set(attr,_121[attr]);}};for(var attr in this.attributeMap){_120(attr,this);}_4.forEach(this._getSetterAttributes(),function(a){if(!(a in this.attributeMap)){_120(a,this);}},this);},_getSetterAttributes:function(){var ctor=this.constructor;if(!ctor._setterAttrs){var r=(ctor._setterAttrs=[]),_122,_123=ctor.prototype;for(var _124 in _123){if(_4.isFunction(_123[_124])&&(_122=_124.match(/^_set([a-zA-Z]*)Attr$/))&&_122[1]){r.push(_122[1].charAt(0).toLowerCase()+_122[1].substr(1));}}}return ctor._setterAttrs;},postMixInProperties:function(){},buildRendering:function(){if(!this.domNode){this.domNode=this.srcNodeRef||_4.create("div");}if(this.baseClass){var _125=this.baseClass.split(" ");if(!this.isLeftToRight()){_125=_125.concat(_4.map(_125,function(name){return name+"Rtl";}));}_4.addClass(this.domNode,_125);}},postCreate:function(){},startup:function(){this._started=true;},destroyRecursive:function(_126){this._beingDestroyed=true;this.destroyDescendants(_126);this.destroy(_126);},destroy:function(_127){this._beingDestroyed=true;this.uninitialize();var d=_4,dfe=d.forEach,dun=d.unsubscribe;dfe(this._connects,function(_128){dfe(_128,d.disconnect);});dfe(this._subscribes,function(_129){dun(_129);});dfe(this._supportingWidgets||[],function(w){if(w.destroyRecursive){w.destroyRecursive();}else{if(w.destroy){w.destroy();}}});this.destroyRendering(_127);_5.registry.remove(this.id);this._destroyed=true;},destroyRendering:function(_12a){if(this.bgIframe){this.bgIframe.destroy(_12a);delete this.bgIframe;}if(this.domNode){if(_12a){_4.removeAttr(this.domNode,"widgetId");}else{_4.destroy(this.domNode);}delete this.domNode;}if(this.srcNodeRef){if(!_12a){_4.destroy(this.srcNodeRef);}delete this.srcNodeRef;}},destroyDescendants:function(_12b){_4.forEach(this.getChildren(),function(_12c){if(_12c.destroyRecursive){_12c.destroyRecursive(_12b);}});},uninitialize:function(){return false;},_setClassAttr:function(_12d){var _12e=this[this.attributeMap["class"]||"domNode"];_4.replaceClass(_12e,_12d,this["class"]);this._set("class",_12d);},_setStyleAttr:function(_12f){var _130=this[this.attributeMap.style||"domNode"];if(_4.isObject(_12f)){_4.style(_130,_12f);}else{if(_130.style.cssText){_130.style.cssText+="; "+_12f;}else{_130.style.cssText=_12f;}}this._set("style",_12f);},_attrToDom:function(attr,_131){var _132=this.attributeMap[attr];_4.forEach(_4.isArray(_132)?_132:[_132],function(_133){var _134=this[_133.node||_133||"domNode"];var type=_133.type||"attribute";switch(type){case "attribute":if(_4.isFunction(_131)){_131=_4.hitch(this,_131);}var _135=_133.attribute?_133.attribute:(/^on[A-Z][a-zA-Z]*$/.test(attr)?attr.toLowerCase():attr);_4.attr(_134,_135,_131);break;case "innerText":_134.innerHTML="";_134.appendChild(_4.doc.createTextNode(_131));break;case "innerHTML":_134.innerHTML=_131;break;case "class":_4.replaceClass(_134,_131,this[attr]);break;}},this);},get:function(name){var _136=this._getAttrNames(name);return this[_136.g]?this[_136.g]():this[name];},set:function(name,_137){if(typeof name==="object"){for(var x in name){this.set(x,name[x]);}return this;}var _138=this._getAttrNames(name);if(this[_138.s]){var _139=this[_138.s].apply(this,Array.prototype.slice.call(arguments,1));}else{if(name in this.attributeMap){this._attrToDom(name,_137);}this._set(name,_137);}return _139||this;},_attrPairNames:{},_getAttrNames:function(name){var apn=this._attrPairNames;if(apn[name]){return apn[name];}var uc=name.charAt(0).toUpperCase()+name.substr(1);return (apn[name]={n:name+"Node",s:"_set"+uc+"Attr",g:"_get"+uc+"Attr"});},_set:function(name,_13a){var _13b=this[name];this[name]=_13a;if(this._watchCallbacks&&this._created&&_13a!==_13b){this._watchCallbacks(name,_13b,_13a);}},toString:function(){return "[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]";},getDescendants:function(){return this.containerNode?_4.query("[widgetId]",this.containerNode).map(_5.byNode):[];},getChildren:function(){return this.containerNode?_5.findWidgets(this.containerNode):[];},connect:function(obj,_13c,_13d){var _13e=[_4._connect(obj,_13c,this,_13d)];this._connects.push(_13e);return _13e;},disconnect:function(_13f){for(var i=0;i<this._connects.length;i++){if(this._connects[i]==_13f){_4.forEach(_13f,_4.disconnect);this._connects.splice(i,1);return;}}},subscribe:function(_140,_141){var _142=_4.subscribe(_140,this,_141);this._subscribes.push(_142);return _142;},unsubscribe:function(_143){for(var i=0;i<this._subscribes.length;i++){if(this._subscribes[i]==_143){_4.unsubscribe(_143);this._subscribes.splice(i,1);return;}}},isLeftToRight:function(){return this.dir?(this.dir=="ltr"):_4._isBodyLtr();},placeAt:function(_144,_145){if(_144.declaredClass&&_144.addChild){_144.addChild(this,_145);}else{_4.place(this.domNode,_144,_145);}return this;}});})();}if(!_4._hasResource["dijit._base.focus"]){_4._hasResource["dijit._base.focus"]=true;_4.provide("dijit._base.focus");_4.mixin(_5,{_curFocus:null,_prevFocus:null,isCollapsed:function(){return _5.getBookmark().isCollapsed;},getBookmark:function(){var bm,rg,tg,sel=_4.doc.selection,cf=_5._curFocus;if(_4.global.getSelection){sel=_4.global.getSelection();if(sel){if(sel.isCollapsed){tg=cf?cf.tagName:"";if(tg){tg=tg.toLowerCase();if(tg=="textarea"||(tg=="input"&&(!cf.type||cf.type.toLowerCase()=="text"))){sel={start:cf.selectionStart,end:cf.selectionEnd,node:cf,pRange:true};return {isCollapsed:(sel.end<=sel.start),mark:sel};}}bm={isCollapsed:true};if(sel.rangeCount){bm.mark=sel.getRangeAt(0).cloneRange();}}else{rg=sel.getRangeAt(0);bm={isCollapsed:false,mark:rg.cloneRange()};}}}else{if(sel){tg=cf?cf.tagName:"";tg=tg.toLowerCase();if(cf&&tg&&(tg=="button"||tg=="textarea"||tg=="input")){if(sel.type&&sel.type.toLowerCase()=="none"){return {isCollapsed:true,mark:null};}else{rg=sel.createRange();return {isCollapsed:rg.text&&rg.text.length?false:true,mark:{range:rg,pRange:true}};}}bm={};try{rg=sel.createRange();bm.isCollapsed=!(sel.type=="Text"?rg.htmlText.length:rg.length);}catch(e){bm.isCollapsed=true;return bm;}if(sel.type.toUpperCase()=="CONTROL"){if(rg.length){bm.mark=[];var i=0,len=rg.length;while(i<len){bm.mark.push(rg.item(i++));}}else{bm.isCollapsed=true;bm.mark=null;}}else{bm.mark=rg.getBookmark();}}else{console.warn("No idea how to store the current selection for this browser!");}}return bm;},moveToBookmark:function(_146){var _147=_4.doc,mark=_146.mark;if(mark){if(_4.global.getSelection){var sel=_4.global.getSelection();if(sel&&sel.removeAllRanges){if(mark.pRange){var r=mark;var n=r.node;n.selectionStart=r.start;n.selectionEnd=r.end;}else{sel.removeAllRanges();sel.addRange(mark);}}else{console.warn("No idea how to restore selection for this browser!");}}else{if(_147.selection&&mark){var rg;if(mark.pRange){rg=mark.range;}else{if(_4.isArray(mark)){rg=_147.body.createControlRange();_4.forEach(mark,function(n){rg.addElement(n);});}else{rg=_147.body.createTextRange();rg.moveToBookmark(mark);}}rg.select();}}}},getFocus:function(menu,_148){var node=!_5._curFocus||(menu&&_4.isDescendant(_5._curFocus,menu.domNode))?_5._prevFocus:_5._curFocus;return {node:node,bookmark:(node==_5._curFocus)&&_4.withGlobal(_148||_4.global,_5.getBookmark),openedForWindow:_148};},focus:function(_149){if(!_149){return;}var node="node" in _149?_149.node:_149,_14a=_149.bookmark,_14b=_149.openedForWindow,_14c=_14a?_14a.isCollapsed:false;if(node){var _14d=(node.tagName.toLowerCase()=="iframe")?node.contentWindow:node;if(_14d&&_14d.focus){try{_14d.focus();}catch(e){}}_5._onFocusNode(node);}if(_14a&&_4.withGlobal(_14b||_4.global,_5.isCollapsed)&&!_14c){if(_14b){_14b.focus();}try{_4.withGlobal(_14b||_4.global,_5.moveToBookmark,null,[_14a]);}catch(e2){}}},_activeStack:[],registerIframe:function(_14e){return _5.registerWin(_14e.contentWindow,_14e);},unregisterIframe:function(_14f){_5.unregisterWin(_14f);},registerWin:function(_150,_151){var _152=function(evt){_5._justMouseDowned=true;setTimeout(function(){_5._justMouseDowned=false;},0);if(_4.isIE&&evt&&evt.srcElement&&evt.srcElement.parentNode==null){return;}_5._onTouchNode(_151||evt.target||evt.srcElement,"mouse");};var doc=_4.isIE?_150.document.documentElement:_150.document;if(doc){if(_4.isIE){_150.document.body.attachEvent("onmousedown",_152);var _153=function(evt){if(evt.srcElement.tagName.toLowerCase()!="#document"&&_5.isTabNavigable(evt.srcElement)){_5._onFocusNode(_151||evt.srcElement);}else{_5._onTouchNode(_151||evt.srcElement);}};doc.attachEvent("onactivate",_153);var _154=function(evt){_5._onBlurNode(_151||evt.srcElement);};doc.attachEvent("ondeactivate",_154);return function(){_150.document.detachEvent("onmousedown",_152);doc.detachEvent("onactivate",_153);doc.detachEvent("ondeactivate",_154);doc=null;};}else{doc.body.addEventListener("mousedown",_152,true);var _155=function(evt){_5._onFocusNode(_151||evt.target);};doc.addEventListener("focus",_155,true);var _156=function(evt){_5._onBlurNode(_151||evt.target);};doc.addEventListener("blur",_156,true);return function(){doc.body.removeEventListener("mousedown",_152,true);doc.removeEventListener("focus",_155,true);doc.removeEventListener("blur",_156,true);doc=null;};}}},unregisterWin:function(_157){_157&&_157();},_onBlurNode:function(node){_5._prevFocus=_5._curFocus;_5._curFocus=null;if(_5._justMouseDowned){return;}if(_5._clearActiveWidgetsTimer){clearTimeout(_5._clearActiveWidgetsTimer);}_5._clearActiveWidgetsTimer=setTimeout(function(){delete _5._clearActiveWidgetsTimer;_5._setStack([]);_5._prevFocus=null;},100);},_onTouchNode:function(node,by){if(_5._clearActiveWidgetsTimer){clearTimeout(_5._clearActiveWidgetsTimer);delete _5._clearActiveWidgetsTimer;}var _158=[];try{while(node){var _159=_4.attr(node,"dijitPopupParent");if(_159){node=_5.byId(_159).domNode;}else{if(node.tagName&&node.tagName.toLowerCase()=="body"){if(node===_4.body()){break;}node=_4.window.get(node.ownerDocument).frameElement;}else{var id=node.getAttribute&&node.getAttribute("widgetId"),_15a=id&&_5.byId(id);if(_15a&&!(by=="mouse"&&_15a.get("disabled"))){_158.unshift(id);}node=node.parentNode;}}}}catch(e){}_5._setStack(_158,by);},_onFocusNode:function(node){if(!node){return;}if(node.nodeType==9){return;}_5._onTouchNode(node);if(node==_5._curFocus){return;}if(_5._curFocus){_5._prevFocus=_5._curFocus;}_5._curFocus=node;_4.publish("focusNode",[node]);},_setStack:function(_15b,by){var _15c=_5._activeStack;_5._activeStack=_15b;for(var _15d=0;_15d<Math.min(_15c.length,_15b.length);_15d++){if(_15c[_15d]!=_15b[_15d]){break;}}var _15e;for(var i=_15c.length-1;i>=_15d;i--){_15e=_5.byId(_15c[i]);if(_15e){_15e._focused=false;_15e.set("focused",false);_15e._hasBeenBlurred=true;if(_15e._onBlur){_15e._onBlur(by);}_4.publish("widgetBlur",[_15e,by]);}}for(i=_15d;i<_15b.length;i++){_15e=_5.byId(_15b[i]);if(_15e){_15e._focused=true;_15e.set("focused",true);if(_15e._onFocus){_15e._onFocus(by);}_4.publish("widgetFocus",[_15e,by]);}}}});_4.addOnLoad(function(){var _15f=_5.registerWin(window);if(_4.isIE){_4.addOnWindowUnload(function(){_5.unregisterWin(_15f);_15f=null;});}});}if(!_4._hasResource["dojo.AdapterRegistry"]){_4._hasResource["dojo.AdapterRegistry"]=true;_4.provide("dojo.AdapterRegistry");_4.AdapterRegistry=function(_160){this.pairs=[];this.returnWrappers=_160||false;};_4.extend(_4.AdapterRegistry,{register:function(name,_161,wrap,_162,_163){this.pairs[((_163)?"unshift":"push")]([name,_161,wrap,_162]);},match:function(){for(var i=0;i<this.pairs.length;i++){var pair=this.pairs[i];if(pair[1].apply(this,arguments)){if((pair[3])||(this.returnWrappers)){return pair[2];}else{return pair[2].apply(this,arguments);}}}throw new Error("No match found");},unregister:function(name){for(var i=0;i<this.pairs.length;i++){var pair=this.pairs[i];if(pair[0]==name){this.pairs.splice(i,1);return true;}}return false;}});}if(!_4._hasResource["dijit._base.place"]){_4._hasResource["dijit._base.place"]=true;_4.provide("dijit._base.place");_5.getViewport=function(){return _4.window.getBox();};_5.placeOnScreen=function(node,pos,_164,_165){var _166=_4.map(_164,function(_167){var c={corner:_167,pos:{x:pos.x,y:pos.y}};if(_165){c.pos.x+=_167.charAt(1)=="L"?_165.x:-_165.x;c.pos.y+=_167.charAt(0)=="T"?_165.y:-_165.y;}return c;});return _5._place(node,_166);};_5._place=function(node,_168,_169,_16a){var view=_4.window.getBox();if(!node.parentNode||String(node.parentNode.tagName).toLowerCase()!="body"){_4.body().appendChild(node);}var best=null;_4.some(_168,function(_16b){var _16c=_16b.corner;var pos=_16b.pos;var _16d=0;var _16e={w:_16c.charAt(1)=="L"?(view.l+view.w)-pos.x:pos.x-view.l,h:_16c.charAt(1)=="T"?(view.t+view.h)-pos.y:pos.y-view.t};if(_169){var res=_169(node,_16b.aroundCorner,_16c,_16e,_16a);_16d=typeof res=="undefined"?0:res;}var _16f=node.style;var _170=_16f.display;var _171=_16f.visibility;_16f.visibility="hidden";_16f.display="";var mb=_4.marginBox(node);_16f.display=_170;_16f.visibility=_171;var _172=Math.max(view.l,_16c.charAt(1)=="L"?pos.x:(pos.x-mb.w)),_173=Math.max(view.t,_16c.charAt(0)=="T"?pos.y:(pos.y-mb.h)),endX=Math.min(view.l+view.w,_16c.charAt(1)=="L"?(_172+mb.w):pos.x),endY=Math.min(view.t+view.h,_16c.charAt(0)=="T"?(_173+mb.h):pos.y),_174=endX-_172,_175=endY-_173;_16d+=(mb.w-_174)+(mb.h-_175);if(best==null||_16d<best.overflow){best={corner:_16c,aroundCorner:_16b.aroundCorner,x:_172,y:_173,w:_174,h:_175,overflow:_16d,spaceAvailable:_16e};}return !_16d;});if(best.overflow&&_169){_169(node,best.aroundCorner,best.corner,best.spaceAvailable,_16a);}var l=_4._isBodyLtr(),s=node.style;s.top=best.y+"px";s[l?"left":"right"]=(l?best.x:view.w-best.x-best.w)+"px";return best;};_5.placeOnScreenAroundNode=function(node,_176,_177,_178){_176=_4.byId(_176);var _179=_4.position(_176,true);return _5._placeOnScreenAroundRect(node,_179.x,_179.y,_179.w,_179.h,_177,_178);};_5.placeOnScreenAroundRectangle=function(node,_17a,_17b,_17c){return _5._placeOnScreenAroundRect(node,_17a.x,_17a.y,_17a.width,_17a.height,_17b,_17c);};_5._placeOnScreenAroundRect=function(node,x,y,_17d,_17e,_17f,_180){var _181=[];for(var _182 in _17f){_181.push({aroundCorner:_182,corner:_17f[_182],pos:{x:x+(_182.charAt(1)=="L"?0:_17d),y:y+(_182.charAt(0)=="T"?0:_17e)}});}return _5._place(node,_181,_180,{w:_17d,h:_17e});};_5.placementRegistry=new _4.AdapterRegistry();_5.placementRegistry.register("node",function(n,x){return typeof x=="object"&&typeof x.offsetWidth!="undefined"&&typeof x.offsetHeight!="undefined";},_5.placeOnScreenAroundNode);_5.placementRegistry.register("rect",function(n,x){return typeof x=="object"&&"x" in x&&"y" in x&&"width" in x&&"height" in x;},_5.placeOnScreenAroundRectangle);_5.placeOnScreenAroundElement=function(node,_183,_184,_185){return _5.placementRegistry.match.apply(_5.placementRegistry,arguments);};_5.getPopupAroundAlignment=function(_186,_187){var _188={};_4.forEach(_186,function(pos){switch(pos){case "after":_188[_187?"BR":"BL"]=_187?"BL":"BR";break;case "before":_188[_187?"BL":"BR"]=_187?"BR":"BL";break;case "below-alt":_187=!_187;case "below":_188[_187?"BL":"BR"]=_187?"TL":"TR";_188[_187?"BR":"BL"]=_187?"TR":"TL";break;case "above-alt":_187=!_187;case "above":default:_188[_187?"TL":"TR"]=_187?"BL":"BR";_188[_187?"TR":"TL"]=_187?"BR":"BL";break;}});return _188;};}if(!_4._hasResource["dijit._base.window"]){_4._hasResource["dijit._base.window"]=true;_4.provide("dijit._base.window");_5.getDocumentWindow=function(doc){return _4.window.get(doc);};}if(!_4._hasResource["dijit._base.popup"]){_4._hasResource["dijit._base.popup"]=true;_4.provide("dijit._base.popup");_5.popup={_stack:[],_beginZIndex:1000,_idGen:1,_createWrapper:function(_189){var _18a=_189.declaredClass?_189._popupWrapper:(_189.parentNode&&_4.hasClass(_189.parentNode,"dijitPopup")),node=_189.domNode||_189;if(!_18a){_18a=_4.create("div",{"class":"dijitPopup",style:{display:"none"},role:"presentation"},_4.body());_18a.appendChild(node);var s=node.style;s.display="";s.visibility="";s.position="";s.top="0px";if(_189.declaredClass){_189._popupWrapper=_18a;_4.connect(_189,"destroy",function(){_4.destroy(_18a);delete _189._popupWrapper;});}}return _18a;},moveOffScreen:function(_18b){var _18c=this._createWrapper(_18b);_4.style(_18c,{visibility:"hidden",top:"-9999px",display:""});},hide:function(_18d){var _18e=this._createWrapper(_18d);_4.style(_18e,"display","none");},getTopPopup:function(){var _18f=this._stack;for(var pi=_18f.length-1;pi>0&&_18f[pi].parent===_18f[pi-1].widget;pi--){}return _18f[pi];},open:function(args){var _190=this._stack,_191=args.popup,_192=args.orient||((args.parent?args.parent.isLeftToRight():_4._isBodyLtr())?{"BL":"TL","BR":"TR","TL":"BL","TR":"BR"}:{"BR":"TR","BL":"TL","TR":"BR","TL":"BL"}),_193=args.around,id=(args.around&&args.around.id)?(args.around.id+"_dropdown"):("popup_"+this._idGen++);while(_190.length&&(!args.parent||!_4.isDescendant(args.parent.domNode,_190[_190.length-1].widget.domNode))){_5.popup.close(_190[_190.length-1].widget);}var _194=this._createWrapper(_191);_4.attr(_194,{id:id,style:{zIndex:this._beginZIndex+_190.length},"class":"dijitPopup "+(_191.baseClass||_191["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:args.parent?args.parent.id:""});if(_4.isIE||_4.isMoz){if(!_191.bgIframe){_191.bgIframe=new _5.BackgroundIframe(_194);}}var best=_193?_5.placeOnScreenAroundElement(_194,_193,_192,_191.orient?_4.hitch(_191,"orient"):null):_5.placeOnScreen(_194,args,_192=="R"?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],args.padding);_194.style.display="";_194.style.visibility="visible";_191.domNode.style.visibility="visible";var _195=[];_195.push(_4.connect(_194,"onkeypress",this,function(evt){if(evt.charOrCode==_4.keys.ESCAPE&&args.onCancel){_4.stopEvent(evt);args.onCancel();}else{if(evt.charOrCode===_4.keys.TAB){_4.stopEvent(evt);var _196=this.getTopPopup();if(_196&&_196.onCancel){_196.onCancel();}}}}));if(_191.onCancel){_195.push(_4.connect(_191,"onCancel",args.onCancel));}_195.push(_4.connect(_191,_191.onExecute?"onExecute":"onChange",this,function(){var _197=this.getTopPopup();if(_197&&_197.onExecute){_197.onExecute();}}));_190.push({widget:_191,parent:args.parent,onExecute:args.onExecute,onCancel:args.onCancel,onClose:args.onClose,handlers:_195});if(_191.onOpen){_191.onOpen(best);}return best;},close:function(_198){var _199=this._stack;while((_198&&_4.some(_199,function(elem){return elem.widget==_198;}))||(!_198&&_199.length)){var top=_199.pop(),_19a=top.widget,_19b=top.onClose;if(_19a.onClose){_19a.onClose();}_4.forEach(top.handlers,_4.disconnect);if(_19a&&_19a.domNode){this.hide(_19a);}if(_19b){_19b();}}}};_5._frames=new function(){var _19c=[];this.pop=function(){var _19d;if(_19c.length){_19d=_19c.pop();_19d.style.display="";}else{if(_4.isIE<9){var burl=_4.config["dojoBlankHtmlUrl"]||(_4.moduleUrl("dojo","resources/blank.html")+"")||"javascript:\"\"";var html="<iframe src='"+burl+"'"+" style='position: absolute; left: 0px; top: 0px;"+"z-index: -1; filter:Alpha(Opacity=\"0\");'>";_19d=_4.doc.createElement(html);}else{_19d=_4.create("iframe");_19d.src="javascript:\"\"";_19d.className="dijitBackgroundIframe";_4.style(_19d,"opacity",0.1);}_19d.tabIndex=-1;_5.setWaiRole(_19d,"presentation");}return _19d;};this.push=function(_19e){_19e.style.display="none";_19c.push(_19e);};}();_5.BackgroundIframe=function(node){if(!node.id){throw new Error("no id");}if(_4.isIE||_4.isMoz){var _19f=(this.iframe=_5._frames.pop());node.appendChild(_19f);if(_4.isIE<7||_4.isQuirks){this.resize(node);this._conn=_4.connect(node,"onresize",this,function(){this.resize(node);});}else{_4.style(_19f,{width:"100%",height:"100%"});}}};_4.extend(_5.BackgroundIframe,{resize:function(node){if(this.iframe){_4.style(this.iframe,{width:node.offsetWidth+"px",height:node.offsetHeight+"px"});}},destroy:function(){if(this._conn){_4.disconnect(this._conn);this._conn=null;}if(this.iframe){_5._frames.push(this.iframe);delete this.iframe;}}});}if(!_4._hasResource["dijit._base.scroll"]){_4._hasResource["dijit._base.scroll"]=true;_4.provide("dijit._base.scroll");_5.scrollIntoView=function(node,pos){_4.window.scrollIntoView(node,pos);};}if(!_4._hasResource["dojo.uacss"]){_4._hasResource["dojo.uacss"]=true;_4.provide("dojo.uacss");(function(){var d=_4,html=d.doc.documentElement,ie=d.isIE,_1a0=d.isOpera,maj=Math.floor,ff=d.isFF,_1a1=d.boxModel.replace(/-/,""),_1a2={dj_ie:ie,dj_ie6:maj(ie)==6,dj_ie7:maj(ie)==7,dj_ie8:maj(ie)==8,dj_ie9:maj(ie)==9,dj_quirks:d.isQuirks,dj_iequirks:ie&&d.isQuirks,dj_opera:_1a0,dj_khtml:d.isKhtml,dj_webkit:d.isWebKit,dj_safari:d.isSafari,dj_chrome:d.isChrome,dj_gecko:d.isMozilla,dj_ff3:maj(ff)==3};_1a2["dj_"+_1a1]=true;var _1a3="";for(var clz in _1a2){if(_1a2[clz]){_1a3+=clz+" ";}}html.className=d.trim(html.className+" "+_1a3);_4._loaders.unshift(function(){if(!_4._isBodyLtr()){var _1a4="dj_rtl dijitRtl "+_1a3.replace(/ /g,"-rtl ");html.className=d.trim(html.className+" "+_1a4);}});})();}if(!_4._hasResource["dijit._base.sniff"]){_4._hasResource["dijit._base.sniff"]=true;_4.provide("dijit._base.sniff");}if(!_4._hasResource["dijit._base.typematic"]){_4._hasResource["dijit._base.typematic"]=true;_4.provide("dijit._base.typematic");_5.typematic={_fireEventAndReload:function(){this._timer=null;this._callback(++this._count,this._node,this._evt);this._currentTimeout=Math.max(this._currentTimeout<0?this._initialDelay:(this._subsequentDelay>1?this._subsequentDelay:Math.round(this._currentTimeout*this._subsequentDelay)),this._minDelay);this._timer=setTimeout(_4.hitch(this,"_fireEventAndReload"),this._currentTimeout);},trigger:function(evt,_1a5,node,_1a6,obj,_1a7,_1a8,_1a9){if(obj!=this._obj){this.stop();this._initialDelay=_1a8||500;this._subsequentDelay=_1a7||0.9;this._minDelay=_1a9||10;this._obj=obj;this._evt=evt;this._node=node;this._currentTimeout=-1;this._count=-1;this._callback=_4.hitch(_1a5,_1a6);this._fireEventAndReload();this._evt=_4.mixin({faux:true},evt);}},stop:function(){if(this._timer){clearTimeout(this._timer);this._timer=null;}if(this._obj){this._callback(-1,this._node,this._evt);this._obj=null;}},addKeyListener:function(node,_1aa,_1ab,_1ac,_1ad,_1ae,_1af){if(_1aa.keyCode){_1aa.charOrCode=_1aa.keyCode;_4.deprecated("keyCode attribute parameter for dijit.typematic.addKeyListener is deprecated. Use charOrCode instead.","","2.0");}else{if(_1aa.charCode){_1aa.charOrCode=String.fromCharCode(_1aa.charCode);_4.deprecated("charCode attribute parameter for dijit.typematic.addKeyListener is deprecated. Use charOrCode instead.","","2.0");}}return [_4.connect(node,"onkeypress",this,function(evt){if(evt.charOrCode==_1aa.charOrCode&&(_1aa.ctrlKey===undefined||_1aa.ctrlKey==evt.ctrlKey)&&(_1aa.altKey===undefined||_1aa.altKey==evt.altKey)&&(_1aa.metaKey===undefined||_1aa.metaKey==(evt.metaKey||false))&&(_1aa.shiftKey===undefined||_1aa.shiftKey==evt.shiftKey)){_4.stopEvent(evt);_5.typematic.trigger(evt,_1ab,node,_1ac,_1aa,_1ad,_1ae,_1af);}else{if(_5.typematic._obj==_1aa){_5.typematic.stop();}}}),_4.connect(node,"onkeyup",this,function(evt){if(_5.typematic._obj==_1aa){_5.typematic.stop();}})];},addMouseListener:function(node,_1b0,_1b1,_1b2,_1b3,_1b4){var dc=_4.connect;return [dc(node,"mousedown",this,function(evt){_4.stopEvent(evt);_5.typematic.trigger(evt,_1b0,node,_1b1,node,_1b2,_1b3,_1b4);}),dc(node,"mouseup",this,function(evt){_4.stopEvent(evt);_5.typematic.stop();}),dc(node,"mouseout",this,function(evt){_4.stopEvent(evt);_5.typematic.stop();}),dc(node,"mousemove",this,function(evt){evt.preventDefault();}),dc(node,"dblclick",this,function(evt){_4.stopEvent(evt);if(_4.isIE){_5.typematic.trigger(evt,_1b0,node,_1b1,node,_1b2,_1b3,_1b4);setTimeout(_4.hitch(this,_5.typematic.stop),50);}})];},addListener:function(_1b5,_1b6,_1b7,_1b8,_1b9,_1ba,_1bb,_1bc){return this.addKeyListener(_1b6,_1b7,_1b8,_1b9,_1ba,_1bb,_1bc).concat(this.addMouseListener(_1b5,_1b8,_1b9,_1ba,_1bb,_1bc));}};}if(!_4._hasResource["dijit._base.wai"]){_4._hasResource["dijit._base.wai"]=true;_4.provide("dijit._base.wai");_5.wai={onload:function(){var div=_4.create("div",{id:"a11yTestNode",style:{cssText:"border: 1px solid;"+"border-color:red green;"+"position: absolute;"+"height: 5px;"+"top: -999px;"+"background-image: url(\""+(_4.config.blankGif||_4.moduleUrl("dojo","resources/blank.gif"))+"\");"}},_4.body());var cs=_4.getComputedStyle(div);if(cs){var _1bd=cs.backgroundImage;var _1be=(cs.borderTopColor==cs.borderRightColor)||(_1bd!=null&&(_1bd=="none"||_1bd=="url(invalid-url:)"));_4[_1be?"addClass":"removeClass"](_4.body(),"dijit_a11y");if(_4.isIE){div.outerHTML="";}else{_4.body().removeChild(div);}}}};if(_4.isIE||_4.isMoz){_4._loaders.unshift(_5.wai.onload);}_4.mixin(_5,{hasWaiRole:function(elem,role){var _1bf=this.getWaiRole(elem);return role?(_1bf.indexOf(role)>-1):(_1bf.length>0);},getWaiRole:function(elem){return _4.trim((_4.attr(elem,"role")||"").replace("wairole:",""));},setWaiRole:function(elem,role){_4.attr(elem,"role",role);},removeWaiRole:function(elem,role){var _1c0=_4.attr(elem,"role");if(!_1c0){return;}if(role){var t=_4.trim((" "+_1c0+" ").replace(" "+role+" "," "));_4.attr(elem,"role",t);}else{elem.removeAttribute("role");}},hasWaiState:function(elem,_1c1){return elem.hasAttribute?elem.hasAttribute("aria-"+_1c1):!!elem.getAttribute("aria-"+_1c1);},getWaiState:function(elem,_1c2){return elem.getAttribute("aria-"+_1c2)||"";},setWaiState:function(elem,_1c3,_1c4){elem.setAttribute("aria-"+_1c3,_1c4);},removeWaiState:function(elem,_1c5){elem.removeAttribute("aria-"+_1c5);}});}if(!_4._hasResource["dijit._base"]){_4._hasResource["dijit._base"]=true;_4.provide("dijit._base");}if(!_4._hasResource["dijit._Widget"]){_4._hasResource["dijit._Widget"]=true;_4.provide("dijit._Widget");_4.connect(_4,"_connect",function(_1c6,_1c7){if(_1c6&&_4.isFunction(_1c6._onConnect)){_1c6._onConnect(_1c7);}});_5._connectOnUseEventHandler=function(_1c8){};_5._lastKeyDownNode=null;if(_4.isIE){(function(){var _1c9=function(evt){_5._lastKeyDownNode=evt.srcElement;};_4.doc.attachEvent("onkeydown",_1c9);_4.addOnWindowUnload(function(){_4.doc.detachEvent("onkeydown",_1c9);});})();}else{_4.doc.addEventListener("keydown",function(evt){_5._lastKeyDownNode=evt.target;},true);}(function(){_4.declare("dijit._Widget",_5._WidgetBase,{_deferredConnects:{onClick:"",onDblClick:"",onKeyDown:"",onKeyPress:"",onKeyUp:"",onMouseMove:"",onMouseDown:"",onMouseOut:"",onMouseOver:"",onMouseLeave:"",onMouseEnter:"",onMouseUp:""},onClick:_5._connectOnUseEventHandler,onDblClick:_5._connectOnUseEventHandler,onKeyDown:_5._connectOnUseEventHandler,onKeyPress:_5._connectOnUseEventHandler,onKeyUp:_5._connectOnUseEventHandler,onMouseDown:_5._connectOnUseEventHandler,onMouseMove:_5._connectOnUseEventHandler,onMouseOut:_5._connectOnUseEventHandler,onMouseOver:_5._connectOnUseEventHandler,onMouseLeave:_5._connectOnUseEventHandler,onMouseEnter:_5._connectOnUseEventHandler,onMouseUp:_5._connectOnUseEventHandler,create:function(_1ca,_1cb){this._deferredConnects=_4.clone(this._deferredConnects);for(var attr in this.attributeMap){delete this._deferredConnects[attr];}for(attr in this._deferredConnects){if(this[attr]!==_5._connectOnUseEventHandler){delete this._deferredConnects[attr];}}this.inherited(arguments);if(this.domNode){for(attr in this.params){this._onConnect(attr);}}},_onConnect:function(_1cc){if(_1cc in this._deferredConnects){var _1cd=this[this._deferredConnects[_1cc]||"domNode"];this.connect(_1cd,_1cc.toLowerCase(),_1cc);delete this._deferredConnects[_1cc];}},focused:false,isFocusable:function(){return this.focus&&(_4.style(this.domNode,"display")!="none");},onFocus:function(){},onBlur:function(){},_onFocus:function(e){this.onFocus();},_onBlur:function(){this.onBlur();},setAttribute:function(attr,_1ce){_4.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(attr,_1ce);},attr:function(name,_1cf){if(_4.config.isDebug){var _1d0=arguments.callee._ach||(arguments.callee._ach={}),_1d1=(arguments.callee.caller||"unknown caller").toString();if(!_1d0[_1d1]){_4.deprecated(this.declaredClass+"::attr() is deprecated. Use get() or set() instead, called from "+_1d1,"","2.0");_1d0[_1d1]=true;}}var args=arguments.length;if(args>=2||typeof name==="object"){return this.set.apply(this,arguments);}else{return this.get(name);}},nodesWithKeyClick:["input","button"],connect:function(obj,_1d2,_1d3){var d=_4,dc=d._connect,_1d4=this.inherited(arguments,[obj,_1d2=="ondijitclick"?"onclick":_1d2,_1d3]);if(_1d2=="ondijitclick"){if(d.indexOf(this.nodesWithKeyClick,obj.nodeName.toLowerCase())==-1){var m=d.hitch(this,_1d3);_1d4.push(dc(obj,"onkeydown",this,function(e){if((e.keyCode==d.keys.ENTER||e.keyCode==d.keys.SPACE)&&!e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey){_5._lastKeyDownNode=e.target;if(!("openDropDown" in this&&obj==this._buttonNode)){e.preventDefault();}}}),dc(obj,"onkeyup",this,function(e){if((e.keyCode==d.keys.ENTER||e.keyCode==d.keys.SPACE)&&e.target==_5._lastKeyDownNode&&!e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey){_5._lastKeyDownNode=null;return m(e);}}));}}return _1d4;},_onShow:function(){this.onShow();},onShow:function(){},onHide:function(){},onClose:function(){return true;}});})();}if(!_4._hasResource["dojo.string"]){_4._hasResource["dojo.string"]=true;_4.provide("dojo.string");_4.getObject("string",true,_4);_4.string.rep=function(str,num){if(num<=0||!str){return "";}var buf=[];for(;;){if(num&1){buf.push(str);}if(!(num>>=1)){break;}str+=str;}return buf.join("");};_4.string.pad=function(text,size,ch,end){if(!ch){ch="0";}var out=String(text),pad=_4.string.rep(ch,Math.ceil((size-out.length)/ch.length));return end?out+pad:pad+out;};_4.string.substitute=function(_1d5,map,_1d6,_1d7){_1d7=_1d7||_4.global;_1d6=_1d6?_4.hitch(_1d7,_1d6):function(v){return v;};return _1d5.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(_1d8,key,_1d9){var _1da=_4.getObject(key,false,map);if(_1d9){_1da=_4.getObject(_1d9,false,_1d7).call(_1d7,_1da,key);}return _1d6(_1da,key).toString();});};_4.string.trim=String.prototype.trim?_4.trim:function(str){str=str.replace(/^\s+/,"");for(var i=str.length-1;i>=0;i--){if(/\S/.test(str.charAt(i))){str=str.substring(0,i+1);break;}}return str;};}if(!_4._hasResource["dojo.date.stamp"]){_4._hasResource["dojo.date.stamp"]=true;_4.provide("dojo.date.stamp");_4.getObject("date.stamp",true,_4);_4.date.stamp.fromISOString=function(_1db,_1dc){if(!_4.date.stamp._isoRegExp){_4.date.stamp._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/;}var _1dd=_4.date.stamp._isoRegExp.exec(_1db),_1de=null;if(_1dd){_1dd.shift();if(_1dd[1]){_1dd[1]--;}if(_1dd[6]){_1dd[6]*=1000;}if(_1dc){_1dc=new Date(_1dc);_4.forEach(_4.map(["FullYear","Month","Date","Hours","Minutes","Seconds","Milliseconds"],function(prop){return _1dc["get"+prop]();}),function(_1df,_1e0){_1dd[_1e0]=_1dd[_1e0]||_1df;});}_1de=new Date(_1dd[0]||1970,_1dd[1]||0,_1dd[2]||1,_1dd[3]||0,_1dd[4]||0,_1dd[5]||0,_1dd[6]||0);if(_1dd[0]<100){_1de.setFullYear(_1dd[0]||1970);}var _1e1=0,_1e2=_1dd[7]&&_1dd[7].charAt(0);if(_1e2!="Z"){_1e1=((_1dd[8]||0)*60)+(Number(_1dd[9])||0);if(_1e2!="-"){_1e1*=-1;}}if(_1e2){_1e1-=_1de.getTimezoneOffset();}if(_1e1){_1de.setTime(_1de.getTime()+_1e1*60000);}}return _1de;};_4.date.stamp.toISOString=function(_1e3,_1e4){var _1e5=function(n){return (n<10)?"0"+n:n;};_1e4=_1e4||{};var _1e6=[],_1e7=_1e4.zulu?"getUTC":"get",date="";if(_1e4.selector!="time"){var year=_1e3[_1e7+"FullYear"]();date=["0000".substr((year+"").length)+year,_1e5(_1e3[_1e7+"Month"]()+1),_1e5(_1e3[_1e7+"Date"]())].join("-");}_1e6.push(date);if(_1e4.selector!="date"){var time=[_1e5(_1e3[_1e7+"Hours"]()),_1e5(_1e3[_1e7+"Minutes"]()),_1e5(_1e3[_1e7+"Seconds"]())].join(":");var _1e8=_1e3[_1e7+"Milliseconds"]();if(_1e4.milliseconds){time+="."+(_1e8<100?"0":"")+_1e5(_1e8);}if(_1e4.zulu){time+="Z";}else{if(_1e4.selector!="time"){var _1e9=_1e3.getTimezoneOffset();var _1ea=Math.abs(_1e9);time+=(_1e9>0?"-":"+")+_1e5(Math.floor(_1ea/60))+":"+_1e5(_1ea%60);}}_1e6.push(time);}return _1e6.join("T");};}if(!_4._hasResource["dojo.parser"]){_4._hasResource["dojo.parser"]=true;_4.provide("dojo.parser");new Date("X");_4.parser=new function(){var d=_4;function _1eb(_1ec){if(d.isString(_1ec)){return "string";}if(typeof _1ec=="number"){return "number";}if(typeof _1ec=="boolean"){return "boolean";}if(d.isFunction(_1ec)){return "function";}if(d.isArray(_1ec)){return "array";}if(_1ec instanceof Date){return "date";}if(_1ec instanceof d._Url){return "url";}return "object";};function _1ed(_1ee,type){switch(type){case "string":return _1ee;case "number":return _1ee.length?Number(_1ee):NaN;case "boolean":return typeof _1ee=="boolean"?_1ee:!(_1ee.toLowerCase()=="false");case "function":if(d.isFunction(_1ee)){_1ee=_1ee.toString();_1ee=d.trim(_1ee.substring(_1ee.indexOf("{")+1,_1ee.length-1));}try{if(_1ee===""||_1ee.search(/[^\w\.]+/i)!=-1){return new Function(_1ee);}else{return d.getObject(_1ee,false)||new Function(_1ee);}}catch(e){return new Function();}case "array":return _1ee?_1ee.split(/\s*,\s*/):[];case "date":switch(_1ee){case "":return new Date("");case "now":return new Date();default:return d.date.stamp.fromISOString(_1ee);}case "url":return d.baseUrl+_1ee;default:return d.fromJson(_1ee);}};var _1ef={},_1f0={};d.connect(d,"extend",function(){_1f0={};});function _1f1(cls,_1f2){for(var name in cls){if(name.charAt(0)=="_"){continue;}if(name in _1ef){continue;}_1f2[name]=_1eb(cls[name]);}return _1f2;};function _1f3(_1f4,_1f5){var c=_1f0[_1f4];if(!c){var cls=d.getObject(_1f4),_1f6=null;if(!cls){return null;}if(!_1f5){_1f6=_1f1(cls.prototype,{});}c={cls:cls,params:_1f6};}else{if(!_1f5&&!c.params){c.params=_1f1(c.cls.prototype,{});}}return c;};this._functionFromScript=function(_1f7,_1f8){var _1f9="";var _1fa="";var _1fb=(_1f7.getAttribute(_1f8+"args")||_1f7.getAttribute("args"));if(_1fb){d.forEach(_1fb.split(/\s*,\s*/),function(part,idx){_1f9+="var "+part+" = arguments["+idx+"]; ";});}var _1fc=_1f7.getAttribute("with");if(_1fc&&_1fc.length){d.forEach(_1fc.split(/\s*,\s*/),function(part){_1f9+="with("+part+"){";_1fa+="}";});}return new Function(_1f9+_1f7.innerHTML+_1fa);};this.instantiate=function(_1fd,_1fe,args){var _1ff=[],_1fe=_1fe||{};args=args||{};var _200=(args.scope||d._scopeName)+"Type",_201="data-"+(args.scope||d._scopeName)+"-";d.forEach(_1fd,function(obj){if(!obj){return;}var node,type,_202,_203,_204,_205;if(obj.node){node=obj.node;type=obj.type;_205=obj.fastpath;_202=obj.clsInfo||(type&&_1f3(type,_205));_203=_202&&_202.cls;_204=obj.scripts;}else{node=obj;type=_200 in _1fe?_1fe[_200]:node.getAttribute(_200);_202=type&&_1f3(type);_203=_202&&_202.cls;_204=(_203&&(_203._noScript||_203.prototype._noScript)?[]:d.query("> script[type^='dojo/']",node));}if(!_202){throw new Error("Could not load class '"+type);}var _206={};if(args.defaults){d._mixin(_206,args.defaults);}if(obj.inherited){d._mixin(_206,obj.inherited);}if(_205){var _207=node.getAttribute(_201+"props");if(_207&&_207.length){try{_207=d.fromJson.call(args.propsThis,"{"+_207+"}");d._mixin(_206,_207);}catch(e){throw new Error(e.toString()+" in data-dojo-props='"+_207+"'");}}var _208=node.getAttribute(_201+"attach-point");if(_208){_206.dojoAttachPoint=_208;}var _209=node.getAttribute(_201+"attach-event");if(_209){_206.dojoAttachEvent=_209;}_4.mixin(_206,_1fe);}else{var _20a=node.attributes;for(var name in _202.params){var item=name in _1fe?{value:_1fe[name],specified:true}:_20a.getNamedItem(name);if(!item||(!item.specified&&(!_4.isIE||name.toLowerCase()!="value"))){continue;}var _20b=item.value;switch(name){case "class":_20b="className" in _1fe?_1fe.className:node.className;break;case "style":_20b="style" in _1fe?_1fe.style:(node.style&&node.style.cssText);}var _20c=_202.params[name];if(typeof _20b=="string"){_206[name]=_1ed(_20b,_20c);}else{_206[name]=_20b;}}}var _20d=[],_20e=[];d.forEach(_204,function(_20f){node.removeChild(_20f);var _210=(_20f.getAttribute(_201+"event")||_20f.getAttribute("event")),type=_20f.getAttribute("type"),nf=d.parser._functionFromScript(_20f,_201);if(_210){if(type=="dojo/connect"){_20d.push({event:_210,func:nf});}else{_206[_210]=nf;}}else{_20e.push(nf);}});var _211=_203.markupFactory||_203.prototype&&_203.prototype.markupFactory;var _212=_211?_211(_206,node,_203):new _203(_206,node);_1ff.push(_212);var _213=(node.getAttribute(_201+"id")||node.getAttribute("jsId"));if(_213){d.setObject(_213,_212);}d.forEach(_20d,function(_214){d.connect(_212,_214.event,null,_214.func);});d.forEach(_20e,function(func){func.call(_212);});});if(!_1fe._started){d.forEach(_1ff,function(_215){if(!args.noStart&&_215&&_4.isFunction(_215.startup)&&!_215._started&&(!_215.getParent||!_215.getParent())){_215.startup();}});}return _1ff;};this.parse=function(_216,args){var root;if(!args&&_216&&_216.rootNode){args=_216;root=args.rootNode;}else{root=_216;}root=root?_4.byId(root):_4.body();args=args||{};var _217=(args.scope||d._scopeName)+"Type",_218="data-"+(args.scope||d._scopeName)+"-";function scan(_219,list){var _21a=_4.clone(_219.inherited);_4.forEach(["dir","lang"],function(name){var val=_219.node.getAttribute(name);if(val){_21a[name]=val;}});var _21b=_219.clsInfo&&!_219.clsInfo.cls.prototype._noScript?_219.scripts:null;var _21c=(!_219.clsInfo||!_219.clsInfo.cls.prototype.stopParser)||(args&&args.template);for(var _21d=_219.node.firstChild;_21d;_21d=_21d.nextSibling){if(_21d.nodeType==1){var type,_21e=_21c&&_21d.getAttribute(_218+"type");if(_21e){type=_21e;}else{type=_21c&&_21d.getAttribute(_217);}var _21f=_21e==type;if(type){var _220={"type":type,fastpath:_21f,clsInfo:_1f3(type,_21f),node:_21d,scripts:[],inherited:_21a};list.push(_220);scan(_220,list);}else{if(_21b&&_21d.nodeName.toLowerCase()=="script"){type=_21d.getAttribute("type");if(type&&/^dojo\/\w/i.test(type)){_21b.push(_21d);}}else{if(_21c){scan({node:_21d,inherited:_21a},list);}}}}}};var _221={};if(args&&args.inherited){for(var key in args.inherited){if(args.inherited[key]){_221[key]=args.inherited[key];}}}var list=[];scan({node:root,inherited:_221},list);var _222=args&&args.template?{template:true}:null;return this.instantiate(list,_222,args);};}();(function(){var _223=function(){if(_4.config.parseOnLoad){_4.parser.parse();}};if(_4.getObject("dijit.wai.onload")===_4._loaders[0]){_4._loaders.splice(1,0,_223);}else{_4._loaders.unshift(_223);}})();}if(!_4._hasResource["dojo.cache"]){_4._hasResource["dojo.cache"]=true;_4.provide("dojo.cache");var _224={};_4.cache=function(_225,url,_226){if(typeof _225=="string"){var _227=_4.moduleUrl(_225,url);}else{_227=_225;_226=url;}var key=_227.toString();var val=_226;if(_226!=undefined&&!_4.isString(_226)){val=("value" in _226?_226.value:undefined);}var _228=_226&&_226.sanitize?true:false;if(typeof val=="string"){val=_224[key]=_228?_4.cache._sanitize(val):val;}else{if(val===null){delete _224[key];}else{if(!(key in _224)){val=_4._getText(key);_224[key]=_228?_4.cache._sanitize(val):val;}val=_224[key];}}return val;};_4.cache._sanitize=function(val){if(val){val=val.replace(/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,"");var _229=val.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);if(_229){val=_229[1];}}else{val="";}return val;};}if(!_4._hasResource["dijit._Templated"]){_4._hasResource["dijit._Templated"]=true;_4.provide("dijit._Templated");_4.declare("dijit._Templated",null,{templateString:null,templatePath:null,widgetsInTemplate:false,_skipNodeCache:false,_earlyTemplatedStartup:false,constructor:function(){this._attachPoints=[];this._attachEvents=[];},_stringRepl:function(tmpl){var _22a=this.declaredClass,_22b=this;return _4.string.substitute(tmpl,this,function(_22c,key){if(key.charAt(0)=="!"){_22c=_4.getObject(key.substr(1),false,_22b);}if(typeof _22c=="undefined"){throw new Error(_22a+" template:"+key);}if(_22c==null){return "";}return key.charAt(0)=="!"?_22c:_22c.toString().replace(/"/g,"&quot;");},this);},buildRendering:function(){var _22d=_5._Templated.getCachedTemplate(this.templatePath,this.templateString,this._skipNodeCache);var node;if(_4.isString(_22d)){node=_4._toDom(this._stringRepl(_22d));if(node.nodeType!=1){throw new Error("Invalid template: "+_22d);}}else{node=_22d.cloneNode(true);}this.domNode=node;this.inherited(arguments);this._attachTemplateNodes(node);if(this.widgetsInTemplate){var cw=(this._startupWidgets=_4.parser.parse(node,{noStart:!this._earlyTemplatedStartup,template:true,inherited:{dir:this.dir,lang:this.lang},propsThis:this,scope:"dojo"}));this._supportingWidgets=_5.findWidgets(node);this._attachTemplateNodes(cw,function(n,p){return n[p];});}this._fillContent(this.srcNodeRef);},_fillContent:function(_22e){var dest=this.containerNode;if(_22e&&dest){while(_22e.hasChildNodes()){dest.appendChild(_22e.firstChild);}}},_attachTemplateNodes:function(_22f,_230){_230=_230||function(n,p){return n.getAttribute(p);};var _231=_4.isArray(_22f)?_22f:(_22f.all||_22f.getElementsByTagName("*"));var x=_4.isArray(_22f)?0:-1;for(;x<_231.length;x++){var _232=(x==-1)?_22f:_231[x];if(this.widgetsInTemplate&&(_230(_232,"dojoType")||_230(_232,"data-dojo-type"))){continue;}var _233=_230(_232,"dojoAttachPoint")||_230(_232,"data-dojo-attach-point");if(_233){var _234,_235=_233.split(/\s*,\s*/);while((_234=_235.shift())){if(_4.isArray(this[_234])){this[_234].push(_232);}else{this[_234]=_232;}this._attachPoints.push(_234);}}var _236=_230(_232,"dojoAttachEvent")||_230(_232,"data-dojo-attach-event");if(_236){var _237,_238=_236.split(/\s*,\s*/);var trim=_4.trim;while((_237=_238.shift())){if(_237){var _239=null;if(_237.indexOf(":")!=-1){var _23a=_237.split(":");_237=trim(_23a[0]);_239=trim(_23a[1]);}else{_237=trim(_237);}if(!_239){_239=_237;}this._attachEvents.push(this.connect(_232,_237,_239));}}}var role=_230(_232,"waiRole");if(role){_5.setWaiRole(_232,role);}var _23b=_230(_232,"waiState");if(_23b){_4.forEach(_23b.split(/\s*,\s*/),function(_23c){if(_23c.indexOf("-")!=-1){var pair=_23c.split("-");_5.setWaiState(_232,pair[0],pair[1]);}});}}},startup:function(){_4.forEach(this._startupWidgets,function(w){if(w&&!w._started&&w.startup){w.startup();}});this.inherited(arguments);},destroyRendering:function(){_4.forEach(this._attachPoints,function(_23d){delete this[_23d];},this);this._attachPoints=[];_4.forEach(this._attachEvents,this.disconnect,this);this._attachEvents=[];this.inherited(arguments);}});_5._Templated._templateCache={};_5._Templated.getCachedTemplate=function(_23e,_23f,_240){var _241=_5._Templated._templateCache;var key=_23f||_23e;var _242=_241[key];if(_242){try{if(!_242.ownerDocument||_242.ownerDocument==_4.doc){return _242;}}catch(e){}_4.destroy(_242);}if(!_23f){_23f=_4.cache(_23e,{sanitize:true});}_23f=_4.string.trim(_23f);if(_240||_23f.match(/\$\{([^\}]+)\}/g)){return (_241[key]=_23f);}else{var node=_4._toDom(_23f);if(node.nodeType!=1){throw new Error("Invalid template: "+_23f);}return (_241[key]=node);}};if(_4.isIE){_4.addOnWindowUnload(function(){var _243=_5._Templated._templateCache;for(var key in _243){var _244=_243[key];if(typeof _244=="object"){_4.destroy(_244);}delete _243[key];}});}_4.extend(_5._Widget,{dojoAttachEvent:"",dojoAttachPoint:"",waiRole:"",waiState:""});}if(!_4._hasResource["dijit._CssStateMixin"]){_4._hasResource["dijit._CssStateMixin"]=true;_4.provide("dijit._CssStateMixin");_4.declare("dijit._CssStateMixin",[],{cssStateNodes:{},hovering:false,active:false,_applyAttributes:function(){this.inherited(arguments);_4.forEach(["onmouseenter","onmouseleave","onmousedown"],function(e){this.connect(this.domNode,e,"_cssMouseEvent");},this);_4.forEach(["disabled","readOnly","checked","selected","focused","state","hovering","active"],function(attr){this.watch(attr,_4.hitch(this,"_setStateClass"));},this);for(var ap in this.cssStateNodes){this._trackMouseState(this[ap],this.cssStateNodes[ap]);}this._setStateClass();},_cssMouseEvent:function(_245){if(!this.disabled){switch(_245.type){case "mouseenter":case "mouseover":this._set("hovering",true);this._set("active",this._mouseDown);break;case "mouseleave":case "mouseout":this._set("hovering",false);this._set("active",false);break;case "mousedown":this._set("active",true);this._mouseDown=true;var _246=this.connect(_4.body(),"onmouseup",function(){this._mouseDown=false;this._set("active",false);this.disconnect(_246);});break;}}},_setStateClass:function(){var _247=this.baseClass.split(" ");function _248(_249){_247=_247.concat(_4.map(_247,function(c){return c+_249;}),"dijit"+_249);};if(!this.isLeftToRight()){_248("Rtl");}if(this.checked){_248("Checked");}if(this.state){_248(this.state);}if(this.selected){_248("Selected");}if(this.disabled){_248("Disabled");}else{if(this.readOnly){_248("ReadOnly");}else{if(this.active){_248("Active");}else{if(this.hovering){_248("Hover");}}}}if(this._focused){_248("Focused");}var tn=this.stateNode||this.domNode,_24a={};_4.forEach(tn.className.split(" "),function(c){_24a[c]=true;});if("_stateClasses" in this){_4.forEach(this._stateClasses,function(c){delete _24a[c];});}_4.forEach(_247,function(c){_24a[c]=true;});var _24b=[];for(var c in _24a){_24b.push(c);}tn.className=_24b.join(" ");this._stateClasses=_247;},_trackMouseState:function(node,_24c){var _24d=false,_24e=false,_24f=false;var self=this,cn=_4.hitch(this,"connect",node);function _250(){var _251=("disabled" in self&&self.disabled)||("readonly" in self&&self.readonly);_4.toggleClass(node,_24c+"Hover",_24d&&!_24e&&!_251);_4.toggleClass(node,_24c+"Active",_24e&&!_251);_4.toggleClass(node,_24c+"Focused",_24f&&!_251);};cn("onmouseenter",function(){_24d=true;_250();});cn("onmouseleave",function(){_24d=false;_24e=false;_250();});cn("onmousedown",function(){_24e=true;_250();});cn("onmouseup",function(){_24e=false;_250();});cn("onfocus",function(){_24f=true;_250();});cn("onblur",function(){_24f=false;_250();});this.watch("disabled",_250);this.watch("readOnly",_250);}});}if(!_4._hasResource["dijit.form._FormMixin"]){_4._hasResource["dijit.form._FormMixin"]=true;_4.provide("dijit.form._FormMixin");_4.declare("dijit.form._FormMixin",null,{state:"",reset:function(){_4.forEach(this.getDescendants(),function(_252){if(_252.reset){_252.reset();}});},validate:function(){var _253=false;return _4.every(_4.map(this.getDescendants(),function(_254){_254._hasBeenBlurred=true;var _255=_254.disabled||!_254.validate||_254.validate();if(!_255&&!_253){_4.window.scrollIntoView(_254.containerNode||_254.domNode);_254.focus();_253=true;}return _255;}),function(item){return item;});},setValues:function(val){_4.deprecated(this.declaredClass+"::setValues() is deprecated. Use set('value', val) instead.","","2.0");return this.set("value",val);},_setValueAttr:function(obj){var map={};_4.forEach(this.getDescendants(),function(_256){if(!_256.name){return;}var _257=map[_256.name]||(map[_256.name]=[]);_257.push(_256);});for(var name in map){if(!map.hasOwnProperty(name)){continue;}var _258=map[name],_259=_4.getObject(name,false,obj);if(_259===undefined){continue;}if(!_4.isArray(_259)){_259=[_259];}if(typeof _258[0].checked=="boolean"){_4.forEach(_258,function(w,i){w.set("value",_4.indexOf(_259,w.value)!=-1);});}else{if(_258[0].multiple){_258[0].set("value",_259);}else{_4.forEach(_258,function(w,i){w.set("value",_259[i]);});}}}},getValues:function(){_4.deprecated(this.declaredClass+"::getValues() is deprecated. Use get('value') instead.","","2.0");return this.get("value");},_getValueAttr:function(){var obj={};_4.forEach(this.getDescendants(),function(_25a){var name=_25a.name;if(!name||_25a.disabled){return;}var _25b=_25a.get("value");if(typeof _25a.checked=="boolean"){if(/Radio/.test(_25a.declaredClass)){if(_25b!==false){_4.setObject(name,_25b,obj);}else{_25b=_4.getObject(name,false,obj);if(_25b===undefined){_4.setObject(name,null,obj);}}}else{var ary=_4.getObject(name,false,obj);if(!ary){ary=[];_4.setObject(name,ary,obj);}if(_25b!==false){ary.push(_25b);}}}else{var prev=_4.getObject(name,false,obj);if(typeof prev!="undefined"){if(_4.isArray(prev)){prev.push(_25b);}else{_4.setObject(name,[prev,_25b],obj);}}else{_4.setObject(name,_25b,obj);}}});return obj;},isValid:function(){return this.state=="";},onValidStateChange:function(_25c){},_getState:function(){var _25d=_4.map(this._descendants,function(w){return w.get("state")||"";});return _4.indexOf(_25d,"Error")>=0?"Error":_4.indexOf(_25d,"Incomplete")>=0?"Incomplete":"";},disconnectChildren:function(){_4.forEach(this._childConnections||[],_4.hitch(this,"disconnect"));_4.forEach(this._childWatches||[],function(w){w.unwatch();});},connectChildren:function(_25e){var _25f=this;this.disconnectChildren();this._descendants=this.getDescendants();var set=_25e?function(name,val){_25f[name]=val;}:_4.hitch(this,"_set");set("value",this.get("value"));set("state",this._getState());var _260=(this._childConnections=[]),_261=(this._childWatches=[]);_4.forEach(_4.filter(this._descendants,function(item){return item.validate;}),function(_262){_4.forEach(["state","disabled"],function(attr){_261.push(_262.watch(attr,function(attr,_263,_264){_25f.set("state",_25f._getState());}));});});var _265=function(){if(_25f._onChangeDelayTimer){clearTimeout(_25f._onChangeDelayTimer);}_25f._onChangeDelayTimer=setTimeout(function(){delete _25f._onChangeDelayTimer;_25f._set("value",_25f.get("value"));},10);};_4.forEach(_4.filter(this._descendants,function(item){return item.onChange;}),function(_266){_260.push(_25f.connect(_266,"onChange",_265));_261.push(_266.watch("disabled",_265));});},startup:function(){this.inherited(arguments);this.connectChildren(true);this.watch("state",function(attr,_267,_268){this.onValidStateChange(_268=="");});},destroy:function(){this.disconnectChildren();this.inherited(arguments);}});}if(!_4._hasResource["dijit._DialogMixin"]){_4._hasResource["dijit._DialogMixin"]=true;_4.provide("dijit._DialogMixin");_4.declare("dijit._DialogMixin",null,{attributeMap:_5._Widget.prototype.attributeMap,execute:function(_269){},onCancel:function(){},onExecute:function(){},_onSubmit:function(){this.onExecute();this.execute(this.get("value"));},_getFocusItems:function(){var _26a=_5._getTabNavigable(this.containerNode);this._firstFocusItem=_26a.lowest||_26a.first||this.closeButtonNode||this.domNode;this._lastFocusItem=_26a.last||_26a.highest||this._firstFocusItem;}});}if(!_4._hasResource["dijit.DialogUnderlay"]){_4._hasResource["dijit.DialogUnderlay"]=true;_4.provide("dijit.DialogUnderlay");_4.declare("dijit.DialogUnderlay",[_5._Widget,_5._Templated],{templateString:"<div class='dijitDialogUnderlayWrapper'><div class='dijitDialogUnderlay' dojoAttachPoint='node'></div></div>",dialogId:"","class":"",attributeMap:{id:"domNode"},_setDialogIdAttr:function(id){_4.attr(this.node,"id",id+"_underlay");this._set("dialogId",id);},_setClassAttr:function(_26b){this.node.className="dijitDialogUnderlay "+_26b;this._set("class",_26b);},postCreate:function(){_4.body().appendChild(this.domNode);},layout:function(){var is=this.node.style,os=this.domNode.style;os.display="none";var _26c=_4.window.getBox();os.top=_26c.t+"px";os.left=_26c.l+"px";is.width=_26c.w+"px";is.height=_26c.h+"px";os.display="block";},show:function(){this.domNode.style.display="block";this.layout();this.bgIframe=new _5.BackgroundIframe(this.domNode);},hide:function(){this.bgIframe.destroy();delete this.bgIframe;this.domNode.style.display="none";}});}if(!_4._hasResource["dijit._Contained"]){_4._hasResource["dijit._Contained"]=true;_4.provide("dijit._Contained");_4.declare("dijit._Contained",null,{getParent:function(){var _26d=_5.getEnclosingWidget(this.domNode.parentNode);return _26d&&_26d.isContainer?_26d:null;},_getSibling:function(_26e){var node=this.domNode;do{node=node[_26e+"Sibling"];}while(node&&node.nodeType!=1);return node&&_5.byNode(node);},getPreviousSibling:function(){return this._getSibling("previous");},getNextSibling:function(){return this._getSibling("next");},getIndexInParent:function(){var p=this.getParent();if(!p||!p.getIndexOfChild){return -1;}return p.getIndexOfChild(this);}});}if(!_4._hasResource["dijit._Container"]){_4._hasResource["dijit._Container"]=true;_4.provide("dijit._Container");_4.declare("dijit._Container",null,{isContainer:true,buildRendering:function(){this.inherited(arguments);if(!this.containerNode){this.containerNode=this.domNode;}},addChild:function(_26f,_270){var _271=this.containerNode;if(_270&&typeof _270=="number"){var _272=this.getChildren();if(_272&&_272.length>=_270){_271=_272[_270-1].domNode;_270="after";}}_4.place(_26f.domNode,_271,_270);if(this._started&&!_26f._started){_26f.startup();}},removeChild:function(_273){if(typeof _273=="number"){_273=this.getChildren()[_273];}if(_273){var node=_273.domNode;if(node&&node.parentNode){node.parentNode.removeChild(node);}}},hasChildren:function(){return this.getChildren().length>0;},destroyDescendants:function(_274){_4.forEach(this.getChildren(),function(_275){_275.destroyRecursive(_274);});},_getSiblingOfChild:function(_276,dir){var node=_276.domNode,_277=(dir>0?"nextSibling":"previousSibling");do{node=node[_277];}while(node&&(node.nodeType!=1||!_5.byNode(node)));return node&&_5.byNode(node);},getIndexOfChild:function(_278){return _4.indexOf(this.getChildren(),_278);},startup:function(){if(this._started){return;}_4.forEach(this.getChildren(),function(_279){_279.startup();});this.inherited(arguments);}});}if(!_4._hasResource["dijit.layout._LayoutWidget"]){_4._hasResource["dijit.layout._LayoutWidget"]=true;_4.provide("dijit.layout._LayoutWidget");_4.declare("dijit.layout._LayoutWidget",[_5._Widget,_5._Container,_5._Contained],{baseClass:"dijitLayoutContainer",isLayoutContainer:true,buildRendering:function(){this.inherited(arguments);_4.addClass(this.domNode,"dijitContainer");},startup:function(){if(this._started){return;}this.inherited(arguments);var _27a=this.getParent&&this.getParent();if(!(_27a&&_27a.isLayoutContainer)){this.resize();this.connect(_4.isIE?this.domNode:_4.global,"onresize",function(){this.resize();});}},resize:function(_27b,_27c){var node=this.domNode;if(_27b){_4.marginBox(node,_27b);if(_27b.t){node.style.top=_27b.t+"px";}if(_27b.l){node.style.left=_27b.l+"px";}}var mb=_27c||{};_4.mixin(mb,_27b||{});if(!("h" in mb)||!("w" in mb)){mb=_4.mixin(_4.marginBox(node),mb);}var cs=_4.getComputedStyle(node);var me=_4._getMarginExtents(node,cs);var be=_4._getBorderExtents(node,cs);var bb=(this._borderBox={w:mb.w-(me.w+be.w),h:mb.h-(me.h+be.h)});var pe=_4._getPadExtents(node,cs);this._contentBox={l:_4._toPixelValue(node,cs.paddingLeft),t:_4._toPixelValue(node,cs.paddingTop),w:bb.w-pe.w,h:bb.h-pe.h};this.layout();},layout:function(){},_setupChild:function(_27d){var cls=this.baseClass+"-child "+(_27d.baseClass?this.baseClass+"-"+_27d.baseClass:"");_4.addClass(_27d.domNode,cls);},addChild:function(_27e,_27f){this.inherited(arguments);if(this._started){this._setupChild(_27e);}},removeChild:function(_280){var cls=this.baseClass+"-child"+(_280.baseClass?" "+this.baseClass+"-"+_280.baseClass:"");_4.removeClass(_280.domNode,cls);this.inherited(arguments);}});_5.layout.marginBox2contentBox=function(node,mb){var cs=_4.getComputedStyle(node);var me=_4._getMarginExtents(node,cs);var pb=_4._getPadBorderExtents(node,cs);return {l:_4._toPixelValue(node,cs.paddingLeft),t:_4._toPixelValue(node,cs.paddingTop),w:mb.w-(me.w+pb.w),h:mb.h-(me.h+pb.h)};};(function(){var _281=function(word){return word.substring(0,1).toUpperCase()+word.substring(1);};var size=function(_282,dim){var _283=_282.resize?_282.resize(dim):_4.marginBox(_282.domNode,dim);if(_283){_4.mixin(_282,_283);}else{_4.mixin(_282,_4.marginBox(_282.domNode));_4.mixin(_282,dim);}};_5.layout.layoutChildren=function(_284,dim,_285,_286,_287){dim=_4.mixin({},dim);_4.addClass(_284,"dijitLayoutContainer");_285=_4.filter(_285,function(item){return item.region!="center"&&item.layoutAlign!="client";}).concat(_4.filter(_285,function(item){return item.region=="center"||item.layoutAlign=="client";}));_4.forEach(_285,function(_288){var elm=_288.domNode,pos=(_288.region||_288.layoutAlign);var _289=elm.style;_289.left=dim.l+"px";_289.top=dim.t+"px";_289.position="absolute";_4.addClass(elm,"dijitAlign"+_281(pos));var _28a={};if(_286&&_286==_288.id){_28a[_288.region=="top"||_288.region=="bottom"?"h":"w"]=_287;}if(pos=="top"||pos=="bottom"){_28a.w=dim.w;size(_288,_28a);dim.h-=_288.h;if(pos=="top"){dim.t+=_288.h;}else{_289.top=dim.t+dim.h+"px";}}else{if(pos=="left"||pos=="right"){_28a.h=dim.h;size(_288,_28a);dim.w-=_288.w;if(pos=="left"){dim.l+=_288.w;}else{_289.left=dim.l+dim.w+"px";}}else{if(pos=="client"||pos=="center"){size(_288,dim);}}}});};})();}if(!_4._hasResource["dijit.layout._ContentPaneResizeMixin"]){_4._hasResource["dijit.layout._ContentPaneResizeMixin"]=true;_4.provide("dijit.layout._ContentPaneResizeMixin");_4.declare("dijit.layout._ContentPaneResizeMixin",null,{doLayout:true,isContainer:true,isLayoutContainer:true,_startChildren:function(){_4.forEach(this.getChildren(),function(_28b){_28b.startup();_28b._started=true;});},startup:function(){if(this._started){return;}var _28c=_5._Contained.prototype.getParent.call(this);this._childOfLayoutWidget=_28c&&_28c.isLayoutContainer;this._needLayout=!this._childOfLayoutWidget;this.inherited(arguments);this._startChildren();if(this._isShown()){this._onShow();}if(!this._childOfLayoutWidget){this.connect(_4.isIE?this.domNode:_4.global,"onresize",function(){this._needLayout=!this._childOfLayoutWidget;this.resize();});}},_checkIfSingleChild:function(){var _28d=_4.query("> *",this.containerNode).filter(function(node){return node.tagName!=="SCRIPT";}),_28e=_28d.filter(function(node){return _4.hasAttr(node,"data-dojo-type")||_4.hasAttr(node,"dojoType")||_4.hasAttr(node,"widgetId");}),_28f=_4.filter(_28e.map(_5.byNode),function(_290){return _290&&_290.domNode&&_290.resize;});if(_28d.length==_28e.length&&_28f.length==1){this._singleChild=_28f[0];}else{delete this._singleChild;}_4.toggleClass(this.containerNode,this.baseClass+"SingleChild",!!this._singleChild);},resize:function(_291,_292){if(!this._wasShown&&this.open!==false){this._onShow();}this._resizeCalled=true;this._scheduleLayout(_291,_292);},_scheduleLayout:function(_293,_294){if(this._isShown()){this._layout(_293,_294);}else{this._needLayout=true;this._changeSize=_293;this._resultSize=_294;}},_layout:function(_295,_296){if(_295){_4.marginBox(this.domNode,_295);}var cn=this.containerNode;if(cn===this.domNode){var mb=_296||{};_4.mixin(mb,_295||{});if(!("h" in mb)||!("w" in mb)){mb=_4.mixin(_4.marginBox(cn),mb);}this._contentBox=_5.layout.marginBox2contentBox(cn,mb);}else{this._contentBox=_4.contentBox(cn);}this._layoutChildren();delete this._needLayout;},_layoutChildren:function(){if(this.doLayout){this._checkIfSingleChild();}if(this._singleChild&&this._singleChild.resize){var cb=this._contentBox||_4.contentBox(this.containerNode);this._singleChild.resize({w:cb.w,h:cb.h});}else{_4.forEach(this.getChildren(),function(_297){if(_297.resize){_297.resize();}});}},_isShown:function(){if(this._childOfLayoutWidget){if(this._resizeCalled&&"open" in this){return this.open;}return this._resizeCalled;}else{if("open" in this){return this.open;}else{var node=this.domNode,_298=this.domNode.parentNode;return (node.style.display!="none")&&(node.style.visibility!="hidden")&&!_4.hasClass(node,"dijitHidden")&&_298&&_298.style&&(_298.style.display!="none");}}},_onShow:function(){if(this._needLayout){this._layout(this._changeSize,this._resultSize);}this.inherited(arguments);this._wasShown=true;}});}if(!_4._hasResource["dojo.html"]){_4._hasResource["dojo.html"]=true;_4.provide("dojo.html");_4.getObject("html",true,_4);(function(){var _299=0,d=_4;_4.html._secureForInnerHtml=function(cont){return cont.replace(/(?:\s*<!DOCTYPE\s[^>]+>|<title[^>]*>[\s\S]*?<\/title>)/ig,"");};_4.html._emptyNode=_4.empty;_4.html._setNodeContent=function(node,cont){d.empty(node);if(cont){if(typeof cont=="string"){cont=d._toDom(cont,node.ownerDocument);}if(!cont.nodeType&&d.isArrayLike(cont)){for(var _29a=cont.length,i=0;i<cont.length;i=_29a==cont.length?i+1:0){d.place(cont[i],node,"last");}}else{d.place(cont,node,"last");}}return node;};_4.declare("dojo.html._ContentSetter",null,{node:"",content:"",id:"",cleanContent:false,extractContent:false,parseContent:false,parserScope:_4._scopeName,startup:true,constructor:function(_29b,node){_4.mixin(this,_29b||{});node=this.node=_4.byId(this.node||node);if(!this.id){this.id=["Setter",(node)?node.id||node.tagName:"",_299++].join("_");}},set:function(cont,_29c){if(undefined!==cont){this.content=cont;}if(_29c){this._mixin(_29c);}this.onBegin();this.setContent();this.onEnd();return this.node;},setContent:function(){var node=this.node;if(!node){throw new Error(this.declaredClass+": setContent given no node");}try{node=_4.html._setNodeContent(node,this.content);}catch(e){var _29d=this.onContentError(e);try{node.innerHTML=_29d;}catch(e){console.error("Fatal "+this.declaredClass+".setContent could not change content due to "+e.message,e);}}this.node=node;},empty:function(){if(this.parseResults&&this.parseResults.length){_4.forEach(this.parseResults,function(w){if(w.destroy){w.destroy();}});delete this.parseResults;}_4.html._emptyNode(this.node);},onBegin:function(){var cont=this.content;if(_4.isString(cont)){if(this.cleanContent){cont=_4.html._secureForInnerHtml(cont);}if(this.extractContent){var _29e=cont.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);if(_29e){cont=_29e[1];}}}this.empty();this.content=cont;return this.node;},onEnd:function(){if(this.parseContent){this._parse();}return this.node;},tearDown:function(){delete this.parseResults;delete this.node;delete this.content;},onContentError:function(err){return "Error occured setting content: "+err;},_mixin:function(_29f){var _2a0={},key;for(key in _29f){if(key in _2a0){continue;}this[key]=_29f[key];}},_parse:function(){var _2a1=this.node;try{var _2a2={};_4.forEach(["dir","lang","textDir"],function(name){if(this[name]){_2a2[name]=this[name];}},this);this.parseResults=_4.parser.parse({rootNode:_2a1,noStart:!this.startup,inherited:_2a2,scope:this.parserScope});}catch(e){this._onError("Content",e,"Error parsing in _ContentSetter#"+this.id);}},_onError:function(type,err,_2a3){var _2a4=this["on"+type+"Error"].call(this,err);if(_2a3){console.error(_2a3,err);}else{if(_2a4){_4.html._setNodeContent(this.node,_2a4,true);}}}});_4.html.set=function(node,cont,_2a5){if(undefined==cont){console.warn("dojo.html.set: no cont argument provided, using empty string");cont="";}if(!_2a5){return _4.html._setNodeContent(node,cont,true);}else{var op=new _4.html._ContentSetter(_4.mixin(_2a5,{content:cont,node:node}));return op.set();}};})();}if(!_4._hasResource["dijit.layout.ContentPane"]){_4._hasResource["dijit.layout.ContentPane"]=true;_4.provide("dijit.layout.ContentPane");_4.declare("dijit.layout.ContentPane",[_5._Widget,_5.layout._ContentPaneResizeMixin],{href:"",extractContent:false,parseOnLoad:true,parserScope:_4._scopeName,preventCache:false,preload:false,refreshOnShow:false,loadingMessage:"<span class='dijitContentPaneLoading'>${loadingState}</span>",errorMessage:"<span class='dijitContentPaneError'>${errorState}</span>",isLoaded:false,baseClass:"dijitContentPane",ioArgs:{},onLoadDeferred:null,attributeMap:_4.delegate(_5._Widget.prototype.attributeMap,{title:[]}),stopParser:true,template:false,create:function(_2a6,_2a7){if((!_2a6||!_2a6.template)&&_2a7&&!("href" in _2a6)&&!("content" in _2a6)){var df=_4.doc.createDocumentFragment();_2a7=_4.byId(_2a7);while(_2a7.firstChild){df.appendChild(_2a7.firstChild);}_2a6=_4.delegate(_2a6,{content:df});}this.inherited(arguments,[_2a6,_2a7]);},postMixInProperties:function(){this.inherited(arguments);var _2a8=_4.i18n.getLocalization("dijit","loading",this.lang);this.loadingMessage=_4.string.substitute(this.loadingMessage,_2a8);this.errorMessage=_4.string.substitute(this.errorMessage,_2a8);},buildRendering:function(){this.inherited(arguments);if(!this.containerNode){this.containerNode=this.domNode;}this.domNode.title="";if(!_4.attr(this.domNode,"role")){_5.setWaiRole(this.domNode,"group");}},_startChildren:function(){this.inherited(arguments);if(this._contentSetter){_4.forEach(this._contentSetter.parseResults,function(obj){if(!obj._started&&!obj._destroyed&&_4.isFunction(obj.startup)){obj.startup();obj._started=true;}},this);}},setHref:function(href){_4.deprecated("dijit.layout.ContentPane.setHref() is deprecated. Use set('href', ...) instead.","","2.0");return this.set("href",href);},_setHrefAttr:function(href){this.cancel();this.onLoadDeferred=new _4.Deferred(_4.hitch(this,"cancel"));this.onLoadDeferred.addCallback(_4.hitch(this,"onLoad"));this._set("href",href);if(this.preload||(this._created&&this._isShown())){this._load();}else{this._hrefChanged=true;}return this.onLoadDeferred;},setContent:function(data){_4.deprecated("dijit.layout.ContentPane.setContent() is deprecated.  Use set('content', ...) instead.","","2.0");this.set("content",data);},_setContentAttr:function(data){this._set("href","");this.cancel();this.onLoadDeferred=new _4.Deferred(_4.hitch(this,"cancel"));if(this._created){this.onLoadDeferred.addCallback(_4.hitch(this,"onLoad"));}this._setContent(data||"");this._isDownloaded=false;return this.onLoadDeferred;},_getContentAttr:function(){return this.containerNode.innerHTML;},cancel:function(){if(this._xhrDfd&&(this._xhrDfd.fired==-1)){this._xhrDfd.cancel();}delete this._xhrDfd;this.onLoadDeferred=null;},uninitialize:function(){if(this._beingDestroyed){this.cancel();}this.inherited(arguments);},destroyRecursive:function(_2a9){if(this._beingDestroyed){return;}this.inherited(arguments);},_onShow:function(){this.inherited(arguments);if(this.href){if(!this._xhrDfd&&(!this.isLoaded||this._hrefChanged||this.refreshOnShow)){return this.refresh();}}},refresh:function(){this.cancel();this.onLoadDeferred=new _4.Deferred(_4.hitch(this,"cancel"));this.onLoadDeferred.addCallback(_4.hitch(this,"onLoad"));this._load();return this.onLoadDeferred;},_load:function(){this._setContent(this.onDownloadStart(),true);var self=this;var _2aa={preventCache:(this.preventCache||this.refreshOnShow),url:this.href,handleAs:"text"};if(_4.isObject(this.ioArgs)){_4.mixin(_2aa,this.ioArgs);}var hand=(this._xhrDfd=(this.ioMethod||_4.xhrGet)(_2aa));hand.addCallback(function(html){try{self._isDownloaded=true;self._setContent(html,false);self.onDownloadEnd();}catch(err){self._onError("Content",err);}delete self._xhrDfd;return html;});hand.addErrback(function(err){if(!hand.canceled){self._onError("Download",err);}delete self._xhrDfd;return err;});delete this._hrefChanged;},_onLoadHandler:function(data){this._set("isLoaded",true);try{this.onLoadDeferred.callback(data);}catch(e){console.error("Error "+this.widgetId+" running custom onLoad code: "+e.message);}},_onUnloadHandler:function(){this._set("isLoaded",false);try{this.onUnload();}catch(e){console.error("Error "+this.widgetId+" running custom onUnload code: "+e.message);}},destroyDescendants:function(){if(this.isLoaded){this._onUnloadHandler();}var _2ab=this._contentSetter;_4.forEach(this.getChildren(),function(_2ac){if(_2ac.destroyRecursive){_2ac.destroyRecursive();}});if(_2ab){_4.forEach(_2ab.parseResults,function(_2ad){if(_2ad.destroyRecursive&&_2ad.domNode&&_2ad.domNode.parentNode==_4.body()){_2ad.destroyRecursive();}});delete _2ab.parseResults;}_4.html._emptyNode(this.containerNode);delete this._singleChild;},_setContent:function(cont,_2ae){this.destroyDescendants();var _2af=this._contentSetter;if(!(_2af&&_2af instanceof _4.html._ContentSetter)){_2af=this._contentSetter=new _4.html._ContentSetter({node:this.containerNode,_onError:_4.hitch(this,this._onError),onContentError:_4.hitch(this,function(e){var _2b0=this.onContentError(e);try{this.containerNode.innerHTML=_2b0;}catch(e){console.error("Fatal "+this.id+" could not change content due to "+e.message,e);}})});}var _2b1=_4.mixin({cleanContent:this.cleanContent,extractContent:this.extractContent,parseContent:this.parseOnLoad,parserScope:this.parserScope,startup:false,dir:this.dir,lang:this.lang},this._contentSetterParams||{});_2af.set((_4.isObject(cont)&&cont.domNode)?cont.domNode:cont,_2b1);delete this._contentSetterParams;if(this.doLayout){this._checkIfSingleChild();}if(!_2ae){if(this._started){this._startChildren();this._scheduleLayout();}this._onLoadHandler(cont);}},_onError:function(type,err,_2b2){this.onLoadDeferred.errback(err);var _2b3=this["on"+type+"Error"].call(this,err);if(_2b2){console.error(_2b2,err);}else{if(_2b3){this._setContent(_2b3,true);}}},onLoad:function(data){},onUnload:function(){},onDownloadStart:function(){return this.loadingMessage;},onContentError:function(_2b4){},onDownloadError:function(_2b5){return this.errorMessage;},onDownloadEnd:function(){}});}if(!_4._hasResource["dijit.TooltipDialog"]){_4._hasResource["dijit.TooltipDialog"]=true;_4.provide("dijit.TooltipDialog");_4.declare("dijit.TooltipDialog",[_5.layout.ContentPane,_5._Templated,_5.form._FormMixin,_5._DialogMixin],{title:"",doLayout:false,autofocus:true,baseClass:"dijitTooltipDialog",_firstFocusItem:null,_lastFocusItem:null,templateString:_4.cache("dijit","templates/TooltipDialog.html","<div role=\"presentation\" tabIndex=\"-1\">\n\t<div class=\"dijitTooltipContainer\" role=\"presentation\">\n\t\t<div class =\"dijitTooltipContents dijitTooltipFocusNode\" dojoAttachPoint=\"containerNode\" role=\"dialog\"></div>\n\t</div>\n\t<div class=\"dijitTooltipConnector\" role=\"presentation\"></div>\n</div>\n"),_setTitleAttr:function(_2b6){this.containerNode.title=_2b6;this._set("title",_2b6);},postCreate:function(){this.inherited(arguments);this.connect(this.containerNode,"onkeypress","_onKey");},orient:function(node,_2b7,_2b8){var newC="dijitTooltipAB"+(_2b8.charAt(1)=="L"?"Left":"Right")+" dijitTooltip"+(_2b8.charAt(0)=="T"?"Below":"Above");_4.replaceClass(this.domNode,newC,this._currentOrientClass||"");this._currentOrientClass=newC;},focus:function(){this._getFocusItems(this.containerNode);_5.focus(this._firstFocusItem);},onOpen:function(pos){this.orient(this.domNode,pos.aroundCorner,pos.corner);this._onShow();},onClose:function(){this.onHide();},_onKey:function(evt){var node=evt.target;var dk=_4.keys;if(evt.charOrCode===dk.TAB){this._getFocusItems(this.containerNode);}var _2b9=(this._firstFocusItem==this._lastFocusItem);if(evt.charOrCode==dk.ESCAPE){setTimeout(_4.hitch(this,"onCancel"),0);_4.stopEvent(evt);}else{if(node==this._firstFocusItem&&evt.shiftKey&&evt.charOrCode===dk.TAB){if(!_2b9){_5.focus(this._lastFocusItem);}_4.stopEvent(evt);}else{if(node==this._lastFocusItem&&evt.charOrCode===dk.TAB&&!evt.shiftKey){if(!_2b9){_5.focus(this._firstFocusItem);}_4.stopEvent(evt);}else{if(evt.charOrCode===dk.TAB){evt.stopPropagation();}}}}}});}if(!_4._hasResource["dijit.Dialog"]){_4._hasResource["dijit.Dialog"]=true;_4.provide("dijit.Dialog");_4.declare("dijit._DialogBase",[_5._Templated,_5.form._FormMixin,_5._DialogMixin,_5._CssStateMixin],{templateString:_4.cache("dijit","templates/Dialog.html","<div class=\"dijitDialog\" role=\"dialog\" aria-labelledby=\"${id}_title\">\n\t<div dojoAttachPoint=\"titleBar\" class=\"dijitDialogTitleBar\">\n\t<span dojoAttachPoint=\"titleNode\" class=\"dijitDialogTitle\" id=\"${id}_title\"></span>\n\t<span dojoAttachPoint=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" dojoAttachEvent=\"ondijitclick: onCancel\" title=\"${buttonCancel}\" role=\"button\" tabIndex=\"-1\">\n\t\t<span dojoAttachPoint=\"closeText\" class=\"closeText\" title=\"${buttonCancel}\">x</span>\n\t</span>\n\t</div>\n\t\t<div dojoAttachPoint=\"containerNode\" class=\"dijitDialogPaneContent\"></div>\n</div>\n"),baseClass:"dijitDialog",cssStateNodes:{closeButtonNode:"dijitDialogCloseIcon"},attributeMap:_4.delegate(_5._Widget.prototype.attributeMap,{title:[{node:"titleNode",type:"innerHTML"},{node:"titleBar",type:"attribute"}],"aria-describedby":""}),open:false,duration:_5.defaultDuration,refocus:true,autofocus:true,_firstFocusItem:null,_lastFocusItem:null,doLayout:false,draggable:true,"aria-describedby":"",postMixInProperties:function(){var _2ba=_4.i18n.getLocalization("dijit","common");_4.mixin(this,_2ba);this.inherited(arguments);},postCreate:function(){_4.style(this.domNode,{display:"none",position:"absolute"});_4.body().appendChild(this.domNode);this.inherited(arguments);this.connect(this,"onExecute","hide");this.connect(this,"onCancel","hide");this._modalconnects=[];},onLoad:function(){this._position();if(this.autofocus&&_5._DialogLevelManager.isTop(this)){this._getFocusItems(this.domNode);_5.focus(this._firstFocusItem);}this.inherited(arguments);},_endDrag:function(e){if(e&&e.node&&e.node===this.domNode){this._relativePosition=_4.position(e.node);}},_setup:function(){var node=this.domNode;if(this.titleBar&&this.draggable){this._moveable=(_4.isIE==6)?new _4.dnd.TimedMoveable(node,{handle:this.titleBar}):new _4.dnd.Moveable(node,{handle:this.titleBar,timeout:0});this._dndListener=_4.subscribe("/dnd/move/stop",this,"_endDrag");}else{_4.addClass(node,"dijitDialogFixed");}this.underlayAttrs={dialogId:this.id,"class":_4.map(this["class"].split(/\s/),function(s){return s+"_underlay";}).join(" ")};},_size:function(){this._checkIfSingleChild();if(this._singleChild){if(this._singleChildOriginalStyle){this._singleChild.domNode.style.cssText=this._singleChildOriginalStyle;}delete this._singleChildOriginalStyle;}else{_4.style(this.containerNode,{width:"auto",height:"auto"});}var mb=_4._getMarginSize(this.domNode);var _2bb=_4.window.getBox();if(mb.w>=_2bb.w||mb.h>=_2bb.h){var w=Math.min(mb.w,Math.floor(_2bb.w*0.75)),h=Math.min(mb.h,Math.floor(_2bb.h*0.75));if(this._singleChild&&this._singleChild.resize){this._singleChildOriginalStyle=this._singleChild.domNode.style.cssText;this._singleChild.resize({w:w,h:h});}else{_4.style(this.containerNode,{width:w+"px",height:h+"px",overflow:"auto",position:"relative"});}}else{if(this._singleChild&&this._singleChild.resize){this._singleChild.resize();}}},_position:function(){if(!_4.hasClass(_4.body(),"dojoMove")){var node=this.domNode,_2bc=_4.window.getBox(),p=this._relativePosition,bb=p?null:_4._getBorderBox(node),l=Math.floor(_2bc.l+(p?p.x:(_2bc.w-bb.w)/2)),t=Math.floor(_2bc.t+(p?p.y:(_2bc.h-bb.h)/2));_4.style(node,{left:l+"px",top:t+"px"});}},_onKey:function(evt){if(evt.charOrCode){var dk=_4.keys;var node=evt.target;if(evt.charOrCode===dk.TAB){this._getFocusItems(this.domNode);}var _2bd=(this._firstFocusItem==this._lastFocusItem);if(node==this._firstFocusItem&&evt.shiftKey&&evt.charOrCode===dk.TAB){if(!_2bd){_5.focus(this._lastFocusItem);}_4.stopEvent(evt);}else{if(node==this._lastFocusItem&&evt.charOrCode===dk.TAB&&!evt.shiftKey){if(!_2bd){_5.focus(this._firstFocusItem);}_4.stopEvent(evt);}else{while(node){if(node==this.domNode||_4.hasClass(node,"dijitPopup")){if(evt.charOrCode==dk.ESCAPE){this.onCancel();}else{return;}}node=node.parentNode;}if(evt.charOrCode!==dk.TAB){_4.stopEvent(evt);}else{if(!_4.isOpera){try{this._firstFocusItem.focus();}catch(e){}}}}}}},show:function(){if(this.open){return;}if(!this._started){this.startup();}if(!this._alreadyInitialized){this._setup();this._alreadyInitialized=true;}if(this._fadeOutDeferred){this._fadeOutDeferred.cancel();}this._modalconnects.push(_4.connect(window,"onscroll",this,"layout"));this._modalconnects.push(_4.connect(window,"onresize",this,function(){var _2be=_4.window.getBox();if(!this._oldViewport||_2be.h!=this._oldViewport.h||_2be.w!=this._oldViewport.w){this.layout();this._oldViewport=_2be;}}));this._modalconnects.push(_4.connect(this.domNode,"onkeypress",this,"_onKey"));_4.style(this.domNode,{opacity:0,display:""});this._set("open",true);this._onShow();this._size();this._position();var _2bf;this._fadeInDeferred=new _4.Deferred(_4.hitch(this,function(){_2bf.stop();delete this._fadeInDeferred;}));_2bf=_4.fadeIn({node:this.domNode,duration:this.duration,beforeBegin:_4.hitch(this,function(){_5._DialogLevelManager.show(this,this.underlayAttrs);}),onEnd:_4.hitch(this,function(){if(this.autofocus&&_5._DialogLevelManager.isTop(this)){this._getFocusItems(this.domNode);_5.focus(this._firstFocusItem);}this._fadeInDeferred.callback(true);delete this._fadeInDeferred;})}).play();return this._fadeInDeferred;},hide:function(){if(!this._alreadyInitialized){return;}if(this._fadeInDeferred){this._fadeInDeferred.cancel();}var _2c0;this._fadeOutDeferred=new _4.Deferred(_4.hitch(this,function(){_2c0.stop();delete this._fadeOutDeferred;}));_2c0=_4.fadeOut({node:this.domNode,duration:this.duration,onEnd:_4.hitch(this,function(){this.domNode.style.display="none";_5._DialogLevelManager.hide(this);this.onHide();this._fadeOutDeferred.callback(true);delete this._fadeOutDeferred;})}).play();if(this._scrollConnected){this._scrollConnected=false;}_4.forEach(this._modalconnects,_4.disconnect);this._modalconnects=[];if(this._relativePosition){delete this._relativePosition;}this._set("open",false);return this._fadeOutDeferred;},layout:function(){if(this.domNode.style.display!="none"){if(_5._underlay){_5._underlay.layout();}this._position();}},destroy:function(){if(this._fadeInDeferred){this._fadeInDeferred.cancel();}if(this._fadeOutDeferred){this._fadeOutDeferred.cancel();}if(this._moveable){this._moveable.destroy();}if(this._dndListener){_4.unsubscribe(this._dndListener);}_4.forEach(this._modalconnects,_4.disconnect);_5._DialogLevelManager.hide(this);this.inherited(arguments);}});_4.declare("dijit.Dialog",[_5.layout.ContentPane,_5._DialogBase],{});_5._DialogLevelManager={show:function(_2c1,_2c2){var ds=_5._dialogStack;ds[ds.length-1].focus=_5.getFocus(_2c1);var _2c3=_5._underlay;if(!_2c3||_2c3._destroyed){_2c3=_5._underlay=new _5.DialogUnderlay(_2c2);}else{_2c3.set(_2c1.underlayAttrs);}var _2c4=ds[ds.length-1].dialog?ds[ds.length-1].zIndex+2:950;if(ds.length==1){_2c3.show();}_4.style(_5._underlay.domNode,"zIndex",_2c4-1);_4.style(_2c1.domNode,"zIndex",_2c4);ds.push({dialog:_2c1,underlayAttrs:_2c2,zIndex:_2c4});},hide:function(_2c5){var ds=_5._dialogStack;if(ds[ds.length-1].dialog==_2c5){ds.pop();var pd=ds[ds.length-1];if(ds.length==1){if(!_5._underlay._destroyed){_5._underlay.hide();}}else{_4.style(_5._underlay.domNode,"zIndex",pd.zIndex-1);_5._underlay.set(pd.underlayAttrs);}if(_2c5.refocus){var _2c6=pd.focus;if(!_2c6||(pd.dialog&&!_4.isDescendant(_2c6.node,pd.dialog.domNode))){pd.dialog._getFocusItems(pd.dialog.domNode);_2c6=pd.dialog._firstFocusItem;}try{_5.focus(_2c6);}catch(e){}}}else{var idx=_4.indexOf(_4.map(ds,function(elem){return elem.dialog;}),_2c5);if(idx!=-1){ds.splice(idx,1);}}},isTop:function(_2c7){var ds=_5._dialogStack;return ds[ds.length-1].dialog==_2c7;}};_5._dialogStack=[{dialog:null,focus:null,underlayAttrs:null}];}if(!_4._hasResource["dojo.regexp"]){_4._hasResource["dojo.regexp"]=true;_4.provide("dojo.regexp");_4.getObject("regexp",true,_4);_4.regexp.escapeString=function(str,_2c8){return str.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,function(ch){if(_2c8&&_2c8.indexOf(ch)!=-1){return ch;}return "\\"+ch;});};_4.regexp.buildGroupRE=function(arr,re,_2c9){if(!(arr instanceof Array)){return re(arr);}var b=[];for(var i=0;i<arr.length;i++){b.push(re(arr[i]));}return _4.regexp.group(b.join("|"),_2c9);};_4.regexp.group=function(_2ca,_2cb){return "("+(_2cb?"?:":"")+_2ca+")";};}if(!_4._hasResource["dojo.cookie"]){_4._hasResource["dojo.cookie"]=true;_4.provide("dojo.cookie");_4.cookie=function(name,_2cc,_2cd){var c=document.cookie;if(arguments.length==1){var _2ce=c.match(new RegExp("(?:^|; )"+_4.regexp.escapeString(name)+"=([^;]*)"));return _2ce?decodeURIComponent(_2ce[1]):undefined;}else{_2cd=_2cd||{};var exp=_2cd.expires;if(typeof exp=="number"){var d=new Date();d.setTime(d.getTime()+exp*24*60*60*1000);exp=_2cd.expires=d;}if(exp&&exp.toUTCString){_2cd.expires=exp.toUTCString();}_2cc=encodeURIComponent(_2cc);var _2cf=name+"="+_2cc,_2d0;for(_2d0 in _2cd){_2cf+="; "+_2d0;var _2d1=_2cd[_2d0];if(_2d1!==true){_2cf+="="+_2d1;}}document.cookie=_2cf;}};_4.cookie.isSupported=function(){if(!("cookieEnabled" in navigator)){this("__djCookieTest__","CookiesAllowed");navigator.cookieEnabled=this("__djCookieTest__")=="CookiesAllowed";if(navigator.cookieEnabled){this("__djCookieTest__","",{expires:-1});}}return navigator.cookieEnabled;};}if(!_4._hasResource["dijit.layout.BorderContainer"]){_4._hasResource["dijit.layout.BorderContainer"]=true;_4.provide("dijit.layout.BorderContainer");_4.declare("dijit.layout.BorderContainer",_5.layout._LayoutWidget,{design:"headline",gutters:true,liveSplitters:true,persist:false,baseClass:"dijitBorderContainer",_splitterClass:"dijit.layout._Splitter",postMixInProperties:function(){if(!this.gutters){this.baseClass+="NoGutter";}this.inherited(arguments);},startup:function(){if(this._started){return;}_4.forEach(this.getChildren(),this._setupChild,this);this.inherited(arguments);},_setupChild:function(_2d2){var _2d3=_2d2.region;if(_2d3){this.inherited(arguments);_4.addClass(_2d2.domNode,this.baseClass+"Pane");var ltr=this.isLeftToRight();if(_2d3=="leading"){_2d3=ltr?"left":"right";}if(_2d3=="trailing"){_2d3=ltr?"right":"left";}if(_2d3!="center"&&(_2d2.splitter||this.gutters)&&!_2d2._splitterWidget){var _2d4=_4.getObject(_2d2.splitter?this._splitterClass:"dijit.layout._Gutter");var _2d5=new _2d4({id:_2d2.id+"_splitter",container:this,child:_2d2,region:_2d3,live:this.liveSplitters});_2d5.isSplitter=true;_2d2._splitterWidget=_2d5;_4.place(_2d5.domNode,_2d2.domNode,"after");_2d5.startup();}_2d2.region=_2d3;}},layout:function(){this._layoutChildren();},addChild:function(_2d6,_2d7){this.inherited(arguments);if(this._started){this.layout();}},removeChild:function(_2d8){var _2d9=_2d8.region;var _2da=_2d8._splitterWidget;if(_2da){_2da.destroy();delete _2d8._splitterWidget;}this.inherited(arguments);if(this._started){this._layoutChildren();}_4.removeClass(_2d8.domNode,this.baseClass+"Pane");_4.style(_2d8.domNode,{top:"auto",bottom:"auto",left:"auto",right:"auto",position:"static"});_4.style(_2d8.domNode,_2d9=="top"||_2d9=="bottom"?"width":"height","auto");},getChildren:function(){return _4.filter(this.inherited(arguments),function(_2db){return !_2db.isSplitter;});},getSplitter:function(_2dc){return _4.filter(this.getChildren(),function(_2dd){return _2dd.region==_2dc;})[0]._splitterWidget;},resize:function(_2de,_2df){if(!this.cs||!this.pe){var node=this.domNode;this.cs=_4.getComputedStyle(node);this.pe=_4._getPadExtents(node,this.cs);this.pe.r=_4._toPixelValue(node,this.cs.paddingRight);this.pe.b=_4._toPixelValue(node,this.cs.paddingBottom);_4.style(node,"padding","0px");}this.inherited(arguments);},_layoutChildren:function(_2e0,_2e1){if(!this._borderBox||!this._borderBox.h){return;}var _2e2=_4.map(this.getChildren(),function(_2e3,idx){return {pane:_2e3,weight:[_2e3.region=="center"?Infinity:0,_2e3.layoutPriority,(this.design=="sidebar"?1:-1)*(/top|bottom/.test(_2e3.region)?1:-1),idx]};},this);_2e2.sort(function(a,b){var aw=a.weight,bw=b.weight;for(var i=0;i<aw.length;i++){if(aw[i]!=bw[i]){return aw[i]-bw[i];}}return 0;});var _2e4=[];_4.forEach(_2e2,function(_2e5){var pane=_2e5.pane;_2e4.push(pane);if(pane._splitterWidget){_2e4.push(pane._splitterWidget);}});var dim={l:this.pe.l,t:this.pe.t,w:this._borderBox.w-this.pe.w,h:this._borderBox.h-this.pe.h};_5.layout.layoutChildren(this.domNode,dim,_2e4,_2e0,_2e1);},destroyRecursive:function(){_4.forEach(this.getChildren(),function(_2e6){var _2e7=_2e6._splitterWidget;if(_2e7){_2e7.destroy();}delete _2e6._splitterWidget;});this.inherited(arguments);}});_4.extend(_5._Widget,{region:"",layoutPriority:0,splitter:false,minSize:0,maxSize:Infinity});_4.declare("dijit.layout._Splitter",[_5._Widget,_5._Templated],{live:true,templateString:"<div class=\"dijitSplitter\" dojoAttachEvent=\"onkeypress:_onKeyPress,onmousedown:_startDrag,onmouseenter:_onMouse,onmouseleave:_onMouse\" tabIndex=\"0\" role=\"separator\"><div class=\"dijitSplitterThumb\"></div></div>",postMixInProperties:function(){this.inherited(arguments);this.horizontal=/top|bottom/.test(this.region);this._factor=/top|left/.test(this.region)?1:-1;this._cookieName=this.container.id+"_"+this.region;},buildRendering:function(){this.inherited(arguments);_4.addClass(this.domNode,"dijitSplitter"+(this.horizontal?"H":"V"));if(this.container.persist){var _2e8=_4.cookie(this._cookieName);if(_2e8){this.child.domNode.style[this.horizontal?"height":"width"]=_2e8;}}},_computeMaxSize:function(){var dim=this.horizontal?"h":"w",_2e9=_4.marginBox(this.child.domNode)[dim],_2ea=_4.filter(this.container.getChildren(),function(_2eb){return _2eb.region=="center";})[0],_2ec=_4.marginBox(_2ea.domNode)[dim];return Math.min(this.child.maxSize,_2e9+_2ec);},_startDrag:function(e){if(!this.cover){this.cover=_4.doc.createElement("div");_4.addClass(this.cover,"dijitSplitterCover");_4.place(this.cover,this.child.domNode,"after");}_4.addClass(this.cover,"dijitSplitterCoverActive");if(this.fake){_4.destroy(this.fake);}if(!(this._resize=this.live)){(this.fake=this.domNode.cloneNode(true)).removeAttribute("id");_4.addClass(this.domNode,"dijitSplitterShadow");_4.place(this.fake,this.domNode,"after");}_4.addClass(this.domNode,"dijitSplitterActive dijitSplitter"+(this.horizontal?"H":"V")+"Active");if(this.fake){_4.removeClass(this.fake,"dijitSplitterHover dijitSplitter"+(this.horizontal?"H":"V")+"Hover");}var _2ed=this._factor,_2ee=this.horizontal,axis=_2ee?"pageY":"pageX",_2ef=e[axis],_2f0=this.domNode.style,dim=_2ee?"h":"w",_2f1=_4.marginBox(this.child.domNode)[dim],max=this._computeMaxSize(),min=this.child.minSize||20,_2f2=this.region,_2f3=_2f2=="top"||_2f2=="bottom"?"top":"left",_2f4=parseInt(_2f0[_2f3],10),_2f5=this._resize,_2f6=_4.hitch(this.container,"_layoutChildren",this.child.id),de=_4.doc;this._handlers=(this._handlers||[]).concat([_4.connect(de,"onmousemove",this._drag=function(e,_2f7){var _2f8=e[axis]-_2ef,_2f9=_2ed*_2f8+_2f1,_2fa=Math.max(Math.min(_2f9,max),min);if(_2f5||_2f7){_2f6(_2fa);}_2f0[_2f3]=_2f8+_2f4+_2ed*(_2fa-_2f9)+"px";}),_4.connect(de,"ondragstart",_4.stopEvent),_4.connect(_4.body(),"onselectstart",_4.stopEvent),_4.connect(de,"onmouseup",this,"_stopDrag")]);_4.stopEvent(e);},_onMouse:function(e){var o=(e.type=="mouseover"||e.type=="mouseenter");_4.toggleClass(this.domNode,"dijitSplitterHover",o);_4.toggleClass(this.domNode,"dijitSplitter"+(this.horizontal?"H":"V")+"Hover",o);},_stopDrag:function(e){try{if(this.cover){_4.removeClass(this.cover,"dijitSplitterCoverActive");}if(this.fake){_4.destroy(this.fake);}_4.removeClass(this.domNode,"dijitSplitterActive dijitSplitter"+(this.horizontal?"H":"V")+"Active dijitSplitterShadow");this._drag(e);this._drag(e,true);}finally{this._cleanupHandlers();delete this._drag;}if(this.container.persist){_4.cookie(this._cookieName,this.child.domNode.style[this.horizontal?"height":"width"],{expires:365});}},_cleanupHandlers:function(){_4.forEach(this._handlers,_4.disconnect);delete this._handlers;},_onKeyPress:function(e){this._resize=true;var _2fb=this.horizontal;var tick=1;var dk=_4.keys;switch(e.charOrCode){case _2fb?dk.UP_ARROW:dk.LEFT_ARROW:tick*=-1;case _2fb?dk.DOWN_ARROW:dk.RIGHT_ARROW:break;default:return;}var _2fc=_4._getMarginSize(this.child.domNode)[_2fb?"h":"w"]+this._factor*tick;this.container._layoutChildren(this.child.id,Math.max(Math.min(_2fc,this._computeMaxSize()),this.child.minSize));_4.stopEvent(e);},destroy:function(){this._cleanupHandlers();delete this.child;delete this.container;delete this.cover;delete this.fake;this.inherited(arguments);}});_4.declare("dijit.layout._Gutter",[_5._Widget,_5._Templated],{templateString:"<div class=\"dijitGutter\" role=\"presentation\"></div>",postMixInProperties:function(){this.inherited(arguments);this.horizontal=/top|bottom/.test(this.region);},buildRendering:function(){this.inherited(arguments);_4.addClass(this.domNode,"dijitGutter"+(this.horizontal?"H":"V"));}});}if(!_4._hasResource["dojo.behavior"]){_4._hasResource["dojo.behavior"]=true;_4.provide("dojo.behavior");_4.behavior=new function(){function _2fd(obj,name){if(!obj[name]){obj[name]=[];}return obj[name];};var _2fe=0;function _2ff(obj,_300,func){var _301={};for(var x in obj){if(typeof _301[x]=="undefined"){if(!func){_300(obj[x],x);}else{func.call(_300,obj[x],x);}}}};this._behaviors={};this.add=function(_302){var _303={};_2ff(_302,this,function(_304,name){var _305=_2fd(this._behaviors,name);if(typeof _305["id"]!="number"){_305.id=_2fe++;}var _306=[];_305.push(_306);if((_4.isString(_304))||(_4.isFunction(_304))){_304={found:_304};}_2ff(_304,function(rule,_307){_2fd(_306,_307).push(rule);});});};var _308=function(node,_309,_30a){if(_4.isString(_309)){if(_30a=="found"){_4.publish(_309,[node]);}else{_4.connect(node,_30a,function(){_4.publish(_309,arguments);});}}else{if(_4.isFunction(_309)){if(_30a=="found"){_309(node);}else{_4.connect(node,_30a,_309);}}}};this.apply=function(){_2ff(this._behaviors,function(_30b,id){_4.query(id).forEach(function(elem){var _30c=0;var bid="_dj_behavior_"+_30b.id;if(typeof elem[bid]=="number"){_30c=elem[bid];if(_30c==(_30b.length)){return;}}for(var x=_30c,tver;tver=_30b[x];x++){_2ff(tver,function(_30d,_30e){if(_4.isArray(_30d)){_4.forEach(_30d,function(_30f){_308(elem,_30f,_30e);});}});}elem[bid]=_30b.length;});});};};_4.addOnLoad(_4.behavior,"apply");}if(!_4._hasResource["dojo.NodeList-traverse"]){_4._hasResource["dojo.NodeList-traverse"]=true;_4.provide("dojo.NodeList-traverse");_4.extend(_4.NodeList,{_buildArrayFromCallback:function(_310){var ary=[];for(var i=0;i<this.length;i++){var _311=_310.call(this[i],this[i],ary);if(_311){ary=ary.concat(_311);}}return ary;},_getUniqueAsNodeList:function(_312){var ary=[];for(var i=0,node;node=_312[i];i++){if(node.nodeType==1&&_4.indexOf(ary,node)==-1){ary.push(node);}}return this._wrap(ary,null,this._NodeListCtor);},_getUniqueNodeListWithParent:function(_313,_314){var ary=this._getUniqueAsNodeList(_313);ary=(_314?_4._filterQueryResult(ary,_314):ary);return ary._stash(this);},_getRelatedUniqueNodes:function(_315,_316){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(_316),_315);},children:function(_317){return this._getRelatedUniqueNodes(_317,function(node,ary){return _4._toArray(node.childNodes);});},closest:function(_318,root){return this._getRelatedUniqueNodes(null,function(node,ary){do{if(_4._filterQueryResult([node],_318,root).length){return node;}}while(node!=root&&(node=node.parentNode)&&node.nodeType==1);return null;});},parent:function(_319){return this._getRelatedUniqueNodes(_319,function(node,ary){return node.parentNode;});},parents:function(_31a){return this._getRelatedUniqueNodes(_31a,function(node,ary){var pary=[];while(node.parentNode){node=node.parentNode;pary.push(node);}return pary;});},siblings:function(_31b){return this._getRelatedUniqueNodes(_31b,function(node,ary){var pary=[];var _31c=(node.parentNode&&node.parentNode.childNodes);for(var i=0;i<_31c.length;i++){if(_31c[i]!=node){pary.push(_31c[i]);}}return pary;});},next:function(_31d){return this._getRelatedUniqueNodes(_31d,function(node,ary){var next=node.nextSibling;while(next&&next.nodeType!=1){next=next.nextSibling;}return next;});},nextAll:function(_31e){return this._getRelatedUniqueNodes(_31e,function(node,ary){var pary=[];var next=node;while((next=next.nextSibling)){if(next.nodeType==1){pary.push(next);}}return pary;});},prev:function(_31f){return this._getRelatedUniqueNodes(_31f,function(node,ary){var prev=node.previousSibling;while(prev&&prev.nodeType!=1){prev=prev.previousSibling;}return prev;});},prevAll:function(_320){return this._getRelatedUniqueNodes(_320,function(node,ary){var pary=[];var prev=node;while((prev=prev.previousSibling)){if(prev.nodeType==1){pary.push(prev);}}return pary;});},andSelf:function(){return this.concat(this._parent);},first:function(){return this._wrap(((this[0]&&[this[0]])||[]),this);},last:function(){return this._wrap((this.length?[this[this.length-1]]:[]),this);},even:function(){return this.filter(function(item,i){return i%2!=0;});},odd:function(){return this.filter(function(item,i){return i%2==0;});}});}if(!_4._hasResource["dojo.dnd.Container"]){_4._hasResource["dojo.dnd.Container"]=true;_4.provide("dojo.dnd.Container");_4.declare("dojo.dnd.Container",null,{skipForm:false,constructor:function(node,_321){this.node=_4.byId(node);if(!_321){_321={};}this.creator=_321.creator||null;this.skipForm=_321.skipForm;this.parent=_321.dropParent&&_4.byId(_321.dropParent);this.map={};this.current=null;this.containerState="";_4.addClass(this.node,"dojoDndContainer");if(!(_321&&_321._skipStartup)){this.startup();}this.events=[_4.connect(this.node,"onmouseover",this,"onMouseOver"),_4.connect(this.node,"onmouseout",this,"onMouseOut"),_4.connect(this.node,"ondragstart",this,"onSelectStart"),_4.connect(this.node,"onselectstart",this,"onSelectStart")];},creator:function(){},getItem:function(key){return this.map[key];},setItem:function(key,data){this.map[key]=data;},delItem:function(key){delete this.map[key];},forInItems:function(f,o){o=o||_4.global;var m=this.map,e=_4.dnd._empty;for(var i in m){if(i in e){continue;}f.call(o,m[i],i,this);}return o;},clearItems:function(){this.map={};},getAllNodes:function(){return _4.query("> .dojoDndItem",this.parent);},sync:function(){var map={};this.getAllNodes().forEach(function(node){if(node.id){var item=this.getItem(node.id);if(item){map[node.id]=item;return;}}else{node.id=_4.dnd.getUniqueId();}var type=node.getAttribute("dndType"),data=node.getAttribute("dndData");map[node.id]={data:data||node.innerHTML,type:type?type.split(/\s*,\s*/):["text"]};},this);this.map=map;return this;},insertNodes:function(data,_322,_323){if(!this.parent.firstChild){_323=null;}else{if(_322){if(!_323){_323=this.parent.firstChild;}}else{if(_323){_323=_323.nextSibling;}}}if(_323){for(var i=0;i<data.length;++i){var t=this._normalizedCreator(data[i]);this.setItem(t.node.id,{data:t.data,type:t.type});this.parent.insertBefore(t.node,_323);}}else{for(var i=0;i<data.length;++i){var t=this._normalizedCreator(data[i]);this.setItem(t.node.id,{data:t.data,type:t.type});this.parent.appendChild(t.node);}}return this;},destroy:function(){_4.forEach(this.events,_4.disconnect);this.clearItems();this.node=this.parent=this.current=null;},markupFactory:function(_324,node){_324._skipStartup=true;return new _4.dnd.Container(node,_324);},startup:function(){if(!this.parent){this.parent=this.node;if(this.parent.tagName.toLowerCase()=="table"){var c=this.parent.getElementsByTagName("tbody");if(c&&c.length){this.parent=c[0];}}}this.defaultCreator=_4.dnd._defaultCreator(this.parent);this.sync();},onMouseOver:function(e){var n=e.relatedTarget;while(n){if(n==this.node){break;}try{n=n.parentNode;}catch(x){n=null;}}if(!n){this._changeState("Container","Over");this.onOverEvent();}n=this._getChildByEvent(e);if(this.current==n){return;}if(this.current){this._removeItemClass(this.current,"Over");}if(n){this._addItemClass(n,"Over");}this.current=n;},onMouseOut:function(e){for(var n=e.relatedTarget;n;){if(n==this.node){return;}try{n=n.parentNode;}catch(x){n=null;}}if(this.current){this._removeItemClass(this.current,"Over");this.current=null;}this._changeState("Container","");this.onOutEvent();},onSelectStart:function(e){if(!this.skipForm||!_4.dnd.isFormElement(e)){_4.stopEvent(e);}},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(type,_325){var _326="dojoDnd"+type;var _327=type.toLowerCase()+"State";_4.replaceClass(this.node,_326+_325,_326+this[_327]);this[_327]=_325;},_addItemClass:function(node,type){_4.addClass(node,"dojoDndItem"+type);},_removeItemClass:function(node,type){_4.removeClass(node,"dojoDndItem"+type);},_getChildByEvent:function(e){var node=e.target;if(node){for(var _328=node.parentNode;_328;node=_328,_328=node.parentNode){if(_328==this.parent&&_4.hasClass(node,"dojoDndItem")){return node;}}}return null;},_normalizedCreator:function(item,hint){var t=(this.creator||this.defaultCreator).call(this,item,hint);if(!_4.isArray(t.type)){t.type=["text"];}if(!t.node.id){t.node.id=_4.dnd.getUniqueId();}_4.addClass(t.node,"dojoDndItem");return t;}});_4.dnd._createNode=function(tag){if(!tag){return _4.dnd._createSpan;}return function(text){return _4.create(tag,{innerHTML:text});};};_4.dnd._createTrTd=function(text){var tr=_4.create("tr");_4.create("td",{innerHTML:text},tr);return tr;};_4.dnd._createSpan=function(text){return _4.create("span",{innerHTML:text});};_4.dnd._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};_4.dnd._defaultCreator=function(node){var tag=node.tagName.toLowerCase();var c=tag=="tbody"||tag=="thead"?_4.dnd._createTrTd:_4.dnd._createNode(_4.dnd._defaultCreatorNodes[tag]);return function(item,hint){var _329=item&&_4.isObject(item),data,type,n;if(_329&&item.tagName&&item.nodeType&&item.getAttribute){data=item.getAttribute("dndData")||item.innerHTML;type=item.getAttribute("dndType");type=type?type.split(/\s*,\s*/):["text"];n=item;}else{data=(_329&&item.data)?item.data:item;type=(_329&&item.type)?item.type:["text"];n=(hint=="avatar"?_4.dnd._createSpan:c)(String(data));}if(!n.id){n.id=_4.dnd.getUniqueId();}return {node:n,data:data,type:type};};};}if(!_4._hasResource["dojo.dnd.Selector"]){_4._hasResource["dojo.dnd.Selector"]=true;_4.provide("dojo.dnd.Selector");_4.declare("dojo.dnd.Selector",_4.dnd.Container,{constructor:function(node,_32a){if(!_32a){_32a={};}this.singular=_32a.singular;this.autoSync=_32a.autoSync;this.selection={};this.anchor=null;this.simpleSelection=false;this.events.push(_4.connect(this.node,"onmousedown",this,"onMouseDown"),_4.connect(this.node,"onmouseup",this,"onMouseUp"));},singular:false,getSelectedNodes:function(){var t=new _4.NodeList();var e=_4.dnd._empty;for(var i in this.selection){if(i in e){continue;}t.push(_4.byId(i));}return t;},selectNone:function(){return this._removeSelection()._removeAnchor();},selectAll:function(){this.forInItems(function(data,id){this._addItemClass(_4.byId(id),"Selected");this.selection[id]=1;},this);return this._removeAnchor();},deleteSelectedNodes:function(){var e=_4.dnd._empty;for(var i in this.selection){if(i in e){continue;}var n=_4.byId(i);this.delItem(i);_4.destroy(n);}this.anchor=null;this.selection={};return this;},forInSelectedItems:function(f,o){o=o||_4.global;var s=this.selection,e=_4.dnd._empty;for(var i in s){if(i in e){continue;}f.call(o,this.getItem(i),i,this);}},sync:function(){_4.dnd.Selector.superclass.sync.call(this);if(this.anchor){if(!this.getItem(this.anchor.id)){this.anchor=null;}}var t=[],e=_4.dnd._empty;for(var i in this.selection){if(i in e){continue;}if(!this.getItem(i)){t.push(i);}}_4.forEach(t,function(i){delete this.selection[i];},this);return this;},insertNodes:function(_32b,data,_32c,_32d){var _32e=this._normalizedCreator;this._normalizedCreator=function(item,hint){var t=_32e.call(this,item,hint);if(_32b){if(!this.anchor){this.anchor=t.node;this._removeItemClass(t.node,"Selected");this._addItemClass(this.anchor,"Anchor");}else{if(this.anchor!=t.node){this._removeItemClass(t.node,"Anchor");this._addItemClass(t.node,"Selected");}}this.selection[t.node.id]=1;}else{this._removeItemClass(t.node,"Selected");this._removeItemClass(t.node,"Anchor");}return t;};_4.dnd.Selector.superclass.insertNodes.call(this,data,_32c,_32d);this._normalizedCreator=_32e;return this;},destroy:function(){_4.dnd.Selector.superclass.destroy.call(this);this.selection=this.anchor=null;},markupFactory:function(_32f,node){_32f._skipStartup=true;return new _4.dnd.Selector(node,_32f);},onMouseDown:function(e){if(this.autoSync){this.sync();}if(!this.current){return;}if(!this.singular&&!_4.isCopyKey(e)&&!e.shiftKey&&(this.current.id in this.selection)){this.simpleSelection=true;if(e.button===_4.mouseButtons.LEFT){_4.stopEvent(e);}return;}if(!this.singular&&e.shiftKey){if(!_4.isCopyKey(e)){this._removeSelection();}var c=this.getAllNodes();if(c.length){if(!this.anchor){this.anchor=c[0];this._addItemClass(this.anchor,"Anchor");}this.selection[this.anchor.id]=1;if(this.anchor!=this.current){var i=0;for(;i<c.length;++i){var node=c[i];if(node==this.anchor||node==this.current){break;}}for(++i;i<c.length;++i){var node=c[i];if(node==this.anchor||node==this.current){break;}this._addItemClass(node,"Selected");this.selection[node.id]=1;}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1;}}}else{if(this.singular){if(this.anchor==this.current){if(_4.isCopyKey(e)){this.selectNone();}}else{this.selectNone();this.anchor=this.current;this._addItemClass(this.anchor,"Anchor");this.selection[this.current.id]=1;}}else{if(_4.isCopyKey(e)){if(this.anchor==this.current){delete this.selection[this.anchor.id];this._removeAnchor();}else{if(this.current.id in this.selection){this._removeItemClass(this.current,"Selected");delete this.selection[this.current.id];}else{if(this.anchor){this._removeItemClass(this.anchor,"Anchor");this._addItemClass(this.anchor,"Selected");}this.anchor=this.current;this._addItemClass(this.current,"Anchor");this.selection[this.current.id]=1;}}}else{if(!(this.current.id in this.selection)){this.selectNone();this.anchor=this.current;this._addItemClass(this.current,"Anchor");this.selection[this.current.id]=1;}}}}_4.stopEvent(e);},onMouseUp:function(e){if(!this.simpleSelection){return;}this.simpleSelection=false;this.selectNone();if(this.current){this.anchor=this.current;this._addItemClass(this.anchor,"Anchor");this.selection[this.current.id]=1;}},onMouseMove:function(e){this.simpleSelection=false;},onOverEvent:function(){this.onmousemoveEvent=_4.connect(this.node,"onmousemove",this,"onMouseMove");},onOutEvent:function(){_4.disconnect(this.onmousemoveEvent);delete this.onmousemoveEvent;},_removeSelection:function(){var e=_4.dnd._empty;for(var i in this.selection){if(i in e){continue;}var node=_4.byId(i);if(node){this._removeItemClass(node,"Selected");}}this.selection={};return this;},_removeAnchor:function(){if(this.anchor){this._removeItemClass(this.anchor,"Anchor");this.anchor=null;}return this;}});}if(!_4._hasResource["dojo.dnd.Avatar"]){_4._hasResource["dojo.dnd.Avatar"]=true;_4.provide("dojo.dnd.Avatar");_4.declare("dojo.dnd.Avatar",null,{constructor:function(_330){this.manager=_330;this.construct();},construct:function(){this.isA11y=_4.hasClass(_4.body(),"dijit_a11y");var a=_4.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),_331=this.manager.source,node,b=_4.create("tbody",null,a),tr=_4.create("tr",null,b),td=_4.create("td",null,tr),icon=this.isA11y?_4.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"<"},td):null,span=_4.create("span",{innerHTML:_331.generateText?this._generateText():""},td),k=Math.min(5,this.manager.nodes.length),i=0;_4.attr(tr,{"class":"dojoDndAvatarHeader",style:{opacity:0.9}});for(;i<k;++i){if(_331.creator){node=_331._normalizedCreator(_331.getItem(this.manager.nodes[i].id).data,"avatar").node;}else{node=this.manager.nodes[i].cloneNode(true);if(node.tagName.toLowerCase()=="tr"){var _332=_4.create("table"),_333=_4.create("tbody",null,_332);_333.appendChild(node);node=_332;}}node.id="";tr=_4.create("tr",null,b);td=_4.create("td",null,tr);td.appendChild(node);_4.attr(tr,{"class":"dojoDndAvatarItem",style:{opacity:(9-i)/10}});}this.node=a;},destroy:function(){_4.destroy(this.node);this.node=false;},update:function(){_4[(this.manager.canDropFlag?"add":"remove")+"Class"](this.node,"dojoDndAvatarCanDrop");if(this.isA11y){var icon=_4.byId("a11yIcon");var text="+";if(this.manager.canDropFlag&&!this.manager.copy){text="< ";}else{if(!this.manager.canDropFlag&&!this.manager.copy){text="o";}else{if(!this.manager.canDropFlag){text="x";}}}icon.innerHTML=text;}_4.query(("tr.dojoDndAvatarHeader td span"+(this.isA11y?" span":"")),this.node).forEach(function(node){node.innerHTML=this._generateText();},this);},_generateText:function(){return this.manager.nodes.length.toString();}});}if(!_4._hasResource["dojo.dnd.Manager"]){_4._hasResource["dojo.dnd.Manager"]=true;_4.provide("dojo.dnd.Manager");_4.declare("dojo.dnd.Manager",null,{constructor:function(){this.avatar=null;this.source=null;this.nodes=[];this.copy=true;this.target=null;this.canDropFlag=false;this.events=[];},OFFSET_X:16,OFFSET_Y:16,overSource:function(_334){if(this.avatar){this.target=(_334&&_334.targetState!="Disabled")?_334:null;this.canDropFlag=Boolean(this.target);this.avatar.update();}_4.publish("/dnd/source/over",[_334]);},outSource:function(_335){if(this.avatar){if(this.target==_335){this.target=null;this.canDropFlag=false;this.avatar.update();_4.publish("/dnd/source/over",[null]);}}else{_4.publish("/dnd/source/over",[null]);}},startDrag:function(_336,_337,copy){this.source=_336;this.nodes=_337;this.copy=Boolean(copy);this.avatar=this.makeAvatar();_4.body().appendChild(this.avatar.node);_4.publish("/dnd/start",[_336,_337,this.copy]);this.events=[_4.connect(_4.doc,"onmousemove",this,"onMouseMove"),_4.connect(_4.doc,"onmouseup",this,"onMouseUp"),_4.connect(_4.doc,"onkeydown",this,"onKeyDown"),_4.connect(_4.doc,"onkeyup",this,"onKeyUp"),_4.connect(_4.doc,"ondragstart",_4.stopEvent),_4.connect(_4.body(),"onselectstart",_4.stopEvent)];var c="dojoDnd"+(copy?"Copy":"Move");_4.addClass(_4.body(),c);},canDrop:function(flag){var _338=Boolean(this.target&&flag);if(this.canDropFlag!=_338){this.canDropFlag=_338;this.avatar.update();}},stopDrag:function(){_4.removeClass(_4.body(),["dojoDndCopy","dojoDndMove"]);_4.forEach(this.events,_4.disconnect);this.events=[];this.avatar.destroy();this.avatar=null;this.source=this.target=null;this.nodes=[];},makeAvatar:function(){return new _4.dnd.Avatar(this);},updateAvatar:function(){this.avatar.update();},onMouseMove:function(e){var a=this.avatar;if(a){_4.dnd.autoScrollNodes(e);var s=a.node.style;s.left=(e.pageX+this.OFFSET_X)+"px";s.top=(e.pageY+this.OFFSET_Y)+"px";var copy=Boolean(this.source.copyState(_4.isCopyKey(e)));if(this.copy!=copy){this._setCopyStatus(copy);}}},onMouseUp:function(e){if(this.avatar){if(this.target&&this.canDropFlag){var copy=Boolean(this.source.copyState(_4.isCopyKey(e))),_339=[this.source,this.nodes,copy,this.target,e];_4.publish("/dnd/drop/before",_339);_4.publish("/dnd/drop",_339);}else{_4.publish("/dnd/cancel");}this.stopDrag();}},onKeyDown:function(e){if(this.avatar){switch(e.keyCode){case _4.keys.CTRL:var copy=Boolean(this.source.copyState(true));if(this.copy!=copy){this._setCopyStatus(copy);}break;case _4.keys.ESCAPE:_4.publish("/dnd/cancel");this.stopDrag();break;}}},onKeyUp:function(e){if(this.avatar&&e.keyCode==_4.keys.CTRL){var copy=Boolean(this.source.copyState(false));if(this.copy!=copy){this._setCopyStatus(copy);}}},_setCopyStatus:function(copy){this.copy=copy;this.source._markDndStatus(this.copy);this.updateAvatar();_4.replaceClass(_4.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"));}});_4.dnd._manager=null;_4.dnd.manager=function(){if(!_4.dnd._manager){_4.dnd._manager=new _4.dnd.Manager();}return _4.dnd._manager;};}if(!_4._hasResource["dojo.dnd.Source"]){_4._hasResource["dojo.dnd.Source"]=true;_4.provide("dojo.dnd.Source");_4.declare("dojo.dnd.Source",_4.dnd.Selector,{isSource:true,horizontal:false,copyOnly:false,selfCopy:false,selfAccept:true,skipForm:false,withHandles:false,autoSync:false,delay:0,accept:["text"],generateText:true,constructor:function(node,_33a){_4.mixin(this,_4.mixin({},_33a));var type=this.accept;if(type.length){this.accept={};for(var i=0;i<type.length;++i){this.accept[type[i]]=1;}}this.isDragging=false;this.mouseDown=false;this.targetAnchor=null;this.targetBox=null;this.before=true;this._lastX=0;this._lastY=0;this.sourceState="";if(this.isSource){_4.addClass(this.node,"dojoDndSource");}this.targetState="";if(this.accept){_4.addClass(this.node,"dojoDndTarget");}if(this.horizontal){_4.addClass(this.node,"dojoDndHorizontal");}this.topics=[_4.subscribe("/dnd/source/over",this,"onDndSourceOver"),_4.subscribe("/dnd/start",this,"onDndStart"),_4.subscribe("/dnd/drop",this,"onDndDrop"),_4.subscribe("/dnd/cancel",this,"onDndCancel")];},checkAcceptance:function(_33b,_33c){if(this==_33b){return !this.copyOnly||this.selfAccept;}for(var i=0;i<_33c.length;++i){var type=_33b.getItem(_33c[i].id).type;var flag=false;for(var j=0;j<type.length;++j){if(type[j] in this.accept){flag=true;break;}}if(!flag){return false;}}return true;},copyState:function(_33d,self){if(_33d){return true;}if(arguments.length<2){self=this==_4.dnd.manager().target;}if(self){if(this.copyOnly){return this.selfCopy;}}else{return this.copyOnly;}return false;},destroy:function(){_4.dnd.Source.superclass.destroy.call(this);_4.forEach(this.topics,_4.unsubscribe);this.targetAnchor=null;},markupFactory:function(_33e,node){_33e._skipStartup=true;return new _4.dnd.Source(node,_33e);},onMouseMove:function(e){if(this.isDragging&&this.targetState=="Disabled"){return;}_4.dnd.Source.superclass.onMouseMove.call(this,e);var m=_4.dnd.manager();if(!this.isDragging){if(this.mouseDown&&this.isSource&&(Math.abs(e.pageX-this._lastX)>this.delay||Math.abs(e.pageY-this._lastY)>this.delay)){var _33f=this.getSelectedNodes();if(_33f.length){m.startDrag(this,_33f,this.copyState(_4.isCopyKey(e),true));}}}if(this.isDragging){var _340=false;if(this.current){if(!this.targetBox||this.targetAnchor!=this.current){this.targetBox=_4.position(this.current,true);}if(this.horizontal){_340=(e.pageX-this.targetBox.x)<(this.targetBox.w/2);}else{_340=(e.pageY-this.targetBox.y)<(this.targetBox.h/2);}}if(this.current!=this.targetAnchor||_340!=this.before){this._markTargetAnchor(_340);m.canDrop(!this.current||m.source!=this||!(this.current.id in this.selection));}}},onMouseDown:function(e){if(!this.mouseDown&&this._legalMouseDown(e)&&(!this.skipForm||!_4.dnd.isFormElement(e))){this.mouseDown=true;this._lastX=e.pageX;this._lastY=e.pageY;_4.dnd.Source.superclass.onMouseDown.call(this,e);}},onMouseUp:function(e){if(this.mouseDown){this.mouseDown=false;_4.dnd.Source.superclass.onMouseUp.call(this,e);}},onDndSourceOver:function(_341){if(this!=_341){this.mouseDown=false;if(this.targetAnchor){this._unmarkTargetAnchor();}}else{if(this.isDragging){var m=_4.dnd.manager();m.canDrop(this.targetState!="Disabled"&&(!this.current||m.source!=this||!(this.current.id in this.selection)));}}},onDndStart:function(_342,_343,copy){if(this.autoSync){this.sync();}if(this.isSource){this._changeState("Source",this==_342?(copy?"Copied":"Moved"):"");}var _344=this.accept&&this.checkAcceptance(_342,_343);this._changeState("Target",_344?"":"Disabled");if(this==_342){_4.dnd.manager().overSource(this);}this.isDragging=true;},onDndDrop:function(_345,_346,copy,_347){if(this==_347){this.onDrop(_345,_346,copy);}this.onDndCancel();},onDndCancel:function(){if(this.targetAnchor){this._unmarkTargetAnchor();this.targetAnchor=null;}this.before=true;this.isDragging=false;this.mouseDown=false;this._changeState("Source","");this._changeState("Target","");},onDrop:function(_348,_349,copy){if(this!=_348){this.onDropExternal(_348,_349,copy);}else{this.onDropInternal(_349,copy);}},onDropExternal:function(_34a,_34b,copy){var _34c=this._normalizedCreator;if(this.creator){this._normalizedCreator=function(node,hint){return _34c.call(this,_34a.getItem(node.id).data,hint);};}else{if(copy){this._normalizedCreator=function(node,hint){var t=_34a.getItem(node.id);var n=node.cloneNode(true);n.id=_4.dnd.getUniqueId();return {node:n,data:t.data,type:t.type};};}else{this._normalizedCreator=function(node,hint){var t=_34a.getItem(node.id);_34a.delItem(node.id);return {node:node,data:t.data,type:t.type};};}}this.selectNone();if(!copy&&!this.creator){_34a.selectNone();}this.insertNodes(true,_34b,this.before,this.current);if(!copy&&this.creator){_34a.deleteSelectedNodes();}this._normalizedCreator=_34c;},onDropInternal:function(_34d,copy){var _34e=this._normalizedCreator;if(this.current&&this.current.id in this.selection){return;}if(copy){if(this.creator){this._normalizedCreator=function(node,hint){return _34e.call(this,this.getItem(node.id).data,hint);};}else{this._normalizedCreator=function(node,hint){var t=this.getItem(node.id);var n=node.cloneNode(true);n.id=_4.dnd.getUniqueId();return {node:n,data:t.data,type:t.type};};}}else{if(!this.current){return;}this._normalizedCreator=function(node,hint){var t=this.getItem(node.id);return {node:node,data:t.data,type:t.type};};}this._removeSelection();this.insertNodes(true,_34d,this.before,this.current);this._normalizedCreator=_34e;},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){_4.dnd.Source.superclass.onOverEvent.call(this);_4.dnd.manager().overSource(this);if(this.isDragging&&this.targetState!="Disabled"){this.onDraggingOver();}},onOutEvent:function(){_4.dnd.Source.superclass.onOutEvent.call(this);_4.dnd.manager().outSource(this);if(this.isDragging&&this.targetState!="Disabled"){this.onDraggingOut();}},_markTargetAnchor:function(_34f){if(this.current==this.targetAnchor&&this.before==_34f){return;}if(this.targetAnchor){this._removeItemClass(this.targetAnchor,this.before?"Before":"After");}this.targetAnchor=this.current;this.targetBox=null;this.before=_34f;if(this.targetAnchor){this._addItemClass(this.targetAnchor,this.before?"Before":"After");}},_unmarkTargetAnchor:function(){if(!this.targetAnchor){return;}this._removeItemClass(this.targetAnchor,this.before?"Before":"After");this.targetAnchor=null;this.targetBox=null;this.before=true;},_markDndStatus:function(copy){this._changeState("Source",copy?"Copied":"Moved");},_legalMouseDown:function(e){if(!_4.mouseButtons.isLeft(e)){return false;}if(!this.withHandles){return true;}for(var node=e.target;node&&node!==this.node;node=node.parentNode){if(_4.hasClass(node,"dojoDndHandle")){return true;}if(_4.hasClass(node,"dojoDndItem")||_4.hasClass(node,"dojoDndIgnore")){break;}}return false;}});_4.declare("dojo.dnd.Target",_4.dnd.Source,{constructor:function(node,_350){this.isSource=false;_4.removeClass(this.node,"dojoDndSource");},markupFactory:function(_351,node){_351._skipStartup=true;return new _4.dnd.Target(node,_351);}});_4.declare("dojo.dnd.AutoSource",_4.dnd.Source,{constructor:function(node,_352){this.autoSync=true;},markupFactory:function(_353,node){_353._skipStartup=true;return new _4.dnd.AutoSource(node,_353);}});}if(!_4._hasResource["dojox.fx._base"]){_4._hasResource["dojox.fx._base"]=true;_4.provide("dojox.fx._base");_4.mixin(_6.fx,{anim:_4.anim,animateProperty:_4.animateProperty,fadeTo:_4._fade,fadeIn:_4.fadeIn,fadeOut:_4.fadeOut,combine:_4.fx.combine,chain:_4.fx.chain,slideTo:_4.fx.slideTo,wipeIn:_4.fx.wipeIn,wipeOut:_4.fx.wipeOut});_6.fx.sizeTo=function(args){var node=args.node=_4.byId(args.node),abs="absolute";var _354=args.method||"chain";if(!args.duration){args.duration=500;}if(_354=="chain"){args.duration=Math.floor(args.duration/2);}var top,_355,left,_356,_357,_358=null;var init=(function(n){return function(){var cs=_4.getComputedStyle(n),pos=cs.position,w=cs.width,h=cs.height;top=(pos==abs?n.offsetTop:parseInt(cs.top)||0);left=(pos==abs?n.offsetLeft:parseInt(cs.left)||0);_357=(w=="auto"?0:parseInt(w));_358=(h=="auto"?0:parseInt(h));_356=left-Math.floor((args.width-_357)/2);_355=top-Math.floor((args.height-_358)/2);if(pos!=abs&&pos!="relative"){var ret=_4.coords(n,true);top=ret.y;left=ret.x;n.style.position=abs;n.style.top=top+"px";n.style.left=left+"px";}};})(node);var _359=_4.animateProperty(_4.mixin({properties:{height:function(){init();return {end:args.height||0,start:_358};},top:function(){return {start:top,end:_355};}}},args));var _35a=_4.animateProperty(_4.mixin({properties:{width:function(){return {start:_357,end:args.width||0};},left:function(){return {start:left,end:_356};}}},args));var anim=_4.fx[(args.method=="combine"?"combine":"chain")]([_359,_35a]);return anim;};_6.fx.slideBy=function(args){var node=args.node=_4.byId(args.node),top,left;var init=(function(n){return function(){var cs=_4.getComputedStyle(n);var pos=cs.position;top=(pos=="absolute"?n.offsetTop:parseInt(cs.top)||0);left=(pos=="absolute"?n.offsetLeft:parseInt(cs.left)||0);if(pos!="absolute"&&pos!="relative"){var ret=_4.coords(n,true);top=ret.y;left=ret.x;n.style.position="absolute";n.style.top=top+"px";n.style.left=left+"px";}};})(node);init();var _35b=_4.animateProperty(_4.mixin({properties:{top:top+(args.top||0),left:left+(args.left||0)}},args));_4.connect(_35b,"beforeBegin",_35b,init);return _35b;};_6.fx.crossFade=function(args){var _35c=args.nodes[0]=_4.byId(args.nodes[0]),op1=_4.style(_35c,"opacity"),_35d=args.nodes[1]=_4.byId(args.nodes[1]),op2=_4.style(_35d,"opacity");var _35e=_4.fx.combine([_4[(op1==0?"fadeIn":"fadeOut")](_4.mixin({node:_35c},args)),_4[(op1==0?"fadeOut":"fadeIn")](_4.mixin({node:_35d},args))]);return _35e;};_6.fx.highlight=function(args){var node=args.node=_4.byId(args.node);args.duration=args.duration||400;var _35f=args.color||"#ffff99",_360=_4.style(node,"backgroundColor");if(_360=="rgba(0, 0, 0, 0)"){_360="transparent";}var anim=_4.animateProperty(_4.mixin({properties:{backgroundColor:{start:_35f,end:_360}}},args));if(_360=="transparent"){_4.connect(anim,"onEnd",anim,function(){node.style.backgroundColor=_360;});}return anim;};_6.fx.wipeTo=function(args){args.node=_4.byId(args.node);var node=args.node,s=node.style;var dir=(args.width?"width":"height"),_361=args[dir],_362={};_362[dir]={start:function(){s.overflow="hidden";if(s.visibility=="hidden"||s.display=="none"){s[dir]="1px";s.display="";s.visibility="";return 1;}else{var now=_4.style(node,dir);return Math.max(now,1);}},end:_361};var anim=_4.animateProperty(_4.mixin({properties:_362},args));return anim;};}if(!_4._hasResource["dojox.fx"]){_4._hasResource["dojox.fx"]=true;_4.provide("dojox.fx");}if(!_4._hasResource["dojo.DeferredList"]){_4._hasResource["dojo.DeferredList"]=true;_4.provide("dojo.DeferredList");_4.DeferredList=function(list,_363,_364,_365,_366){var _367=[];_4.Deferred.call(this);var self=this;if(list.length===0&&!_363){this.resolve([0,[]]);}var _368=0;_4.forEach(list,function(item,i){item.then(function(_369){if(_363){self.resolve([i,_369]);}else{_36a(true,_369);}},function(_36b){if(_364){self.reject(_36b);}else{_36a(false,_36b);}if(_365){return null;}throw _36b;});function _36a(_36c,_36d){_367[i]=[_36c,_36d];_368++;if(_368===list.length){self.resolve(_367);}};});};_4.DeferredList.prototype=new _4.Deferred();_4.DeferredList.prototype.gatherResults=function(_36e){var d=new _4.DeferredList(_36e,false,true,false);d.addCallback(function(_36f){var ret=[];_4.forEach(_36f,function(_370){ret.push(_370[1]);});return ret;});return d;};}if(!_4._hasResource["pundit.TripleComposer"]){_4._hasResource["pundit.TripleComposer"]=true;_4.provide("pundit.TripleComposer");_4.declare("pundit.TripleComposer",pundit.BaseComponent,{tripleDnD:{},constructor:function(_371){var self=this,pu="<div id=\"pundit-tc-container\" class=\"pundit-tab pundit-selected\">";pu+="    <div class=\"pundit-tab-header\">";pu+="      <span class=\"pundit-gui-button\" id=\"pundit-tc-save-button\"><span class=\"pundit-bicon pundit-save-icon\"></span><span>Save</span></span>";pu+="      <span class=\"pundit-gui-button\" id=\"pundit-tc-add-triple-button\"><span class=\"pundit-bicon pundit-add-triple-icon\"></span>Add a new triple</span>";pu+="      <span class=\"pundit-gui-button\" id=\"pundit-tc-push-wikidata-button\"><span class=\"pundit-bicon pundit-push-wikidata-icon\"></span><span class=\"push-to-wikidata\">Push to Wikidata</span></span>";pu+="      <span class=\"pundit-gui-button\" id=\"pundit-tc-reset-button\"><span>Reset</span></span>";pu+="      <span id=\"pundit-tc-edit-msg\">Editing annotation XY</span>";pu+="    </div>";pu+="    <div id=\"pundit-tc-labels-container\" class=\"pundit-stop-wheel-propagation\">";pu+="        <div style=\"position:absolute;margin-left:6px\">Subject</div>";pu+="        <div style=\"position:absolute;margin-left:142px\">Predicate</div>";pu+="        <div style=\"position:absolute;margin-left:280px\">Object</div>";pu+="    </div>";pu+="    <div id=\"pundit-tc-triples-container\" class=\"pundit-tab-content pundit-stop-wheel-propagation\">";pu+="    </div>";pu+="  </div>";_4.query("#pundit-gui-right").append(pu);self.saver=new pundit.AnnotationWriter();self.subjSuggestionPanel=new pundit.ResourcesPanel({name:"subj-suggestions",searchType:"filter",field:"subject"});self.subjSuggestionPanel.onItemAdded(function(item){self.addItem(item);self.subjSuggestionPanel.hide();});self.objSuggestionPanel=new pundit.ResourcesPanel({name:"obj-suggestions",field:"object",searchType:"filter",namedEntitiesSources:_PUNDIT.config.activeEntitySources});self.objSuggestionPanel.onItemAdded(function(item){self.addItem(item);self.objSuggestionPanel.hide();});self.propSuggestionPanel=new pundit.ResourcesPanel({name:"pred-suggestions",field:"predicate",searchType:"filter"});self.propSuggestionPanel.onItemAdded(function(item){self.addItem(item);self.propSuggestionPanel.hide();});semlibWindow.onWindowResize(function(_372){self.checkNeedToHideResourcePanel(_372);});semlibWindow.onWindowClose(function(){self.subjSuggestionPanel.hide();self.propSuggestionPanel.hide();self.objSuggestionPanel.hide();});self.initDnD();self.initBehaviors();self.pushToWikidata();self.createCallback(["save"]);self.log("Pundit up and running!");},initBehaviors:function(){var self=this;self.saver.onError(function(m){self.log("ERROR!!! Saver answered with "+m);_4.query("#pundit-tc-container").removeClass("pundit-panel-loading");});self.saver.onSave(function(m){self.log("Saver answered with "+m);self.saveItems(m);});self.saver.onSaveItems(function(_373){self.clearDnDTriples();_4.query("#pundit-tc-container").removeClass("pundit-panel-loading");self.tryToShowAnnotation=_373;self.fireOnSave();});_4.connect(_4.byId("pundit-tc-save-button"),"onclick",function(){_PUNDIT.ga.track("gui-button","click","#pundit-tc-save-button");_4.query("#pundit-tc-container").addClass("pundit-panel-loading");self.saveTriples();});_4.connect(_4.byId("pundit-tc-add-triple-button"),"onclick",function(){_PUNDIT.ga.track("gui-button","click","#pundit-tc-add-triple.button");self.subjSuggestionPanel.hide();self.objSuggestionPanel.hide();self.propSuggestionPanel.hide();self.addDnDTriple();});_4.subscribe("/dnd/start",null,function(s,_374){self.highlightDnDTargetsReceivingNodes(s,_374);});_4.subscribe("/dnd/cancel",null,function(){_4.query(".pundit-tc-dnd-container ul").removeClass("dnd_selected");});_4.subscribe("/dnd/drop",function(_375,_376,copy,_377){_4.query(".pundit-tc-dnd-container ul").removeClass("dnd_selected");self.resetSelections();if(_377.node.id.substring(0,10)==="pundit-tc-"){var item,_378,uri;if(typeof (_375.semlibTree)!=="undefined"){_PUNDIT.ga.track("items","drop","triple-composer-drop-from-tree");for(var i=_376.length-1;i>=0;i--){_378=_375.getItem(_376[i].id);item={description:_378.data.item.description[0],label:_378.data.item.label[0],rdftype:_378.data.item.rdftype,type:_378.data.item.type,value:_378.data.item.value[0]};if(typeof (_378.data.item.image)!=="undefined"){item.image=_378.data.item.image[0];}uri=item.value;item.rdfData=semlibMyItems.createBucketForVocabItem(item).bucket;if(!semlibMyItems.uriInItems(uri)){semlibMyItems.addItem(item,true);}setTimeout("dojo.behavior.apply();",50);return;}}_PUNDIT.ga.track("items","drop","triple-composer-drop");for(var i=_376.length-1;i>=0;i--){var id=_4.attr(_376[i],"id");item=_375.map[id];if(typeof item!=="undefined"){uri=item.data.value;if(!semlibMyItems.uriInItems(uri)){semlibMyItems.addItem(item.data,true);}}}}setTimeout("dojo.behavior.apply();",50);});_4.behavior.add({"#pundit-tc-triples-container li.dojoDndItem span.pundit-icon-context-button":{"onclick":function(e){cMenu.show(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset,_4.query(e.target).parent()[0].id,"pundititem");_4.stopEvent(e);}},"#pundit-tc-triples-container li.dojoDndItem":{"onmouseover":function(e){var id=(_4.hasClass(e.target,"pundit-icon-context-button"))?_4.query(e.target).parent()[0].id:e.target.id,item;item=self.getItemFromId(id);if(typeof (item)!=="undefined"){previewer.show(item.data.value);}},"onclick":function(e){_4.stopEvent(e);}}});cMenu.addAction({type:["pundititem"],name:"removePunditItem",label:"Remove this item",showIf:function(id){return true;},onclick:function(id){_PUNDIT.ga.track("cmenu","click","triple-composer-remove-item");_4.destroy(id);for(var i in self.tripleDnD){["s","p","o"].forEach(function(_379){var _37a=self.tripleDnD[i][_379].getItem(id);if(typeof (_37a)!=="undefined"){self.tripleDnD[i][_379].delItem(id);self.tripleDnD[i][_379].sync();}});}return true;}});},initDnD:function(){var self=this;self.addDnDTriple();},getItemFromId:function(id){var self=this,bits=["s","p","o"],ret;for(var i in self.tripleDnD){for(var j=bits.length;j--;){if(ret=self.tripleDnD[i][bits[j]].getItem(id)){return ret;}}}return undefined;},addDnDTriple:function(_37b){var self=this,c="",u="";for(var i=5;i--;){u+="abcdefghijklmnopqrstuvwxyz0123456789".charAt(0|Math.random()*36);}c+="<div class=\"pundit-tc-dnd-container expanded\" id=\"pundit-tc-dnd-container"+u+"\">";c+="  <ul class=\"pundit-tc-dnd sub pundit-items pundit-small-items\" id=\"pundit-tc-s-"+u+"\"></ul>";c+="  <ul class=\"pundit-tc-dnd pre pundit-items pundit-small-items\" id=\"pundit-tc-p-"+u+"\"></ul>";c+="  <ul class=\"pundit-tc-dnd obj pundit-items pundit-small-items\" id=\"pundit-tc-o-"+u+"\"></ul>";c+="  <div class=\"pundit-tc-dndButtons\">";c+="    <span id=\"punditRemoveTriple"+u+"\"><span class=\"pundit-remove-icon pundit-icon\"></span></span>";c+="  </div>";c+="</div>";_4.query("#pundit-tc-triples-container .pundit-tc-dnd-container").removeClass("expanded").addClass("collapsed");if(!_37b){_4.query("#pundit-tc-triples-container").prepend(c);}else{_4.query("#pundit-tc-triples-container").append(c);}self.tripleDnD[u]={};self.tripleDnD[u]["s"]=new _4.dnd.Source("pundit-tc-s-"+u,{creator:semlibItems.itemNodeCreator,checkAcceptance:function(s,n){return self.checkAcceptance(s,n,this);},onDndDrop:function(s,n,c,t){if(this==t){if(this.getAllNodes().length>0){this.clearItems();_4.empty(_4.byId("pundit-tc-s-"+u));}this.onDrop(s,n,c);self.subjSuggestionPanel.hide();self.propSuggestionPanel.hide();self.objSuggestionPanel.hide();}this.onDndCancel();},accept:["subject"]});self.tripleDnD[u]["p"]=new _4.dnd.Source("pundit-tc-p-"+u,{creator:semlibItems.itemNodeCreator,checkAcceptance:function(s,n){return self.checkAcceptance(s,n,this);},onDndDrop:function(s,n,c,t){if(this==t){if(this.getAllNodes().length>0){this.clearItems();_4.empty(_4.byId("pundit-tc-p-"+u));}this.onDrop(s,n,c);self.propSuggestionPanel.hide();}this.onDndCancel();},accept:["predicate"]});self.tripleDnD[u]["o"]=new _4.dnd.Source("pundit-tc-o-"+u,{creator:semlibItems.itemNodeCreator,checkAcceptance:function(s,n){return self.checkAcceptance(s,n,this);},onDndDrop:function(s,n,c,t){if(this==t){if(this.getAllNodes().length>0){this.clearItems();_4.empty(_4.byId("pundit-tc-o-"+u));}this.onDrop(s,n,c);self.subjSuggestionPanel.hide();self.propSuggestionPanel.hide();self.objSuggestionPanel.hide();}this.onDndCancel();},accept:["subject","object"]});_4.connect(_4.byId("punditRemoveTriple"+u),"onclick",function(e){_PUNDIT.ga.track("gui-button","click","triple-composer-remove-triple");self.subjSuggestionPanel.hide();self.objSuggestionPanel.hide();self.propSuggestionPanel.hide();self.removeTripleRow(u);if(_4.query(".pundit-tc-dnd-container").length===0){self.addDnDTriple();}});_4.connect(_4.byId("pundit-tc-s-"+u),"onclick",function(e){_PUNDIT.ga.track("gui-button","click","triple-composer-subject");self.dndTargetsClickHandler(e,this,"s");});_4.connect(_4.byId("pundit-tc-p-"+u),"onclick",function(e){_PUNDIT.ga.track("gui-button","click","triple-composer-predicate");self.dndTargetsClickHandler(e,this,"p");});_4.connect(_4.byId("pundit-tc-o-"+u),"onclick",function(e){_PUNDIT.ga.track("gui-button","click","triple-composer-object");self.dndTargetsClickHandler(e,this,"o");});return u;},removeTripleRow:function(row){var self=this;self.log("Removing triple row "+row);self.tripleDnD[row]["s"].destroy();self.tripleDnD[row]["p"].destroy();self.tripleDnD[row]["o"].destroy();_4.destroy("pundit-tc-dnd-container"+row);delete self.tripleDnD[row];},clearDnDTriples:function(){var self=this;for(var row in self.tripleDnD){self.removeTripleRow(row);}self.subjSuggestionPanel.hide();self.propSuggestionPanel.hide();self.objSuggestionPanel.hide();self.objSuggestionPanel.reset();self.addDnDTriple();},dndTargetsClickHandler:function(e,_37c,type){var self=this,u=_4.attr(_37c,"id").substr(-5),_37d=_4.position(_37c),y=_37d.y+_37d.h,x,_37e,_37f;self.currentDnd=self.tripleDnD[u][type];if(type==="p"){x=(_37d.x+(_37d.w/2))-200;_37e="Relations";_37f="center";}else{if(type==="s"){x=_37d.x;_37e="Subjects";_37f="left";}else{if(type==="o"){x=(_37d.x+_37d.w)-400;_37e="Objects";_37f="right";}}}if(type==="p"){var _380=[],_381=[];if(typeof self.tripleDnD[u]["s"].map!=="undefined"){for(var i in self.tripleDnD[u]["s"].map){_381=self.tripleDnD[u]["s"].map[i].data.rdftype;}}if(typeof self.tripleDnD[u]["o"].map!=="undefined"){for(var i in self.tripleDnD[u]["o"].map){_380=self.tripleDnD[u]["o"].map[i].data.rdftype;}}var _382=semlibItems.getProperties(_380,_381);var _383={properties:{label:"Relations",items:_382}};self.propSuggestionPanel.load(_383);self.propSuggestionPanel.show(x,y,{title:_37e,arrow:_37f});self.subjSuggestionPanel.hide();self.objSuggestionPanel.hide();}else{if(type==="s"){var _384=self.getAcceptedTypes(u,_37c);var _385=semlibMyItems.getItemsFromTerm("",_384);var _386=semlibItems.getItemsFromTerm("",_384);var _387={myitems:{label:"My Items",items:_385},pageitems:{label:"Page Items",items:_386}};for(var v in _PUNDIT["vocab"].vocabs){var _388=_PUNDIT["vocab"].getItemsForTermInVocab("",v,_384);_387[v]={label:v,items:_388};}self.subjSuggestionPanel.load(_387);if(type==="o"){if(_384.length===0){self.subjSuggestionPanel.show(x,y,{title:_37e,arrow:_37f,literalMode:"literalEnabled"});}else{if(_384[0]===ns.rdfs_literal){self.subjSuggestionPanel.show(x,y,{title:_37e,arrow:_37f,literalMode:"literalOnly"});}else{self.subjSuggestionPanel.show(x,y,{title:_37e,arrow:_37f});}}}else{self.subjSuggestionPanel.show(x,y,{title:_37e,arrow:_37f});}self.propSuggestionPanel.hide();self.objSuggestionPanel.hide();}else{if(type==="o"){var _384=self.getAcceptedTypes(u,_37c);var _385=semlibMyItems.getItemsFromTerm("",_384);var _386=semlibItems.getItemsFromTerm("",_384);var _387={myitems:{label:"My Items",items:_385},pageitems:{label:"Page Items",items:_386}};for(var v in _PUNDIT["vocab"].vocabs){var _388=_PUNDIT["vocab"].getItemsForTermInVocab("",v,_384);_387[v]={label:v,items:_388};}self.objSuggestionPanel.load(_387);if(type==="o"){if(_384.length===0){self.objSuggestionPanel.show(x,y,{title:_37e,arrow:_37f,literalMode:"literalEnabled"});}else{if(_384[0]===ns.rdfs_literal){var _389=_4.query("#pundit-tc-p-"+u+" li span.pundit-item-label")[0].innerHTML.toLowerCase();self.objSuggestionPanel.show(x,y,{title:_37e,arrow:_37f,literalMode:_389.match(/date/)===null?"literalOnly":"dateOnly"});}else{self.objSuggestionPanel.show(x,y,{title:_37e,arrow:_37f});}}}else{self.objSuggestionPanel.show(x,y,{title:_37e,arrow:_37f});}self.propSuggestionPanel.hide();self.subjSuggestionPanel.hide();}}}_4.query(".pundit-tc-dnd-container ul").removeClass("dnd_selected");_4.query(e.target).addClass("dnd_selected");},highlightDnDTargetsReceivingNodes:function(_38a,_38b){var self=this,bits=["s","p","o"];_4.query(".pundit-tc-dnd-container ul").removeClass("dnd_selected");for(var row in self.tripleDnD){for(var j=bits;j--;){if(self.checkAcceptance(_38a,_38b,self.tripleDnD[row][bits[j]])){_4.addClass("pundit-tc-"+bits[j]+"-"+row,"dnd_selected");}}}},addItem:function(item){var self=this;var _38c=self.currentDnd.getAllNodes();if(_38c.length>0){self.currentDnd.clearItems();_38c.forEach(function(item){_4.destroy(item);});}self.currentDnd.insertNodes(false,[item]);},checkAcceptance:function(_38d,_38e,_38f,_390){if(_38f===_38d){return false;}if(typeof (_38d.semlibTree)!=="undefined"){for(i=_38e.length-1;i>=0;i--){var id=_38e[i].id,item=_38d.getItem(id),flag=false;if(typeof (item.data.item.type)!=="undefined"){var type=item.data.item.type;for(j=type.length-1;j>=0;j--){if(type[j] in _38f.accept){flag=true;break;}}if(flag===false){return false;}}else{return false;}}var u=_38f.parent.id.substr(-5),self=this,_391=[],_392=[];_38f.forInItems(function(item){_392.push(item.data.value);});for(var i=_38e.length-1;i>=0;i--){_391[i]=_38d.getItem(_38e[i].id);if(_392.length>0&&_4.indexOf(_392,_391[i].data.item.value)!==-1){return false;}}return self.rowAcceptItems(u,_391,_38f);}for(var i=_38e.length-1;i>=0;i--){var type=_38d.getItem(_38e[i].id).type,uri=_38d.getItem(_38e[i].id).data.value,flag=false;for(var j=type.length-1;j>=0;j--){if(type[j] in _38f.accept){flag=true;break;}}if(flag===false){return false;}}var u=_38f.parent.id.substr(-5),self=this,_391=[],_392=[];_38f.forInItems(function(item){_392.push(item.data.value);});for(var i=_38e.length-1;i>=0;i--){_391[i]=_38d.getItem(_38e[i].id);if(_392.length>0&&_4.indexOf(_392,_391[i].data.value)!==-1){return false;}}return self.rowAcceptItems(u,_391,_38f);},rowAcceptItems:function(row,item,_393){var self=this,_394=_393.parent.id.substr(10,1);var _395=item.slice(0);if(typeof (_395[0].data.type)==="undefined"){for(var j=_395.length;j--;){_395[j].data=_395[j].data.item;}}if(_394==="s"){var _396,_397=[];self.tripleDnD[row]["p"].forInItems(function(item){if(item.data.domain.length>0){_397.push(item.data.domain);}});_396=self._intersection(_397);if(_396.length===0){if(_397.length!==0){self.log("Error in the predicate? No possible domains found!");return false;}return true;}else{var _398=[];for(var i=_395.length-1;i>=0;i--){_398.push(_395[i].data.rdftype);}_398=self._intersection(_398);if(self._intersection([_398,_396]).length===0){return false;}else{return true;}}}else{if(_394==="o"){var _399,_39a=[];self.tripleDnD[row]["p"].forInItems(function(item){if(item.data.range.length>0){_39a.push(item.data.range);}});_399=self._intersection(_39a);if(_399.length===0){if(_39a.length!==0){self.log("Error in the predicate? No possible ranges found!");return false;}return true;}else{var _398=[];for(var i=_395.length-1;i>=0;i--){_398.push(_395[i].data.rdftype);}_398=self._intersection(_398);if(self._intersection([_398,_399]).length===0){return false;}else{return true;}}}else{if(_394==="p"){var _39b=[],suL,_39c=0,_39d=[],obL,_39e=0,_39f=false;self.tripleDnD[row]["s"].forInItems(function(item){_39c++;if(item.data.rdftype.length>0){_39b.push(item.data.rdftype);}});self.tripleDnD[row]["o"].forInItems(function(item){_39e++;if(item.data.rdftype.length===0){_39f=true;}if(item.data.rdftype.length>0){_39d.push(item.data.rdftype);}});obL=_39d.length;suL=_39b.length;_39b=self._intersection(_39b);_39d=self._intersection(_39d);if(obL+suL>0){if(_39b.length===0&&suL>0){self.log("Subjects types intersection is empty!! Error in the subject panel.");return;}if(_39d.length===0&&obL>0){self.log("Objects type intersection is empty!! Error in the object panel.");return;}var _396=[],_399=[];for(var i=_395.length-1;i>=0;i--){if(_395[i].data.domain.length>0){_396.push(_395[i].data.domain);}if(_395[i].data.range.length>0){_399.push(_395[i].data.range);}}_396=self._intersection(_396);_399=self._intersection(_399);if(suL>0&&_396.length>0&&self._intersection([_396,_39b]).length===0){return false;}if(obL>0&&_399.length>0&&self._intersection([_399,_39d]).length===0){return false;}if(_39f===true&&_399.length>0){return false;}self.log("Items passed matches domains '"+_396.join(", ")+"' and ranges '"+_399.join(", ")+"'");return true;}else{var _399=[];for(var i=_395.length-1;i>=0;i--){if(_395[i].data.range.length>0){_399.push(_395[i].data.range);}}_399=self._intersection(_399);if(_39e+_39c===0){self.log("Items passing test: no items in subject nor object containers!");return true;}if(_399.length===0&&_39d.length===0){self.log("Items passing test: empty ranges .. Found a literal?");return true;}}}}}return false;},_intersection:function(a){if(a.length===0){return [];}if(a.length===1){return a[0];}var ret=[],val,foo;for(var i=a[0].length-1;i>=0;i--){val=a[0][i];foo=true;for(var j=a.length-1;j>0;j--){if(_4.indexOf(a[j],val)===-1){foo=false;}}if(foo){ret.push(val);}}return ret;},getAcceptedTypes:function(row,_3a0){var self=this,_3a1=[],_3a2,_3a3=[],_3a4=_3a0.id.substr(10,1);if(_3a4==="s"){return [ns.fragments.text,ns.fragments.image,ns.image,ns.page];}if(_3a4==="p"){}if(_3a4==="o"){var _3a5,_3a6=[];self.tripleDnD[row]["p"].forInItems(function(item){if(item.data.range.length>0){_3a6.push(item.data.range);}});return self._intersection(_3a6);}},resetSelections:function(){var self=this;for(var i in self.tripleDnD){self.tripleDnD[i]["s"].selectNone();self.tripleDnD[i]["p"].selectNone();self.tripleDnD[i]["o"].selectNone();}},getSafePageContext:function(){var self=this,uri=window.location.href,_3a7,_3a8,_3a9,ret;if(uri.indexOf("#")!==-1){_3a7=uri.substring(uri.indexOf("#")+1,uri.length);uri=uri.substring(0,uri.indexOf("#"));}if(uri.indexOf("?")!==-1){_3a8=uri.substring(uri.indexOf("?")+1,uri.length);uri=uri.substring(0,uri.indexOf("?"));_3a9=_4.queryToObject(_3a8);delete _3a9["pundit-show"];_3a8=_4.objectToQuery(_3a9);}if(_3a8){uri+="?"+_3a8;}if(_3a7){uri+="#"+_3a7;}return uri;},getQueryParametersObject:function(){var uri=window.location.href,_3aa;if(uri.indexOf("#")!==-1){uri=uri.substring(0,uri.indexOf("#"));}_3aa=uri.substring(uri.indexOf("?")+1,uri.length);return _4.queryToObject(_3aa);},saveTriples:function(){var self=this,_3ab=[],_3ac=self.getSafePageContext(),b=new pundit.TriplesBucket();if(_3ac.indexOf("#xpointer(")!==-1){_3ac=_3ac.split("#")[0];}for(var row in self.tripleDnD){var s=[],p=[],o=[];self.tripleDnD[row]["s"].forInItems(function(item){s.push(item);});self.tripleDnD[row]["p"].forInItems(function(item){p.push(item);});self.tripleDnD[row]["o"].forInItems(function(item){o.push(item);});if((typeof (s)==="undefined")||(typeof (p)==="undefined")||(typeof (o)==="undefined")){break;}for(var i=s.length;i--;){for(var j=p.length;j--;){for(var k=o.length;k--;){var _3ad,sd=s[i].data,sv=sd.value,pd=p[j].data,pv=pd.value,od=o[k].data,ov=od.value;if(o[k].data.type[0]==="object"&&(o[k].data.rdftype.length===0||o[k].data.rdftype[0]===ns.rdfs_literal)){_3ad="literal";}else{_3ad="uri";}b.addTriple(sv,pv,ov,_3ad);if(sv.indexOf("#xpointer(")!==-1&&_4.indexOf(_3ab,sv)===-1){_3ab.push(sv);}if(ov.indexOf("#xpointer(")!==-1&&_4.indexOf(_3ab,ov)===-1){_3ab.push(ov);}if("parentItemXP" in sd){self.log("Found a parent Item XP while saving, adding the target "+sd.parentItemXP);_3ab.push(sd.parentItemXP);}if("parentItemXP" in od){self.log("Found a parent Item XP while saving, adding the target "+od.parentItemXP);_3ab.push(od.parentItemXP);}if(_PUNDIT.config.isModuleActive("pundit.ImageFragmentHandler")){var _3ae=semlibImageFragmentHandler.getParentImageXpointer(sv);if(typeof (_3ae)!=="undefined"){_3ab.push(_3ae);}var _3af=semlibImageFragmentHandler.getParentImageXpointer(ov);if(typeof (_3af)!=="undefined"){_3ab.push(_3af);}}if(_4.indexOf(sd.rdftype,ns.fragments.image)!==-1){_3ab.push(sv);}if(_4.indexOf(od.rdftype,ns.fragments.image)!==-1){_3ab.push(ov);}if(_4.indexOf(sd.rdftype,ns.page)!==-1){_3ab.push(sv);}if(_4.indexOf(od.rdftype,ns.page)!==-1){_3ab.push(ov);}}}}self.log("Added TripleComposer row "+row+" to save bucket");}if(b.isEmpty()){self.log("Cannot save an incomplete annotation");_4.query("#pundit-tc-container").removeClass("pundit-panel-loading");return;}if(self.isEditing){self.saver.deleteAnnotation(self.isEditing,function(){self.log("Deleted annotation "+self.isEditing);semlibWindow.destroyPanelById(self.isEditing);self.isEditing=false;_4.query("#pundit-tc-container").removeClass("pundit-edit-mode");});}self.log("Saving current: "+_4.toJson(b.getTalisJson()));self.saver.writeAnnotationContent(b,_3ab,_3ac);},saveItems:function(_3b0){var self=this,b=new pundit.TriplesBucket(),_3b1=[];for(var row in self.tripleDnD){var s=[],p=[],o=[];self.tripleDnD[row]["s"].forInItems(function(item){s.push(item);});self.tripleDnD[row]["p"].forInItems(function(item){p.push(item);});self.tripleDnD[row]["o"].forInItems(function(item){o.push(item);});if(s.length===0||p.length===0||o.length===0){self.log("No items to save in row "+row+": skipping it.");break;}_3b1=_3b1.concat(s).concat(p).concat(o);}for(var i=_3b1.length;i--;){b.concatBucket(_3b1[i].data.rdfData);}if(!b.isEmpty()){self.log("Posting "+_3b1.length+" items with "+b.bucket.length+" triples..");self.saver.writeAnnotationItems(_3b0,_4.toJson(b.getTalisJson()));}else{self.log("saveItems with an empty bucket??!");}},itemExists:function(_3b2){var _3b3=false;self.itemsDnD.forInItems(function(item){if(item.data.value==_3b2.value){_3b3=true;return;}});return _3b3;},tripleExists:function(_3b4){var _3b5=false,keys=[];for(var i in self.tripleDnD){keys.push(i);}for(var j=keys.length;j--;){if(typeof (self.tripleDnD)!=="undefined"&&(keys.length>0)){if((typeof (self.tripleDnD[keys[j]]["s"])!=="undefined")&&(typeof (self.tripleDnD[keys[j]]["p"])!=="undefined")&&(typeof (self.tripleDnD[keys[j]]["o"])!=="undefined")){if((self.itemInDnDContainer(self.tripleDnD[keys[j]]["s"],_3b4["s"]))&&(self.itemInDnDContainer(self.tripleDnD[keys[j]]["p"],_3b4["p"]))&&(self.itemInDnDContainer(self.tripleDnD[keys[j]]["o"],_3b4["o"]))){_3b5=true;return _3b5;}}}}return _3b5;},itemInDnDContainer:function(_3b6,item){var _3b7=false,_3b8=item;_3b6.forInItems(function(_3b9){for(var i in _3b8){if(_3b9.data.value==_3b8[i].value){_3b7=true;}}});return _3b7;},addItemToSubject:function(_3ba){var self=this,_3bb=_4.query(".pundit-tc-dnd-container :first")[0],_3bc=_4.attr(_3bb,"id"),item={data:_3ba},id=_3bc.substring(12);var _3bd=self.tripleDnD[id].s.getAllNodes();if(_3bd.length>0){self.tripleDnD[id].s.clearItems();_3bd.forEach(function(item){_4.destroy(item);});}if(self.tripleDnD[id].s.getAllNodes().length===0){if(self.rowAcceptItems(id,[item],self.tripleDnD[id].s)){self.tripleDnD[id].s.insertNodes(false,[_3ba]);_4.behavior.apply();}}},addItemToObject:function(_3be){var self=this,_3bf=_4.query(".pundit-tc-dnd-container :first")[0],_3c0=_4.attr(_3bf,"id"),item={data:_3be},id=_3c0.substring(12);if(self.tripleDnD[id].o.getAllNodes().length===0){if(self.rowAcceptItems(id,[item],self.tripleDnD[id].o)){self.tripleDnD[id].o.insertNodes(false,[_3be]);_4.behavior.apply();}}},addItemToPredicate:function(_3c1){var self=this,_3c2=_4.query(".pundit-tc-dnd-container :first")[0],_3c3=_4.attr(_3c2,"id"),item={data:_3c1},id=_3c3.substring(12);if(self.tripleDnD[id].p.getAllNodes().length===0){if(self.rowAcceptItems(id,[item],self.tripleDnD[id].p)){self.tripleDnD[id].p.insertNodes(false,[_3c1]);_4.behavior.apply();}}},getNumberOfTriples:function(){var self=this,ret=0;for(var t in self.tripleDnD){ret++;}return ret;},checkNeedToHideResourcePanel:function(_3c4){var self=this;if(self.subjSuggestionPanel.isVisible()){if(self.subjSuggestionPanel.getPosition().y>_3c4+15){self.subjSuggestionPanel.hide();}}if(self.propSuggestionPanel.isVisible()){if(self.propSuggestionPanel.getPosition().y>_3c4+15){self.propSuggestionPanel.hide();}}if(self.objSuggestionPanel.isVisible()){if(self.objSuggestionPanel.getPosition().y>_3c4+15){self.objSuggestionPanel.hide();}}},pushToWikidata:function(){var self=this;self.reader=new pundit.AnnotationReader();self.reader.getOwnedNotebooks(function(ids){self.addLoginHref(ids);});},loginOpts:{loginTimerMS:2000,redirectURL:"http://tools.wmflabs.org/bajo"},addLoginHref:function(ids){var ids=ids.join("&");var self=this;var _3c5=self.loginOpts.redirectURL+"?"+ids;var _3c5="<a href=\""+_3c5+"\" target=\"_blank\">Push to Wikidata</a>";_4.query(".push-to-wikidata").html(_3c5);},});}if(!_4._hasResource["pundit.AnnotationReader"]){_4._hasResource["pundit.AnnotationReader"]=true;_4.provide("pundit.AnnotationReader");_4.declare("pundit.AnnotationReader",pundit.BaseComponent,{constructor:function(_3c6){this.createCallback(["notebookAnn","error","annotationMetadata","annotationContent","annotationItems","storageGet","storageError","jsonpVocabLoaded","notebookChecked"]);},getCurrentNotebookId:function(cb){var self=this;var args={url:ns.annotationServerApiCurrentNotebook,handleAs:"json",headers:{"Accept":"application/json"},load:function(r){if(typeof (cb)==="function"){cb(r.NotebookID);}},error:function(_3c7){self.log("ERROR: while getting current notebook ID");self.fireOnError("DOH");}},_3c8=requester.xGet(args);_PUNDIT.ga.track("api","get","annotationServerApiCurrentNotebook");},getOwnedNotebooks:function(cb){var self=this;var args={url:ns.annotationServerApiOwnedNotebooks,handleAs:"json",headers:{"Accept":"application/json"},load:function(r){if(typeof (cb)==="function"){cb(r.NotebookIDs);}},error:function(_3c9){self.log("ERROR: while getting current notebook ID");self.fireOnError("DOH");}},_3ca=requester.xGet(args);_PUNDIT.ga.track("api","get","annotationServerApiOwnedNotebooks");},getActiveNotebooks:function(cb){var self=this;var args={url:ns.annotationServerNotebooksActive,handleAs:"json",headers:{"Accept":"application/json"},load:function(r){if(typeof (cb)==="function"){cb(r.NotebookIDs);}},error:function(_3cb){self.log("ERROR: while getting current notebook ID");self.fireOnError("DOH");}},_3cc=requester.xGet(args);_PUNDIT.ga.track("api","get","annotationServerNotebooksActive");},getNotebookMetadata:function(_3cd,cb){var self=this;var args={url:ns.annotationServerApiNotebooks+_3cd+"/metadata",handleAs:"json",headers:{"Accept":"application/json"},load:function(r){if(typeof (cb)==="function"){cb(_3cd,r);}},error:function(_3ce){self.log("ERROR: while getting current notebook ID");self.fireOnError("DOH");}},_3cf=requester.xGet(args);_PUNDIT.ga.track("api","get","annotationServerApiNotebooks/$ID/metadata");},getUserMetadata:function(id,cb){var self=this;var args={url:ns.annotationServerApiUsers+id,handleAs:"json",headers:{"Accept":"application/json"},load:function(r){if(typeof (cb)==="function"){cb(id,r);}},error:function(_3d0){self.log("ERROR: while getting users data");self.fireOnError("DOH");}},_3d1=requester.xGet(args);_PUNDIT.ga.track("api","get","annotationServerApiUsers/$ID");},getNotebookGraph:function(_3d2){var self=this,args={url:ns.annotationServerApiNotebooks+_3d2+"/graph",headers:{"Accept":"application/json"},handleAs:"json",load:function(r){self.fireOnNotebookAnn(r);},error:function(_3d3){self.fireOnError("DOH");}},_3d4=requester.xGet(args);_PUNDIT.ga.track("api","get","annotationServerApiNotebooks/$ID/graph");},getCurrentNotebookGraph:function(){this.getCurrentNotebookId(this.getNotebookGraph);},getAnnotationMetadataFromUri:function(uris){var self=this,_3d5={},_3d6=_PUNDIT.loadingBox.addJob("Reading annotation metadata");if(typeof (uris)!=="object"){uris=[uris];}_3d5.resources=uris;myPundit.getAnnotationVisibility(function(mode){var args={url:ns.annotationServerMetadataSearch+"?scope="+mode+"&query="+encodeURIComponent(_4.toJson(_3d5)),handleAs:"json",failOk:true,headers:{"Accept":"application/json"},load:function(g){self.fireOnAnnotationMetadata(g);_PUNDIT.loadingBox.setJobOk(_3d6);},error:function(_3d7){self.log("ERROR! getAnnotationMetadataFromUri FAILED");self.fireOnError(_3d7);_PUNDIT.loadingBox.setJobKo(_3d6);return false;}},_3d8=requester.xGet(args);_PUNDIT.ga.track("api","get","annotationServerMetadataSearch?scope="+mode+"&query=");});},getAnnotationContentFromId:function(id){var self=this,args={url:ns.annotationServerApiAnnotations+id+"/graph",failOk:true,handleAs:"json",headers:{"Accept":"application/json"},load:function(g){self.log("getAnnotationContentFromId loaded content for annotation "+id);self.fireOnAnnotationContent(g,id);},error:function(_3d9){self.log("ERROR! getAnnotationContentFromId FAILED");self.fireOnError(_3d9);return false;}},_3da=requester.xGet(args);_PUNDIT.ga.track("api","get","annotationServerApiAnnotations/$ID/graph");},getAnnotationItemsFromId:function(id,xp){var self=this,args={url:ns.annotationServerApiAnnotations+id+"/items",handleAs:"json",failOk:true,headers:{"Accept":"application/json"},load:function(g){self.log("getAnnotationItemsFromId loaded items for annotation "+id);self.fireOnAnnotationItems(g,id,xp);},error:function(_3db){self.log("ERROR! getAnnotationItemsFromId FAILED");self.fireOnError(_3db);return false;}},_3dc=requester.xGet(args);_PUNDIT.ga.track("api","get","annotationServerApiAnnotations/$ID/items");},getVocabularyFromJsonp:function(_3dd,f){var self=this,_3de=_PUNDIT.loadingBox.addJob("Reading remote vocabulary "+_3dd.substr(_3dd.lastIndexOf("/")+1,_3dd.length));_4.io.script.get({url:_3dd,load:function(r){self.log("Loaded a vocabulary from "+_3dd);_PUNDIT.loadingBox.setJobOk(_3de);self.fireOnJsonpVocabLoaded(_3dd);},error:function(_3df,_3e0){self.log("getVocabularyFromJsonp had an error. "+_3de);_PUNDIT.loadingBox.setJobKo(_3de);self.fireOnJsonpVocabLoaded(_3dd);}});_PUNDIT.ga.track("api","get","getVocabularyFromJsonp");},getDataFromStorage:function(key){var self=this,args={url:ns.annotationServerStorage+key,headers:{"Accept":"application/json"},failOk:true,handleAs:"json",load:function(r){if(r){self.fireOnStorageGet(r);}else{self.fireOnStorageGet([]);self.log("Empty response for getDataFromStorage for key "+key);}},error:function(_3e1,req){if(req.xhr.status===204){self.log("204 Empty store from remote, firing ok anyway");self.fireOnStorageGet([]);return false;}self.log("Error getting response for getDataFromStorage for key "+key);self.fireOnStorageError(_3e1);}};var _3e2=requester.xGet(args);_PUNDIT.ga.track("api","get","annotationServerStorage/$KEY");},checkNotebook:function(id,cb){var self=this,args={url:ns.annotationServerNotebooksActive+"/"+id,handleAs:"json",failOk:true,headers:{"Accept":"application/json"},load:function(g){self.log("Notebook "+id+" checked for active state");self.fireOnNotebookChecked(id,g.NotebookActive);if(typeof (cb)==="function"){cb(id,g.NotebookActive);}},error:function(_3e3){self.log("ERROR! checkNotebook FAILED");self.fireOnError(_3e3);return false;}},_3e4=requester.xGet(args);_PUNDIT.ga.track("api","get","annotationServerNotebooksActive/$ID");}});}if(!_4._hasResource["pundit.AnnotationWriter"]){_4._hasResource["pundit.AnnotationWriter"]=true;_4.provide("pundit.AnnotationWriter");_4.declare("pundit.AnnotationWriter",pundit.BaseComponent,{constructor:function(_3e5){this.createCallback(["save","saveItems","error","saveStorage","storageError","setNotebookActive"]);},writeAnnotationContent:function(_3e6,_3e7,_3e8){var self=this,_3e9=new pundit.AnnotationReader({debug:self.opts.debug}),_3ea=_PUNDIT.loadingBox.addJob("Creating a new annotation"),_3eb=encodeURIComponent(_4.toJson({targets:_3e7,pageContext:_3e8})),_3ec=_4.toJson(_3e6.getTalisJson());_3e9.getCurrentNotebookId(function(_3ed){var post={url:ns.annotationServerApiNotebooksGraph+_3ed+"?context="+_3eb,postData:_3ec,headers:{"Content-Type":"application/json;charset=UTF-8;"},handleAs:"json",load:function(data){self.log("Saved content to notebook "+_3ed+", annotation id "+data.AnnotationID);_PUNDIT.loadingBox.setJobOk(_3ea);self.fireOnSave(data.AnnotationID);},error:function(_3ee){alert("Error saving content to notebook");_PUNDIT.loadingBox.setJobKo(_3ea);self.fireOnError("DOH");}};requester.xPost(post);_PUNDIT.ga.track("api","post","annotationServerApiNotebooksGraph/$ID/?context");});},deleteAnnotation:function(id,cb){var self=this,args={url:ns.annotationServerApiAnnotations+id,handleAs:"json",headers:{"Accept":"application/json"},load:function(data){if(typeof (cb)==="function"){cb(data);}},error:function(_3ef){self.fireOnError("DOH");}};requester.xDelete(args);_PUNDIT.ga.track("api","delete","annotationServerApiAnnotations/$ID");},writeAnnotationItems:function(_3f0,_3f1){var self=this,_3f2=_PUNDIT.loadingBox.addJob("Saving annotation "+_3f0),args={url:ns.annotationServerApiAnnotations+_3f0+"/items",postData:_3f1,headers:{"Content-Type":"application/json;charset=UTF-8;"},handleAs:"json",load:function(data){_PUNDIT.loadingBox.setJobOk(_3f2);self.log("writeAnnotationItems completed for "+_3f0);self.fireOnSaveItems(_3f0);},error:function(_3f3){_PUNDIT.loadingBox.setJobKo(_3f2);self.log("writeAnnotationItems got an error for "+_3f0);console.log("TODO: writeAnnotationItems ERROR");self.fireOnError("DOH");}};requester.xPost(args);_PUNDIT.ga.track("api","post","annotationServerApiAnnotations/$ID/items");},postRemoteStorage:function(key,_3f4){var args={url:ns.annotationServerStorage+key,postData:_3f4,headers:{"Content-Type":"application/json;charset=UTF-8;"},handleAs:"text",load:function(data){},error:function(_3f5){console.log("TODO: ERROR saving remote storage");self.fireOnStorageError("DOH");}};requester.xPost(args);_PUNDIT.ga.track("api","post","annotationServerStorage/$KEY");},setNotebookActive:function(_3f6,flag,cb){var self=this;var args={url:ns.annotationServerNotebooksActive+"/"+_3f6,handleAs:"text",load:function(data){self.log("Notebook set active state completed for "+_3f6);self.fireOnSetNotebookActive(_3f6,flag);if(typeof (cb)==="function"){cb(_3f6,flag);}},error:function(_3f7){if(flag==1){console.log("TODO: ERROR activating notebook "+_3f6);}else{if(flag==0){console.log("TODO: ERROR deactivating notebook "+_3f6);}}self.fireOnError("DOH");}};if(flag==1){requester.xPut(args);_PUNDIT.ga.track("api","put","annotationServerNotebooksActive/$ID");}else{if(flag==0){_PUNDIT.ga.track("api","delete","annotationServerNotebooksActive/$ID");requester.xDelete(args);}}},setNotebookCurrent:function(_3f8,cb){var self=this;var args={url:ns.annotationServerApiNotebooks+"current/"+_3f8,handleAs:"text",load:function(data){self.log("Notebook set current: "+_3f8);if(typeof (cb)==="function"){cb(_3f8);}},error:function(_3f9){console.log("TODO: ERROR setting notebook current: "+_3f8);self.fireOnError("DOH");}};requester.xPut(args);_PUNDIT.ga.track("api","put","annotationServerApiNotebooks/current/$ID");},setNotebookVisibility:function(_3fa,_3fb,cb){var self=this;var args={url:ns.annotationServerApiNotebooks+_3fb+"/"+_3fa,handleAs:"text",load:function(data){self.log("Notebook set current: "+_3fa);if(typeof (cb)==="function"){cb(_3fa,_3fb);}},error:function(_3fc){console.log("TODO: ERROR setting notebook current: "+_3fa);self.fireOnError("DOH");}};requester.xPut(args);_PUNDIT.ga.track("api","put","annotationServerApiNotebooks/state/$ID");},createNotebook:function(_3fd,cb){var self=this;var args={url:ns.annotationServerApiNotebooks,postData:_4.toJson({NotebookName:_3fd}),headers:{"Content-Type":"application/json;charset=UTF-8;"},handleAs:"json",load:function(data){self.log("Notebook created: "+data.NotebookID);if(typeof (cb)==="function"){cb(data.NotebookID);}},error:function(_3fe){console.log("TODO: ERROR creating notebook: "+_3fd);self.fireOnError("DOH");}};requester.xPost(args);_PUNDIT.ga.track("api","post","annotationServerApiNotebooks");},uploadImage:function(form,cb){var self=this;var args={url:"http://192.168.65.101:8080/annotationserver/api/services/upload/image",form:form,handleAs:"json",load:function(data){self.log("Notebook created: "+data.NotebookID);if(typeof (cb)==="function"){cb(data.NotebookID);}},error:function(_3ff){console.log("TODO: ERROR creating uploading image: ");self.fireOnError("DOH");}};_4.io.iframe.send(args);}});}if(!_4._hasResource["dojo.NodeList-manipulate"]){_4._hasResource["dojo.NodeList-manipulate"]=true;_4.provide("dojo.NodeList-manipulate");(function(){function _400(node){var text="",ch=node.childNodes;for(var i=0,n;n=ch[i];i++){if(n.nodeType!=8){if(n.nodeType==1){text+=_400(n);}else{text+=n.nodeValue;}}}return text;};function _401(node){while(node.childNodes[0]&&node.childNodes[0].nodeType==1){node=node.childNodes[0];}return node;};function _402(html,_403){if(typeof html=="string"){html=_4._toDom(html,(_403&&_403.ownerDocument));if(html.nodeType==11){html=html.childNodes[0];}}else{if(html.nodeType==1&&html.parentNode){html=html.cloneNode(false);}}return html;};_4.extend(_4.NodeList,{_placeMultiple:function(_404,_405){var nl2=typeof _404=="string"||_404.nodeType?_4.query(_404):_404;var _406=[];for(var i=0;i<nl2.length;i++){var _407=nl2[i];var _408=this.length;for(var j=_408-1,item;item=this[j];j--){if(i>0){item=this._cloneNode(item);_406.unshift(item);}if(j==_408-1){_4.place(item,_407,_405);}else{_407.parentNode.insertBefore(item,_407);}_407=item;}}if(_406.length){_406.unshift(0);_406.unshift(this.length-1);Array.prototype.splice.apply(this,_406);}return this;},innerHTML:function(_409){if(arguments.length){return this.addContent(_409,"only");}else{return this[0].innerHTML;}},text:function(_40a){if(arguments.length){for(var i=0,node;node=this[i];i++){if(node.nodeType==1){_4.empty(node);node.appendChild(node.ownerDocument.createTextNode(_40a));}}return this;}else{var _40b="";for(i=0;node=this[i];i++){_40b+=_400(node);}return _40b;}},val:function(_40c){if(arguments.length){var _40d=_4.isArray(_40c);for(var _40e=0,node;node=this[_40e];_40e++){var name=node.nodeName.toUpperCase();var type=node.type;var _40f=_40d?_40c[_40e]:_40c;if(name=="SELECT"){var opts=node.options;for(var i=0;i<opts.length;i++){var opt=opts[i];if(node.multiple){opt.selected=(_4.indexOf(_40c,opt.value)!=-1);}else{opt.selected=(opt.value==_40f);}}}else{if(type=="checkbox"||type=="radio"){node.checked=(node.value==_40f);}else{node.value=_40f;}}}return this;}else{node=this[0];if(!node||node.nodeType!=1){return undefined;}_40c=node.value||"";if(node.nodeName.toUpperCase()=="SELECT"&&node.multiple){_40c=[];opts=node.options;for(i=0;i<opts.length;i++){opt=opts[i];if(opt.selected){_40c.push(opt.value);}}if(!_40c.length){_40c=null;}}return _40c;}},append:function(_410){return this.addContent(_410,"last");},appendTo:function(_411){return this._placeMultiple(_411,"last");},prepend:function(_412){return this.addContent(_412,"first");},prependTo:function(_413){return this._placeMultiple(_413,"first");},after:function(_414){return this.addContent(_414,"after");},insertAfter:function(_415){return this._placeMultiple(_415,"after");},before:function(_416){return this.addContent(_416,"before");},insertBefore:function(_417){return this._placeMultiple(_417,"before");},remove:_4.NodeList.prototype.orphan,wrap:function(html){if(this[0]){html=_402(html,this[0]);for(var i=0,node;node=this[i];i++){var _418=this._cloneNode(html);if(node.parentNode){node.parentNode.replaceChild(_418,node);}var _419=_401(_418);_419.appendChild(node);}}return this;},wrapAll:function(html){if(this[0]){html=_402(html,this[0]);this[0].parentNode.replaceChild(html,this[0]);var _41a=_401(html);for(var i=0,node;node=this[i];i++){_41a.appendChild(node);}}return this;},wrapInner:function(html){if(this[0]){html=_402(html,this[0]);for(var i=0;i<this.length;i++){var _41b=this._cloneNode(html);this._wrap(_4._toArray(this[i].childNodes),null,this._NodeListCtor).wrapAll(_41b);}}return this;},replaceWith:function(_41c){_41c=this._normalize(_41c,this[0]);for(var i=0,node;node=this[i];i++){this._place(_41c,node,"before",i>0);node.parentNode.removeChild(node);}return this;},replaceAll:function(_41d){var nl=_4.query(_41d);var _41e=this._normalize(this,this[0]);for(var i=0,node;node=nl[i];i++){this._place(_41e,node,"before",i>0);node.parentNode.removeChild(node);}return this;},clone:function(){var ary=[];for(var i=0;i<this.length;i++){ary.push(this._cloneNode(this[i]));}return this._wrap(ary,this,this._NodeListCtor);}});if(!_4.NodeList.prototype.html){_4.NodeList.prototype.html=_4.NodeList.prototype.innerHTML;}})();}if(!_4._hasResource["pundit.TextFragmentHandler"]){_4._hasResource["pundit.TextFragmentHandler"]=true;_4.provide("pundit.TextFragmentHandler");_4.declare("pundit.TextFragmentHandler",pundit.BaseComponent,{lastSelectedRange:document.createRange(),constructor:function(_41f){var self=this;self.helper=new pundit.XpointersHelper();self.initBehaviors();self.log("TextFragmentHandler up and running");},initBehaviors:function(){var self=this;_4.query("body").connect("onmousedown",function(e){var _420,_421=e.target;while(_421.tagName.toLowerCase()!=="body"){if(_4.hasClass(_421,"pundit-disable-annotation")){_420=false;break;}_421=_4.query(_421).parent()[0];}if(_420===false){self.selectable=false;}else{self.selectable=true;}});_4.query("body").connect("onmouseup",function(e){if(!self.selectable){_PUNDIT.cMenu.hide(e);return;}var _422=true,_423=e.target,_424,xp;while(_423.tagName.toLowerCase()!=="body"){if(_4.hasClass(_423,"pundit-disable-annotation")){_422=false;break;}_423=_4.query(_423).parent()[0];}if(_422===false){_PUNDIT.cMenu.hide(e);return false;}_424=self.getSelectedRange();if(_424===null){self.log("ERROR: trying to create a new item from with null range?");_PUNDIT.cMenu.hide(e);return false;}self.lastSelectedRange=_424;xp=self.getCleanSelectedXpointer();if(xp===null){self.log("ERROR: trying to create a new item with null xpointer?");_PUNDIT.cMenu.hide(e);return false;}var item=self.createItemFromRange(_424);cMenu.show(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset,item,"textSelectionHelper");return true;});cMenu.addAction({type:["textSelectionHelper"],name:"AddTextFragmentToMyItems",label:"Add to My Items",showIf:function(item){return true;},onclick:function(item){tooltip_viewer.highlightByXpointer(item.value);if(!tooltip_viewer.isTempXpointer(item.value)){tooltip_viewer.tempXpointers.push(item.value);tooltip_viewer.consolidate();}semlibMyItems.addItem(item,true);previewer.buildPreviewForItem(item);semlibMyItems.show_pundittabfiltermyitemsfragment();return true;}});cMenu.addAction({type:["textSelectionHelper","annotatedtextfragment","bookmarkedtextfragment"],name:"AnnotateWithTripleComposer",label:"Annotate text fragment",showIf:function(item){return true;},onclick:function(item){tripleComposer.addItemToSubject(item);previewer.buildPreviewForItem(item);if(!_PUNDIT.GUI.isWindowOpen()){_PUNDIT.GUI.toggleWindow();}return true;}});},getLastSelectedContent:function(_425){var self=this,_426=self.helper.extractContentFromRange(self.lastSelectedRange);if(typeof (_425)!=="undefined"){return _426.substr(0,_425);}return _426;},createItemFromRange:function(_427){var self=this,_428=self.helper.extractContentFromRange(_427),_429=_428.length>50?_428.substr(0,50)+" ..":_428,xp=self.range2xpointer(self.dirtyRange2cleanRange(_427)),_42a=_PUNDIT.tripleComposer.getSafePageContext(),item;if(_42a.indexOf("#xpointer")!==-1){_42a=_42a.substring(0,_42a.indexOf("#"));}item={type:["subject"],rdftype:[ns.fragments.text],label:_429,description:_428,value:xp,isPartOf:xp.split("#")[0],pageContext:_42a};item.rdfData=semlibItems.createBucketForTextFragment(item).bucket;self.log("Created an item from range with label: "+_429);self.log("Clean xpointer is: "+xp);return item;},range2xpointer:function(_42b){var self=this,_42c=self.correctXPathFinalNumber(self.calculateCleanXPath(_42b.startContainer),_42b.cleanStartNumber),_42d=self.correctXPathFinalNumber(self.calculateCleanXPath(_42b.endContainer),_42b.cleanEndNumber),_42e=self.getContentURLFromXPath(_42c),_42f=self.getXPointerString(_42e,_42c,_42b.startOffset,_42d,_42b.endOffset);this.log("range2xpointer returning an xpointer: "+_42f);return _42f;},getXPointerString:function(_430,_431,_432,_433,_434){return _430+"#xpointer(start-point(string-range("+_431+",'',"+_432+"))"+"/range-to(string-range("+_433+",'',"+_434+")))";},getContentURLFromXPath:function(_435){var self=this,_436=_PUNDIT.tripleComposer.getSafePageContext(),_437=_435.indexOf("DIV[@about='"),_438="about";if(_437===-1){return (_436.indexOf("#")!==-1)?_436.split("#")[0]:_436;}if(_437<3){var _439=_437+7+_438.length,pos=_435.indexOf("_text']"),_43a=((pos!==-1)?_435.indexOf("_text']"):_435.indexOf("']"))-_439;return _435.substr(_439,_43a);}self.log("ERROR: getContentURLFromXPath returning something weird? xpath = "+_435);return "";},getCleanSelectedXpointer:function(){var self=this;if(self.lastSelectedRange===null){return null;}return self.range2xpointer(self.dirtyRange2cleanRange(self.lastSelectedRange));},getSelectedRange:function(){var self=this,_43b;if(window.getSelection().rangeCount===0){self.log("getSelection().rangeCount is 0: no selected range.");return null;}_43b=window.getSelection().getRangeAt(0);if(_43b!==null&&(_43b.startContainer===_43b.endContainer)&&(_43b.startOffset===_43b.endOffset)){self.log("Range is not null, but start/end containers and offsets match: no selected range.");return null;}self.log("GetSelectedRange is returning a range: "+_43b.startContainer.nodeName+"["+_43b.startOffset+"] > "+_43b.endContainer.nodeName+"["+_43b.endOffset+"]");return _43b;},dirtyRange2cleanRange:function(_43c){var self=this,_43d={};self.log("dirty2cleanRange DIRTY is: "+_43c.startContainer.nodeName+"["+_43c.startOffset+"] > "+_43c.endContainer.nodeName+"["+_43c.endOffset+"]");var foos=self.calculateCleanOffset(_43c.startContainer,_43c.startOffset),fooe=self.calculateCleanOffset(_43c.endContainer,_43c.endOffset);_43d.startContainer=foos.cleanContainer;_43d.startOffset=foos.cleanOffset;_43d.endContainer=fooe.cleanContainer;_43d.endOffset=fooe.cleanOffset;_43d.cleanStartNumber=self.calculateCleanNodeNumber(_43d.startContainer);_43d.cleanEndNumber=self.calculateCleanNodeNumber(_43d.endContainer);self.log("dirty2cleanRange CLEAN (invalid?) range: "+_43d.startContainer.nodeName+"["+_43d.startOffset+"] > "+_43d.endContainer.nodeName+"["+_43d.endOffset+"]");return _43d;},correctXPathFinalNumber:function(_43e,_43f){return _43e.replace(/\[[0-9]+\]$/,"["+_43f+"]");},calculateCleanNodeNumber:function(node){var self=this,_440,_441=self.getXPathNodeName(node),_442=_4.query(node).parent()[0],_443=(self.helper.isWrapNode(_442))?_442:node;if(self.helper.isTextNode(node)){_440=1;while(current_node=_443.previousSibling){if((self.helper.isTextNode(current_node)||self.helper.isWrappedTextNode(current_node)||self.helper.isUIButton(current_node))&&((self.helper.isElementNode(_443)&&!self.helper.isUIButton(_443)&&!self.helper.isWrappedTextNode(_443))||self.helper.isWrappedElementNode(_443))){_440++;}_443=current_node;}}else{_440=1;while(current_node=_443.previousSibling){if(self.getXPathNodeName(current_node)===_441&&!self.helper.isIgnoreNode(current_node)){_440++;}_443=current_node;}}return _440;},calculateCleanOffset:function(_444,_445){var self=this,_446=_4.query(_444).parent()[0],node=_444,_447=_445;if(self.helper.isElementNode(_444)&&!self.helper.isIgnoreNode(_444)){return {cleanContainer:node,cleanOffset:_447};}if(self.helper.isTextNode(_444)&&self.helper.isWrapNode(_446)){node=_446;}while(currentNode=node.previousSibling){if(!self.helper.isIgnoreNode(currentNode)&&self.helper.isElementNode(currentNode)&&!self.helper.isWrapNode(currentNode)){if(self.helper.isTextNode(_444)&&self.helper.isWrapNode(_446)){return {cleanContainer:_444,cleanOffset:_447};}else{return {cleanContainer:node,cleanOffset:_447};}}if(self.helper.isTextNode(currentNode)){_447+=currentNode.length;}else{if(self.helper.isWrapNode(currentNode)){_447+=currentNode.firstChild.length;}}node=currentNode;}if(self.helper.isTextNode(_444)&&self.helper.isWrapNode(_446)){return {cleanContainer:_444,cleanOffset:_447};}else{return {cleanContainer:node,cleanOffset:_447};}},getXPathNodeName:function(node){if(this.helper.isTextNode(node)){return "text()";}else{return node.nodeName.toUpperCase();}},calculateCleanXPath:function(node,_448){var _449=_4.query(node).parent()[0];if(!node){return _448;}var self=this,_44a=self.getXPathNodeName(node);if(self.helper.isContentNode(node)){if(typeof (_448)!=="undefined"){return "//DIV[@about='"+_4.attr(node,"about")+"']/"+_448;}else{return "//DIV[@about='"+_4.attr(node,"about")+"']";}}if(_44a==="BODY"||_44a==="HTML"){if(typeof (_448)!=="undefined"){return "//BODY/"+_448;}else{return "//BODY";}}if(self.helper.isWrapNode(node)){return self.calculateCleanXPath(node.parentNode,_448);}var num=1,_44b=node;if(!self.helper.isTextNode(_44b)){while(sibling=_44b.previousSibling){if(self.getXPathNodeName(sibling)===_44a&&!self.helper.isIgnoreNode(sibling)){num++;}_44b=sibling;}}if(typeof (_448)!=="undefined"){_448=_44a+"["+num+"]/"+_448;}else{_448=_44a+"["+num+"]";}return self.calculateCleanXPath(_449,_448);},xpointer2Xpaths:function(_44c){var self=this,_44d,ret={},foo,_44e,_44f;_44d=_44c.split("#xpointer(start-point(string-range(")[1].split("))/range-to(string-range(");foo=_44d[0].split(",'',");ret.startXpath=foo[0];ret.startOffset=foo[1];foo=_44d[1].substr(0,_44d[1].length-3).split(",'',");ret.endXpath=foo[0];ret.endOffset=foo[1];_44e=self.getNodeFromXpath(ret.startXpath);_44f=self.getNodeFromXpath(ret.endXpath);ret.valid=!(_44e===null||_44f===null);if(ret.startXPath===ret.endXpath){ret.valid&=(ret.startOffset<ret.endOffset);}return ret;},getURLFromXpointer:function(_450){return _450.split("#xpointer(start-point(string-range(")[0];},getNodeFromXpath:function(_451){var self=this,_452=document.evaluate(_451,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);return _452.singleNodeValue;}});}if(!_4._hasResource["dojox.layout.DragPane"]){_4._hasResource["dojox.layout.DragPane"]=true;_4.provide("dojox.layout.DragPane");_4.declare("dojox.layout.DragPane",_5._Widget,{invert:true,postCreate:function(){this.connect(this.domNode,"onmousedown","_down");this.connect(this.domNode,"onmouseleave","_up");this.connect(this.domNode,"onmouseup","_up");},_down:function(e){var t=this.domNode;e.preventDefault();_4.style(t,"cursor","move");this._x=e.pageX;this._y=e.pageY;if((this._x<t.offsetLeft+t.clientWidth)&&(this._y<t.offsetTop+t.clientHeight)){_4.setSelectable(t,false);this._mover=this.connect(t,"onmousemove","_move");}},_up:function(e){_4.setSelectable(this.domNode,true);_4.style(this.domNode,"cursor","pointer");this._mover&&this.disconnect(this._mover);delete this._mover;},_move:function(e){var mod=this.invert?1:-1;this.domNode.scrollTop+=(this._y-e.pageY)*mod;this.domNode.scrollLeft+=(this._x-e.pageX)*mod;this._x=e.pageX;this._y=e.pageY;}});}if(!_4._hasResource["dojox.fx._core"]){_4._hasResource["dojox.fx._core"]=true;_4.provide("dojox.fx._core");_6.fx._Line=function(_453,end){this.start=_453;this.end=end;var _454=_4.isArray(_453),d=(_454?[]:end-_453);if(_454){_4.forEach(this.start,function(s,i){d[i]=this.end[i]-s;},this);this.getValue=function(n){var res=[];_4.forEach(this.start,function(s,i){res[i]=(d[i]*n)+s;},this);return res;};}else{this.getValue=function(n){return (d*n)+this.start;};}};}if(!_4._hasResource["dojox.fx.scroll"]){_4._hasResource["dojox.fx.scroll"]=true;_4.provide("dojox.fx.scroll");_4.experimental("dojox.fx.scroll");_6.fx.smoothScroll=function(args){if(!args.target){args.target=_4.position(args.node);}var _455=_4[(_4.isIE?"isObject":"isFunction")](args["win"].scrollTo),_456={x:args.target.x,y:args.target.y};if(!_455){var _457=_4.position(args.win);_456.x-=_457.x;_456.y-=_457.y;}var _458=(_455)?(function(val){args.win.scrollTo(val[0],val[1]);}):(function(val){args.win.scrollLeft=val[0];args.win.scrollTop=val[1];});var anim=new _4.Animation(_4.mixin({beforeBegin:function(){if(this.curve){delete this.curve;}var _459=_455?_4._docScroll():{x:args.win.scrollLeft,y:args.win.scrollTop};anim.curve=new _6.fx._Line([_459.x,_459.y],[_459.x+_456.x,_459.y+_456.y]);},onAnimate:_458},args));return anim;};}if(!_4._hasResource["pundit.TooltipAnnotationViewer"]){_4._hasResource["pundit.TooltipAnnotationViewer"]=true;_4.provide("pundit.TooltipAnnotationViewer");_4.declare("pundit.TooltipAnnotationViewer",pundit.BaseComponent,{opts:{hideMouseLeaveMS:500,enableHighlightingMode:true,highlightingMode:false,showInvalidXPointers:false,allowAnnotationEdit:false},constructor:function(_45a){var self=this;self.createCallback(["AnnotationIconMouseEnter","AnnotationIconMouseLeave","AnnotationIconMouseClick","Consolidate","NotebookActivationChanged"]);self.initBehaviors();self.hideTimer=[];self.highlightCount=[];self.helper=new pundit.XpointersHelper();self.reader=new pundit.AnnotationReader();self.writer=new pundit.AnnotationWriter();self.jobId=null;self.initReader();self.initWriter();self.contentURIs=self.helper.getContentURIs();self.initContextualMenu();self.refreshPageItems=false;tripleComposer.onSave(function(){self.refreshAnnotations();});self.isRefreshingAnnotations=true;self.wipe();_PUNDIT.init.onInitDone(function(){self.refreshAnnotations();});self.notebooks={};self._onLoadAnnotationShown=false;self.log("TooltipAnnotationViewer Up and running");},initWriter:function(){var self=this;self.writer.onSetNotebookActive(function(id,flag){semlibWindow.closeAllPanels();self.refreshAnnotations();self.fireOnNotebookActivationChanged();});},initReader:function(){var self=this;self.reader.onAnnotationMetadata(function(g){if(!self.jobId){if(self.refreshPageItems){semlibItems.itemsDnD.forInItems(function(item){if(item.data.rdftype[0]!==ns.rdf_property){semlibItems.removeItemFromUri(item.data.value);}});self.refreshPageItems=false;}self.jobId=_PUNDIT.loadingBox.addJob("Downloading annotation content");self.addAnnotations(g);for(var _45b in self.notebooks){self.reader.checkNotebook(_45b);}self.consolidate();_4.behavior.apply();}else{console.log("DEBUG: two refresh() Too fast?!?");}});self.reader.onAnnotationContent(function(g,id){self.log("Annotation content for "+id+" received");self.addAnnotationContent(id,g);self.reader.getAnnotationItemsFromId(id);});self.reader.onAnnotationItems(function(g,id){self.log("Annotation items for "+id+" received");self.addAnnotationItems(id,g);if(--self.annToDownload===0){self.consolidate();_PUNDIT.loadingBox.setJobOk(self.jobId);self.isRefreshingAnnotations=false;self.jobId=null;if(_PUNDIT.tripleComposer.tryToShowAnnotation){try{self.showAnnotationPanel(_PUNDIT.tripleComposer.tryToShowAnnotation);self.log("Showing annotation after full reload.");}catch(e){self.log("Failed to show annotation after full reload.");}_PUNDIT.tripleComposer.tryToShowAnnotation=null;}self.showAnnotationOnLoad();}});self.reader.onNotebookChecked(function(id,flag){self.log("Notebook "+id+" cheked: active = "+flag);self.notebooks[id]=flag;});self.reader.onError(function(e){console.log("TODO: Reader got an error, deal with it!",e);return false;});},showAllAnnotationsOnItem:function(xp){var self=this;for(var i=self.xpointersAnnotationsId[xp].length-1;i>=0;i--){self.log("RDF Icon click: Opening panel for annotation "+self.xpointersAnnotationsId[xp][i]);self.showAnnotationPanel(self.xpointersAnnotationsId[xp][i],xp);}var y=_4.position(_4.query("span."+self.xpointersClasses[xp])[0],true).y,_45c=_4.query("body")[0].scrollTop;if((y-_45c<_4.position("pundit-gui",true).h)||(y-_45c>window.innerHeight)){_6.fx.smoothScroll({node:_4.query("span."+self.xpointersClasses[xp])[0],offset:{y:_4.position("pundit-gui",true).h+100},win:window,duration:800}).play();}return true;},areAllAnnotationsOnItemOpened:function(xp){var self=this;if(typeof (self.xpointersAnnotationsId[xp])==="undefined"){return false;}return semlibWindow.getOpenedPanelsByXpointer(xp).length>0;},initContextualMenu:function(){var self=this;if(self.opts.showInvalidXPointers===true){cMenu.addAction({type:["punditThisPageMenu"],name:"showAllBrokenAnnotations",label:"Show broken annotations",showIf:function(){return self.invalidXpointers.length>0;},onclick:function(){_PUNDIT.tooltipViewer.showAllBrokenAnnotations();return true;}});}cMenu.addAction({type:["annotatedtextfragment"],name:"openAll",label:"Show all annotations on this item",showIf:function(item){return true;},onclick:function(item){var _45d=item.value;if(item.rdftype.indexOf(ns.fragments.image)!==-1){_45d=item.parentItemXP;}semlibWindow.closePanelByXpointer(_45d);self.showAllAnnotationsOnItem(_45d);return true;}});cMenu.addAction({type:["annotatedtextfragment"],name:"closeAll",label:"Close all annotations on this item",showIf:function(item){return self.areAllAnnotationsOnItemOpened(item.value);},onclick:function(item){_PUNDIT.ga.track("cmenu","click","close-all-annotation-on-this-item");semlibWindow.closePanelByXpointer(item.value);return true;}});cMenu.addAction({type:["__all"],name:"zoomItem",label:"Zoom on this item",showIf:function(item){if(typeof (item)==="undefined"){return false;}return self.xpointersClasses[item.value];},onclick:function(item){_PUNDIT.ga.track("cmenu","click","zoom-on-this-item");self.zoomOnXpointer(item.value);return true;}});cMenu.addAction({type:["bookmarkedtextfragment"],name:"removeSelection",label:"Remove from My Items",showIf:function(item){if(typeof semlibMyItems.getItemFromUri(item.value)!=="undefined"){return true;}else{return false;}},onclick:function(item){_PUNDIT.ga.track("cmenu","click","remove-from-my-items");semlibMyItems.removeItemFromUri(item.value);self.removeTempXpointer(item.value);tooltip_viewer.consolidate();return true;}});cMenu.addAction({type:["textfragment","annotatedtextfragment"],name:"AddAnnotatedItemToMyItems",label:"Add to My Items",showIf:function(item){return !semlibMyItems.uriInItems(item.value);},onclick:function(item){_PUNDIT.ga.track("cmenu","click","add-to-my-items");tooltip_viewer.highlightByXpointer(item.value);var item=semlibItems.getItemFromUri(item.value);if(typeof item!=="undefined"){semlibMyItems.addItem(item,true);semlibMyItems.show_pundittabfiltermyitemsfragment();}return true;}});cMenu.addAction({type:["annotatedtextfragment",],name:"RemoveAnnotatedItemFromMyItems",label:"Remove from My Items",showIf:function(item){return semlibMyItems.uriInItems(item.value);},onclick:function(item){_PUNDIT.ga.track("cmenu","click","remove-annotated-from-my-items");semlibMyItems.removeItemFromUri(item.value);tooltip_viewer.removeTempXpointer(item.value);tooltip_viewer.consolidate();return true;}});cMenu.addAction({type:["punditThisPageMenu"],name:"TurnHighlightingOn",label:"Turn Highlighting On",showIf:function(){return self.opts.enableHighlightingMode&&!self.opts.highlightingMode;},onclick:function(){_PUNDIT.ga.track("cmenu","click","turn-highlighting-on");self.opts.highlightingMode=true;tooltip_viewer.consolidate();return true;}});cMenu.addAction({type:["punditThisPageMenu"],name:"TurnHighlightingOff",label:"Turn Highlighting Off",showIf:function(){return self.opts.enableHighlightingMode&&self.opts.highlightingMode;},onclick:function(){_PUNDIT.ga.track("cmenu","click","turn-highlighting-on");self.opts.highlightingMode=false;tooltip_viewer.consolidate();return true;}});cMenu.onTypeShow_annotatedtextfragment(function(xp){self.highlightByXpointer(xp);});cMenu.onTypeHide_annotatedtextfragment(function(xp){self.removeHighlightByXpointer(xp);});cMenu.onTypeShow_bookmarkedtextfragment(function(xp){self.highlightByXpointer(xp);});cMenu.onTypeHide_bookmarkedtextfragment(function(xp){self.removeHighlightByXpointer(xp);});},getAnnotationFromAnnId:function(_45e){for(var xp in this.annotations){if(this.annotations[xp].id===_45e){return this.annotations[xp];}}},showAllBrokenAnnotations:function(){var self=this;for(var i=self.invalidAnnIds.length;i--;){var id=self.invalidAnnIds[i];console.log("Showing BROKEN ann "+id);self.showAnnotationPanel(id,null);}},showAllAnnotations:function(){var self=this;if(self.annIds===null||self.annIds===undefined){self.log("ERROR: Annotaion panel not ready, not showing all annotations.");return;}for(var i=self.annIds.length;i--;){var _45f=self.annIds[i];self.showAnnotationPanel(_45f);}},removeTargetFromAnnotation:function(uri,_460){var self=this,_461;if((_461=self.annotations[_460].targets.indexOf(uri))!==-1){self.annotations[_460].targets.splice(_461,1);}},annotationHasTargets:function(_462){var self=this;return !(self.annotations[_462].targets==0);},isNotebookActive:function(_463){var self=this;return self.notebooks[_463]==1;},showAnnotationPanel:function(_464,_465){var self=this,_466="dialog_"+_464+"_content";if(_4.query("#"+_466).length>0){self.log("Panel for annotation id "+_464+" is already open!");return;}var ann=self.annotations[_464],_467="",_468="",c=ann.content,m=ann.metadata,_469=ann.items,_46a=m[ns.pundit_isIncludedIn][0].value,_46b=_46a.split("/")[_46a.split("/").length-1],_46c=[],_46d,_46e=m[ns.pundit_authorURI][0].value,_46f=m[ns.pundit_annotationDate][0].value,_470=false;self.log("Showing annotation panel for "+_464);var _471=[];for(var i=m[ns.pundit_hasTarget].length;i--;){if(m[ns.pundit_hasTarget][i]["value"]!==_PUNDIT.tripleComposer.getSafePageContext()){_471.push(m[ns.pundit_hasTarget][i]["value"]);}}self.log("Annotation with "+_471.length+" targets");for(i=_471.length;i--;){var uri=_471[i];if((typeof (self.xpointersClasses[uri])==="undefined")){self.log("ERROR: trying to show annotation panel for "+uri+" but its not consolidated on this page");self.removeTargetFromAnnotation(uri,_464);if(!(self.annotationHasTargets(_464))){self.log("ERROR: none of the annotation target is present in the page (ann_id: "+_464+")");_470=true;}continue;}else{var cl=self.xpointersClasses[uri].join("");_46c.push(uri);if(typeof (self.xpointersColors[uri])==="undefined"){self.xpointersColors[uri]=self.colors.pop()||self.fallbackColor;self.usedColors[self.xpointersColors[uri]]=1;self.log("Assigned color to target: "+self.xpointersColors[uri]);}else{self.usedColors[self.xpointersColors[uri]]=self.usedColors[self.xpointersColors[uri]]+1;}_4.query("span."+cl).addClass(self.xpointersColors[uri]);}}if(_46e===myPundit.user.uri){_468+="<span class='pundit-gui-button delete' about='"+_464+"'>Delete</span>";if(self.opts.allowAnnotationEdit){_468+="<span class='pundit-gui-button edit' data-nbId='"+_46b+"' data-annId='"+_464+"'>Edit</span>";}}if(_PUNDIT.config.modules["pundit.NotebookManager"].active===true&&_PUNDIT.config.modules["pundit.NotebookManager"].activateFromAnnotations===true){if(self.isNotebookActive(_46b)){_468+="<span class='pundit-gui-button deactivate' about='"+_46b+"'>Deactivate</span>";}else{_468+="<span class='pundit-gui-button activate' about='"+_46b+"'>Activate</span>";}}if(typeof (m[ns.pundit_authorName])!=="undefined"&&m[ns.pundit_authorName][0].value!==""){_46d=m[ns.pundit_authorName][0].value;}else{_46d="User: "+_46e.substr(_46e.lastIndexOf("/")+1,_46e.length);}_467+="<div class='pundit-metadata'>";if(_470){_467+="<span class='pundit-error-msg'>Apparently, this annotation should be shown on this page, sadly Pundit is not able to handle it properly. :(</span>";}_467+="<span class='author'><em>Created by</em> : "+_46d+"</span>";_467+="<span class='date'><em>On</em> : "+_46f.split("T")[0]+", "+_46f.split("T")[1]+"</span>";_467+="<span class='author'><em>ID</em> : "+_464+"</span>";_467+="</div>";_467+=self.getStatementsHTML(c,_469);var _472=(function(uris,id){return function(){for(var i=uris.length;i--;){var cl=self.xpointersClasses[uris[i]].join(""),_473=self.xpointersColors[uris[i]];if(self.usedColors[_473]===1){_4.query("span."+cl).removeClass(_473);delete self.xpointersColors[uris[i]];if(_473!==self.fallbackColor){self.colors.push(_473);}}else{self.usedColors[_473]=self.usedColors[_473]-1;}}_4.destroy(id);delete semlibWindow.panels[id];};})(_46c,_466);self.log("Adding new annotation window item, with id "+_466);semlibWindow.awAdd({id:_466,content:_467,buttons:_468,xpointers:_46c,positioningXpointer:_465||_46c[0],title:"By "+_46d+" on "+_46f.split("T")[0],onClose:_472,isBroken:_470});_4.behavior.apply();if(!semlibWindow.isAnnotationWindowOpen()){semlibWindow.toggleAnnotationWindow();}},addHyperlinksToText:function(text){var exp=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/i;return text.replace(exp,"<a target='_blank' href='$1'>$1</a>");},getStatementsHTML:function(c,_474){var self=this,_475="";for(var _476 in c){_475+="<div class=\"pundit-statement\"><div class=\"pundit-subject\">";_475+=self.getTriplePartHTML(c,_474,_476);self.log("Getting statement from annotation: subject :"+_476.substr(0,41)+"..");var _477=self.getCommentsFromTriples(c,_476);if(_477.length!=0){_475+="<div class=\"pundit-predicate\">";_475+="<span>Comments:</span>";_475+="<div class=\"pundit-object\">";for(var j=_477.length;j--;){_475+="<span>"+self.addHyperlinksToText(_477[j])+"</span>";}_475+="</div></div>";}var tags=self.getTagsFromTriples(c,_476);if(tags.length!=0){_475+="<div class=\"pundit-predicate\">";_475+="<span>Tags:</span>";for(var j=tags.length;j--;){_475+="<div class=\"pundit-object\">";_475+=self.getTriplePartHTML(c,_474,tags[j]);_475+="</div>";}_475+="</div>";}for(var _478 in c[_476]){if(_478===ns.pundit_hasComment||_478===ns.pundit_hasTag){break;}_475+="<div class=\"pundit-predicate\">";_475+=self.getTriplePartHTML(c,_474,_478);for(var k=c[_476][_478].length-1;k>=0;k--){var _479=c[_476][_478][k];_475+="<div class=\"pundit-object\">";_475+=self.getTriplePartHTML(c,_474,_479.value,_479.type);_475+="</div>";}_475+="</div>";}_475+="</div></div>";}self.log("Produced statements HTML");return _475;},getTagsFromTriples:function(_47a,_47b){var _47c=[];var _47d=_47a[_47b];for(var _47e in _47d){var _47f=_47d[_47e];for(var k=_47f.length;k--;){if(_47e===ns.pundit_hasTag&&_47f[k].type==="uri"){_47c.push(_47f[k].value);}}}return _47c;},getCommentsFromTriples:function(_480,_481){var _482=[];var _483=_480[_481];for(var _484 in _483){var _485=_483[_484];for(var k=_485.length;k--;){if(_484===ns.pundit_hasComment&&_485[k].type==="literal"){_482.push(_485[k].value);}}}return _482;},getTriplePartHTML:function(c,_486,uri,type){var self=this,tp="",_487="",_488="",_489="",_48a="",_48b="",_48c="",_48d="",_48e="";self.log("TriplePartHTML for "+uri.substr(0,30));if(_486===null||typeof (_486)==="undefined"||(type!=="literal"&&typeof (_486[uri])==="undefined")){self.log("No items for uri "+uri.substr(0,30)+"... :|");console.log("TODO: something wrong rendering items? ",uri,type,_486);return "<span>(ERR) "+uri.substr(0,30)+"</span>";}_48e=_486[uri];if(typeof (type)!=="undefined"&&type==="literal"){if(uri.indexOf("<")===-1&&uri.length>20){_487=uri.substr(0,20)+"...";}else{_487=uri;}_489="<li><em>Datatype</em>: Literal</li>";_48a="<li><em>Full content</em>: "+uri+"</li>";}else{if(typeof (_48e[ns.rdfs_label])!=="undefined"){_487=_48e[ns.rdfs_label][0].value;}else{_487=uri.substr(uri.length-20,20);}if(_48e[ns.rdfs_comment]){_48b="<li><em>Comment:</em> "+_48e[ns.rdfs_comment][0].value+"</li>";}if(_48e[ns.items.image]){if(_48e[ns.items.type][0].value===ns.fragments.image){_489+="<li><em>Image Fragment</em><div class='pundit-image-fragment-preview' style='position:relative' about='"+uri+"'><img class='pundit-image-preview-large' src='"+_48e[ns.items.image][0].value+"' /></div></li>";}else{_489+="<li><em>Image</em><img src='"+_48e[ns.items.image][0].value+"' / class='pundit-image-preview-large'></li>";}}var _48f=[];if(typeof (_48e[ns.rdf_type])!=="undefined"){_489+="<li><em>Types</em>: ";for(var i=_48e[ns.rdf_type].length-1;i>=0;i--){_48d=_48e[ns.rdf_type][i].value;_48f.push(_48d);if(typeof (_486[_48d])!=="undefined"&&typeof (_486[_48d][ns.rdfs_label])!=="undefined"){_48c=_486[_48d][ns.rdfs_label][0].value;}else{_48c=ns.getLabelFromUri(_48d);}_489+="<a class=\"go_to\" target=\"_blank\" href=\""+_48d+"\">"+_48c+"</a>, ";}_489=_489.substr(0,_489.length-2);_489+="</li>";}var _490;if(_48f.indexOf(ns.fragments.image)!==-1){_490=_48e[ns.items.parentItemXP][0].value;}else{_490=uri;}var _491="";if(_48f.indexOf(ns.fragments.text)!==-1||_48f.indexOf(ns.image)!==-1||_48f.indexOf(ns.fragments.image)!==-1){_491="Full content";if(self.xpointersClasses[_490]){_48a+="<li><a href=\"#\" class=\"zoom\" about=\""+_490+"\"><em>Zoom on this item</em></a></li>";}else{var _492=_48e[ns.items.pageContext][0].value,_493=uri.split("#")[1];var _494;if(typeof (_493)!=="undefined"){_494=_492+"#"+_493;}else{_494=_492;}_48a+="<li><em><a href=\""+_494+"\">Show in origin page</a></em></li>";}}else{_491="Description";_48a+="<li><a href=\""+uri+"\" target=\"_blank\">More info</a></li>";}if(_PUNDIT.config.enableSemanticExpansion){var _495=uri;if(_495.indexOf("europeana.eu")!==-1){var _496=_495.split("/");_495="http://data.europeana.eu/item/"+_496[_496.length-2]+"/"+_496[_496.length-1];}_48a+="<li><a href='"+ns.lodLiveURL+"?"+encodeURI(_495)+"' target='_blank'>(NEW!) Explore in LodLive</a></li>";}if(_48e[ns.items.description]&&_48f.indexOf(ns.image)===-1){_489+="<li><em>"+_491+"</em>: "+_48e[ns.items.description][0].value+"</li>";}}_488=self.xpointersColors[_490]||"";tp+="<span class=\"pundit-moreinfo "+_488+"\">"+_487+"</span>";tp+="<span class=\"pundit-moreinfo-subpanel pundit-hidden\"><ul>";tp+=_48b+_489+_48a;tp+="</ul></span>";return tp;},addAnnotationContent:function(_497,_498){var self=this;self.annotations[_497].content=_498;self.log("Added content to annotation "+_497);},addAnnotationItems:function(_499,_49a){var self=this,c=self.annotations[_499].content;self.annotations[_499].items=_49a;for(var _49b in c){self.log("Adding SUBJECT item: "+_49b.substr(0,41)+"..");self.extractItemFromAnnContent(_49b,_49a);for(var _49c in c[_49b]){for(var k=c[_49b][_49c].length-1;k>=0;k--){var _49d=c[_49b][_49c][k];if(_49d.type==="literal"){}else{self.extractItemFromAnnContent(_49d.value,_49a);}}}}},extractItemFromAnnContent:function(uri,it){var self=this,item={value:uri};self.log("Extracting item from content: "+uri.substr(0,40));if(typeof (it)==="undefined"||it===null){self.log("No items to extract from.");return;}if(typeof (it[uri])==="undefined"){self.log("Cant extract item for this uri!!");console.log("TODO: Error? Literallone?",it,uri);return;}for(var _49e in ns.items){var _49f=ns.items[_49e];if(typeof (it[uri][_49f])!=="undefined"){if(_49e==="selector"){var _4a0=it[uri][_49f][0].value;var _4a1=it[_4a0][ns.rdf_value][0].value;if(typeof (item["selectors"])==="undefined"){item["selectors"]=[];}item["selectors"].push(_4.fromJson(_4a1));}else{item[_49e]=it[uri][_49f][0].value;}}}item["rdftype"]=[];for(var i=it[uri][ns.items.type].length;i--;){item["rdftype"].push(it[uri][ns.items.type][i].value);}if(it[uri][ns.items.type][0].value===ns.fragments.text){item["type"]=["subject"];item.rdfData=semlibItems.createBucketForTextFragment(item).bucket;previewer.buildPreviewForItem(item);semlibItems.addItem(item);self.log("Created and added a TEXT item "+item.value.substr(0,30)+"..");return;}if(it[uri][ns.items.type][0].value===ns.rdfs_resource){item["type"]=["subject"];item.rdfData=semlibItems.createBucketForVocabItem(item).bucket;previewer.buildPreviewForItem(item);semlibItems.addItem(item);self.log("Created and added VOCAB item "+item.value.substr(0,30)+"..");return;}self.log("Assuming proper item for "+item.value.substr(0,30)+"..");item["type"]=["subject"];item.rdfData=semlibItems.createBucketForItem(item).bucket;previewer.buildPreviewForItem(item);semlibItems.addItem(item);self.log("Created and added DEFAULT item "+item.value.substr(0,30)+"..");},refreshAnnotations:function(){var self=this;self.log("Refresing annotations");self.isRefreshingAnnotations=true;self.backup={usedColors:self.usedColors,colors:self.colors,xpointersColors:self.xpointersColors};self.wipe();self.contentURIs=self.helper.getContentURIs();self.reader.getAnnotationMetadataFromUri(self.contentURIs);},wipe:function(){var self=this;self.tempXpointers=self.tempXpointers||[];self.annXpointers=[];self.xpointers=[];self.invalidXpointers=[];self.invalidAnnIds=[];self.xpointersClasses={};self.xpointersColors={};self.xpointersAnnotationsId={};self.xpaths=[];self.annotations={};self.contentURIs=[];self.colors=["col1","col2","col3","col4","col5","col6","col7","col9","col10","col11","col12","col13","col14","col15","col16","col17","col18","col19","col20","col21","col22","col23","col24","col25"];self.usedColors={};self.fallbackColor=["col1"];},consolidate:function(){var self=this,foo;self.wipeConsolidatedAnnotations();for(var i=self.annXpointers.length;i--;){self.xpointers.push(self.annXpointers[i]);}for(var k=self.tempXpointers.length;k--;){self.xpointers.push(self.tempXpointers[k]);}foo=self.helper.getXPathsFromXPointers(self.xpointers);self.xpointers=foo.xpointers;self.xpaths=foo.xpaths;self.invalidXpointers=foo.invalidXpointers;for(var i=self.xpointers.length;i--;){var uri=self.xpointers[i];self.xpointersClasses[uri]=["consxp"+i];}self.sortedXpaths=self.helper.splitAndSortXPaths(self.xpaths);self.htmlClasses=self.helper.getClassesForNewXpointers(self.xpointers,self.sortedXpaths,self.xpaths,self.xpointersClasses);self.helper.updateDOM(self.sortedXpaths,self.htmlClasses);for(xp in self.xpointersClasses){var cl=self.xpointersClasses[xp].join(""),_4a2=_4.query("."+cl),n=_4a2.length-1,id="icon_"+cl,_4a3="";if(n<0){continue;}self.log("Adding RDF icon for "+id);if(self.isAnnXpointer(xp)){_4.place("<a class=\"pundit-icon-annotation\" id=\""+id+"\"></a>",_4a2[n],"after");}else{if(self.isTempXpointer(xp)){_4.place("<a class=\"pundit-icon-annotation selected_fragment_icon\" id=\""+id+"\"></a>",_4a2[n],"after");}}_4.connect(_4.byId(id),"onmouseenter",(function(_4a4,_4a5){return function(e){self.highlightByXpointer(_4a5);if(self.isAnnXpointer(_4a5)){self.fireOnAnnotationIconMouseEnter(_4a5);}};})(cl,xp));_4.connect(_4.byId(id),"onmouseleave",(function(_4a6,_4a7){return function(){self.removeHighlightByXpointer(_4a7);if(self.isAnnXpointer(_4a7)){self.fireOnAnnotationIconMouseLeave(_4a7);}};})(cl,xp));_4.connect(_4.byId(id),"onclick",(function(_4a8,_4a9){return function(e){_PUNDIT.ga.track("gui-button","click","rdf-icon");if(semlibWindow.isAnnotationWindowOpen()){var _4aa=semlibWindow.getOpenedPanelsByXpointer(_4a9);for(var j=_4aa.length;j--;){semlibWindow.setPositioningXpointer(_4aa[j].id,_4a9);}}e.preventDefault();self.fireOnAnnotationIconMouseClick(_4a9);var item=_PUNDIT["items"].getItemByUri(_4a9);if(typeof (item)==="undefined"){var _4ab=new pundit.XpointersHelper();var _4ac=_4ab.getXPathsFromXPointers([_4a9]).xpaths[_4a9].startxpath;var el=document.evaluate(_4ac,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;var _4ad=_4.query("img",el);for(var _4ae=0;_4ae<_4ad.length;_4ae++){var _4af=_4ad[_4ae].src;item=_PUNDIT["items"].getItemsFromParentItem(_4af)[0];}}if(self.isAnnXpointer(_4a9)){cMenu.show(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset,item,"annotatedtextfragment");}else{if(self.isTempXpointer(_4a9)){cMenu.show(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset,item,"bookmarkedtextfragment");}}_4.stopEvent(e);return false;};})(cl,xp));}self.log("DOM is consolidated.");if(typeof (self.backup.xpointersColors)!=="undefined"){self.xpointersColors=self.backup.xpointersColors;self.colors=self.backup.colors;self.usedColors=self.backup.usedColors;}for(var xp in self.xpointersColors){var cl=self.xpointersClasses[xp].join("");_4.query("span."+cl).addClass(self.xpointersColors[xp]);}if(self.opts.highlightingMode){self.highlightAll();}self.fireOnConsolidate();if(self.opts.showInvalidXPointers===true){console.log("-----------------------------------------------");console.log("BROKEN ANNOTATIONS FOR "+self.invalidXpointers.length+" XPOINTERS");self.invalidAnnIds=[];for(var i=self.invalidXpointers.length;i--;){var xp=self.invalidXpointers[i],anns=self.xpointersAnnotationsId[xp];for(var j in anns){var id=anns[j],meta=self.annotations[id].metadata,_4b0=meta[_PUNDIT.ns.pundit_authorName][0].value,date=meta[_PUNDIT.ns.pundit_annotationDate][0].value,nb=meta[_PUNDIT.ns.pundit_isIncludedIn][0].value.substr(41,8),_4b1="No content retrieved";try{_4b1=self.annotations[id].items[xp][_PUNDIT.ns.items.label][0].value;}catch(e){}console.log("BROKEN ANN "+id+" ("+_4b0+", "+date+", nb "+nb+"): "+_4b1);self.invalidAnnIds.push(id);}}}self.log("Consolidate() is done.");},showAnnotationOnLoad:function(){var self=this;if(self._onLoadAnnotationShown){return;}self.queryObject=_PUNDIT.tripleComposer.getQueryParametersObject();if("pundit-show" in self.queryObject){try{var id=self.queryObject["pundit-show"],xp=self.annotations[id].targets[0];self.showAnnotationPanel(id);setTimeout(function(){self.zoomOnXpointer(xp);},1000);}catch(e){console.log("Error trying to show an annotation on load.");}}self._onLoadAnnotationShown=true;},highlightByXpointer:function(xp){var self=this;if(xp in self.xpointersClasses){if(typeof (self.hideTimer[xp])!=="undefined"){clearTimeout(self.hideTimer[xp]);}else{self.hideTimer[xp]=null;}if(typeof (self.highlightCount[xp])==="undefined"){self.highlightCount[xp]=0;}self.highlightCount[xp]++;_4.query("span."+self.xpointersClasses[xp].join("")).addClass("active");}},removeHighlightByXpointer:function(xp){var self=this;if(xp in this.xpointersClasses){self.highlightCount[xp]--;if(self.highlightCount[xp]>0){return;}clearTimeout(self.hideTimer[xp]);self.hideTimer[xp]=setTimeout(function(){if(self.xpointersClasses[xp]&&!self.highlightingMode){_4.query("span."+self.xpointersClasses[xp].join("")).removeClass("active");}},self.opts.hideMouseLeaveMS);}},highlightAll:function(){_4.query(".cons").forEach(function(item){_4.addClass(item,"active");});},hideZoom:function(){_4.destroy("pundit-zoomed-fragment");},zoomOnXpointer:function(xp){if(typeof (this.xpointersClasses[xp])==="undefined"){return;}var self=this,cl=self.xpointersClasses[xp].join(" "),top=Infinity,left=Infinity,_4b2=-Infinity,_4b3=-Infinity,y=Infinity,_4b4=5,st;self.log("Zooming on class "+cl);_4.query(".cons."+cl+", .cons."+cl+" img").forEach(function(item){var c=_4.position(item,true);top=Math.min(top,c.y);left=Math.min(left,c.x);_4b2=Math.max(_4b2,c.y+c.h);_4b3=Math.max(_4b3,c.x+c.w);y=Math.min(y,c.y);});if(_4.query("#pundit-zoomed-fragment").length>0){_4.destroy("pundit-zoomed-fragment");}_4.query("body").append("<div id=\"pundit-zoomed-fragment\"><span class=\"pundit-icon-close\"></span></div>");_4.behavior.apply();st={position:"absolute",left:(left-_4b4-1)+"px",top:(top-_4b4-1)+"px",height:(_4b2-top+2*_4b4)+"px",width:(_4b3-left+2*_4b4)+"px"};_4.style("pundit-zoomed-fragment",st);_4.toggleClass("pundit-zoomed-fragment","pundit-shown");var _4b5=_4.query("body")[0].scrollTop;if((y-_4b5<_4.position("pundit-gui",true).h)||(y-_4b5+_4.position("pundit-zoomed-fragment",true).h>window.innerHeight)){_6.fx.smoothScroll({node:_4.query("#pundit-zoomed-fragment")[0],offset:{x:0,y:_4.position("pundit-gui",true).h+100},win:window,duration:800}).play();}},wipeConsolidatedAnnotations:function(){var self=this;_4.query(".pundit-icon-annotation, .selected_fragment_icon").forEach(function(node){_4.destroy(node);});self.unwrap("cons");self.helper.mergeTextNodes(_4.query("body")[0]);self.log("Wiped all consolidated annotations");},unwrap:function(c){var _4b6=_4.query("."+c);for(var i=_4b6.length;i--;){var _4b7=_4.query(_4b6[i]).parent()[0];while(_4b6[i].firstChild){_4b7.insertBefore(_4b6[i].firstChild,_4b6[i]);}_4.destroy(_4b6[i]);}},initBehaviors:function(){var self=this;_4.behavior.add({"div.pundit-statement span.pundit-moreinfo":{"onclick":function(e){_4.toggleClass(_4.query(e.currentTarget).next()[0],"pundit-hidden");e.preventDefault();var node=_4.query(e.target).next().children().children().children(".pundit-image-fragment-preview");if(node.length>0&&_4.query(node).children(".kineticjs-content").length===0){var _4b8=_4.attr(_4.query(node)[0],"about");var _4b9=_4.style(_4.query(node).children("img")[0]),w=_4b9.width.replace("px",""),h=_4b9.height.replace("px",""),item=_PUNDIT["items"].getItemByUri(_4b8);var s=new Kinetic.Stage({container:_4.query(e.target).next().children().children().children(".pundit-image-fragment-preview")[0],width:w,height:h});_4.style(s.getContent(),{left:_4b9.marginLeft,top:_4b9.marginTop,position:"absolute"});var l=new Kinetic.Layer();s.add(l);for(var i=item.selectors.length;i--;){var _4ba=[];if(item.selectors[i].type==="polygon"){for(var j=item.selectors[i].points.length;j--;){_4ba.push({x:item.selectors[i].points[j].x*parseInt(w),y:item.selectors[i].points[j].y*parseInt(h)});}var p=[];for(var k=_4ba.length;k--;){p=p.concat([_4ba[k].x,_4ba[k].y]);}p=p.concat([_4ba[0].x,_4ba[0].y]);var poly=new Kinetic.Polygon({points:p,fill:"#00D2FF",stroke:"black",strokeWidth:2,opacity:0.3});l.add(poly);s.draw();}}}semlibWindow.positionPanels();}},"div.pundit-statement a.zoom":{"click":function(e){var xp=_4.attr(e.currentTarget,"about"),_4bb=_4.query(e.currentTarget).parents(".pundit-aw-panel")[0];self.zoomOnXpointer(xp);semlibWindow.setPositioningXpointer(_4.attr(_4bb,"id"),xp);e.preventDefault();},"onmouseover":function(e){self.highlightByXpointer(_4.attr(e.currentTarget,"about"));},"onmouseout":function(e){self.removeHighlightByXpointer(_4.attr(e.currentTarget,"about"));}},"#pundit-tc-reset-button":{"click":function(){_PUNDIT.ga.track("gui-button","click","pundit-tc-edit-reset");tripleComposer.clearDnDTriples();_4.query("#pundit-tc-container").removeClass("pundit-edit-mode");_PUNDIT.tripleComposer.isEditing=false;}},"div.pundit-aw-panel-buttons span.edit":{"click":function(e){_PUNDIT.ga.track("gui-button","click","pundit-tc-edit");var _4bc=_4.attr(e.currentTarget,"data-annId"),nbId=_4.attr(e.currentTarget,"data-nbId");self.editAnnotation(nbId,_4bc);}},"div.pundit-aw-panel-buttons span.activate":{"click":function(e){var _4bd=_4.attr(e.currentTarget,"about");self.writer.setNotebookActive(_4bd,"1");}},"div.pundit-aw-panel-buttons span.deactivate":{"click":function(e){var _4be=_4.attr(e.currentTarget,"about");self.writer.setNotebookActive(_4be,"0");}},"div.pundit-aw-panel-buttons span.delete":{"click":function(e){_PUNDIT.ga.track("gui-button","click","pundit-tc-delete");var _4bf=_4.attr(e.currentTarget,"about"),_4c0=_PUNDIT.loadingBox.addJob("Deleting annotation ");_4.query("#dialog_"+_4bf+"_content").addClass("pundit-panel-loading");_4.query("#dialog_"+_4bf+"_content .pundit-gui-button.delete").style("display","none");self.refreshPageItems=true;self.writer.deleteAnnotation(_4bf,function(){semlibWindow.destroyPanelById(_4bf);self.refreshAnnotations();_PUNDIT.loadingBox.setJobOk(_4c0);});}},"div#pundit-zoomed-fragment span.pundit-icon-close":{"click":function(e){self.hideZoom();}}});},editAnnotation:function(nbId,_4c1){var self=this,ann=self.annotations[_4c1].content,_4c2=0;self.log("Editing annotation "+_4c1+" from notebook "+nbId);_PUNDIT.tripleComposer.isEditing=_4c1;_4.query("#pundit-tc-edit-msg")[0].innerHTML="Editing annotation "+_4c1;_4.query("#pundit-tc-container").addClass("pundit-edit-mode");tripleComposer.clearDnDTriples();for(var sUri in ann){for(var pUri in ann[sUri]){for(var oUri in ann[sUri][pUri]){var ob=ann[sUri][pUri][oUri],s=semlibItems.getItemFromUri(sUri),p=semlibItems.getItemFromUri(pUri),o;if(ob.type==="uri"){o=semlibItems.getItemFromUri(ob.value);}else{o=semlibLiterals.createLiteralItem(ob.value);}_4c2++;if(tripleComposer.getNumberOfTriples()!==_4c2){tripleComposer.addDnDTriple();}tripleComposer.addItemToSubject(s);tripleComposer.addItemToPredicate(p);tripleComposer.addItemToObject(o);}}}if(!_PUNDIT.GUI.isWindowOpen()){_PUNDIT.GUI.toggleWindow();}},addAnnotations:function(_4c3){var self=this,nAnn=0,nXps=0,_4c4=[];self.log("Adding annotations from raw graph......");self.annXpointers=[];self.annIds=[];for(var _4c5 in _4c3){var a=_4c3[_4c5],_4c6,_4c7,_4c8=false;for(var t=a[ns.rdf_type].length;t--;){if(a[ns.rdf_type][t].value===ns.annotation){_4c8=true;}}if(!_4c8){self.log("ERROR: invalid annotation from /search query! .. discarded.");continue;}_4c6=a[ns.pundit_hasTarget]||[];_4c7=a[ns.pundit_annotationId][0].value;var _4c9=a[ns.pundit_isIncludedIn][0].value;var _4ca=_4c9.split("/")[_4c9.split("/").length-1];self.notebooks[_4ca]=null;self.log("Adding annotation "+_4c7+" with "+_4c6.length+" targets");if(_4c6.length===0){self.annIds.push(_4c7);a[ns.pundit_hasTarget]=[];self.annotations[_4c7]={targets:[],metadata:a,id:_4c7};}else{for(var i=_4c6.length;i--;){var val=_4c6[i].value;if(val.match(/#xpointer\(start-point\(string-range\(/)){if(_4.indexOf(self.annIds,_4c7)===-1){self.annIds.push(_4c7);}self.xpointers.push(val);self.annXpointers.push(val);if(_4c7 in self.annotations){self.annotations[_4c7].targets.push(val);}else{self.annotations[_4c7]={targets:[val],metadata:a,id:_4c7};}if(typeof (self.xpointersAnnotationsId[val])==="undefined"){self.xpointersAnnotationsId[val]=[_4c7];}else{self.xpointersAnnotationsId[val].push(_4c7);}}else{if(val===_PUNDIT.tripleComposer.getSafePageContext()){if(_4.indexOf(self.annIds,_4c7)===-1){self.annIds.push(_4c7);}if(_4c7 in self.annotations){}else{self.annotations[_4c7]={targets:[],metadata:a,id:_4c7};}}else{self.log("Ops, annotation target is not an xpointer?");}}}}}self.annToDownload=self.annIds.length;if(self.annToDownload===0){_PUNDIT.loadingBox.setJobOk(self.jobId);self.jobId=null;self.log("No annotations added: nothing to display on this page.");self.isRefreshingAnnotations=false;}else{self.log("Added "+self.annToDownload+" annotations ready to be downloaded");for(var i=self.annIds.length;i--;){self.reader.getAnnotationContentFromId(self.annIds[i]);}}},isAnnXpointer:function(xp){for(var i=this.annXpointers.length;i--;){if(xp===this.annXpointers[i]){return true;}}return false;},isTempXpointer:function(xp){for(var i=this.tempXpointers.length;i--;){if(xp===this.tempXpointers[i]){return true;}}return false;},resetTempXpointers:function(){this.tempXpointers=[];},removeTempXpointer:function(xp){for(var i=this.tempXpointers.length;i--;){if(xp===this.tempXpointers[i]){if(typeof semlibMyItems.getItemFromUri(xp)==="undefined"){this.tempXpointers.splice(i,1);}}}for(var i=this.xpointers.length;i--;){if(xp===this.xpointers[i]){this.xpointers.splice(i,1);}}if(typeof semlibMyItems.getItemFromUri(xp)==="undefined"){delete tooltip_viewer.xpointersClasses[xp];}}});}if(!_4._hasResource["pundit.TriplesBucket"]){_4._hasResource["pundit.TriplesBucket"]=true;_4.provide("pundit.TriplesBucket");_4.declare("pundit.TriplesBucket",null,{opts:{},constructor:function(_4cb){if(_4cb&&typeof (_4cb.bucket)!=="undefined"){this.bucket=_4cb.bucket;}else{this.bucket=[];}},concatBucket:function(b){this.bucket=this.bucket.concat(b);},addTriple:function(s,p,o,_4cc){if(typeof (s)!=="undefined"&&typeof (p)!=="undefined"&&typeof (o)!=="undefined"&&typeof (_4cc)!=="undefined"){this.bucket.push({s:s,p:p,o:o,otype:_4cc});}},updateTripleObject:function(s,p,o,_4cd){if(typeof (s)==="undefined"||typeof (p)==="undefined"||typeof (o)==="undefined"||typeof (_4cd)==="undefined"){return;}for(var i=0;i<this.bucket.length;i++){if(this.bucket[i].s===s&&this.bucket[i].p===p){this.bucket[i].o=o;this.bucket[i].otype=_4cd;}}},emptyBucket:function(){this.bucket=[];},getTalisJson:function(){var res={},t;for(var i=0;i<this.bucket.length;i++){t=this.bucket[i];if(!(t.s in res)){res[t.s]={};}if(!(t.p in res[t.s])){res[t.s][t.p]=[];}res[t.s][t.p].push({value:t.o,type:t.otype});}return res;},getObject:function(s,p){var ret=[],t;for(var i in this.bucket){t=this.bucket[i];if(t.s===s&&t.p===p){ret.push(t.o);}}return ret;},isEmpty:function(){return this.bucket.length===0;}});}if(!_4._hasResource["dojo.data.util.filter"]){_4._hasResource["dojo.data.util.filter"]=true;_4.provide("dojo.data.util.filter");_4.getObject("data.util.filter",true,_4);_4.data.util.filter.patternToRegExp=function(_4ce,_4cf){var rxp="^";var c=null;for(var i=0;i<_4ce.length;i++){c=_4ce.charAt(i);switch(c){case "\\":rxp+=c;i++;rxp+=_4ce.charAt(i);break;case "*":rxp+=".*";break;case "?":rxp+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":rxp+="\\";default:rxp+=c;}}rxp+="$";if(_4cf){return new RegExp(rxp,"mi");}else{return new RegExp(rxp,"m");}};}if(!_4._hasResource["dojo.data.util.sorter"]){_4._hasResource["dojo.data.util.sorter"]=true;_4.provide("dojo.data.util.sorter");_4.getObject("data.util.sorter",true,_4);_4.data.util.sorter.basicComparator=function(a,b){var r=-1;if(a===null){a=undefined;}if(b===null){b=undefined;}if(a==b){r=0;}else{if(a>b||a==null){r=1;}}return r;};_4.data.util.sorter.createSortFunction=function(_4d0,_4d1){var _4d2=[];function _4d3(attr,dir,comp,s){return function(_4d4,_4d5){var a=s.getValue(_4d4,attr);var b=s.getValue(_4d5,attr);return dir*comp(a,b);};};var _4d6;var map=_4d1.comparatorMap;var bc=_4.data.util.sorter.basicComparator;for(var i=0;i<_4d0.length;i++){_4d6=_4d0[i];var attr=_4d6.attribute;if(attr){var dir=(_4d6.descending)?-1:1;var comp=bc;if(map){if(typeof attr!=="string"&&("toString" in attr)){attr=attr.toString();}comp=map[attr]||bc;}_4d2.push(_4d3(attr,dir,comp,_4d1));}}return function(rowA,rowB){var i=0;while(i<_4d2.length){var ret=_4d2[i++](rowA,rowB);if(ret!==0){return ret;}}return 0;};};}if(!_4._hasResource["dojo.data.util.simpleFetch"]){_4._hasResource["dojo.data.util.simpleFetch"]=true;_4.provide("dojo.data.util.simpleFetch");_4.getObject("data.util.simpleFetch",true,_4);_4.data.util.simpleFetch.fetch=function(_4d7){_4d7=_4d7||{};if(!_4d7.store){_4d7.store=this;}var self=this;var _4d8=function(_4d9,_4da){if(_4da.onError){var _4db=_4da.scope||_4.global;_4da.onError.call(_4db,_4d9,_4da);}};var _4dc=function(_4dd,_4de){var _4df=_4de.abort||null;var _4e0=false;var _4e1=_4de.start?_4de.start:0;var _4e2=(_4de.count&&(_4de.count!==Infinity))?(_4e1+_4de.count):_4dd.length;_4de.abort=function(){_4e0=true;if(_4df){_4df.call(_4de);}};var _4e3=_4de.scope||_4.global;if(!_4de.store){_4de.store=self;}if(_4de.onBegin){_4de.onBegin.call(_4e3,_4dd.length,_4de);}if(_4de.sort){_4dd.sort(_4.data.util.sorter.createSortFunction(_4de.sort,self));}if(_4de.onItem){for(var i=_4e1;(i<_4dd.length)&&(i<_4e2);++i){var item=_4dd[i];if(!_4e0){_4de.onItem.call(_4e3,item,_4de);}}}if(_4de.onComplete&&!_4e0){var _4e4=null;if(!_4de.onItem){_4e4=_4dd.slice(_4e1,_4e2);}_4de.onComplete.call(_4e3,_4e4,_4de);}};this._fetchItems(_4d7,_4dc,_4d8);return _4d7;};}if(!_4._hasResource["dojo.data.ItemFileReadStore"]){_4._hasResource["dojo.data.ItemFileReadStore"]=true;_4.provide("dojo.data.ItemFileReadStore");_4.declare("dojo.data.ItemFileReadStore",null,{constructor:function(_4e5){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=false;this._jsonFileUrl=_4e5.url;this._ccUrl=_4e5.url;this.url=_4e5.url;this._jsonData=_4e5.data;this.data=null;this._datatypeMap=_4e5.typeMap||{};if(!this._datatypeMap["Date"]){this._datatypeMap["Date"]={type:Date,deserialize:function(_4e6){return _4.date.stamp.fromISOString(_4e6);}};}this._features={"dojo.data.api.Read":true,"dojo.data.api.Identity":true};this._itemsByIdentity=null;this._storeRefPropName="_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=false;this._queuedFetches=[];if(_4e5.urlPreventCache!==undefined){this.urlPreventCache=_4e5.urlPreventCache?true:false;}if(_4e5.hierarchical!==undefined){this.hierarchical=_4e5.hierarchical?true:false;}if(_4e5.clearOnClose){this.clearOnClose=true;}if("failOk" in _4e5){this.failOk=_4e5.failOk?true:false;}},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:false,urlPreventCache:false,failOk:false,hierarchical:true,_assertIsItem:function(item){if(!this.isItem(item)){throw new Error("dojo.data.ItemFileReadStore: Invalid item argument.");}},_assertIsAttribute:function(_4e7){if(typeof _4e7!=="string"){throw new Error("dojo.data.ItemFileReadStore: Invalid attribute argument.");}},getValue:function(item,_4e8,_4e9){var _4ea=this.getValues(item,_4e8);return (_4ea.length>0)?_4ea[0]:_4e9;},getValues:function(item,_4eb){this._assertIsItem(item);this._assertIsAttribute(_4eb);return (item[_4eb]||[]).slice(0);},getAttributes:function(item){this._assertIsItem(item);var _4ec=[];for(var key in item){if((key!==this._storeRefPropName)&&(key!==this._itemNumPropName)&&(key!==this._rootItemPropName)&&(key!==this._reverseRefMap)){_4ec.push(key);}}return _4ec;},hasAttribute:function(item,_4ed){this._assertIsItem(item);this._assertIsAttribute(_4ed);return (_4ed in item);},containsValue:function(item,_4ee,_4ef){var _4f0=undefined;if(typeof _4ef==="string"){_4f0=_4.data.util.filter.patternToRegExp(_4ef,false);}return this._containsValue(item,_4ee,_4ef,_4f0);},_containsValue:function(item,_4f1,_4f2,_4f3){return _4.some(this.getValues(item,_4f1),function(_4f4){if(_4f4!==null&&!_4.isObject(_4f4)&&_4f3){if(_4f4.toString().match(_4f3)){return true;}}else{if(_4f2===_4f4){return true;}}});},isItem:function(_4f5){if(_4f5&&_4f5[this._storeRefPropName]===this){if(this._arrayOfAllItems[_4f5[this._itemNumPropName]]===_4f5){return true;}}return false;},isItemLoaded:function(_4f6){return this.isItem(_4f6);},loadItem:function(_4f7){this._assertIsItem(_4f7.item);},getFeatures:function(){return this._features;},getLabel:function(item){if(this._labelAttr&&this.isItem(item)){return this.getValue(item,this._labelAttr);}return undefined;},getLabelAttributes:function(item){if(this._labelAttr){return [this._labelAttr];}return null;},_fetchItems:function(_4f8,_4f9,_4fa){var self=this,_4fb=function(_4fc,_4fd){var _4fe=[],i,key;if(_4fc.query){var _4ff,_500=_4fc.queryOptions?_4fc.queryOptions.ignoreCase:false;var _501={};for(key in _4fc.query){_4ff=_4fc.query[key];if(typeof _4ff==="string"){_501[key]=_4.data.util.filter.patternToRegExp(_4ff,_500);}else{if(_4ff instanceof RegExp){_501[key]=_4ff;}}}for(i=0;i<_4fd.length;++i){var _502=true;var _503=_4fd[i];if(_503===null){_502=false;}else{for(key in _4fc.query){_4ff=_4fc.query[key];if(!self._containsValue(_503,key,_4ff,_501[key])){_502=false;}}}if(_502){_4fe.push(_503);}}_4f9(_4fe,_4fc);}else{for(i=0;i<_4fd.length;++i){var item=_4fd[i];if(item!==null){_4fe.push(item);}}_4f9(_4fe,_4fc);}};if(this._loadFinished){_4fb(_4f8,this._getItemsArray(_4f8.queryOptions));}else{if(this._jsonFileUrl!==this._ccUrl){_4.deprecated("dojo.data.ItemFileReadStore: ","To change the url, set the url property of the store,"+" not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0");this._ccUrl=this._jsonFileUrl;this.url=this._jsonFileUrl;}else{if(this.url!==this._ccUrl){this._jsonFileUrl=this.url;this._ccUrl=this.url;}}if(this.data!=null){this._jsonData=this.data;this.data=null;}if(this._jsonFileUrl){if(this._loadInProgress){this._queuedFetches.push({args:_4f8,filter:_4fb});}else{this._loadInProgress=true;var _504={url:self._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk};var _505=_4.xhrGet(_504);_505.addCallback(function(data){try{self._getItemsFromLoadedData(data);self._loadFinished=true;self._loadInProgress=false;_4fb(_4f8,self._getItemsArray(_4f8.queryOptions));self._handleQueuedFetches();}catch(e){self._loadFinished=true;self._loadInProgress=false;_4fa(e,_4f8);}});_505.addErrback(function(_506){self._loadInProgress=false;_4fa(_506,_4f8);});var _507=null;if(_4f8.abort){_507=_4f8.abort;}_4f8.abort=function(){var df=_505;if(df&&df.fired===-1){df.cancel();df=null;}if(_507){_507.call(_4f8);}};}}else{if(this._jsonData){try{this._loadFinished=true;this._getItemsFromLoadedData(this._jsonData);this._jsonData=null;_4fb(_4f8,this._getItemsArray(_4f8.queryOptions));}catch(e){_4fa(e,_4f8);}}else{_4fa(new Error("dojo.data.ItemFileReadStore: No JSON source data was provided as either URL or a nested Javascript object."),_4f8);}}}},_handleQueuedFetches:function(){if(this._queuedFetches.length>0){for(var i=0;i<this._queuedFetches.length;i++){var _508=this._queuedFetches[i],_509=_508.args,_50a=_508.filter;if(_50a){_50a(_509,this._getItemsArray(_509.queryOptions));}else{this.fetchItemByIdentity(_509);}}this._queuedFetches=[];}},_getItemsArray:function(_50b){if(_50b&&_50b.deep){return this._arrayOfAllItems;}return this._arrayOfTopLevelItems;},close:function(_50c){if(this.clearOnClose&&this._loadFinished&&!this._loadInProgress){if(((this._jsonFileUrl==""||this._jsonFileUrl==null)&&(this.url==""||this.url==null))&&this.data==null){console.debug("dojo.data.ItemFileReadStore: WARNING!  Data reload "+" information has not been provided."+"  Please set 'url' or 'data' to the appropriate value before"+" the next fetch");}this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=false;this._itemsByIdentity=null;this._loadInProgress=false;this._queuedFetches=[];}},_getItemsFromLoadedData:function(_50d){var _50e=false,self=this;function _50f(_510){var _511=((_510!==null)&&(typeof _510==="object")&&(!_4.isArray(_510)||_50e)&&(!_4.isFunction(_510))&&(_510.constructor==Object||_4.isArray(_510))&&(typeof _510._reference==="undefined")&&(typeof _510._type==="undefined")&&(typeof _510._value==="undefined")&&self.hierarchical);return _511;};function _512(_513){self._arrayOfAllItems.push(_513);for(var _514 in _513){var _515=_513[_514];if(_515){if(_4.isArray(_515)){var _516=_515;for(var k=0;k<_516.length;++k){var _517=_516[k];if(_50f(_517)){_512(_517);}}}else{if(_50f(_515)){_512(_515);}}}}};this._labelAttr=_50d.label;var i,item;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=_50d.items;for(i=0;i<this._arrayOfTopLevelItems.length;++i){item=this._arrayOfTopLevelItems[i];if(_4.isArray(item)){_50e=true;}_512(item);item[this._rootItemPropName]=true;}var _518={},key;for(i=0;i<this._arrayOfAllItems.length;++i){item=this._arrayOfAllItems[i];for(key in item){if(key!==this._rootItemPropName){var _519=item[key];if(_519!==null){if(!_4.isArray(_519)){item[key]=[_519];}}else{item[key]=[null];}}_518[key]=key;}}while(_518[this._storeRefPropName]){this._storeRefPropName+="_";}while(_518[this._itemNumPropName]){this._itemNumPropName+="_";}while(_518[this._reverseRefMap]){this._reverseRefMap+="_";}var _51a;var _51b=_50d.identifier;if(_51b){this._itemsByIdentity={};this._features["dojo.data.api.Identity"]=_51b;for(i=0;i<this._arrayOfAllItems.length;++i){item=this._arrayOfAllItems[i];_51a=item[_51b];var _51c=_51a[0];if(!Object.hasOwnProperty.call(this._itemsByIdentity,_51c)){this._itemsByIdentity[_51c]=item;}else{if(this._jsonFileUrl){throw new Error("dojo.data.ItemFileReadStore:  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+_51b+"].  Value collided: ["+_51c+"]");}else{if(this._jsonData){throw new Error("dojo.data.ItemFileReadStore:  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+_51b+"].  Value collided: ["+_51c+"]");}}}}}else{this._features["dojo.data.api.Identity"]=Number;}for(i=0;i<this._arrayOfAllItems.length;++i){item=this._arrayOfAllItems[i];item[this._storeRefPropName]=this;item[this._itemNumPropName]=i;}for(i=0;i<this._arrayOfAllItems.length;++i){item=this._arrayOfAllItems[i];for(key in item){_51a=item[key];for(var j=0;j<_51a.length;++j){_519=_51a[j];if(_519!==null&&typeof _519=="object"){if(("_type" in _519)&&("_value" in _519)){var type=_519._type;var _51d=this._datatypeMap[type];if(!_51d){throw new Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+type+"'");}else{if(_4.isFunction(_51d)){_51a[j]=new _51d(_519._value);}else{if(_4.isFunction(_51d.deserialize)){_51a[j]=_51d.deserialize(_519._value);}else{throw new Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");}}}}if(_519._reference){var _51e=_519._reference;if(!_4.isObject(_51e)){_51a[j]=this._getItemByIdentity(_51e);}else{for(var k=0;k<this._arrayOfAllItems.length;++k){var _51f=this._arrayOfAllItems[k],_520=true;for(var _521 in _51e){if(_51f[_521]!=_51e[_521]){_520=false;}}if(_520){_51a[j]=_51f;}}}if(this.referenceIntegrity){var _522=_51a[j];if(this.isItem(_522)){this._addReferenceToMap(_522,item,key);}}}else{if(this.isItem(_519)){if(this.referenceIntegrity){this._addReferenceToMap(_519,item,key);}}}}}}}},_addReferenceToMap:function(_523,_524,_525){},getIdentity:function(item){var _526=this._features["dojo.data.api.Identity"];if(_526===Number){return item[this._itemNumPropName];}else{var _527=item[_526];if(_527){return _527[0];}}return null;},fetchItemByIdentity:function(_528){var item,_529;if(!this._loadFinished){var self=this;if(this._jsonFileUrl!==this._ccUrl){_4.deprecated("dojo.data.ItemFileReadStore: ","To change the url, set the url property of the store,"+" not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0");this._ccUrl=this._jsonFileUrl;this.url=this._jsonFileUrl;}else{if(this.url!==this._ccUrl){this._jsonFileUrl=this.url;this._ccUrl=this.url;}}if(this.data!=null&&this._jsonData==null){this._jsonData=this.data;this.data=null;}if(this._jsonFileUrl){if(this._loadInProgress){this._queuedFetches.push({args:_528});}else{this._loadInProgress=true;var _52a={url:self._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk};var _52b=_4.xhrGet(_52a);_52b.addCallback(function(data){var _52c=_528.scope?_528.scope:_4.global;try{self._getItemsFromLoadedData(data);self._loadFinished=true;self._loadInProgress=false;item=self._getItemByIdentity(_528.identity);if(_528.onItem){_528.onItem.call(_52c,item);}self._handleQueuedFetches();}catch(error){self._loadInProgress=false;if(_528.onError){_528.onError.call(_52c,error);}}});_52b.addErrback(function(_52d){self._loadInProgress=false;if(_528.onError){var _52e=_528.scope?_528.scope:_4.global;_528.onError.call(_52e,_52d);}});}}else{if(this._jsonData){self._getItemsFromLoadedData(self._jsonData);self._jsonData=null;self._loadFinished=true;item=self._getItemByIdentity(_528.identity);if(_528.onItem){_529=_528.scope?_528.scope:_4.global;_528.onItem.call(_529,item);}}}}else{item=this._getItemByIdentity(_528.identity);if(_528.onItem){_529=_528.scope?_528.scope:_4.global;_528.onItem.call(_529,item);}}},_getItemByIdentity:function(_52f){var item=null;if(this._itemsByIdentity&&Object.hasOwnProperty.call(this._itemsByIdentity,_52f)){item=this._itemsByIdentity[_52f];}else{if(Object.hasOwnProperty.call(this._arrayOfAllItems,_52f)){item=this._arrayOfAllItems[_52f];}}if(item===undefined){item=null;}return item;},getIdentityAttributes:function(item){var _530=this._features["dojo.data.api.Identity"];if(_530===Number){return null;}else{return [_530];}},_forceLoad:function(){var self=this;if(this._jsonFileUrl!==this._ccUrl){_4.deprecated("dojo.data.ItemFileReadStore: ","To change the url, set the url property of the store,"+" not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0");this._ccUrl=this._jsonFileUrl;this.url=this._jsonFileUrl;}else{if(this.url!==this._ccUrl){this._jsonFileUrl=this.url;this._ccUrl=this.url;}}if(this.data!=null){this._jsonData=this.data;this.data=null;}if(this._jsonFileUrl){var _531={url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,sync:true};var _532=_4.xhrGet(_531);_532.addCallback(function(data){try{if(self._loadInProgress!==true&&!self._loadFinished){self._getItemsFromLoadedData(data);self._loadFinished=true;}else{if(self._loadInProgress){throw new Error("dojo.data.ItemFileReadStore:  Unable to perform a synchronous load, an async load is in progress.");}}}catch(e){console.log(e);throw e;}});_532.addErrback(function(_533){throw _533;});}else{if(this._jsonData){self._getItemsFromLoadedData(self._jsonData);self._jsonData=null;self._loadFinished=true;}}}});_4.extend(_4.data.ItemFileReadStore,_4.data.util.simpleFetch);}if(!_4._hasResource["dojo.store.util.QueryResults"]){_4._hasResource["dojo.store.util.QueryResults"]=true;_4.provide("dojo.store.util.QueryResults");_4.getObject("store.util",true,_4);_4.store.util.QueryResults=function(_534){if(!_534){return _534;}if(_534.then){_534=_4.delegate(_534);}function _535(_536){if(!_534[_536]){_534[_536]=function(){var args=arguments;return _4.when(_534,function(_537){Array.prototype.unshift.call(args,_537);return _4.store.util.QueryResults(_4[_536].apply(_4,args));});};}};_535("forEach");_535("filter");_535("map");if(!_534.total){_534.total=_4.when(_534,function(_538){return _538.length;});}return _534;};}if(!_4._hasResource["dojo.store.util.SimpleQueryEngine"]){_4._hasResource["dojo.store.util.SimpleQueryEngine"]=true;_4.provide("dojo.store.util.SimpleQueryEngine");_4.getObject("store.util",true,_4);_4.store.util.SimpleQueryEngine=function(_539,_53a){switch(typeof _539){default:throw new Error("Can not query with a "+typeof _539);case "object":case "undefined":var _53b=_539;_539=function(_53c){for(var key in _53b){var _53d=_53b[key];if(_53d&&_53d.test){if(!_53d.test(_53c[key])){return false;}}else{if(_53d!=_53c[key]){return false;}}}return true;};break;case "string":if(!this[_539]){throw new Error("No filter function "+_539+" was found in store");}_539=this[_539];case "function":}function _53e(_53f){var _540=_4.filter(_53f,_539);if(_53a&&_53a.sort){_540.sort(function(a,b){for(var sort,i=0;sort=_53a.sort[i];i++){var _541=a[sort.attribute];var _542=b[sort.attribute];if(_541!=_542){return !!sort.descending==_541>_542?-1:1;}}return 0;});}if(_53a&&(_53a.start||_53a.count)){var _543=_540.length;_540=_540.slice(_53a.start||0,(_53a.start||0)+(_53a.count||Infinity));_540.total=_543;}return _540;};_53e.matches=_539;return _53e;};}if(!_4._hasResource["dojo.store.Memory"]){_4._hasResource["dojo.store.Memory"]=true;_4.provide("dojo.store.Memory");_4.declare("dojo.store.Memory",null,{constructor:function(_544){this.index={};_4.mixin(this,_544);this.setData(this.data||[]);},data:null,idProperty:"id",index:null,queryEngine:_4.store.util.SimpleQueryEngine,get:function(id){return this.index[id];},getIdentity:function(_545){return _545[this.idProperty];},put:function(_546,_547){var id=_547&&_547.id||_546[this.idProperty]||Math.random();this.index[id]=_546;var data=this.data,_548=this.idProperty;for(var i=0,l=data.length;i<l;i++){if(data[i][_548]==id){data[i]=_546;return id;}}this.data.push(_546);return id;},add:function(_549,_54a){if(this.index[_54a&&_54a.id||_549[this.idProperty]]){throw new Error("Object already exists");}return this.put(_549,_54a);},remove:function(id){delete this.index[id];var data=this.data,_54b=this.idProperty;for(var i=0,l=data.length;i<l;i++){if(data[i][_54b]==id){data.splice(i,1);return;}}},query:function(_54c,_54d){return _4.store.util.QueryResults(this.queryEngine(_54c,_54d)(this.data));},setData:function(data){if(data.items){this.idProperty=data.identifier;data=this.data=data.items;}else{this.data=data;}for(var i=0,l=data.length;i<l;i++){var _54e=data[i];this.index[_54e[this.idProperty]]=_54e;}}});}if(!_4._hasResource["dojo.data.ObjectStore"]){_4._hasResource["dojo.data.ObjectStore"]=true;_4.provide("dojo.data.ObjectStore");_4.declare("dojo.data.ObjectStore",null,{objectStore:null,constructor:function(_54f){_4.mixin(this,_54f);},labelProperty:"label",getValue:function(item,_550,_551){return typeof item.get==="function"?item.get(_550):_550 in item?item[_550]:_551;},getValues:function(item,_552){var val=this.getValue(item,_552);return val instanceof Array?val:val===undefined?[]:[val];},getAttributes:function(item){var res=[];for(var i in item){if(item.hasOwnProperty(i)&&!(i.charAt(0)=="_"&&i.charAt(1)=="_")){res.push(i);}}return res;},hasAttribute:function(item,_553){return _553 in item;},containsValue:function(item,_554,_555){return _4.indexOf(this.getValues(item,_554),_555)>-1;},isItem:function(item){return (typeof item=="object")&&item&&!(item instanceof Date);},isItemLoaded:function(item){return item&&typeof item.load!=="function";},loadItem:function(args){var item;if(typeof args.item.load==="function"){_4.when(args.item.load(),function(_556){item=_556;var func=_556 instanceof Error?args.onError:args.onItem;if(func){func.call(args.scope,_556);}});}else{if(args.onItem){args.onItem.call(args.scope,args.item);}}return item;},close:function(_557){return _557&&_557.abort&&_557.abort();},fetch:function(args){args=args||{};var self=this;var _558=args.scope||self;var _559=args.query;if(typeof _559=="object"){_559=_4.delegate(_559);for(var i in _559){var _55a=_559[i];if(typeof _55a=="string"){_559[i]=RegExp("^"+_4.regexp.escapeString(_55a,"*?").replace(/\*/g,".*").replace(/\?/g,".")+"$",args.queryOptions&&args.queryOptions.ignoreCase?"mi":"m");_559[i].toString=(function(_55b){return function(){return _55b;};})(_55a);}}}var _55c=this.objectStore.query(_559,args);_4.when(_55c.total,function(_55d){_4.when(_55c,function(_55e){if(args.onBegin){args.onBegin.call(_558,_55d||_55e.length,args);}if(args.onItem){for(var i=0;i<_55e.length;i++){args.onItem.call(_558,_55e[i],args);}}if(args.onComplete){args.onComplete.call(_558,args.onItem?null:_55e,args);}return _55e;},_55f);},_55f);function _55f(_560){if(args.onError){args.onError.call(_558,_560,args);}};args.abort=function(){if(_55c.cancel){_55c.cancel();}};args.store=this;return args;},getFeatures:function(){return {"dojo.data.api.Read":!!this.objectStore.get,"dojo.data.api.Identity":true,"dojo.data.api.Write":!!this.objectStore.put,"dojo.data.api.Notification":true};},getLabel:function(item){if(this.isItem(item)){return this.getValue(item,this.labelProperty);}return undefined;},getLabelAttributes:function(item){return [this.labelProperty];},getIdentity:function(item){return item.getId?item.getId():item[this.objectStore.idProperty||"id"];},getIdentityAttributes:function(item){return [this.objectStore.idProperty];},fetchItemByIdentity:function(args){var item;_4.when(this.objectStore.get(args.identity),function(_561){item=_561;args.onItem.call(args.scope,_561);},function(_562){args.onError.call(args.scope,_562);});return item;},newItem:function(data,_563){if(_563){var _564=this.getValue(_563.parent,_563.attribute,[]);_564=_564.concat([data]);data.__parent=_564;this.setValue(_563.parent,_563.attribute,_564);}this._dirtyObjects.push({object:data,save:true});this.onNew(data);return data;},deleteItem:function(item){this.changing(item,true);this.onDelete(item);},setValue:function(item,_565,_566){var old=item[_565];this.changing(item);item[_565]=_566;this.onSet(item,_565,old,_566);},setValues:function(item,_567,_568){if(!_4.isArray(_568)){throw new Error("setValues expects to be passed an Array object as its value");}this.setValue(item,_567,_568);},unsetAttribute:function(item,_569){this.changing(item);var old=item[_569];delete item[_569];this.onSet(item,_569,old,undefined);},_dirtyObjects:[],changing:function(_56a,_56b){_56a.__isDirty=true;for(var i=0;i<this._dirtyObjects.length;i++){var _56c=this._dirtyObjects[i];if(_56a==_56c.object){if(_56b){_56c.object=false;if(!this._saveNotNeeded){_56c.save=true;}}return;}}var old=_56a instanceof Array?[]:{};for(i in _56a){if(_56a.hasOwnProperty(i)){old[i]=_56a[i];}}this._dirtyObjects.push({object:!_56b&&_56a,old:old,save:!this._saveNotNeeded});},save:function(_56d){_56d=_56d||{};var _56e,_56f=[];var _570={};var _571=[];var self;var _572=this._dirtyObjects;var left=_572.length;try{_4.connect(_56d,"onError",function(){if(_56d.revertOnError!==false){var _573=_572;_572=_571;var _574=0;jr.revert();self._dirtyObjects=_573;}else{self._dirtyObjects=dirtyObject.concat(_571);}});if(this.objectStore.transaction){var _575=this.objectStore.transaction();}for(var i=0;i<_572.length;i++){var _576=_572[i];var _577=_576.object;var old=_576.old;delete _577.__isDirty;if(_577){_56e=this.objectStore.put(_577,{overwrite:!!old});}else{_56e=this.objectStore.remove(this.getIdentity(old));}_571.push(_576);_572.splice(i--,1);_4.when(_56e,function(_578){if(!(--left)){if(_56d.onComplete){_56d.onComplete.call(_56d.scope,_56f);}}},function(_579){left=-1;_56d.onError.call(_56d.scope,_579);});}if(_575){_575.commit();}}catch(e){_56d.onError.call(_56d.scope,value);}},revert:function(_57a){var _57b=this._dirtyObjects;for(var i=_57b.length;i>0;){i--;var _57c=_57b[i];var _57d=_57c.object;var old=_57c.old;if(_57d&&old){for(var j in old){if(old.hasOwnProperty(j)&&_57d[j]!==old[j]){this.onSet(_57d,j,_57d[j],old[j]);_57d[j]=old[j];}}for(j in _57d){if(!old.hasOwnProperty(j)){this.onSet(_57d,j,_57d[j]);delete _57d[j];}}}else{if(!old){this.onDelete(_57d);}else{this.onNew(old);}}delete (_57d||old).__isDirty;_57b.splice(i,1);}},isDirty:function(item){if(!item){return !!this._dirtyObjects.length;}return item.__isDirty;},onSet:function(){},onNew:function(){},onDelete:function(){}});}if(!_4._hasResource["dijit.tree.TreeStoreModel"]){_4._hasResource["dijit.tree.TreeStoreModel"]=true;_4.provide("dijit.tree.TreeStoreModel");_4.declare("dijit.tree.TreeStoreModel",null,{store:null,childrenAttrs:["children"],newItemIdAttr:"id",labelAttr:"",root:null,query:null,deferItemLoadingUntilExpand:false,constructor:function(args){_4.mixin(this,args);this.connects=[];var _57e=this.store;if(!_57e.getFeatures()["dojo.data.api.Identity"]){throw new Error("dijit.Tree: store must support dojo.data.Identity");}if(_57e.getFeatures()["dojo.data.api.Notification"]){this.connects=this.connects.concat([_4.connect(_57e,"onNew",this,"onNewItem"),_4.connect(_57e,"onDelete",this,"onDeleteItem"),_4.connect(_57e,"onSet",this,"onSetItem")]);}},destroy:function(){_4.forEach(this.connects,_4.disconnect);},getRoot:function(_57f,_580){if(this.root){_57f(this.root);}else{this.store.fetch({query:this.query,onComplete:_4.hitch(this,function(_581){if(_581.length!=1){throw new Error(this.declaredClass+": query "+_4.toJson(this.query)+" returned "+_581.length+" items, but must return exactly one item");}this.root=_581[0];_57f(this.root);}),onError:_580});}},mayHaveChildren:function(item){return _4.some(this.childrenAttrs,function(attr){return this.store.hasAttribute(item,attr);},this);},getChildren:function(_582,_583,_584){var _585=this.store;if(!_585.isItemLoaded(_582)){var _586=_4.hitch(this,arguments.callee);_585.loadItem({item:_582,onItem:function(_587){_586(_587,_583,_584);},onError:_584});return;}var _588=[];for(var i=0;i<this.childrenAttrs.length;i++){var vals=_585.getValues(_582,this.childrenAttrs[i]);_588=_588.concat(vals);}var _589=0;if(!this.deferItemLoadingUntilExpand){_4.forEach(_588,function(item){if(!_585.isItemLoaded(item)){_589++;}});}if(_589==0){_583(_588);}else{_4.forEach(_588,function(item,idx){if(!_585.isItemLoaded(item)){_585.loadItem({item:item,onItem:function(item){_588[idx]=item;if(--_589==0){_583(_588);}},onError:_584});}});}},isItem:function(_58a){return this.store.isItem(_58a);},fetchItemByIdentity:function(_58b){this.store.fetchItemByIdentity(_58b);},getIdentity:function(item){return this.store.getIdentity(item);},getLabel:function(item){if(this.labelAttr){return this.store.getValue(item,this.labelAttr);}else{return this.store.getLabel(item);}},newItem:function(args,_58c,_58d){var _58e={parent:_58c,attribute:this.childrenAttrs[0]},_58f;if(this.newItemIdAttr&&args[this.newItemIdAttr]){this.fetchItemByIdentity({identity:args[this.newItemIdAttr],scope:this,onItem:function(item){if(item){this.pasteItem(item,null,_58c,true,_58d);}else{_58f=this.store.newItem(args,_58e);if(_58f&&(_58d!=undefined)){this.pasteItem(_58f,_58c,_58c,false,_58d);}}}});}else{_58f=this.store.newItem(args,_58e);if(_58f&&(_58d!=undefined)){this.pasteItem(_58f,_58c,_58c,false,_58d);}}},pasteItem:function(_590,_591,_592,_593,_594){var _595=this.store,_596=this.childrenAttrs[0];if(_591){_4.forEach(this.childrenAttrs,function(attr){if(_595.containsValue(_591,attr,_590)){if(!_593){var _597=_4.filter(_595.getValues(_591,attr),function(x){return x!=_590;});_595.setValues(_591,attr,_597);}_596=attr;}});}if(_592){if(typeof _594=="number"){var _598=_595.getValues(_592,_596).slice();_598.splice(_594,0,_590);_595.setValues(_592,_596,_598);}else{_595.setValues(_592,_596,_595.getValues(_592,_596).concat(_590));}}},onChange:function(item){},onChildrenChange:function(_599,_59a){},onDelete:function(_59b,_59c){},onNewItem:function(item,_59d){if(!_59d){return;}this.getChildren(_59d.item,_4.hitch(this,function(_59e){this.onChildrenChange(_59d.item,_59e);}));},onDeleteItem:function(item){this.onDelete(item);},onSetItem:function(item,_59f,_5a0,_5a1){if(_4.indexOf(this.childrenAttrs,_59f)!=-1){this.getChildren(item,_4.hitch(this,function(_5a2){this.onChildrenChange(item,_5a2);}));}else{this.onChange(item);}}});}if(!_4._hasResource["dijit.tree._dndContainer"]){_4._hasResource["dijit.tree._dndContainer"]=true;_4.provide("dijit.tree._dndContainer");_4.getObject("tree",true,_4);_5.tree._compareNodes=function(n1,n2){if(n1===n2){return 0;}if("sourceIndex" in document.documentElement){return n1.sourceIndex-n2.sourceIndex;}else{if("compareDocumentPosition" in document.documentElement){return n1.compareDocumentPosition(n2)&2?1:-1;}else{if(document.createRange){var r1=doc.createRange();r1.setStartBefore(n1);var r2=doc.createRange();r2.setStartBefore(n2);return r1.compareBoundaryPoints(r1.END_TO_END,r2);}else{throw Error("dijit.tree._compareNodes don't know how to compare two different nodes in this browser");}}}};_4.declare("dijit.tree._dndContainer",null,{constructor:function(tree,_5a3){this.tree=tree;this.node=tree.domNode;_4.mixin(this,_5a3);this.map={};this.current=null;this.containerState="";_4.addClass(this.node,"dojoDndContainer");this.events=[_4.connect(this.node,"onmouseenter",this,"onOverEvent"),_4.connect(this.node,"onmouseleave",this,"onOutEvent"),_4.connect(this.tree,"_onNodeMouseEnter",this,"onMouseOver"),_4.connect(this.tree,"_onNodeMouseLeave",this,"onMouseOut"),_4.connect(this.node,"ondragstart",_4,"stopEvent"),_4.connect(this.node,"onselectstart",_4,"stopEvent")];},getItem:function(key){var _5a4=this.selection[key],ret={data:_5a4,type:["treeNode"]};return ret;},destroy:function(){_4.forEach(this.events,_4.disconnect);this.node=this.parent=null;},onMouseOver:function(_5a5,evt){this.current=_5a5;},onMouseOut:function(_5a6,evt){this.current=null;},_changeState:function(type,_5a7){var _5a8="dojoDnd"+type;var _5a9=type.toLowerCase()+"State";_4.replaceClass(this.node,_5a8+_5a7,_5a8+this[_5a9]);this[_5a9]=_5a7;},_addItemClass:function(node,type){_4.addClass(node,"dojoDndItem"+type);},_removeItemClass:function(node,type){_4.removeClass(node,"dojoDndItem"+type);},onOverEvent:function(){this._changeState("Container","Over");},onOutEvent:function(){this._changeState("Container","");}});}if(!_4._hasResource["dijit.tree._dndSelector"]){_4._hasResource["dijit.tree._dndSelector"]=true;_4.provide("dijit.tree._dndSelector");_4.declare("dijit.tree._dndSelector",_5.tree._dndContainer,{constructor:function(tree,_5aa){this.selection={};this.anchor=null;_5.setWaiState(this.tree.domNode,"multiselect",!this.singular);this.events.push(_4.connect(this.tree.domNode,"onmousedown",this,"onMouseDown"),_4.connect(this.tree.domNode,"onmouseup",this,"onMouseUp"),_4.connect(this.tree.domNode,"onmousemove",this,"onMouseMove"));},singular:false,getSelectedTreeNodes:function(){var _5ab=[],sel=this.selection;for(var i in sel){_5ab.push(sel[i]);}return _5ab;},selectNone:function(){this.setSelection([]);return this;},destroy:function(){this.inherited(arguments);this.selection=this.anchor=null;},addTreeNode:function(node,_5ac){this.setSelection(this.getSelectedTreeNodes().concat([node]));if(_5ac){this.anchor=node;}return node;},removeTreeNode:function(node){this.setSelection(this._setDifference(this.getSelectedTreeNodes(),[node]));return node;},isTreeNodeSelected:function(node){return node.id&&!!this.selection[node.id];},setSelection:function(_5ad){var _5ae=this.getSelectedTreeNodes();_4.forEach(this._setDifference(_5ae,_5ad),_4.hitch(this,function(node){node.setSelected(false);if(this.anchor==node){delete this.anchor;}delete this.selection[node.id];}));_4.forEach(this._setDifference(_5ad,_5ae),_4.hitch(this,function(node){node.setSelected(true);this.selection[node.id]=node;}));this._updateSelectionProperties();},_setDifference:function(xs,ys){_4.forEach(ys,function(y){y.__exclude__=true;});var ret=_4.filter(xs,function(x){return !x.__exclude__;});_4.forEach(ys,function(y){delete y["__exclude__"];});return ret;},_updateSelectionProperties:function(){var _5af=this.getSelectedTreeNodes();var _5b0=[],_5b1=[];_4.forEach(_5af,function(node){_5b1.push(node);_5b0.push(node.getTreePath());});var _5b2=_4.map(_5b1,function(node){return node.item;});this.tree._set("paths",_5b0);this.tree._set("path",_5b0[0]||[]);this.tree._set("selectedNodes",_5b1);this.tree._set("selectedNode",_5b1[0]||null);this.tree._set("selectedItems",_5b2);this.tree._set("selectedItem",_5b2[0]||null);},onMouseDown:function(e){if(!this.current||this.tree.isExpandoNode(e.target,this.current)){return;}if(e.button==_4.mouseButtons.RIGHT){return;}_4.stopEvent(e);var _5b3=this.current,copy=_4.isCopyKey(e),id=_5b3.id;if(!this.singular&&!e.shiftKey&&this.selection[id]){this._doDeselect=true;return;}else{this._doDeselect=false;}this.userSelect(_5b3,copy,e.shiftKey);},onMouseUp:function(e){if(!this._doDeselect){return;}this._doDeselect=false;this.userSelect(this.current,_4.isCopyKey(e),e.shiftKey);},onMouseMove:function(e){this._doDeselect=false;},userSelect:function(node,_5b4,_5b5){if(this.singular){if(this.anchor==node&&_5b4){this.selectNone();}else{this.setSelection([node]);this.anchor=node;}}else{if(_5b5&&this.anchor){var cr=_5.tree._compareNodes(this.anchor.rowNode,node.rowNode),_5b6,end,_5b7=this.anchor;if(cr<0){_5b6=_5b7;end=node;}else{_5b6=node;end=_5b7;}nodes=[];while(_5b6!=end){nodes.push(_5b6);_5b6=this.tree._getNextNode(_5b6);}nodes.push(end);this.setSelection(nodes);}else{if(this.selection[node.id]&&_5b4){this.removeTreeNode(node);}else{if(_5b4){this.addTreeNode(node,true);}else{this.setSelection([node]);this.anchor=node;}}}}},forInSelectedItems:function(f,o){o=o||_4.global;for(var id in this.selection){f.call(o,this.getItem(id),id,this);}}});}if(!_4._hasResource["dijit.tree.dndSource"]){_4._hasResource["dijit.tree.dndSource"]=true;_4.provide("dijit.tree.dndSource");_4.declare("dijit.tree.dndSource",_5.tree._dndSelector,{isSource:true,accept:["text","treeNode"],copyOnly:false,dragThreshold:5,betweenThreshold:0,constructor:function(tree,_5b8){if(!_5b8){_5b8={};}_4.mixin(this,_5b8);this.isSource=typeof _5b8.isSource=="undefined"?true:_5b8.isSource;var type=_5b8.accept instanceof Array?_5b8.accept:["text","treeNode"];this.accept=null;if(type.length){this.accept={};for(var i=0;i<type.length;++i){this.accept[type[i]]=1;}}this.isDragging=false;this.mouseDown=false;this.targetAnchor=null;this.targetBox=null;this.dropPosition="";this._lastX=0;this._lastY=0;this.sourceState="";if(this.isSource){_4.addClass(this.node,"dojoDndSource");}this.targetState="";if(this.accept){_4.addClass(this.node,"dojoDndTarget");}this.topics=[_4.subscribe("/dnd/source/over",this,"onDndSourceOver"),_4.subscribe("/dnd/start",this,"onDndStart"),_4.subscribe("/dnd/drop",this,"onDndDrop"),_4.subscribe("/dnd/cancel",this,"onDndCancel")];},checkAcceptance:function(_5b9,_5ba){return true;},copyState:function(_5bb){return this.copyOnly||_5bb;},destroy:function(){this.inherited("destroy",arguments);_4.forEach(this.topics,_4.unsubscribe);this.targetAnchor=null;},_onDragMouse:function(e){var m=_4.dnd.manager(),_5bc=this.targetAnchor,_5bd=this.current,_5be=this.dropPosition;var _5bf="Over";if(_5bd&&this.betweenThreshold>0){if(!this.targetBox||_5bc!=_5bd){this.targetBox=_4.position(_5bd.rowNode,true);}if((e.pageY-this.targetBox.y)<=this.betweenThreshold){_5bf="Before";}else{if((e.pageY-this.targetBox.y)>=(this.targetBox.h-this.betweenThreshold)){_5bf="After";}}}if(_5bd!=_5bc||_5bf!=_5be){if(_5bc){this._removeItemClass(_5bc.rowNode,_5be);}if(_5bd){this._addItemClass(_5bd.rowNode,_5bf);}if(!_5bd){m.canDrop(false);}else{if(_5bd==this.tree.rootNode&&_5bf!="Over"){m.canDrop(false);}else{if(m.source==this&&(_5bd.id in this.selection)){m.canDrop(false);}else{if(this.checkItemAcceptance(_5bd.rowNode,m.source,_5bf.toLowerCase())&&!this._isParentChildDrop(m.source,_5bd.rowNode)){m.canDrop(true);}else{m.canDrop(false);}}}}this.targetAnchor=_5bd;this.dropPosition=_5bf;}},onMouseMove:function(e){if(this.isDragging&&this.targetState=="Disabled"){return;}this.inherited(arguments);var m=_4.dnd.manager();if(this.isDragging){this._onDragMouse(e);}else{if(this.mouseDown&&this.isSource&&(Math.abs(e.pageX-this._lastX)>=this.dragThreshold||Math.abs(e.pageY-this._lastY)>=this.dragThreshold)){var _5c0=this.getSelectedTreeNodes();if(_5c0.length){if(_5c0.length>1){var seen=this.selection,i=0,r=[],n,p;nextitem:while((n=_5c0[i++])){for(p=n.getParent();p&&p!==this.tree;p=p.getParent()){if(seen[p.id]){continue nextitem;}}r.push(n);}_5c0=r;}_5c0=_4.map(_5c0,function(n){return n.domNode;});m.startDrag(this,_5c0,this.copyState(_4.isCopyKey(e)));}}}},onMouseDown:function(e){this.mouseDown=true;this.mouseButton=e.button;this._lastX=e.pageX;this._lastY=e.pageY;this.inherited(arguments);},onMouseUp:function(e){if(this.mouseDown){this.mouseDown=false;this.inherited(arguments);}},onMouseOut:function(){this.inherited(arguments);this._unmarkTargetAnchor();},checkItemAcceptance:function(_5c1,_5c2,_5c3){return true;},onDndSourceOver:function(_5c4){if(this!=_5c4){this.mouseDown=false;this._unmarkTargetAnchor();}else{if(this.isDragging){var m=_4.dnd.manager();m.canDrop(false);}}},onDndStart:function(_5c5,_5c6,copy){if(this.isSource){this._changeState("Source",this==_5c5?(copy?"Copied":"Moved"):"");}var _5c7=this.checkAcceptance(_5c5,_5c6);this._changeState("Target",_5c7?"":"Disabled");if(this==_5c5){_4.dnd.manager().overSource(this);}this.isDragging=true;},itemCreator:function(_5c8,_5c9,_5ca){return _4.map(_5c8,function(node){return {"id":node.id,"name":node.textContent||node.innerText||""};});},onDndDrop:function(_5cb,_5cc,copy){if(this.containerState=="Over"){var tree=this.tree,_5cd=tree.model,_5ce=this.targetAnchor,_5cf=false;this.isDragging=false;var _5d0=_5ce;var _5d1;var _5d2;_5d1=(_5d0&&_5d0.item)||tree.item;if(this.dropPosition=="Before"||this.dropPosition=="After"){_5d1=(_5d0.getParent()&&_5d0.getParent().item)||tree.item;_5d2=_5d0.getIndexInParent();if(this.dropPosition=="After"){_5d2=_5d0.getIndexInParent()+1;}}else{_5d1=(_5d0&&_5d0.item)||tree.item;}var _5d3;_4.forEach(_5cc,function(node,idx){var _5d4=_5cb.getItem(node.id);if(_4.indexOf(_5d4.type,"treeNode")!=-1){var _5d5=_5d4.data,_5d6=_5d5.item,_5d7=_5d5.getParent().item;}if(_5cb==this){if(typeof _5d2=="number"){if(_5d1==_5d7&&_5d5.getIndexInParent()<_5d2){_5d2-=1;}}_5cd.pasteItem(_5d6,_5d7,_5d1,copy,_5d2);}else{if(_5cd.isItem(_5d6)){_5cd.pasteItem(_5d6,_5d7,_5d1,copy,_5d2);}else{if(!_5d3){_5d3=this.itemCreator(_5cc,_5ce.rowNode,_5cb);}_5cd.newItem(_5d3[idx],_5d1,_5d2);}}},this);this.tree._expandNode(_5d0);}this.onDndCancel();},onDndCancel:function(){this._unmarkTargetAnchor();this.isDragging=false;this.mouseDown=false;delete this.mouseButton;this._changeState("Source","");this._changeState("Target","");},onOverEvent:function(){this.inherited(arguments);_4.dnd.manager().overSource(this);},onOutEvent:function(){this._unmarkTargetAnchor();var m=_4.dnd.manager();if(this.isDragging){m.canDrop(false);}m.outSource(this);this.inherited(arguments);},_isParentChildDrop:function(_5d8,_5d9){if(!_5d8.tree||_5d8.tree!=this.tree){return false;}var root=_5d8.tree.domNode;var ids=_5d8.selection;var node=_5d9.parentNode;while(node!=root&&!ids[node.id]){node=node.parentNode;}return node.id&&ids[node.id];},_unmarkTargetAnchor:function(){if(!this.targetAnchor){return;}this._removeItemClass(this.targetAnchor.rowNode,this.dropPosition);this.targetAnchor=null;this.targetBox=null;this.dropPosition=null;},_markDndStatus:function(copy){this._changeState("Source",copy?"Copied":"Moved");}});}if(!_4._hasResource["dijit.tree.ForestStoreModel"]){_4._hasResource["dijit.tree.ForestStoreModel"]=true;_4.provide("dijit.tree.ForestStoreModel");_4.declare("dijit.tree.ForestStoreModel",_5.tree.TreeStoreModel,{rootId:"$root$",rootLabel:"ROOT",query:null,constructor:function(_5da){this.root={store:this,root:true,id:_5da.rootId,label:_5da.rootLabel,children:_5da.rootChildren};},mayHaveChildren:function(item){return item===this.root||this.inherited(arguments);},getChildren:function(_5db,_5dc,_5dd){if(_5db===this.root){if(this.root.children){_5dc(this.root.children);}else{this.store.fetch({query:this.query,onComplete:_4.hitch(this,function(_5de){this.root.children=_5de;_5dc(_5de);}),onError:_5dd});}}else{this.inherited(arguments);}},isItem:function(_5df){return (_5df===this.root)?true:this.inherited(arguments);},fetchItemByIdentity:function(_5e0){if(_5e0.identity==this.root.id){var _5e1=_5e0.scope?_5e0.scope:_4.global;if(_5e0.onItem){_5e0.onItem.call(_5e1,this.root);}}else{this.inherited(arguments);}},getIdentity:function(item){return (item===this.root)?this.root.id:this.inherited(arguments);},getLabel:function(item){return (item===this.root)?this.root.label:this.inherited(arguments);},newItem:function(args,_5e2,_5e3){if(_5e2===this.root){this.onNewRootItem(args);return this.store.newItem(args);}else{return this.inherited(arguments);}},onNewRootItem:function(args){},pasteItem:function(_5e4,_5e5,_5e6,_5e7,_5e8){if(_5e5===this.root){if(!_5e7){this.onLeaveRoot(_5e4);}}_5.tree.TreeStoreModel.prototype.pasteItem.call(this,_5e4,_5e5===this.root?null:_5e5,_5e6===this.root?null:_5e6,_5e7,_5e8);if(_5e6===this.root){this.onAddToRoot(_5e4);}},onAddToRoot:function(item){console.log(this,": item ",item," added to root");},onLeaveRoot:function(item){console.log(this,": item ",item," removed from root");},_requeryTop:function(){var _5e9=this.root.children||[];this.store.fetch({query:this.query,onComplete:_4.hitch(this,function(_5ea){this.root.children=_5ea;if(_5e9.length!=_5ea.length||_4.some(_5e9,function(item,idx){return _5ea[idx]!=item;})){this.onChildrenChange(this.root,_5ea);}})});},onNewItem:function(item,_5eb){this._requeryTop();this.inherited(arguments);},onDeleteItem:function(item){if(_4.indexOf(this.root.children,item)!=-1){this._requeryTop();}this.inherited(arguments);},onSetItem:function(item,_5ec,_5ed,_5ee){this._requeryTop();this.inherited(arguments);}});}if(!_4._hasResource["dijit.Tree"]){_4._hasResource["dijit.Tree"]=true;_4.provide("dijit.Tree");_4.declare("dijit._TreeNode",[_5._Widget,_5._Templated,_5._Container,_5._Contained,_5._CssStateMixin],{item:null,isTreeNode:true,label:"",isExpandable:null,isExpanded:false,state:"UNCHECKED",templateString:_4.cache("dijit","templates/TreeNode.html","<div class=\"dijitTreeNode\" role=\"presentation\"\n\t><div dojoAttachPoint=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\" dojoAttachEvent=\"onmouseenter:_onMouseEnter, onmouseleave:_onMouseLeave, onclick:_onClick, ondblclick:_onDblClick\"\n\t\t><img src=\"${_blankGif}\" alt=\"\" dojoAttachPoint=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"\n\t\t/><span dojoAttachPoint=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"\n\t\t></span\n\t\t><span dojoAttachPoint=\"contentNode\"\n\t\t\tclass=\"dijitTreeContent\" role=\"presentation\">\n\t\t\t<img src=\"${_blankGif}\" alt=\"\" dojoAttachPoint=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"\n\t\t\t/><span dojoAttachPoint=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\" dojoAttachEvent=\"onfocus:_onLabelFocus\"></span>\n\t\t</span\n\t></div>\n\t<div dojoAttachPoint=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\n</div>\n"),baseClass:"dijitTreeNode",cssStateNodes:{rowNode:"dijitTreeRow",labelNode:"dijitTreeLabel"},attributeMap:_4.delegate(_5._Widget.prototype.attributeMap,{label:{node:"labelNode",type:"innerText"},tooltip:{node:"rowNode",type:"attribute",attribute:"title"}}),buildRendering:function(){this.inherited(arguments);this._setExpando();this._updateItemClasses(this.item);if(this.isExpandable){_5.setWaiState(this.labelNode,"expanded",this.isExpanded);}this.setSelected(false);},_setIndentAttr:function(_5ef){var _5f0=(Math.max(_5ef,0)*this.tree._nodePixelIndent)+"px";_4.style(this.domNode,"backgroundPosition",_5f0+" 0px");_4.style(this.rowNode,this.isLeftToRight()?"paddingLeft":"paddingRight",_5f0);_4.forEach(this.getChildren(),function(_5f1){_5f1.set("indent",_5ef+1);});this._set("indent",_5ef);},markProcessing:function(){this.state="LOADING";this._setExpando(true);},unmarkProcessing:function(){this._setExpando(false);},_updateItemClasses:function(item){var tree=this.tree,_5f2=tree.model;if(tree._v10Compat&&item===_5f2.root){item=null;}this._applyClassAndStyle(item,"icon","Icon");this._applyClassAndStyle(item,"label","Label");this._applyClassAndStyle(item,"row","Row");},_applyClassAndStyle:function(item,_5f3,_5f4){var _5f5="_"+_5f3+"Class";var _5f6=_5f3+"Node";var _5f7=this[_5f5];this[_5f5]=this.tree["get"+_5f4+"Class"](item,this.isExpanded);_4.replaceClass(this[_5f6],this[_5f5]||"",_5f7||"");_4.style(this[_5f6],this.tree["get"+_5f4+"Style"](item,this.isExpanded)||{});},_updateLayout:function(){var _5f8=this.getParent();if(!_5f8||_5f8.rowNode.style.display=="none"){_4.addClass(this.domNode,"dijitTreeIsRoot");}else{_4.toggleClass(this.domNode,"dijitTreeIsLast",!this.getNextSibling());}},_setExpando:function(_5f9){var _5fa=["dijitTreeExpandoLoading","dijitTreeExpandoOpened","dijitTreeExpandoClosed","dijitTreeExpandoLeaf"],_5fb=["*","-","+","*"],idx=_5f9?0:(this.isExpandable?(this.isExpanded?1:2):3);_4.replaceClass(this.expandoNode,_5fa[idx],_5fa);this.expandoNodeText.innerHTML=_5fb[idx];},expand:function(){if(this._expandDeferred){return this._expandDeferred;}this._wipeOut&&this._wipeOut.stop();this.isExpanded=true;_5.setWaiState(this.labelNode,"expanded","true");if(this.tree.showRoot||this!==this.tree.rootNode){_5.setWaiRole(this.containerNode,"group");}_4.addClass(this.contentNode,"dijitTreeContentExpanded");this._setExpando();this._updateItemClasses(this.item);if(this==this.tree.rootNode){_5.setWaiState(this.tree.domNode,"expanded","true");}var def,_5fc=_4.fx.wipeIn({node:this.containerNode,duration:_5.defaultDuration,onEnd:function(){def.callback(true);}});def=(this._expandDeferred=new _4.Deferred(function(){_5fc.stop();}));_5fc.play();return def;},collapse:function(){if(!this.isExpanded){return;}if(this._expandDeferred){this._expandDeferred.cancel();delete this._expandDeferred;}this.isExpanded=false;_5.setWaiState(this.labelNode,"expanded","false");if(this==this.tree.rootNode){_5.setWaiState(this.tree.domNode,"expanded","false");}_4.removeClass(this.contentNode,"dijitTreeContentExpanded");this._setExpando();this._updateItemClasses(this.item);if(!this._wipeOut){this._wipeOut=_4.fx.wipeOut({node:this.containerNode,duration:_5.defaultDuration});}this._wipeOut.play();},indent:0,setChildItems:function(_5fd){var tree=this.tree,_5fe=tree.model,defs=[];_4.forEach(this.getChildren(),function(_5ff){_5._Container.prototype.removeChild.call(this,_5ff);},this);this.state="LOADED";if(_5fd&&_5fd.length>0){this.isExpandable=true;_4.forEach(_5fd,function(item){var id=_5fe.getIdentity(item),_600=tree._itemNodesMap[id],node;if(_600){for(var i=0;i<_600.length;i++){if(_600[i]&&!_600[i].getParent()){node=_600[i];node.set("indent",this.indent+1);break;}}}if(!node){node=this.tree._createTreeNode({item:item,tree:tree,isExpandable:_5fe.mayHaveChildren(item),label:tree.getLabel(item),tooltip:tree.getTooltip(item),dir:tree.dir,lang:tree.lang,indent:this.indent+1});if(_600){_600.push(node);}else{tree._itemNodesMap[id]=[node];}}this.addChild(node);if(this.tree.autoExpand||this.tree._state(item)){defs.push(tree._expandNode(node));}},this);_4.forEach(this.getChildren(),function(_601,idx){_601._updateLayout();});}else{this.isExpandable=false;}if(this._setExpando){this._setExpando(false);}this._updateItemClasses(this.item);if(this==tree.rootNode){var fc=this.tree.showRoot?this:this.getChildren()[0];if(fc){fc.setFocusable(true);tree.lastFocused=fc;}else{tree.domNode.setAttribute("tabIndex","0");}}return new _4.DeferredList(defs);},getTreePath:function(){var node=this;var path=[];while(node&&node!==this.tree.rootNode){path.unshift(node.item);node=node.getParent();}path.unshift(this.tree.rootNode.item);return path;},getIdentity:function(){return this.tree.model.getIdentity(this.item);},removeChild:function(node){this.inherited(arguments);var _602=this.getChildren();if(_602.length==0){this.isExpandable=false;this.collapse();}_4.forEach(_602,function(_603){_603._updateLayout();});},makeExpandable:function(){this.isExpandable=true;this._setExpando(false);},_onLabelFocus:function(evt){this.tree._onNodeFocus(this);},setSelected:function(_604){_5.setWaiState(this.labelNode,"selected",_604);_4.toggleClass(this.rowNode,"dijitTreeRowSelected",_604);},setFocusable:function(_605){this.labelNode.setAttribute("tabIndex",_605?"0":"-1");},_onClick:function(evt){this.tree._onClick(this,evt);},_onDblClick:function(evt){this.tree._onDblClick(this,evt);},_onMouseEnter:function(evt){this.tree._onNodeMouseEnter(this,evt);},_onMouseLeave:function(evt){this.tree._onNodeMouseLeave(this,evt);}});_4.declare("dijit.Tree",[_5._Widget,_5._Templated],{store:null,model:null,query:null,label:"",showRoot:true,childrenAttr:["children"],paths:[],path:[],selectedItems:null,selectedItem:null,openOnClick:false,openOnDblClick:false,templateString:_4.cache("dijit","templates/Tree.html","<div class=\"dijitTree dijitTreeContainer\" role=\"tree\"\n\tdojoAttachEvent=\"onkeypress:_onKeyPress\">\n\t<div class=\"dijitInline dijitTreeIndent\" style=\"position: absolute; top: -9999px\" dojoAttachPoint=\"indentDetector\"></div>\n</div>\n"),persist:true,autoExpand:false,dndController:"dijit.tree._dndSelector",dndParams:["onDndDrop","itemCreator","onDndCancel","checkAcceptance","checkItemAcceptance","dragThreshold","betweenThreshold"],onDndDrop:null,itemCreator:null,onDndCancel:null,checkAcceptance:null,checkItemAcceptance:null,dragThreshold:5,betweenThreshold:0,_nodePixelIndent:19,_publish:function(_606,_607){_4.publish(this.id,[_4.mixin({tree:this,event:_606},_607||{})]);},postMixInProperties:function(){this.tree=this;if(this.autoExpand){this.persist=false;}this._itemNodesMap={};if(!this.cookieName){this.cookieName=this.id+"SaveStateCookie";}this._loadDeferred=new _4.Deferred();this.inherited(arguments);},postCreate:function(){this._initState();if(!this.model){this._store2model();}this.connect(this.model,"onChange","_onItemChange");this.connect(this.model,"onChildrenChange","_onItemChildrenChange");this.connect(this.model,"onDelete","_onItemDelete");this._load();this.inherited(arguments);if(this.dndController){if(_4.isString(this.dndController)){this.dndController=_4.getObject(this.dndController);}var _608={};for(var i=0;i<this.dndParams.length;i++){if(this[this.dndParams[i]]){_608[this.dndParams[i]]=this[this.dndParams[i]];}}this.dndController=new this.dndController(this,_608);}},_store2model:function(){this._v10Compat=true;_4.deprecated("Tree: from version 2.0, should specify a model object rather than a store/query");var _609={id:this.id+"_ForestStoreModel",store:this.store,query:this.query,childrenAttrs:this.childrenAttr};if(this.params.mayHaveChildren){_609.mayHaveChildren=_4.hitch(this,"mayHaveChildren");}if(this.params.getItemChildren){_609.getChildren=_4.hitch(this,function(item,_60a,_60b){this.getItemChildren((this._v10Compat&&item===this.model.root)?null:item,_60a,_60b);});}this.model=new _5.tree.ForestStoreModel(_609);this.showRoot=Boolean(this.label);},onLoad:function(){},_load:function(){this.model.getRoot(_4.hitch(this,function(item){var rn=(this.rootNode=this.tree._createTreeNode({item:item,tree:this,isExpandable:true,label:this.label||this.getLabel(item),indent:this.showRoot?0:-1}));if(!this.showRoot){rn.rowNode.style.display="none";_5.setWaiRole(this.domNode,"presentation");_5.setWaiRole(rn.labelNode,"presentation");_5.setWaiRole(rn.containerNode,"tree");}this.domNode.appendChild(rn.domNode);var _60c=this.model.getIdentity(item);if(this._itemNodesMap[_60c]){this._itemNodesMap[_60c].push(rn);}else{this._itemNodesMap[_60c]=[rn];}rn._updateLayout();this._expandNode(rn).addCallback(_4.hitch(this,function(){this._loadDeferred.callback(true);this.onLoad();}));}),function(err){console.error(this,": error loading root: ",err);});},getNodesByItem:function(item){if(!item){return [];}var _60d=_4.isString(item)?item:this.model.getIdentity(item);return [].concat(this._itemNodesMap[_60d]);},_setSelectedItemAttr:function(item){this.set("selectedItems",[item]);},_setSelectedItemsAttr:function(_60e){var tree=this;this._loadDeferred.addCallback(_4.hitch(this,function(){var _60f=_4.map(_60e,function(item){return (!item||_4.isString(item))?item:tree.model.getIdentity(item);});var _610=[];_4.forEach(_60f,function(id){_610=_610.concat(tree._itemNodesMap[id]||[]);});this.set("selectedNodes",_610);}));},_setPathAttr:function(path){if(path.length){return this.set("paths",[path]);}else{return this.set("paths",[]);}},_setPathsAttr:function(_611){var tree=this;return new _4.DeferredList(_4.map(_611,function(path){var d=new _4.Deferred();path=_4.map(path,function(item){return _4.isString(item)?item:tree.model.getIdentity(item);});if(path.length){tree._loadDeferred.addCallback(function(){_612(path,[tree.rootNode],d);});}else{d.errback("Empty path");}return d;})).addCallback(_613);function _612(path,_614,def){var _615=path.shift();var _616=_4.filter(_614,function(node){return node.getIdentity()==_615;})[0];if(!!_616){if(path.length){tree._expandNode(_616).addCallback(function(){_612(path,_616.getChildren(),def);});}else{def.callback(_616);}}else{def.errback("Could not expand path at "+_615);}};function _613(_617){tree.set("selectedNodes",_4.map(_4.filter(_617,function(x){return x[0];}),function(x){return x[1];}));};},_setSelectedNodeAttr:function(node){this.set("selectedNodes",[node]);},_setSelectedNodesAttr:function(_618){this._loadDeferred.addCallback(_4.hitch(this,function(){this.dndController.setSelection(_618);}));},mayHaveChildren:function(item){},getItemChildren:function(_619,_61a){},getLabel:function(item){return this.model.getLabel(item);},getIconClass:function(item,_61b){return (!item||this.model.mayHaveChildren(item))?(_61b?"dijitFolderOpened":"dijitFolderClosed"):"dijitLeaf";},getLabelClass:function(item,_61c){},getRowClass:function(item,_61d){},getIconStyle:function(item,_61e){},getLabelStyle:function(item,_61f){},getRowStyle:function(item,_620){},getTooltip:function(item){return "";},_onKeyPress:function(e){if(e.altKey){return;}var dk=_4.keys;var _621=_5.getEnclosingWidget(e.target);if(!_621){return;}var key=e.charOrCode;if(typeof key=="string"&&key!=" "){if(!e.altKey&&!e.ctrlKey&&!e.shiftKey&&!e.metaKey){this._onLetterKeyNav({node:_621,key:key.toLowerCase()});_4.stopEvent(e);}}else{if(this._curSearch){clearTimeout(this._curSearch.timer);delete this._curSearch;}var map=this._keyHandlerMap;if(!map){map={};map[dk.ENTER]="_onEnterKey";map[dk.SPACE]=map[" "]="_onEnterKey";map[this.isLeftToRight()?dk.LEFT_ARROW:dk.RIGHT_ARROW]="_onLeftArrow";map[this.isLeftToRight()?dk.RIGHT_ARROW:dk.LEFT_ARROW]="_onRightArrow";map[dk.UP_ARROW]="_onUpArrow";map[dk.DOWN_ARROW]="_onDownArrow";map[dk.HOME]="_onHomeKey";map[dk.END]="_onEndKey";this._keyHandlerMap=map;}if(this._keyHandlerMap[key]){this[this._keyHandlerMap[key]]({node:_621,item:_621.item,evt:e});_4.stopEvent(e);}}},_onEnterKey:function(_622){this._publish("execute",{item:_622.item,node:_622.node});this.dndController.userSelect(_622.node,_4.isCopyKey(_622.evt),_622.evt.shiftKey);this.onClick(_622.item,_622.node,_622.evt);},_onDownArrow:function(_623){var node=this._getNextNode(_623.node);if(node&&node.isTreeNode){this.focusNode(node);}},_onUpArrow:function(_624){var node=_624.node;var _625=node.getPreviousSibling();if(_625){node=_625;while(node.isExpandable&&node.isExpanded&&node.hasChildren()){var _626=node.getChildren();node=_626[_626.length-1];}}else{var _627=node.getParent();if(!(!this.showRoot&&_627===this.rootNode)){node=_627;}}if(node&&node.isTreeNode){this.focusNode(node);}},_onRightArrow:function(_628){var node=_628.node;if(node.isExpandable&&!node.isExpanded){this._expandNode(node);}else{if(node.hasChildren()){node=node.getChildren()[0];if(node&&node.isTreeNode){this.focusNode(node);}}}},_onLeftArrow:function(_629){var node=_629.node;if(node.isExpandable&&node.isExpanded){this._collapseNode(node);}else{var _62a=node.getParent();if(_62a&&_62a.isTreeNode&&!(!this.showRoot&&_62a===this.rootNode)){this.focusNode(_62a);}}},_onHomeKey:function(){var node=this._getRootOrFirstNode();if(node){this.focusNode(node);}},_onEndKey:function(_62b){var node=this.rootNode;while(node.isExpanded){var c=node.getChildren();node=c[c.length-1];}if(node&&node.isTreeNode){this.focusNode(node);}},multiCharSearchDuration:250,_onLetterKeyNav:function(_62c){var cs=this._curSearch;if(cs){cs.pattern=cs.pattern+_62c.key;clearTimeout(cs.timer);}else{cs=this._curSearch={pattern:_62c.key,startNode:_62c.node};}var self=this;cs.timer=setTimeout(function(){delete self._curSearch;},this.multiCharSearchDuration);var node=cs.startNode;do{node=this._getNextNode(node);if(!node){node=this._getRootOrFirstNode();}}while(node!==cs.startNode&&(node.label.toLowerCase().substr(0,cs.pattern.length)!=cs.pattern));if(node&&node.isTreeNode){if(node!==cs.startNode){this.focusNode(node);}}},isExpandoNode:function(node,_62d){return _4.isDescendant(node,_62d.expandoNode);},_onClick:function(_62e,e){var _62f=e.target,_630=this.isExpandoNode(_62f,_62e);if((this.openOnClick&&_62e.isExpandable)||_630){if(_62e.isExpandable){this._onExpandoClick({node:_62e});}}else{this._publish("execute",{item:_62e.item,node:_62e,evt:e});this.onClick(_62e.item,_62e,e);this.focusNode(_62e);}_4.stopEvent(e);},_onDblClick:function(_631,e){var _632=e.target,_633=(_632==_631.expandoNode||_632==_631.expandoNodeText);if((this.openOnDblClick&&_631.isExpandable)||_633){if(_631.isExpandable){this._onExpandoClick({node:_631});}}else{this._publish("execute",{item:_631.item,node:_631,evt:e});this.onDblClick(_631.item,_631,e);this.focusNode(_631);}_4.stopEvent(e);},_onExpandoClick:function(_634){var node=_634.node;this.focusNode(node);if(node.isExpanded){this._collapseNode(node);}else{this._expandNode(node);}},onClick:function(item,node,evt){},onDblClick:function(item,node,evt){},onOpen:function(item,node){},onClose:function(item,node){},_getNextNode:function(node){if(node.isExpandable&&node.isExpanded&&node.hasChildren()){return node.getChildren()[0];}else{while(node&&node.isTreeNode){var _635=node.getNextSibling();if(_635){return _635;}node=node.getParent();}return null;}},_getRootOrFirstNode:function(){return this.showRoot?this.rootNode:this.rootNode.getChildren()[0];},_collapseNode:function(node){if(node._expandNodeDeferred){delete node._expandNodeDeferred;}if(node.isExpandable){if(node.state=="LOADING"){return;}node.collapse();this.onClose(node.item,node);if(node.item){this._state(node.item,false);this._saveState();}}},_expandNode:function(node,_636){if(node._expandNodeDeferred&&!_636){return node._expandNodeDeferred;}var _637=this.model,item=node.item,_638=this;switch(node.state){case "UNCHECKED":node.markProcessing();var def=(node._expandNodeDeferred=new _4.Deferred());_637.getChildren(item,function(_639){node.unmarkProcessing();var scid=node.setChildItems(_639);var ed=_638._expandNode(node,true);scid.addCallback(function(){ed.addCallback(function(){def.callback();});});},function(err){console.error(_638,": error loading root children: ",err);});break;default:def=(node._expandNodeDeferred=node.expand());this.onOpen(node.item,node);if(item){this._state(item,true);this._saveState();}}return def;},focusNode:function(node){_5.focus(node.labelNode);},_onNodeFocus:function(node){if(node&&node!=this.lastFocused){if(this.lastFocused&&!this.lastFocused._destroyed){this.lastFocused.setFocusable(false);}node.setFocusable(true);this.lastFocused=node;}},_onNodeMouseEnter:function(node){},_onNodeMouseLeave:function(node){},_onItemChange:function(item){var _63a=this.model,_63b=_63a.getIdentity(item),_63c=this._itemNodesMap[_63b];if(_63c){var _63d=this.getLabel(item),_63e=this.getTooltip(item);_4.forEach(_63c,function(node){node.set({item:item,label:_63d,tooltip:_63e});node._updateItemClasses(item);});}},_onItemChildrenChange:function(_63f,_640){var _641=this.model,_642=_641.getIdentity(_63f),_643=this._itemNodesMap[_642];if(_643){_4.forEach(_643,function(_644){_644.setChildItems(_640);});}},_onItemDelete:function(item){var _645=this.model,_646=_645.getIdentity(item),_647=this._itemNodesMap[_646];if(_647){_4.forEach(_647,function(node){this.dndController.removeTreeNode(node);var _648=node.getParent();if(_648){_648.removeChild(node);}node.destroyRecursive();},this);delete this._itemNodesMap[_646];}},_initState:function(){if(this.persist){var _649=_4.cookie(this.cookieName);this._openedItemIds={};if(_649){_4.forEach(_649.split(","),function(item){this._openedItemIds[item]=true;},this);}}},_state:function(item,_64a){if(!this.persist){return false;}var id=this.model.getIdentity(item);if(arguments.length===1){return this._openedItemIds[id];}if(_64a){this._openedItemIds[id]=true;}else{delete this._openedItemIds[id];}},_saveState:function(){if(!this.persist){return;}var ary=[];for(var id in this._openedItemIds){ary.push(id);}_4.cookie(this.cookieName,ary.join(","),{expires:365});},destroy:function(){if(this._curSearch){clearTimeout(this._curSearch.timer);delete this._curSearch;}if(this.rootNode){this.rootNode.destroyRecursive();}if(this.dndController&&!_4.isString(this.dndController)){this.dndController.destroy();}this.rootNode=null;this.inherited(arguments);},destroyRecursive:function(){this.destroy();},resize:function(_64b){if(_64b){_4.marginBox(this.domNode,_64b);}this._nodePixelIndent=_4._getMarginSize(this.tree.indentDetector).w;if(this.tree.rootNode){this.tree.rootNode.set("indent",this.showRoot?0:-1);}},_createTreeNode:function(args){return new _5._TreeNode(args);}});}if(!_4._hasResource["dojox.html._base"]){_4._hasResource["dojox.html._base"]=true;_4.provide("dojox.html._base");(function(){if(_4.isIE){var _64c=/(AlphaImageLoader\([^)]*?src=(['"]))(?![a-z]+:|\/)([^\r\n;}]+?)(\2[^)]*\)\s*[;}]?)/g;}var _64d=/(?:(?:@import\s*(['"])(?![a-z]+:|\/)([^\r\n;{]+?)\1)|url\(\s*(['"]?)(?![a-z]+:|\/)([^\r\n;]+?)\3\s*\))([a-z, \s]*[;}]?)/g;var _64e=_6.html._adjustCssPaths=function(_64f,_650){if(!_650||!_64f){return;}if(_64c){_650=_650.replace(_64c,function(_651,pre,_652,url,post){return pre+(new _4._Url(_64f,"./"+url).toString())+post;});}return _650.replace(_64d,function(_653,_654,_655,_656,_657,_658){if(_655){return "@import \""+(new _4._Url(_64f,"./"+_655).toString())+"\""+_658;}else{return "url("+(new _4._Url(_64f,"./"+_657).toString())+")"+_658;}});};var _659=/(<[a-z][a-z0-9]*\s[^>]*)(?:(href|src)=(['"]?)([^>]*?)\3|style=(['"]?)([^>]*?)\5)([^>]*>)/gi;var _65a=_6.html._adjustHtmlPaths=function(_65b,cont){var url=_65b||"./";return cont.replace(_659,function(tag,_65c,name,_65d,_65e,_65f,_660,end){return _65c+(name?(name+"="+_65d+(new _4._Url(url,_65e).toString())+_65d):("style="+_65f+_64e(url,_660)+_65f))+end;});};var _661=_6.html._snarfStyles=function(_662,cont,_663){_663.attributes=[];return cont.replace(/(?:<style([^>]*)>([\s\S]*?)<\/style>|<link\s+(?=[^>]*rel=['"]?stylesheet)([^>]*?href=(['"])([^>]*?)\4[^>\/]*)\/?>)/gi,function(_664,_665,_666,_667,_668,href){var i,attr=(_665||_667||"").replace(/^\s*([\s\S]*?)\s*$/i,"$1");if(_666){i=_663.push(_662?_64e(_662,_666):_666);}else{i=_663.push("@import \""+href+"\";");attr=attr.replace(/\s*(?:rel|href)=(['"])?[^\s]*\1\s*/gi,"");}if(attr){attr=attr.split(/\s+/);var _669={},tmp;for(var j=0,e=attr.length;j<e;j++){tmp=attr[j].split("=");_669[tmp[0]]=tmp[1].replace(/^\s*['"]?([\s\S]*?)['"]?\s*$/,"$1");}_663.attributes[i-1]=_669;}return "";});};var _66a=_6.html._snarfScripts=function(cont,_66b){_66b.code="";cont=cont.replace(/<[!][-][-](.|\s)*?[-][-]>/g,function(_66c){return _66c.replace(/<(\/?)script\b/ig,"&lt;$1Script");});function _66d(src){if(_66b.downloadRemote){src=src.replace(/&([a-z0-9#]+);/g,function(m,name){switch(name){case "amp":return "&";case "gt":return ">";case "lt":return "<";default:return name.charAt(0)=="#"?String.fromCharCode(name.substring(1)):"&"+name+";";}});_4.xhrGet({url:src,sync:true,load:function(code){_66b.code+=code+";";},error:_66b.errBack});}};return cont.replace(/<script\s*(?![^>]*type=['"]?(?:dojo\/|text\/html\b))(?:[^>]*?(?:src=(['"]?)([^>]*?)\1[^>]*)?)*>([\s\S]*?)<\/script>/gi,function(_66e,_66f,src,code){if(src){_66d(src);}else{_66b.code+=code;}return "";});};var _670=_6.html.evalInGlobal=function(code,_671){_671=_671||_4.doc.body;var n=_671.ownerDocument.createElement("script");n.type="text/javascript";_671.appendChild(n);n.text=code;};_4.declare("dojox.html._ContentSetter",[_4.html._ContentSetter],{adjustPaths:false,referencePath:".",renderStyles:false,executeScripts:false,scriptHasHooks:false,scriptHookReplacement:null,_renderStyles:function(_672){this._styleNodes=[];var st,att,_673,doc=this.node.ownerDocument;var head=doc.getElementsByTagName("head")[0];for(var i=0,e=_672.length;i<e;i++){_673=_672[i];att=_672.attributes[i];st=doc.createElement("style");st.setAttribute("type","text/css");for(var x in att){st.setAttribute(x,att[x]);}this._styleNodes.push(st);head.appendChild(st);if(st.styleSheet){st.styleSheet.cssText=_673;}else{st.appendChild(doc.createTextNode(_673));}}},empty:function(){this.inherited("empty",arguments);this._styles=[];},onBegin:function(){this.inherited("onBegin",arguments);var cont=this.content,node=this.node;var _674=this._styles;if(_4.isString(cont)){if(this.adjustPaths&&this.referencePath){cont=_65a(this.referencePath,cont);}if(this.renderStyles||this.cleanContent){cont=_661(this.referencePath,cont,_674);}if(this.executeScripts){var _675=this;var _676={downloadRemote:true,errBack:function(e){_675._onError.call(_675,"Exec","Error downloading remote script in \""+_675.id+"\"",e);}};cont=_66a(cont,_676);this._code=_676.code;}}this.content=cont;},onEnd:function(){var code=this._code,_677=this._styles;if(this._styleNodes&&this._styleNodes.length){while(this._styleNodes.length){_4.destroy(this._styleNodes.pop());}}if(this.renderStyles&&_677&&_677.length){this._renderStyles(_677);}if(this.executeScripts&&code){if(this.cleanContent){code=code.replace(/(<!--|(?:\/\/)?-->|<!\[CDATA\[|\]\]>)/g,"");}if(this.scriptHasHooks){code=code.replace(/_container_(?!\s*=[^=])/g,this.scriptHookReplacement);}try{_670(code,this.node);}catch(e){this._onError("Exec","Error eval script in "+this.id+", "+e.message,e);}}this.inherited("onEnd",arguments);},tearDown:function(){this.inherited(arguments);delete this._styles;if(this._styleNodes&&this._styleNodes.length){while(this._styleNodes.length){_4.destroy(this._styleNodes.pop());}}delete this._styleNodes;_4.mixin(this,_4.getObject(this.declaredClass).prototype);}});_6.html.set=function(node,cont,_678){if(!_678){return _4.html._setNodeContent(node,cont,true);}else{var op=new _6.html._ContentSetter(_4.mixin(_678,{content:cont,node:node}));return op.set();}};})();}if(!_4._hasResource["dojox.layout.ContentPane"]){_4._hasResource["dojox.layout.ContentPane"]=true;_4.provide("dojox.layout.ContentPane");_4.declare("dojox.layout.ContentPane",_5.layout.ContentPane,{adjustPaths:false,cleanContent:false,renderStyles:false,executeScripts:true,scriptHasHooks:false,constructor:function(){this.ioArgs={};this.ioMethod=_4.xhrGet;},onExecError:function(e){},_setContent:function(cont){var _679=this._contentSetter;if(!(_679&&_679 instanceof _6.html._ContentSetter)){_679=this._contentSetter=new _6.html._ContentSetter({node:this.containerNode,_onError:_4.hitch(this,this._onError),onContentError:_4.hitch(this,function(e){var _67a=this.onContentError(e);try{this.containerNode.innerHTML=_67a;}catch(e){console.error("Fatal "+this.id+" could not change content due to "+e.message,e);}})});}this._contentSetterParams={adjustPaths:Boolean(this.adjustPaths&&(this.href||this.referencePath)),referencePath:this.href||this.referencePath,renderStyles:this.renderStyles,executeScripts:this.executeScripts,scriptHasHooks:this.scriptHasHooks,scriptHookReplacement:"dijit.byId('"+this.id+"')"};this.inherited("_setContent",arguments);}});}if(!_4._hasResource["dojox.layout.ResizeHandle"]){_4._hasResource["dojox.layout.ResizeHandle"]=true;_4.provide("dojox.layout.ResizeHandle");_4.experimental("dojox.layout.ResizeHandle");_4.declare("dojox.layout.ResizeHandle",[_5._Widget,_5._Templated],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:false,activeResizeClass:"dojoxResizeHandleClone",animateSizing:true,animateMethod:"chain",animateDuration:225,minHeight:100,minWidth:100,constrainMax:false,maxHeight:0,maxWidth:0,fixedAspect:false,intermediateChanges:false,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:"<div dojoAttachPoint=\"resizeHandle\" class=\"dojoxResizeHandle\"><div></div></div>",postCreate:function(){this.connect(this.resizeHandle,"onmousedown","_beginSizing");if(!this.activeResize){this._resizeHelper=_5.byId("dojoxGlobalResizeHelper");if(!this._resizeHelper){this._resizeHelper=new _6.layout._ResizeHelper({id:"dojoxGlobalResizeHelper"}).placeAt(_4.body());_4.addClass(this._resizeHelper.domNode,this.activeResizeClass);}}else{this.animateSizing=false;}if(!this.minSize){this.minSize={w:this.minWidth,h:this.minHeight};}if(this.constrainMax){this.maxSize={w:this.maxWidth,h:this.maxHeight};}this._resizeX=this._resizeY=false;var _67b=_4.partial(_4.addClass,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=true;_67b("dojoxResizeNW");break;case "x":this._resizeX=true;_67b("dojoxResizeW");break;case "y":this._resizeY=true;_67b("dojoxResizeN");break;}},_beginSizing:function(e){if(this._isSizing){return false;}_4.publish(this.startTopic,[this]);this.targetWidget=_5.byId(this.targetId);this.targetDomNode=this.targetWidget?this.targetWidget.domNode:_4.byId(this.targetId);if(this.targetContainer){this.targetDomNode=this.targetContainer;}if(!this.targetDomNode){return false;}if(!this.activeResize){var c=_4.position(this.targetDomNode,true);console.log(c);console.log(_4.window.getBox());this._resizeHelper.resize({l:c.x,t:c.y,w:c.w,h:c.h});this._resizeHelper.show();}this._isSizing=true;this.startPoint={x:e.clientX,y:e.clientY};var mb=this.targetWidget?_4.marginBox(this.targetDomNode):_4.contentBox(this.targetDomNode);this.startSize={w:mb.w,h:mb.h};if(this.fixedAspect){var max,val;if(mb.w>mb.h){max="w";val=mb.w/mb.h;}else{max="h";val=mb.h/mb.w;}this._aspect={prop:max};this._aspect[max]=val;}this._pconnects=[];this._pconnects.push(_4.connect(_4.doc,"onmousemove",this,"_updateSizing"));this._pconnects.push(_4.connect(_4.doc,"onmouseup",this,"_endSizing"));_4.stopEvent(e);},_updateSizing:function(e){if(this.activeResize){this._changeSizing(e);}else{var tmp=this._getNewCoords(e);if(tmp===false){return;}this._resizeHelper.resize(tmp);}e.preventDefault();},_getNewCoords:function(e){try{if(!e.clientX||!e.clientY){return false;}}catch(e){return false;}this._activeResizeLastEvent=e;var dx=(this.isLeftToRight()?this.startPoint.x-e.clientX:e.clientX-this.startPoint.x),dy=this.startPoint.y-e.clientY,newW=this.startSize.w-(this._resizeX?dx:0),newH=this.startSize.h-(this._resizeY?dy:0);return this._checkConstraints(newW,newH);},_checkConstraints:function(newW,newH){if(this.minSize){var tm=this.minSize;if(newW<tm.w){newW=tm.w;}if(newH<tm.h){newH=tm.h;}}if(this.constrainMax&&this.maxSize){var ms=this.maxSize;if(newW>ms.w){newW=ms.w;}if(newH>ms.h){newH=ms.h;}}if(this.fixedAspect){var ta=this._aspect[this._aspect.prop];if(newW<newH){newH=newW*ta;}else{if(newH<newW){newW=newH*ta;}}}return {w:newW,h:newH};},_changeSizing:function(e){var tmp=this._getNewCoords(e);if(tmp===false){return;}if(this.targetWidget&&_4.isFunction(this.targetWidget.resize)){this.targetWidget.resize(tmp);}else{if(this.animateSizing){var anim=_4.fx[this.animateMethod]([_4.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:tmp.w}},duration:this.animateDuration}),_4.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:tmp.h}},duration:this.animateDuration})]);anim.play();}else{_4.style(this.targetDomNode,{width:tmp.w+"px",height:tmp.h+"px"});}}if(this.intermediateChanges){this.onResize(e);}},_endSizing:function(e){_4.forEach(this._pconnects,_4.disconnect);var pub=_4.partial(_4.publish,this.endTopic,[this]);if(!this.activeResize){this._resizeHelper.hide();this._changeSizing(e);setTimeout(pub,this.animateDuration+15);}else{pub();}this._isSizing=false;this.onResize(e);},onResize:function(e){}});_4.declare("dojox.layout._ResizeHelper",_5._Widget,{show:function(){_4.fadeIn({node:this.domNode,duration:120,beforeBegin:function(n){_4.style(n,"display","");}}).play();},hide:function(){_4.fadeOut({node:this.domNode,duration:250,onEnd:function(n){_4.style(n,"display","none");}}).play();},resize:function(dim){_4.marginBox(this.domNode,dim);}});}if(!_4._hasResource["dojox.layout.FloatingPane"]){_4._hasResource["dojox.layout.FloatingPane"]=true;_4.provide("dojox.layout.FloatingPane");_4.experimental("dojox.layout.FloatingPane");_4.declare("dojox.layout.FloatingPane",[_6.layout.ContentPane,_5._Templated],{closable:true,dockable:true,resizable:false,maxable:false,resizeAxis:"xy",title:"",dockTo:"",duration:400,contentClass:"dojoxFloatingPaneContent",_showAnim:null,_hideAnim:null,_dockNode:null,_restoreState:{},_allFPs:[],_startZ:100,templateString:_4.cache("dojox.layout","resources/FloatingPane.html","<div class=\"dojoxFloatingPane\" id=\"${id}\">\n\t<div tabindex=\"0\" role=\"button\" class=\"dojoxFloatingPaneTitle\" dojoAttachPoint=\"focusNode\">\n\t\t<span dojoAttachPoint=\"closeNode\" dojoAttachEvent=\"onclick: close\" class=\"dojoxFloatingCloseIcon\"></span>\n\t\t<span dojoAttachPoint=\"maxNode\" dojoAttachEvent=\"onclick: maximize\" class=\"dojoxFloatingMaximizeIcon\">&thinsp;</span>\n\t\t<span dojoAttachPoint=\"restoreNode\" dojoAttachEvent=\"onclick: _restore\" class=\"dojoxFloatingRestoreIcon\">&thinsp;</span>\t\n\t\t<span dojoAttachPoint=\"dockNode\" dojoAttachEvent=\"onclick: minimize\" class=\"dojoxFloatingMinimizeIcon\">&thinsp;</span>\n\t\t<span dojoAttachPoint=\"titleNode\" class=\"dijitInline dijitTitleNode\"></span>\n\t</div>\n\t<div dojoAttachPoint=\"canvas\" class=\"dojoxFloatingPaneCanvas\">\n\t\t<div dojoAttachPoint=\"containerNode\" role=\"region\" tabindex=\"-1\" class=\"${contentClass}\">\n\t\t</div>\n\t\t<span dojoAttachPoint=\"resizeHandle\" class=\"dojoxFloatingResizeHandle\"></span>\n\t</div>\n</div>\n"),attributeMap:_4.delegate(_5._Widget.prototype.attributeMap,{title:{type:"innerHTML",node:"titleNode"}}),postCreate:function(){this.inherited(arguments);new _4.dnd.Moveable(this.domNode,{handle:this.focusNode});if(!this.dockable){this.dockNode.style.display="none";}if(!this.closable){this.closeNode.style.display="none";}if(!this.maxable){this.maxNode.style.display="none";this.restoreNode.style.display="none";}if(!this.resizable){this.resizeHandle.style.display="none";}else{this.domNode.style.width=_4.marginBox(this.domNode).w+"px";}this._allFPs.push(this);this.domNode.style.position="absolute";this.bgIframe=new _5.BackgroundIframe(this.domNode);this._naturalState=_4.coords(this.domNode);},startup:function(){if(this._started){return;}this.inherited(arguments);if(this.resizable){if(_4.isIE){this.canvas.style.overflow="auto";}else{this.containerNode.style.overflow="auto";}this._resizeHandle=new _6.layout.ResizeHandle({targetId:this.id,resizeAxis:this.resizeAxis},this.resizeHandle);}if(this.dockable){var _67c=this.dockTo;if(this.dockTo){this.dockTo=_5.byId(this.dockTo);}else{this.dockTo=_5.byId("dojoxGlobalFloatingDock");}if(!this.dockTo){var _67d,_67e;if(_67c){_67d=_67c;_67e=_4.byId(_67c);}else{_67e=_4.create("div",null,_4.body());_4.addClass(_67e,"dojoxFloatingDockDefault");_67d="dojoxGlobalFloatingDock";}this.dockTo=new _6.layout.Dock({id:_67d,autoPosition:"south"},_67e);this.dockTo.startup();}if((this.domNode.style.display=="none")||(this.domNode.style.visibility=="hidden")){this.minimize();}}this.connect(this.focusNode,"onmousedown","bringToTop");this.connect(this.domNode,"onmousedown","bringToTop");this.resize(_4.coords(this.domNode));this._started=true;},setTitle:function(_67f){_4.deprecated("pane.setTitle","Use pane.set('title', someTitle)","2.0");this.set("title",_67f);},close:function(){if(!this.closable){return;}_4.unsubscribe(this._listener);this.hide(_4.hitch(this,function(){this.destroyRecursive();}));},hide:function(_680){_4.fadeOut({node:this.domNode,duration:this.duration,onEnd:_4.hitch(this,function(){this.domNode.style.display="none";this.domNode.style.visibility="hidden";if(this.dockTo&&this.dockable){this.dockTo._positionDock(null);}if(_680){_680();}})}).play();},show:function(_681){var anim=_4.fadeIn({node:this.domNode,duration:this.duration,beforeBegin:_4.hitch(this,function(){this.domNode.style.display="";this.domNode.style.visibility="visible";if(this.dockTo&&this.dockable){this.dockTo._positionDock(null);}if(typeof _681=="function"){_681();}this._isDocked=false;if(this._dockNode){this._dockNode.destroy();this._dockNode=null;}})}).play();this.resize(_4.coords(this.domNode));this._onShow();},minimize:function(){if(!this._isDocked){this.hide(_4.hitch(this,"_dock"));}},maximize:function(){if(this._maximized){return;}this._naturalState=_4.position(this.domNode);if(this._isDocked){this.show();setTimeout(_4.hitch(this,"maximize"),this.duration);}_4.addClass(this.focusNode,"floatingPaneMaximized");this.resize(_4.window.getBox());this._maximized=true;},_restore:function(){if(this._maximized){this.resize(this._naturalState);_4.removeClass(this.focusNode,"floatingPaneMaximized");this._maximized=false;}},_dock:function(){if(!this._isDocked&&this.dockable){this._dockNode=this.dockTo.addNode(this);this._isDocked=true;}},resize:function(dim){dim=dim||this._naturalState;this._currentState=dim;var dns=this.domNode.style;if("t" in dim){dns.top=dim.t+"px";}if("l" in dim){dns.left=dim.l+"px";}dns.width=dim.w+"px";dns.height=dim.h+"px";var _682={l:0,t:0,w:dim.w,h:(dim.h-this.focusNode.offsetHeight)};_4.marginBox(this.canvas,_682);this._checkIfSingleChild();if(this._singleChild&&this._singleChild.resize){this._singleChild.resize(_682);}},bringToTop:function(){var _683=_4.filter(this._allFPs,function(i){return i!==this;},this);_683.sort(function(a,b){return a.domNode.style.zIndex-b.domNode.style.zIndex;});_683.push(this);_4.forEach(_683,function(w,x){w.domNode.style.zIndex=this._startZ+(x*2);_4.removeClass(w.domNode,"dojoxFloatingPaneFg");},this);_4.addClass(this.domNode,"dojoxFloatingPaneFg");},destroy:function(){this._allFPs.splice(_4.indexOf(this._allFPs,this),1);if(this._resizeHandle){this._resizeHandle.destroy();}this.inherited(arguments);}});_4.declare("dojox.layout.Dock",[_5._Widget,_5._Templated],{templateString:"<div class=\"dojoxDock\"><ul dojoAttachPoint=\"containerNode\" class=\"dojoxDockList\"></ul></div>",_docked:[],_inPositioning:false,autoPosition:false,addNode:function(_684){var div=_4.create("li",null,this.containerNode),node=new _6.layout._DockNode({title:_684.title,paneRef:_684},div);node.startup();return node;},startup:function(){if(this.id=="dojoxGlobalFloatingDock"||this.isFixedDock){this.connect(window,"onresize","_positionDock");this.connect(window,"onscroll","_positionDock");if(_4.isIE){this.connect(this.domNode,"onresize","_positionDock");}}this._positionDock(null);this.inherited(arguments);},_positionDock:function(e){if(!this._inPositioning){if(this.autoPosition=="south"){setTimeout(_4.hitch(this,function(){this._inPositiononing=true;var _685=_4.window.getBox();var s=this.domNode.style;s.left=_685.l+"px";s.width=(_685.w-2)+"px";s.top=(_685.h+_685.t)-this.domNode.offsetHeight+"px";this._inPositioning=false;}),125);}}}});_4.declare("dojox.layout._DockNode",[_5._Widget,_5._Templated],{title:"",paneRef:null,templateString:"<li dojoAttachEvent=\"onclick: restore\" class=\"dojoxDockNode\">"+"<span dojoAttachPoint=\"restoreNode\" class=\"dojoxDockRestoreButton\" dojoAttachEvent=\"onclick: restore\"></span>"+"<span class=\"dojoxDockTitleNode\" dojoAttachPoint=\"titleNode\">${title}</span>"+"</li>",restore:function(){this.paneRef.show();this.paneRef.bringToTop();this.destroy();}});}if(!_4._hasResource["pundit.XpointersHelper"]){_4._hasResource["pundit.XpointersHelper"]=true;_4.provide("pundit.XpointersHelper");_4.declare("pundit.XpointersHelper",pundit.BaseComponent,{opts:{wrapNodeName:"span",wrapNodeClass:"cons",contentClasses:["pundit-content"],ignoreClasses:["cons","pundit-icon-annotation"]},constructor:function(_686){var self=this;self.log("xpointersHelper up and running");},getContentURIs:function(){var self=this,_687=[];_687.push(document.location.href);for(var i=self.opts.contentClasses.length-1;i>=0;i--){_4.query("."+self.opts.contentClasses[i]).forEach(function(node){_687.push(_4.attr(node,"about"));});}self.log("# getContentURIs: "+_687.length+" new uris found");return _687;},updateDOM:function(_688,_689){var self=this;for(i=_688.length-1;i>0;i--){var _68a=_688[i-1],end=_688[i];if(_689[i].length){self.log("## Updating DOM, xpath "+i+": "+_689[i].join(" "));self.wrapXPaths(_68a,end,self.opts.wrapNodeName,_689[i].join(" ")+" "+self.opts.wrapNodeClass);}}self.log("Dom succesfully updated!");},wrapXPaths:function(_68b,_68c,_68d,_68e){var self=this,_68f=_68d||"span",_690=_68e||"highlight",_691=document.createRange(),_692=self.getNodeFromXpath(_68b.xpath),_693=self.getNodeFromXpath(_68c.xpath);if(!_68b.xpath.match(/\[[0-9]+\]$/)&&!_68c.xpath.match(/\[[0-9]+\]$/)){_691.selectNode(_692.childNodes[_68b.offset]);}else{if(!self.isElementNode(_692)){_691.setStart(_692,_68b.offset);}else{_691.setStart(_692,_68b.offset);}if(!self.isElementNode(_693)){_691.setEnd(_693,_68c.offset);}else{_691.setEndAfter(_693);}}self.wrapElement(_691.commonAncestorContainer,_691,_68f,_690);},wrapElement:function(_694,_695,_696,_697){var self=this;if(_694.childNodes&&_694.childNodes.length>0){for(var i=(_694.childNodes.length-1);i>=0&&_694.childNodes[i];i--){self.wrapElement(_694.childNodes[i],_695,_696,_697);}}else{if(self.isTextNodeInsideRange(_694,_695)){self.wrapNode(_694,_695,_696,_697);}else{if(self.isImageNodeInsideRange(_694,_695)){self.wrapNode(_694,_695,_696,_697);}}}},isTextNodeInsideRange:function(node,_698){var self=this,_699;if(node.nodeType!==Node.TEXT_NODE){return false;}_699=node.textContent.replace(/ /g,"").replace(/\n/,"");if(!node.data||_699===""||_699===" "){return false;}return self.isNodeInsideRange(node,_698);},isImageNodeInsideRange:function(node,_69a){var self=this;if(node.nodeType!==Node.ELEMENT_NODE){return false;}if(node.tagName.toLowerCase()!=="img"){return false;}return self.isNodeInsideRange(node,_69a);},isNodeInsideRange:function(node,_69b){var _69c=document.createRange();try{_69c.selectNode(node);}catch(e){_69c.selectNodeContents(node);}if(_69b.compareBoundaryPoints(Range.END_TO_START||3,_69c)!=-1||_69b.compareBoundaryPoints(Range.START_TO_END||1,_69c)!=1){return false;}return true;},wrapNode:function(_69d,_69e,_69f,_6a0){var self=this,r2=document.createRange();if(_69d===_69e.startContainer||_69d===_69e.endContainer){r2.setStart(_69d,(_69d===_69e.startContainer)?_69e.startOffset:0);r2.setEnd(_69d,(_69d===_69e.endContainer)?_69e.endOffset:_69d.length);}else{r2.selectNode(_69d);}r2.surroundContents(self.createWrapNode(_69f,_6a0));},createWrapNode:function(_6a1,_6a2){var _6a3=document.createElement(_6a1);_4.query(_6a3).addClass(_6a2);return _6a3;},getClassesForNewXpointers:function(_6a4,_6a5,_6a6,_6a7){var self=this,_6a8=[],_6a9=[];for(var i=0;i<_6a5.length-1;i++){var _6aa=_6a5[i],end=_6a5[i+1],_6ab=self.getStartingXPs(_6a4,_6a6,_6aa.xpath,_6aa.offset),_6ac=self.getEndingXPs(_6a4,_6a6,_6aa.xpath,_6aa.offset);_6a8=self.addToArray(_6a8,_6ab);_6a8=self.removeFromArray(_6a8,_6ac);var _6ad=[];for(var j=_6a8.length-1;j>=0;j--){var xp=_6a8[j];for(var k=_6a7[xp].length-1;k>=0;k--){_6ad.push(_6a7[xp][k]);}}_6a9[i+1]=_6ad;}self.log("Got classes for new xpointers");return _6a9;},getStartingXPs:function(_6ae,_6af,_6b0,_6b1){var self=this,ret=[];for(var i=_6ae.length-1;i>=0;i--){var xp=_6ae[i];if(_6af[xp].startxpath===_6b0&&_6af[xp].startoffset===_6b1){ret.push(xp);}}return ret;},getEndingXPs:function(_6b2,_6b3,_6b4,_6b5){var self=this,ret=[];for(var i=_6b2.length-1;i>=0;i--){var xp=_6b2[i];if(_6b3[xp].endxpath===_6b4&&_6b3[xp].endoffset===_6b5){ret.push(xp);}}return ret;},splitAndSortXPaths:function(_6b6){var self=this,x=[],_6b7=self.getNodeFromXpath("//body");for(var _6b8 in _6b6){self.log("## Splitting and sorting "+_6b8);var _6b9=document.createRange(),node=self.getNodeFromXpath(_6b6[_6b8].startxpath);_6b9.setStart(_6b7,0);_6b9.setEnd(node,_6b6[_6b8].startoffset);x.push({xpointer:_6b8,xpath:_6b6[_6b8].startxpath,offset:_6b6[_6b8].startoffset,range:_6b9});_6b9=document.createRange();node=self.getNodeFromXpath(_6b6[_6b8].endxpath);_6b9.setStart(_6b7,0);_6b9.setEnd(node,_6b6[_6b8].endoffset);x.push({xpointer:_6b8,xpath:_6b6[_6b8].endxpath,offset:_6b6[_6b8].endoffset,range:_6b9});}x.sort(self._sortFunction);x=self.unique(x);return x;},getXPathsFromXPointers:function(_6ba){var self=this,_6bb=[],_6bc=[],_6bd={};for(var i=_6ba.length-1;i>=0;i--){_6bc=self.addToArray(_6bc,[_6ba[i]]);}for(var i=_6ba.length-1;i>=0;i--){var xp=_6ba[i],obj=self.xPointerToXPath(xp);if(obj.valid){_6bd[xp]=obj;}else{self.log("REMOVING "+xp+" from xpointers, it's not valid :(");_6bc=self.removeFromArray(_6bc,[xp]);_6bb.push(xp);}}self.log("# Consolidating "+_6bc.length+" valid xpointers out of "+_6ba.length+" passed in.");return {invalidXpointers:_6bb,xpaths:_6bd,xpointers:_6bc};},xPointerToXPath:function(_6be){var self=this,_6bf,ret={},foo,_6c0,_6c1;_6bf=_6be.split("#xpointer(start-point(string-range(")[1].split("))/range-to(string-range(");foo=_6bf[0].split(",'',");ret.startxpath=foo[0];ret.startoffset=foo[1];foo=_6bf[1].substr(0,_6bf[1].length-3).split(",'',");ret.endxpath=foo[0];ret.endoffset=foo[1];_6c0=self.getNodeFromXpath(ret.startxpath);_6c1=self.getNodeFromXpath(ret.endxpath);ret.valid=self.isValidRange(_6c0,ret.startoffset,_6c1,ret.endoffset);return ret;},isValidRange:function(_6c2,_6c3,_6c4,_6c5){try{var r=document.createRange();r.setStart(_6c2,_6c3);r.setEnd(_6c4,_6c5);return true;}catch(e){return false;}},isValidXPointer:function(xp){var self=this,_6c6,ret={},foo,_6c7,_6c8;_6c6=xp.split("#xpointer(start-point(string-range(")[1].split("))/range-to(string-range(");foo=_6c6[0].split(",'',");ret.startxpath=foo[0];ret.startoffset=foo[1];foo=_6c6[1].substr(0,_6c6[1].length-3).split(",'',");ret.endxpath=foo[0];ret.endoffset=foo[1];console.log("Start: ",ret.startxpath);_6c7=self.getNodeFromXpath(ret.startxpath);console.log("Start: ",_6c7,ret.startoffset);console.log("End: ",ret.endxpath);_6c8=self.getNodeFromXpath(ret.endxpath);console.log("End: ",_6c8,ret.endoffset);console.log("Valid start end",_6c7,_6c8);console.log("Valid: ",self.isValidRange(_6c7,ret.startoffset,_6c8,ret.endoffset));},getNodeFromXpath:function(_6c9){var self=this,_6ca;_6ca=document.evaluate(_6c9,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);return _6ca.singleNodeValue;},addToArray:function(arr,add){return arr.concat(add);},removeFromArray:function(arr,rem){var ret=[];for(var i=arr.length-1;i>=0;i--){if(rem.indexOf(arr[i])===-1){ret.push(arr[i]);}}return ret;},unique:function(arr){var _6cb=[],len=arr.length;_6cb[0]=arr[0];for(var i=1,j=0;i<len;i++){if(arr[i].xpath!=_6cb[j].xpath||arr[i].offset!=_6cb[j].offset){_6cb[++j]=arr[i];}}return _6cb;},_sortFunction:function(a,b){return a.range.compareBoundaryPoints(Range.END_TO_END,b.range);},extractContentFromRange:function(_6cc){if(_6cc===null){return "";}var self=this,_6cd="",_6ce=_6cc.cloneContents(),_6cf=_6ce.childNodes,len=_6cf.length;for(var i=0;i<len;i++){_6cd+=self.extractContentFromNode(_6cf[i]);}return _6cd;},extractContentFromNode:function(node){var self=this,_6d0="",type=node.nodeType;if(self.isElementNode(node)){if(node.nodeName.toUpperCase()==="IMG"){var src;if(src=_4.attr(node,"src")){var idx=src.lastIndexOf("/");if(idx!==-1){src=src.substr(idx+1,src.length-idx);}}else{src="unknown location";}_6d0+="[img: "+src+"]";}else{var _6d1=node.childNodes,len=_6d1.length;for(var i=0;i<len;i++){_6d0+=self.extractContentFromNode(_6d1[i]);}}}else{if(!self.isCommentNode(node)){if(typeof (node.textContent)!=="undefined"){_6d0+=node.textContent;}}}return _6d0;},extractContentFromXpointer:function(xp){var self=this;},isUIButton:function(node){var self=this;if(!self.isElementNode(node)){return false;}if(node.nodeName.toUpperCase()!=="A"){return false;}if(_4.hasClass(node,"pundit-icon-annotation")){return true;}return false;},isIgnoreNode:function(node){var self=this;if(!self.isElementNode(node)){return false;}var i,c=self.opts.ignoreClasses;for(i=c.length;i--;){if(_4.hasClass(node,c[i])){return true;}}return false;},isTextNode:function(node){return node.nodeType===Node.TEXT_NODE;},isElementNode:function(node){return node.nodeType===Node.ELEMENT_NODE;},isCommentNode:function(node){return node.nodeType===Node.COMMENT_NODE;},isWrapNode:function(node){var self=this;if(!self.isElementNode(node)){return false;}if(node.nodeName.toUpperCase()!==self.opts.wrapNodeName.toUpperCase()){return false;}if(_4.hasClass(node,self.opts.wrapNodeClass)){return true;}return false;},isWrappedElementNode:function(node){var self=this;if(!self.isWrapNode(node)){return false;}if(!self.isElementNode(node.firstChild)){return false;}return true;},isWrappedTextNode:function(node){var self=this;if(!self.isWrapNode(node)){return false;}if(!self.isTextNode(node.firstChild)){return false;}return true;},isContentNode:function(node){var self=this;if(!self.isElementNode(node)){return false;}var i,c=self.opts.contentClasses;for(i=c.length;i--;){if(_4.hasClass(node,c[i])){return true;}}return false;},mergeTextNodes:function(node){var self=this;if(!node){return;}if((typeof (node.childNodes)!=="undefined")&&(node.childNodes.length>0)){var i=node.childNodes.length-1;try{var _6d2,_6d3;while(_6d2=node.childNodes[i--]){if(self.isTextNode(_6d2)&&(_6d3=node.childNodes[i])&&self.isTextNode(_6d3)){_6d3.nodeValue=_6d3.nodeValue+_6d2.nodeValue;node.removeChild(_6d2);}else{if(self.isElementNode(_6d2)){self.mergeTextNodes(_6d2);}}}}catch(err){console.log("ERROR while merging text nodes!");}}},getXpFromNode:function(node){var _6d4=document.createRange();_6d4.selectNode(node);return fragmentHandler.range2xpointer(fragmentHandler.dirtyRange2cleanRange(_6d4));},getXpFromChildNodes:function(node){var self=this,_6d5=self.getRangeFromChildNodes(node);return fragmentHandler.range2xpointer(fragmentHandler.dirtyRange2cleanRange(_6d5));},getRangeFromChildNodes:function(node){var _6d6=document.createRange();_6d6.setStart(node.firstChild,0);_6d6.setEnd(node.lastChild,0);return _6d6;},});}if(!_4._hasResource["pundit.RemoteStorageHandler"]){_4._hasResource["pundit.RemoteStorageHandler"]=true;_4.provide("pundit.RemoteStorageHandler");_4.declare("pundit.RemoteStorageHandler",pundit.BaseComponent,{constructor:function(){var self=this;self.createCallback(["storeRead","storeSave","storeError"]);self.reader=new pundit.AnnotationReader({debug:self.opts.debug});self.reader.onStorageGet(function(data){self.log("Storage read from server");if(data){self.log("Firing onStoreRead");self.fireOnStoreRead(data);}});self.reader.onStorageError(function(_6d7){self.fireOnStoreError();});self.writer=new pundit.AnnotationWriter();self.writer.onStorageError(function(_6d8){self.fireOnStoreError();});},exists:function(key){},save:function(key,val){var _6d9=new Date(),_6da=_4.toJson({value:val,created:_6d9.getTime()});this.writer.postRemoteStorage(key,_6da);},read:function(key){this.reader.getDataFromStorage(key);},clearStore:function(){},clearKey:function(key){},get:function(key,_6db,_6dc){var self=this,args;if(typeof (_6db)!=="function"){self.log("ERROR: get() with no success callback.");return;}if(typeof (key)!=="string"||key.length===0){self.log("ERROR: get() with invalid key: "+key);return;}args={url:ns.annotationServerStorage+key,headers:{"Accept":"application/json"},failOk:true,handleAs:"json",load:function(r){if(r){self.log("Success get() response for key "+key);_6db.call(self,r);}else{self.log("Empty get() response for key "+key);_6db.call(self,[]);}return false;},error:function(_6dd,req){if(req.xhr.status===204){self.log("204 Empty store from remote for key "+key+", firing ok anyway");_6db.call(self,[]);return false;}self.log("ERROR: get() for key "+key);if(typeof (_6dc)==="function"){_6dc.call(self,_6dd,req);}}};requester.xGet(args);},set:function(key,_6de,_6df,_6e0){if(typeof (key)!=="string"||key.length===0){self.log("ERROR: set() with invalid key: "+key);return;}var self=this,_6e1=_4.toJson({value:_6de,created:(new Date()).getTime()}),args={url:ns.annotationServerStorage+key,postData:_6e1,headers:{"Content-Type":"application/json;charset=UTF-8;"},handleAs:"text",load:function(data){self.log("Success set() for key "+key);if(typeof (_6df)==="function"){_6df.call(self,data);}},error:function(_6e2){self.log("ERROR: set() for key "+key);if(typeof (_6e0)==="function"){_6e0.call(self,data);}}};requester.xPost(args);}});}if(!_4._hasResource["pundit.LocalStorageHandler"]){_4._hasResource["pundit.LocalStorageHandler"]=true;_4.provide("pundit.LocalStorageHandler");_4.declare("pundit.LocalStorageHandler",pundit.BaseComponent,{storeType:"localStorage",constructor:function(_6e3){if(typeof (localStorage)!=="undefined"){this.createCallback(["storeRead","storeSave"]);}else{alert("Local Storage not available in your browser :-(");}},exists:function(key){if((typeof (localStorage[key])!=="undefined")&&(localStorage[key]!==null)){return true;}else{return false;}},save:function(key,val){var _6e4=new Date();localStorage[key]=_4.toJson({value:val,created:_6e4.getTime()});},read:function(key){return _4.fromJson(localStorage[key]);},clearStore:function(){localStorage.clear();},clearKey:function(key){if(typeof (localStorage[key])!=="undefined"){localStorage.removeItem(key);}}});}if(!_4._hasResource["pundit.CookiesStorageHandler"]){_4._hasResource["pundit.CookiesStorageHandler"]=true;_4.provide("pundit.CookiesStorageHandler");_4.declare("pundit.CookiesStorageHandler",pundit.BaseComponent,{constructor:function(_6e5){var self=this;_4.cookie("mystestcookie","mytestcookie");if(typeof (_4.cookie("mystestcookie"))!=="undefined"){_4.cookie("mystestcookie",{expires:-1});this.createCallback(["storeRead","storeSave"]);self.log("Using Cookie storage");}else{alert("Cookie Storage cannot be created. :-( Check you cookies preferences!");return false;}},exists:function(key){if(typeof (_4.cookie(key))!=="undefined"){return true;}else{return false;}},save:function(key,val){var _6e6=new Date();_4.cookie(key,_4.toJson({value:val,created:_6e6.getTime()}),{expires:30});},read:function(key){this.fireOnStoreRead(_4.fromJson(_4.cookie(key)));},clearStore:function(){var _6e7=document.cookie.split(";");for(i=0;i<_6e7.length;i++){var _6e8=_6e7[i].split("=")[0];_4.cookie(_6e8,"",{expires:-1});}},clearKey:function(key){_4.cookie(key,"",{expires:-1});}});}if(!_4._hasResource["pundit.GUI"]){_4._hasResource["pundit.GUI"]=true;_4.provide("pundit.GUI");_4.declare("pundit.GUI",pundit.BaseComponent,{opts:{positionPanelsTimerMS:150,topbarHeight:25,initialWindowHeight:200,collapsedWindowHeight:0,minWindowHeight:130,maxWindowHeight:500},constructor:function(_6e9){var self=this;self.createCallback(["windowResize","windowClose","windowAnnotationResize","resizeEnd"]);self.panels={};self.positionPanelsTimer=null;self.resizeEndTimer=null;self._currentWindowHeight=0;self.initWindow();self.initBehaviors();self.resizeSemlibWindow(self.opts.initialWindowHeight);self.show();_PUNDIT.init.onInitDone(function(){self.resizeSemlibWindow(self.opts.initialWindowHeight);self.show();if(_PUNDIT.myPundit.logged===true){_4.query("#pundit-gui-topbar").addClass("pundit-logged-in").removeClass("pundit-logged-off");}semlibMyItems.onMyItemAdded(function(_6ea){self.updateNewMyItems(_6ea);});});_PUNDIT.requester.onLogin(function(data){self.show();_4.query("#pundit-gui-topbar").addClass("pundit-logged-in").removeClass("pundit-logged-off");});_PUNDIT.requester.onLogout(function(data){_4.query("#pundit-gui-topbar").addClass("pundit-logged-off").removeClass("pundit-logged-in");});self.log("GUI up and running!");},initWindow:function(){var self=this,sw,aw;sw="<div id=\"pundit-gui-topbar\" class=\"pundit-base pundit-logged-off pundit-disable-annotation\">";sw+="<span id=\"pundit-gui-topbar-title\">Wikidata Web Annotator (Pundit)</span>";sw+="<span class=\"pundit-gui-button\" id=\"pundit-aw-expander\"><span class=\"pundit-annotations-expand-icon\"></span></span>";sw+="<span class=\"pundit-gui-button\" id=\"pundit-gui-expander\"><span class=\"pundit-window-expand-icon\"></span></span>";sw+="</div>";sw+="<div id=\"pundit-gui\" class=\"pundit-base tundra startup pundit-disable-annotation pundit-stop-wheel-propagation\"\">";sw+="<div id=\"pundit-gui-resize-handler\"></div>";sw+="<ul id=\"pundit-gui-panel-container\" class=\"pundit-horizontal-list\">";sw+="<li id=\"pundit-gui-left\" class=\"pundit-stop-wheel-propagation\"><div id=\"pundit-gui-preview\" class=\"pundit-moreinfo-panel\"></div></li>";sw+="<li id=\"pundit-gui-center\"></li>";sw+="   <li id=\"pundit-gui-right\"></li>";sw+="</ul>";sw+="<ul id=\"pundit-gui-footer\" class=\"pundit-horizontal-list\">";sw+="<li id=\"pundit-gui-footer-left\"></li>";sw+="<li id=\"pundit-gui-footer-center\">";sw+="<span class=\"pundit-gui-button\" id=\"pundit-tab-vocabs\">Vocabulary</span>";sw+="<span class=\"pundit-gui-button\" id=\"pundit-tab-page-items\"><span id=\"pundit-page-items-number\" class=\"pundit-items-number\">0</span>Page Items</span>";sw+="<span class=\"pundit-gui-button pundit-selected\" id=\"pundit-tab-my-items\"><span id=\"pundit-my-items-number\" class=\"pundit-items-number\">0</span> My Items</span>";sw+="</li>";sw+="<li id=\"pundit-gui-footer-right\">";sw+="<span class=\"pundit-gui-button pundit-selected\" id=\"pundit-tab-tc\">Triple Composer</span>";sw+="</li>";sw+="</ul>";sw+="</div>";_4.query("body").append(sw);aw="<div id=\"pundit-aw\" class=\"pundit-base startup pundit-disable-annotation\" >";aw+="<div class=\"pundit-shown-content\"></div>";aw+="</div>";_4.query("body").append(aw);self.resizeAnnotationWindow();},show:function(){var self=this;_4.addClass("pundit-gui","pundit-hidden");_4.removeClass("pundit-gui","startup");_4.query("body").addClass("pundit-gui-hidden");_4.addClass("pundit-aw","pundit-hidden");_4.removeClass("pundit-aw","startup");_4.query("body").addClass("pundit-aw-hidden");_4.style("pundit-gui","height",self.opts.collapsedWindowHeight+"px");_4.query("body").style({"marginTop":self.opts.collapsedWindowHeight+self.opts.topbarHeight+"px","background-position-y":self.opts.collapsedWindowHeight+self.opts.topbarHeight+"px"});_4.query("#pundit-aw").style("marginTop",self.opts.collapsedWindowHeight+self.opts.topbarHeight+1+"px");setTimeout(function(){self.resizeAnnotationWindow();},500);},hide:function(){_4.removeClass("pundit-gui","pundit-hidden pundit-shown");_4.addClass("pundit-gui","startup");_4.query("body").removeClass("pundit-gui-hidden pundit-gui-shown");_4.removeClass("pundit-aw","pundit-hidden pundit-shown");_4.addClass("pundit-aw","startup");_4.query("body").removeClass("pundit-aw-hidden pundit-aw-shown");},initBehaviors:function(){var self=this;_PUNDIT.init.onInitDone(function(){tooltip_viewer.onConsolidate(function(){self.positionPanels();});_4.connect(_4.byId("pundit-mypundit-myitems-button"),"onclick",function(){self.show_pundittabmyitems();_4.removeClass("pundit-new-myitems","pundit-visible");});});_4.connect(_4.byId("pundit-gui-expander"),"onclick",function(){_PUNDIT.ga.track("gui-button","click","#pundit-gui-expander");self.toggleWindow();});_4.connect(_4.byId("pundit-aw-expander"),"onclick",function(){_PUNDIT.ga.track("gui-button","click","#pundit-aw-expander");self.toggleAnnotationWindow();});var _6eb={"#pundit-tab-page-items":{container:"#pundit-page-items-container",filter:function(){semlibItems.showOnlyItems(_4.query("#pundit-items li"));}},"#pundit-tab-my-items":{container:"#pundit-my-items-container",filter:function(){semlibMyItems.showOnlyItems(pundit-items.getNodesWhereField("favorite",true));}},"#pundit-tab-vocabs:":{container:"#pundit-vocabs-container"}};for(var tab in _6eb){var f=(function(but,tab){return function(){if(!self.isWindowOpen()){self.toggleWindow();}_4.query("#pundit-gui-center .pundit-tab, #pundit-gui-footer-center .pundit-gui-button").removeClass("pundit-selected");_4.query(but).addClass("pundit-selected");_4.query(tab.container).addClass("pundit-selected");_PUNDIT.ga.track("gui-button","click",but);if(but==="#pundit-tab-my-items"){_4.removeClass("pundit-new-myitems","pundit-visible");semlibMyItems.emptyNewMyItems();}};})(tab,_6eb[tab]);self["show_"+tab.substr(1).replace(/-/g,"")]=f;_4.connect(_4.query(tab)[0],"onclick",f);}var _6ec={"#pundit-tab-tc":"#pundit-tc-container"};for(var tab in _6ec){var f=(function(but,pan){return function(){if(!self.isWindowOpen()){self.toggleWindow();}_4.query("#pundit-gui-right .pundit-tab, #pundit-gui-footer-right .pundit-gui-button").removeClass("pundit-selected");_4.query(but).addClass("pundit-selected");_4.query(pan).addClass("pundit-selected");};})(tab,_6ec[tab]);self["show_"+tab.substr(1)]=f;_4.connect(_4.query(tab)[0],"onclick",f);}_4.connect(_4.byId("pundit-gui-resize-handler"),"mousedown",function(evt){if(evt.button===_4.mouseButtons.LEFT){evt.stopPropagation();_4.addClass("pundit-gui-resize-handler","dragging");b=_4.query("body")[0];_4.style(b,"-webkit-user-select","none");_4.style(b,"user-select","none");self._isResizing=true;self._currentY=evt.clientY-evt.offsetY;self._offsetY=evt.offsetY;self._moveListener=_4.connect(_4.doc,"mousemove",function(e){e.stopPropagation();if(!self._isResizing){_4.disconnect(self._moveListener);return false;}if(e.pageY!==self._currentY){self._currentY=e.clientY-self._offsetY-self.opts.topbarHeight;_4.style("pundit-gui-resize-handler","top",self._currentY+"px");}});}});_4.connect(_4.doc,"mouseup",function(evt){if(self._isResizing){var b=_4.query("body")[0];_4.style(b,"-webkit-user-select","text");_4.style(b,"user-select","text");_4.removeClass("pundit-gui-resize-handler","dragging");_4.disconnect(self._moveListener);self._isResizing=false;self.resizeSemlibWindow(evt.clientY-self._offsetY-self.opts.topbarHeight);if(_4.exists("pundit-zoomed-fragment")){_4.destroy("pundit-zoomed-fragment");clearTimeout(self.positionPanelsTimer);self.positionPanelsTimer=setTimeout(function(){tooltip_viewer.zoomOnXpointer(tooltip_viewer.zoomedXp);},1100);}}});if(!_4.isMozilla){_4.behavior.add({".pundit-stop-wheel-propagation":{"onmousewheel":function(e){self.handleScroll(e);_4.stopEvent(e);}}});}else{_4.behavior.add({".pundit-stop-wheel-propagation":{"DOMMouseScroll":function(e){self.handleScroll(e);_4.stopEvent(e);}}});}},handleScroll:function(e){var _6ed=e.target;while(!_4.hasClass(_4.query(_6ed)[0],"pundit-stop-wheel-propagation")){_6ed=_4.query(_6ed).parent()[0];}var h=_4.position(_4.query(_6ed)[0]).h;var dy=e.wheelDeltaY;if(Math.abs(dy)>h){if(dy>0){dy=(h/2);}else{dy=-(h/2);}}_4.query(_6ed)[0].scrollTop-=dy;_4.stopEvent(e);},toggleWindow:function(){var self=this;self.fireOnWindowClose();if(self.isWindowOpen()){_4.style("pundit-gui",{"height":self.opts.collapsedWindowHeight+"px"});_4.query("body").style({"marginTop":self.opts.collapsedWindowHeight+self.opts.topbarHeight+"px","background-position-y":self.opts.collapsedWindowHeight+self.opts.topbarHeight+"px"});self.fixFixedNodeTopPosition(-self._currentWindowHeight);_4.query("#pundit-aw").style("marginTop",self.opts.collapsedWindowHeight+self.opts.topbarHeight+"px");}else{_4.style("pundit-gui",{"height":self._currentWindowHeight+"px"});_4.query("body").style({"marginTop":self._currentWindowHeight+self.opts.topbarHeight+"px","background-position-y":self._currentWindowHeight+"px"});self.fixFixedNodeTopPosition(self._currentWindowHeight);_4.query("#pundit-aw").style("marginTop",self._currentWindowHeight+self.opts.topbarHeight+1+"px");}if(_4.exists("pundit-zoomed-fragment")){_4.destroy("pundit-zoomed-fragment");clearTimeout(self.positionPanelsTimer);self.positionPanelsTimer=setTimeout(function(){tooltip_viewer.zoomOnXpointer(tooltip_viewer.zoomedXp);},1500);}_4.query("#pundit-gui").toggleClass("pundit-hidden");_4.query("#pundit-gui").toggleClass("pundit-shown");_4.query("body").toggleClass("pundit-gui-hidden");_4.query("body").toggleClass("pundit-gui-shown");self.resizeAnnotationWindow();},toggleAnnotationWindow:function(){var a=_4.query("#pundit-aw"),b=_4.query("body"),self=this;a.toggleClass("pundit-hidden");a.toggleClass("pundit-shown");b.toggleClass("pundit-aw-hidden");b.toggleClass("pundit-aw-shown");if(_4.exists("pundit-zoomed-fragment")){_4.destroy("pundit-zoomed-fragment");clearTimeout(self.positionPanelsTimer);self.positionPanelsTimer=setTimeout(function(){tooltip_viewer.zoomOnXpointer(tooltip_viewer.zoomedXp);},1500);}self.resizeAnnotationWindow();},resizeSemlibWindow:function(h){var self=this,h=parseInt(h,10);if(typeof self.firstResize==="undefined"){self.firstResize=true;}if(h<self.opts.minWindowHeight){h=self.opts.minWindowHeight;}if(h>self.opts.maxWindowHeight){h=self.opts.maxWindowHeight;}_4.style("pundit-gui","height",h+"px");_4.query("#pundit-gui-panel-container, #pundit-gui-left, #pundit-gui-center, #pundit-gui-right").style("height",(h-30)+"px");_4.query(".pundit-tab-content").style("height",(h-54)+"px");var _6ee=self._currentWindowHeight;self._currentWindowHeight=h;_4.query("body").style({"marginTop":h+self.opts.topbarHeight+"px","background-position-y":h+"px"});_4.query("#pundit-aw").style("marginTop",h+self.opts.topbarHeight+1+"px");_4.style("pundit-gui-resize-handler","top",self._currentWindowHeight+"px");self.fireOnWindowResize(h);if(self.firstResize){self.firstResize=false;self.fixFixedNodeTopPosition(self.opts.collapsedWindowHeight+self.opts.topbarHeight);}else{self.fixFixedNodeTopPosition(h-_6ee);}self.resizeAnnotationWindow();self.positionPanels();},resizeAnnotationWindow:function(){var self=this,b=_4.query("body")[0],bh=_4.position(b,true).h;clearTimeout(self.resizeEndTimer);self.fireOnWindowAnnotationResize();_4.style("pundit-aw","height",bh+"px");_4.style(_4.query("#pundit-aw div.pundit-shown-content")[0],"height",bh+"px");self.resizeEndTimer=setTimeout(function(){self.fireOnResizeEnd();},1000);},isWindowOpen:function(){return _4.hasClass("pundit-gui","pundit-shown");},isAnnotationWindowOpen:function(){return _4.hasClass("pundit-aw","pundit-shown");},getOpenedPanelsByXpointer:function(xp){var self=this,ret=[];for(var id in self.panels){if(_4.indexOf(self.panels[id].trackXPs,xp)!==-1){ret.push(self.panels[id]);}}return ret;},isSomePanelOpen:function(){var self=this;for(var id in self.panels){return true;}},closePanelByXpointer:function(xp){var self=this;self.log("Closing panels by xpointer "+xp.substr(-30));for(var id in self.panels){if(_4.indexOf(self.panels[id].trackXPs,xp)!==-1){self.panels[id].close();}}self.positionPanels();},closeAllPanels:function(){var self=this;self.log("Closing all panels");for(var id in self.panels){self.panels[id].close();}},closePanelById:function(id){var self=this;self.log("Closing panels by id "+id);if(typeof (self.panels["dialog_"+id+"_content"])!=="undefined"){self.panels["dialog_"+id+"_content"].close();self.positionPanels();}},destroyPanelById:function(id){var self=this;self.log("Closing panels by id "+id);if(typeof (self.panels["dialog_"+id+"_content"])!=="undefined"){self.panels["dialog_"+id+"_content"].close();}},setPositioningXpointer:function(id,xp){this.panels[id].positioningXpointer=xp;this.positionPanels();},togglePanel:function(id){var self=this;if(self.panels[id].expanded===false){self.showPanel(id);}else{self.collapsePanel(id);}self.positionPanels();},showPanel:function(id){var self=this;_4.query(".pundit-aw-panel").forEach(function(e,i){if(_4.attr(e,"id")!==id){self.collapsePanel(_4.attr(e,"id"));}});self.panels[id].expanded=true;_4.removeClass(id,"pundit-hidden");_4.addClass("collapse_"+id,"pundit-expanded");_4.removeClass("collapse_"+id,"pundit-collapsed");},collapsePanel:function(id){var self=this;self.panels[id].expanded=false;_4.addClass(id,"pundit-hidden");_4.removeClass("collapse_"+id,"pundit-expanded");_4.addClass("collapse_"+id,"pundit-collapsed");},positionPanels:function(){var self=this;clearTimeout(self.positionPanelsTimer);self.positionPanelsTimer=setTimeout(function(){self._positionPanels();},self.opts.positionPanelsTimerMS);},_positionPanels:function(){var self=this,_6ef=parseInt(_4.style(_4.query("body")[0],"marginTop")),_6f0={},_6f1=[],_6f2={},_6f3,y;for(var id in self.panels){var p=self.panels[id],cl=tooltip_viewer.xpointersClasses[p.positioningXpointer];if(typeof cl!=="undefined"){if(_4.byId("icon_"+cl)===null){continue;}_6f2=_4.position(_4.query("span.cons."+cl)[0],true);y=_6f2.y-_6ef;}else{_6f2={y:_6ef,x:0};_4.style(id,"top",_6f2.y+"px");}if(p.expanded){_6f0={id:id,coords:_6f2,panelHeight:_4.position(_4.byId(id),true).h};}else{self.collapsePanel(id);}_6f1.push({id:id,coords:_6f2,panelHeight:_4.position(_4.byId(id),true).h});}_6f1=_6f1.sort(function(a,b){if(a.coords.y===b.coords.y){return a.coords.x-b.coords.x;}return a.coords.y-b.coords.y;});var _6f4=28,_6f5=5,_6f6=0,len=_6f1.length;for(var i=0;i<len;i++){if(_6f1[i].coords.y>_6f6){_6f3=_6f1[i].coords.y;_6f6=_6f1[i].coords.y+_6f4+_6f5;}else{_6f3=_6f6;_6f6+=_6f4+_6f5;}if(_6f1[i].id===_6f0.id){_6f6=_6f6-_6f4+_6f0.panelHeight;}_4.style(_6f1[i].id,"top",(_6f3-_6ef)+"px");}},awAdd:function(o){var self=this,c="",_6f7="",_6f8;self.panels[o.id]={id:o.id,content:o.content,positioningXpointer:o.positioningXpointer,trackXPs:o.xpointers,close:o.onClose,expanded:true,isBroken:o.isBroken};for(var i=o.xpointers.length;i--;){var _6f8=tooltip_viewer.xpointersColors[o.xpointers[i]];_6f7+="<span id=\"pundit-aw-button-color-"+_6f8+"-"+o.id+"\" class=\"pundit-button-color "+_6f8+"\">"+_6f8+"</span>";}c+="<div class='pundit-aw-panel "+(o.isBroken?"pundit-broken-ann":"")+"' id='"+o.id+"'>";c+="<div class='pundit-aw-panel-buttons'>"+_6f7+o.buttons+"</div>";c+="<div class='pundit-aw-panel-header'>";if(o.xpointers.length===0){c+="    <span class=pundit-icon-page></span>";}c+="    <span class='pundit-aw-panel-title'>"+o.title+"</span>";c+="    <span class='pundit-aw-button pundit-icon-close' id='close_"+o.id+"'></span><span class='pundit-aw-button pundit-icon-collapse pundit-collapsed' id='collapse_"+o.id+"'></span>";c+="</div>";c+="<div class='pundit-aw-panel-content' id='content_"+o.id+"'>"+o.content+"</div></div>";_4.query("#pundit-aw div.pundit-shown-content").append(c);_4.connect(_4.byId("close_"+o.id),"onclick",function(){o.onClose();self.positionPanels();});_4.connect(_4.byId("collapse_"+o.id),"onclick",function(){self.togglePanel(o.id);});if(typeof _6f8!=="undefined"){_4.connect(_4.byId("pundit-aw-button-color-"+_6f8+"-"+o.id),"onclick",function(){if(!self.isAnnotationWindowOpen()){self.toggleAnnotationWindow();}self.showPanel(o.id);self.positionPanels();});}self.showPanel(o.id);self.positionPanels();},initNotebookShareDialog:function(id){var self=this,h="<div id='pundit-login-popup-content' class='off tundra'>";h+="<p>To share this notebook just copy the following URL and send it over (e.g. by e-mail).</p>";h+="<p><strong>"+ns.annotationServer+"/pages/activate.html?id="+id+"</strong></p>";h+="</div>";var _6f9=new _5.Dialog({style:"width: 600px"});_6f9.attr("content",h);_6f9.attr("title","Share Notebook");_4.addClass(_4.byId(_6f9.id),"tundra");return _6f9;},fixFixedNodeTopPosition:function(_6fa){_4.query("body *").forEach(function(item){if((_4.style(item,"position")==="fixed")&&(typeof _4.style(item,"bottom")==="undefined"||_4.style(item,"bottom")==="auto")&&(typeof _4.style(item,"top")!=="undefined"||_4.style(item,"top")==="auto")&&!_4.hasClass(item,"pundit-base")){_4.query(item).style({"-webkit-transition-property":"top","-webkit-transition-duration":"1s","-moz-transition-property":"top","-moz-transition-duration":"1s"});_4.style(item,"top",parseInt(_4.style(item,"top"))+_6fa+"px");}});},updateNewMyItems:function(_6fb){var self=this;if(_6fb.length>0){_4.addClass("pundit-new-myitems","pundit-visible");_4.query("#pundit-new-myitems").html("(+"+_6fb.length+")");}}});}if(!_4._hasResource["pundit.Items"]){_4._hasResource["pundit.Items"]=true;_4.provide("pundit.Items");_4.declare("pundit.Items",pundit.BaseComponent,{constructor:function(_6fc){},init:function(name){var self=this;self.crypto=new pundit.Crypto();this.name=name;var si="<div id=\"pundit-"+this.name+"-container\" class=\"pundit-tab pundit-selected\">";si+="<div class=\"pundit-tab-header\"><ul id=\"pundit-"+this.name+"-filter-list\" class=\"pundit-item-filter-list\">";si+="<li id=\"pundit-tab-filter-"+this.name+"-fragment\" class=\"pundit-selected\">Text-fragment</li>";si+="<li id=\"pundit-tab-filter-"+this.name+"-images\">Images</li>";si+="<li id=\"pundit-tab-filter-"+this.name+"-images-fragment\">Image Fragments</li>";si+="<li id=\"pundit-tab-filter-"+this.name+"-entities\">Terms</li>";si+="<li id=\"pundit-tab-filter-"+this.name+"-pages\">Pages</li>";si+="<li id=\"pundit-tab-filter-"+this.name+"-named\">Named Content</li>";si+="<li id=\"pundit-tab-filter-"+this.name+"-suggestions\" class=\"pundit-hidden\"><span class=\"suggestionNumber\"></span> Suggestions</li>";si+="</ul></span><span class=\"pundit-sort-items pundit-view-tile \"></span><span class=\"pundit-sort-items pundit-view-list pundit-selected\"></div>";si+="<div id=\"pundit-tab-content"+this.name+"\" class=\"pundit-tab-content pundit-stop-wheel-propagation\"><ul id=\"pundit-"+this.name+"\" class=\"pundit-items pundit-view-list\"></ul></div>";si+="</div>";_4.query("#pundit-gui-center").append(si);self.initDnD();self.initBehaviors();self.createCallback(["itemAdded","itemRemoved","allItemsRemoved"]);self.log("Pundit"+self.name+"Container up and running..");_PUNDIT.init.onInitDone(function(){setTimeout(function(){self.showOnlyItems(self.getNodesWhereTypeIs(ns.fragments.text));_4.query("#pundit-tab-filter-"+self.name+"-fragment").addClass("pundit-selected");},1000);});},initDnD:function(){var self=this;self.itemsDnD=new _4.dnd.Source("pundit-"+self.name,{copyOnly:true,creator:self.itemNodeCreator,checkAcceptance:function(){return false;}});},initBehaviors:function(){var self=this;var tabs={},beh={};tabs["#pundit-tab-filter-"+this.name+"-entities"]=function(){return self.getNodesEntities();};tabs["#pundit-tab-filter-"+this.name+"-fragment"]=function(){return self.getNodesWhereTypeIs(ns.fragments.text);};tabs["#pundit-tab-filter-"+this.name+"-images"]=function(){return self.getNodesWhereTypeIs(ns.image);};tabs["#pundit-tab-filter-"+this.name+"-images-fragment"]=function(){return self.getNodesWhereTypeIs(ns.fragments.image);};tabs["#pundit-tab-filter-"+this.name+"-pages"]=function(){return self.getNodesWhereTypeIs(ns.page);};tabs["#pundit-tab-filter-"+this.name+"-named"]=function(){return self.getNodesWhereTypeIs(ns.fragments.named);};for(var t in tabs){var f=(function(id,_6fd){return function(){self.showOnlyItems(_6fd());self.hideSuggestionsTab();_4.query("#pundit-"+self.name+"-container .pundit-item-filter-list li").removeClass("pundit-selected");_4.query(id).addClass("pundit-selected");};})(t,tabs[t]);self["show_"+t.substr(1).replace(/-/g,"")]=f;_4.connect(_4.query(t)[0],"onclick",f);}beh["#pundit-"+self.name+" li.dojoDndItem span.pundit-icon-context-button"]={"onclick":function(e){var id=_4.query(e.target).parent()[0].id;var item=self.itemsDnD.getItem(id);if(item.data.rdftype.length===0){cMenu.show(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset,item.data,"semlibLiteral"+self.name);}else{cMenu.show(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset,item.data,"pundit-"+self.name);}}};beh["#pundit-"+self.name+" li.dojoDndItem"]={"onmouseover":function(e){var id=(_4.hasClass(e.target,"pundit-icon-context-button")||_4.hasClass(e.target,"pundit-trim"))?_4.query(e.target).parent()[0].id:e.target.id;var item=self.itemsDnD.getItem(id);previewer.show(item.data.value);if(tooltip_viewer.isAnnXpointer(item.data.value)||tooltip_viewer.isTempXpointer(item.data.value)){tooltip_viewer.highlightByXpointer(item.data.value);}},"onmouseout":function(e){var id=(_4.hasClass(e.target,"pundit-icon-context-button")||_4.hasClass(e.target,"pundit-trim"))?_4.query(e.target).parent()[0].id:e.target.id;var item=self.itemsDnD.getItem(id);if(tooltip_viewer.isAnnXpointer(item.data.value)||tooltip_viewer.isTempXpointer(item.data.value)){tooltip_viewer.removeHighlightByXpointer(item.data.value);}},"onclick":function(e){var _6fe=e.target;while(!_4.hasClass(_4.query(_6fe)[0],"dojoDndItem")){_6fe=_4.query(_6fe).parent()[0];}var id=_6fe.id;self.itemsDnD.selectNone();self.itemsDnD.selection[id]=1;}};beh["#pundit-"+self.name+"-container .pundit-sort-items.pundit-view-list"]={"onclick":function(e){self.setItemsLayout("pundit-view-list");}};beh["#pundit-"+self.name+"-container .pundit-sort-items.pundit-view-tile"]={"onclick":function(e){self.setItemsLayout("pundit-view-tile");}};_4.behavior.add(beh);},initContextualMenu:function(){var self=this;},itemNodeCreator:function(item,hint){var self=this,_6ff="",_700=item.label,i,node;if(typeof (item.type)==="undefined"){item={};var i=_PUNDIT.vocab.draggedItem;item.value=i.value;item.type=i.type;item.rdfData=i.rdfData;item.rdftype=i.rdftype;item.label=i.label;if(typeof (i.image)!=="undefined"){item.image=i.image;}}var b=new pundit.TriplesBucket({bucket:item.rdfData}),_701=[];for(var j=Math.min(item.rdftype.length,_PUNDIT.items.opts.itemTypesNumber);j--;){if(b.getObject(item.rdftype[j],ns.rdfs_label).length>0){_701.push(b.getObject(item.rdftype[j],ns.rdfs_label)[0]);}else{_701.push(item.rdftype[j]);}}_6ff=_701.join(", ");if(item.rdftype.length===0){_6ff="Literal";}else{if(item.rdftype[0]===ns.fragments.text){_700=item.label;}if(item.rdftype.length>_PUNDIT.items.opts.itemTypesNumber){_6ff+=", ...";}}if(hint!=="avatar"){node=document.createElement("li");_4.addClass(node,"pundit-"+item.type);_4.addClass(node,"pundit-shown");node.innerHTML="<span class=\"pundit-icon-context-button\"></span><span class=\"pundit-trim pundit-item-label\">"+_700+"</span><span class=\"pundit-item-add-button\"></span><span class=\"pundit-item-remove-button\"></span><span class=\"pundit-trim pundit-item-rdftype\" >&nbsp;("+_6ff+")</span>";}else{node=document.createElement("div");node.innerHTML=item.label;}return {node:node,data:item,type:item.type};},uriInItems:function(uri){var self=this,ret=false;self.itemsDnD.forInItems(function(item){if(item.data.value==uri){ret=true;}});return ret;},setItemsLayout:function(name){var self=this,_702=["pundit-view-list","pundit-view-tile"];_4.query("#pundit-"+self.name+"-container .pundit-sort-items").removeClass("pundit-selected");_4.query("#pundit-"+self.name+"-container .pundit-sort-items."+name).addClass("pundit-selected");for(var i=_702.length;i--;){_4.query("#pundit-"+self.name).removeClass(_702[i]);}_4.query("#pundit-"+self.name).addClass(name);},getSelectedTab:function(){var self=this;return _4.attr(_4.query("#pundit-"+self.name+"-filter-list li.pundit-selected")[0],"id");},hideSuggestionsTab:function(){_4.query("#pundit-tab-filter"+self.name+"Suggestions").addClass("pundit-hidden");},showOnlyItems:function(_703){var self=this;_4.query(".pundit-tc-dnd-container ul").removeClass("dnd_selected");_4.query("#pundit-"+self.name+"-container .pundit-item-filter-list li").removeClass("pundit-selected");this.hideAllItems();if(_703.length===0){return;}var self=this,all=self.getItemsIds(_4.query("#pundit-"+self.name+" li")),_704=self.getItemsIds(_703);for(var id in all){if(typeof (_704[id])!=="undefined"){_4.query("#"+id).removeClass("pundit-hidden");setTimeout((function(i){return function(){_4.query("#"+i).addClass("pundit-shown");};})(id),10);}}},showAllItems:function(){var self=this;_4.query(".pundit-tc-dnd-container ul").removeClass("dnd_selected");_4.query("#pundit-"+self.name+"-container .pundit-item-filter-list li").removeClass("pundit-selected");_4.query("#pundit-tab-filter"+self.name+"All").addClass("pundit-selected");_4.query("#pundit-"+self.name+" li").removeClass("pundit-hidden");setTimeout(function(){_4.query("#semlibItems li").addClass("pundit-shown");},10);},hideAllItems:function(){var self=this;_4.query("#pundit-"+self.name+" li").removeClass("pundit-shown");_4.query("#pundit-"+self.name+" li").addClass("pundit-hidden");},refreshItemsNumber:function(){var self=this,ret=0;this.itemsDnD.forInItems(function(item){if(item.data.type[0]!=="predicate"){ret++;}});_4.query("#pundit-"+self.name+"-number").html(ret);},getNodesEntities:function(){var self=this,foo=[];for(var id in self.itemsDnD.map){if(_4.indexOf(self.itemsDnD.map[id].data.rdftype,ns.fragments.text)===-1&&_4.indexOf(self.itemsDnD.map[id].data.rdftype,ns.image)===-1&&_4.indexOf(self.itemsDnD.map[id].data.rdftype,ns.fragments.image)===-1&&_4.indexOf(self.itemsDnD.map[id].data.rdftype,ns.rdf_property)===-1&&_4.indexOf(self.itemsDnD.map[id].data.rdftype,ns.page)===-1){foo.push(_4.query("#"+id)[0]);}}return foo;},getItemsWhereFieldTest:function(_705,_706){var self=this,_707,foo=[];for(var id in self.itemsDnD.map){_707=self.itemsDnD.map[id].data[_705];if(_706(_707)===true){foo.push(self.itemsDnD.map[id].data);}else{self.log("Item "+self.itemsDnD.map[id].data.value+" discarded, missing field "+_705);}}return foo;},getNodesWhereField:function(_708,_709){var self=this,foo=[];for(var id in self.itemsDnD.map){if(self.itemsDnD.map[id].data[_708]===_709){foo.push(_4.query("#"+id)[0]);}}return foo;},getNodesWhereTypeIs:function(type){var self=this,foo=[];for(var id in self.itemsDnD.map){if(_4.indexOf(self.itemsDnD.map[id].data.rdftype,type)!==-1){foo.push(_4.query("#"+id)[0]);}}return foo;},getLiterals:function(){var self=this,foo=[];for(var id in self.itemsDnD.map){var item=self.itemsDnD.map[id];if(item.data.type.length===1&&item.data.rdftype.length===0){if(_4.indexOf(item.data.type,"object")!==-1){foo.push(_4.query("#"+id)[0]);}}}return foo;},getItemsIds:function(_70a){var ids={};_70a.forEach(function(pi){ids[_4.attr(pi,"id")]=true;});return ids;},getItemFromUri:function(uri){var self=this,ret;self.itemsDnD.forInItems(function(item){if(item.data.value===uri){ret=item.data;}});return ret;},getItemsFromParentItem:function(_70b){var self=this,ret=[];self.itemsDnD.forInItems(function(item){if(item.data.isPartOf===_70b){ret.push(item.data);}});return ret;},getItemIdFromUri:function(uri){var self=this;for(var id in self.itemsDnD.map){if(self.itemsDnD.map[id].data.value===uri){return id;}}self.log("ERROR: getItemIdFromUri with wrong uri? "+uri);return null;},getItemsFromTerm:function(term,_70c,_70d){var self=this,_70e=self.getItemsWhereFieldTest("description",function(c){if(typeof (c)==="undefined"){return false;}for(var i=term.length;i--;){if(c.indexOf(term[i])===-1){return false;}}return true;});if(((typeof (_70c)==="undefined")&&(typeof (_70d)==="undefined"))){return _70e;}return self.filterItemsByRdftype(_70e,_70c,_70d);},filterItemsByRdftype:function(_70f,_710,_711){var _712=[];if(typeof (_710)==="undefined"){_710=[];}if(typeof (_711)==="undefined"){_711=[];}for(var i=_70f.length;i--;){var _713=true;for(var j=_70f[i].rdftype.length;j--;){for(var k=_710.length;k--;){if(_70f[i].rdftype[j]===_710[k]){_713=true;break;}else{_713=false;}}for(var k=_711.length;k--;){if(_70f[i].rdftype[j]===_711[k]){_713=false;break;}else{_713=true;}}if(_713===true){break;}}if(_713===true){_712.push(_70f[i]);}}return _712;},getProperties:function(_714,_715){var _716=[];this.itemsDnD.forInItems(function(item){var t=item.data.rdftype;for(var i=t.length;i--;){if(t[i]===ns.rdf_property){_716.push(item.data);break;}}});if((typeof (_714)==="undefined")||(typeof (_715)==="undefined")){return _716;}else{var _717=[];for(var i=_716.length;i--;){var _718=tripleComposer._intersection([_716[i].domain,_715]);var _719=tripleComposer._intersection([_716[i].range,_714]);if((typeof _715==="undefined")||_716[i].domain.length===0||_715.length===0||_718.length>0){if((typeof _714==="undefined")||_716[i].range.length===0||_714.length===0||_719.length>0){_717.push(_716[i]);}}}return _717;}},setItemFieldFromUri:function(uri,_71a,_71b){var self=this,id=self.getItemIdFromUri(uri),item=self.itemsDnD.map[id];item.data[_71a]=_71b;self.itemsDnD.setItem(id,item);self.itemsDnD.sync();return true;},addItem:function(item){var self=this;if(self.uriInItems(item.value)){self.log("Not adding again "+item.value.substr(0,30)+"..");return;}self.itemsDnD.insertNodes(false,[item]);_4.behavior.apply();self.refreshItemsNumber();self.fireOnItemAdded(item);self.log("Added to pundit items: "+item.value);},removeItemFromUri:function(uri){var self=this;if(!self.uriInItems(uri)){return;}var _71c=self.getItemIdFromUri(uri),item=self.getItemFromUri(uri);self.itemsDnD.delItem(_71c);_4.destroy(_71c);self.itemsDnD.sync();self.refreshItemsNumber();self.fireOnItemRemoved(item);self.log("Removed item from pundit items: "+uri);return false;},removeAllItems:function(){var self=this,_71d=[];self.itemsDnD.forInItems(function(item){var _71e=self.getItemIdFromUri(item.data.value);_71d.push(_71e);});for(var _71f=_71d.length;_71f--;){self.itemsDnD.delItem(_71d[_71f]);_4.destroy(_71d[_71f]);self.itemsDnD.sync();}self.refreshItemsNumber();self.fireOnAllItemsRemoved();self.log("Removed all item from pundit items");},createBucketForPredicate:function(d){var self=this,b=new pundit.TriplesBucket();b.addTriple(d.value,ns.items.label,d.label,"literal");b.addTriple(d.value,ns.items.altLabel,d.label,"literal");b.addTriple(d.value,ns.items.description,d.description,"literal");b.addTriple(d.value,ns.items.type,ns.rdf_property,"uri");b.addTriple(ns.rdf_property,ns.items.label,"RDF Property","literal");return b;},createBucketForVocabItem:function(d){var self=this,b=new pundit.TriplesBucket();b.addTriple(d.value,ns.items.label,d.label,"literal");b.addTriple(d.value,ns.items.altLabel,d.label,"literal");b.addTriple(d.value,ns.items.description,d.description,"literal");b.addTriple(d.value,ns.items.image,d.image,"literal");if(typeof (d.rdftype)!=="undefined"){for(var i=d.rdftype.length;i--;){b.addTriple(d.value,ns.items.type,d.rdftype[i],"uri");b.addTriple(d.rdftype[i],ns.items.label,ns.getLabelFromUri(d.rdftype[i]),"literal");}}return b;},createBucketForNamedContent:function(d){var self=this,b=new pundit.TriplesBucket();b.addTriple(d.value,ns.items.label,d.label,"literal");b.addTriple(d.value,ns.items.altLabel,d.label,"literal");b.addTriple(d.value,ns.items.description,d.description,"literal");b.addTriple(d.value,ns.items.image,d.image,"uri");b.addTriple(d.value,ns.items.pageContext,d.pageContext,"uri");b.addTriple(d.value,ns.items.isPartOf,d.isPartOf,"uri");if(typeof (d.rdftype)!=="undefined"){for(var i=d.rdftype.length;i--;){b.addTriple(d.value,ns.items.type,d.rdftype[i],"uri");b.addTriple(d.rdftype[i],ns.items.label,ns.getLabelFromUri(d.rdftype[i]),"literal");}}b.addTriple(ns.fragments.text,ns.items.label,"Text Fragment","literal");b.addTriple(ns.fragments.named,ns.items.label,"Named Content","literal");return b;},createBucketForTextFragment:function(d){var self=this,b=new pundit.TriplesBucket();b.addTriple(d.value,ns.items.label,d.label,"literal");b.addTriple(d.value,ns.items.altLabel,d.label,"literal");b.addTriple(d.value,ns.items.description,d.description,"literal");b.addTriple(d.value,ns.items.image,d.image,"uri");b.addTriple(d.value,ns.items.pageContext,d.pageContext,"uri");b.addTriple(d.value,ns.items.isPartOf,d.isPartOf,"uri");b.addTriple(d.value,ns.items.type,ns.fragments.text,"uri");b.addTriple(ns.fragments.text,ns.items.label,"Text Fragment","literal");return b;},createBucketForImageFragment:function(d){var self=this,b=new pundit.TriplesBucket();b.addTriple(d.value,ns.items.label,d.label,"literal");b.addTriple(d.value,ns.items.altLabel,d.label,"literal");b.addTriple(d.value,ns.items.description,d.description,"literal");b.addTriple(d.value,ns.items.image,d.image,"uri");b.addTriple(d.value,ns.items.pageContext,d.pageContext,"uri");b.addTriple(d.value,ns.items.isPartOf,d.isPartOf,"uri");b.addTriple(d.value,ns.items.type,ns.image,"uri");b.addTriple(ns.image,ns.items.label,"Image","literal");return b;},createBucketForImageRegionFragment:function(d){var self=this,b=new pundit.TriplesBucket();b.addTriple(d.value,ns.items.label,d.label,"literal");b.addTriple(d.value,ns.items.altLabel,d.label,"literal");b.addTriple(d.value,ns.items.description,d.description,"literal");b.addTriple(d.value,ns.items.image,d.image,"uri");b.addTriple(d.value,ns.items.parentItemXP,d.parentItemXP,"uri");b.addTriple(d.value,ns.items.pageContext,d.pageContext,"uri");b.addTriple(d.value,ns.items.isPartOf,d.isPartOf,"uri");b.addTriple(d.value,ns.items.type,ns.fragments.image,"uri");b.addTriple(ns.fragments.image,ns.items.label,"Image Fragment","literal");b.addTriple(d.value,ns.items.selector,d.selector,"uri");for(var i=d.selectors.length;i--;){var _720=ns.selectorBaseUri+d.selectors[i].type+"/"+self.crypto.hex_md5(d.image+_4.toJson(d.selectors[i]));b.addTriple(d.value,ns.items.selector,_720,"uri");b.addTriple(_720,ns.items.type,ns.selectors[d.selectors[i].type].value,"uri");b.addTriple(ns.selectors[d.selectors[i].type].value,ns.items.label,ns.selectors[d.selectors[i].type].label,"literal");b.addTriple(ns.selectors[d.selectors[i].type].value,ns.items.description,ns.selectors[d.selectors[i].type].description,"literal");b.addTriple(_720,ns.rdf_value,_4.toJson(d.selectors[i]),"literal");}return b;},createBucketForItem:function(d){var self=this,b=new pundit.TriplesBucket();b.addTriple(d.value,ns.items.label,d.label,"literal");b.addTriple(d.value,ns.items.altLabel,d.altLabel,"literal");b.addTriple(d.value,ns.items.description,d.description,"literal");b.addTriple(d.value,ns.items.image,d.image,"literal");for(var i=d.rdftype.length;i--;){b.addTriple(d.value,ns.items.type,d.rdftype[i],"uri");b.addTriple(d.rdftype[i],ns.items.label,ns.getLabelFromUri(d.rdftype[i]),"literal");}b.addTriple(d.value,ns.items.prefLabel,d.label,"literal");return b;},createBucketForPage:function(d){var self=this,b=new pundit.TriplesBucket();b.addTriple(d.value,ns.items.label,d.label,"literal");b.addTriple(d.value,ns.items.altLabel,d.altLabel,"literal");b.addTriple(d.value,ns.items.description,d.description,"literal");for(var i=d.rdftype.length;i--;){b.addTriple(d.value,ns.items.type,d.rdftype[i],"uri");b.addTriple(d.rdftype[i],ns.items.label,ns.getLabelFromUri(d.rdftype[i]),"literal");}b.addTriple(d.value,ns.items.prefLabel,d.label,"literal");return b;},refreshItems:function(){var self=this,t=self.getSelectedTab();self["show_"+t.replace(/-/g,"")]();}});}if(!_4._hasResource["pundit.MyItems"]){_4._hasResource["pundit.MyItems"]=true;_4.provide("pundit.MyItems");_4.declare("pundit.MyItems",pundit.Items,{constructor:function(){var self=this;self.name="my-items";self.init(self.name);self.initContextualMenu();self.newAddedItems=[];self.createCallback(["myItemAdded"]);self.loadJobId=_PUNDIT.init.waitBeforeInit();self.readJobId=null;self.writeJobId=null;self.store=new pundit.RemoteStorageHandler({debug:self.opts.debug});self.store.onStoreRead(function(_721){if(_721.length===0){self.log("Perfectly virgin favorites: initializing");self.resetFavoriteItems();_721={value:[]};}tooltip_viewer.tempXpointers=[];for(var i=_721.value.length;i--;){var item=_721.value[i];if(!tooltip_viewer.isTempXpointer(item.value)&&(item.rdftype.indexOf(ns.fragments.text)!==-1||item.rdftype[0]===ns.image)&&(tooltip_viewer.contentURIs.indexOf(item.isPartOf)!==-1)){tooltip_viewer.tempXpointers.push(item.value);}if(!self.uriInItems(item.value)){previewer.buildPreviewForItem(item);item.favorite=true;self.addItem(item);}}_4.behavior.apply();if(self.loadJobId){_PUNDIT.init.doneBeforeInit(self.loadJobId);self.loadJobId=null;}_PUNDIT.loadingBox.setJobOk(self.readJobId);});self.loadMyItems();self.store.onStoreError(function(){console.log("TODO: store is not available");if(self.loadJobId){_PUNDIT.init.doneBeforeInit(self.loadJobId);self.loadJobId=null;}});_PUNDIT.init.onInitDone(function(){tooltip_viewer.onConsolidate(function(){setTimeout(function(){self.zoomURLXPointer();},500);});self.onItemRemoved(function(){self.saveFavoriteItems();});self.onAllItemsRemoved(function(){self.resetFavoriteItems();});self.onItemAdded(function(){self.saveFavoriteItems();});});},addItem:function(item,_722){this.inherited(arguments);if(_722&&!this.isMyItemTabVisible()){var self=this;self.newAddedItems.push(item.value);self.fireOnMyItemAdded(self.newAddedItems);}},isFavoriteFromUri:function(uri){var self=this,ret=false;self.itemsDnD.forInItems(function(item){if(item.data.value===uri&&item.data.favorite===true){ret=true;}});return ret;},resetFavoriteItems:function(){var self=this;self.store.save("favorites",[]);},saveFavoriteItems:function(){var self=this,_723=[];self.itemsDnD.forInItems(function(item){_723.push(item.data);});self.store.save("favorites",_723);},loadMyItems:function(){var self=this;self.readJobId=_PUNDIT.loadingBox.addJob("Reading your items");self.store.read("favorites");},initContextualMenu:function(){var self=this;this.inherited(arguments);cMenu.addAction({type:["pundit-"+self.name],name:"removeSemlib"+self.name+"Item",label:"Remove this item",showIf:function(item){return true;},onclick:function(item){self.removeItemFromUri(item.value);tooltip_viewer.removeTempXpointer(item.value);tooltip_viewer.consolidate();_PUNDIT.ga.track("cmenu","click","myitems-remove-from-myitems");return true;}});cMenu.addAction({type:["pundit-"+self.name],name:"openSemlib"+self.name+"WebPage",label:"Show in origin page",showIf:function(item){var _724=_PUNDIT.tripleComposer.getSafePageContext();if(_724.indexOf("#xpointer")!==-1){_724=_724.substring(0,_724.indexOf("#"));}if((typeof item!=="undefined")&&(typeof tooltip_viewer.xpointersAnnotationsId[item.value]==="undefined")&&((_4.indexOf(item.rdftype,ns.fragments.text)!==-1)||(_4.indexOf(item.rdftype,ns.image)!==-1))){return !tooltip_viewer.xpointersClasses[item.value];}return false;},onclick:function(item){var _725=item.value.split("#")[1],uri=item.pageContext+"#"+_725;window.open(uri,"SemLibOpenedWebPage");self.log("Opened a new window to URL "+uri);_PUNDIT.ga.track("cmenu","click","myitems-show-in-origin-page");return true;}});cMenu.addAction({type:["pundit-"+self.name],name:"open"+self.name+"ResourceItemWebPage",label:"Open Web page",showIf:function(item){if(_PUNDIT.items.isTerm(item)){return true;}else{return false;}},onclick:function(item){window.open(item.value,"SemLibOpenedWebPage");_PUNDIT.ga.track("cmenu","click","myitems-open-web-page");return true;}});cMenu.addAction({type:["pundit-"+self.name],name:"removeSemlibAllItems",label:"Empty MyItems",showIf:function(item){return true;},onclick:function(item){self.removeAllItems();tooltip_viewer.resetTempXpointers();tooltip_viewer.refreshAnnotations();_PUNDIT.ga.track("cmenu","click","myitems-empty-myitems");return true;}});},zoomURLXPointer:function(){var self=this;if(self.loaded){return;}var _726=decodeURIComponent(_PUNDIT.tripleComposer.getSafePageContext());if(_726.indexOf("#")===-1){return;}var _727=_726.split("#")[1];if(_727.indexOf("@about=")===-1){return;}var _728;semlibMyItems.itemsDnD.forInItems(function(item){if(item.data.value.indexOf("#")!==-1&&item.data.value.split("#")[1]===_727){_728=item.data.value;}});if(typeof (_728)!=="undefined"){semlibItems.itemsDnD.forInItems(function(item){if(item.data.value.indexOf("#")!==-1&&item.data.value.split("#")[1]===_727){_728=item.data.value;}});}if(typeof (_728)!=="undefined"){tooltip_viewer.zoomOnXpointer(_728);self.loaded=true;}else{var path=new RegExp("@about='.+?'");if(path.test(_727)){tooltip_viewer.zoomOnXpointer(_728);}self.loaded=true;}},isMyItemTabVisible:function(){return (_4.hasClass("pundit-gui","pundit-shown")&&_4.hasClass("pundit-tab-my-items","pundit-selected"));},emptyNewMyItems:function(){var self=this;self.newAddedItems=[];}});}if(!_4._hasResource["pundit.PageItems"]){_4._hasResource["pundit.PageItems"]=true;_4.provide("pundit.PageItems");_4.declare("pundit.PageItems",pundit.Items,{constructor:function(){var self=this;self.name="page-items";self.init(self.name);self.initBehaviors(self.name);self.initContextualMenu();},initContextualMenu:function(){var self=this;cMenu.addAction({type:["pundit-page-items"],name:"pageItemsToMyItems",label:"Add to My Items",showIf:function(item){return !semlibMyItems.uriInItems(item.value);},onclick:function(item){_PUNDIT.ga.track("cmenu","click","page-item-add-to-myitems");semlibMyItems.addItem(item,true);return true;}});cMenu.addAction({type:["pundit-page-items"],name:"removeVocabFromMyItems",label:"Remove from My Items",showIf:function(item){return semlibMyItems.uriInItems(item.value);},onclick:function(item){_PUNDIT.ga.track("cmenu","click","page-item-remove-from-myitems");semlibMyItems.removeItemFromUri(item.value);return true;}});cMenu.addAction({type:["pundit-"+self.name],name:"open"+self.name+"ResourceItemWebPage",label:"Open Web page",showIf:function(item){if(_PUNDIT.items.isTerm(item)){return true;}else{return false;}},onclick:function(item){_PUNDIT.ga.track("cmenu","click","page-item-open-web-page");window.open(item.value,"SemLibOpenedWebPage");return true;}});}});}if(!_4._hasResource["pundit.ItemContainerManager"]){_4._hasResource["pundit.ItemContainerManager"]=true;_4.provide("pundit.ItemContainerManager");_4.declare("pundit.ItemContainerManager",pundit.BaseComponent,{opts:{itemTypesNumber:3},constructor:function(_729){var self=this;self.itemContainers={};self.initItemContainers();self.log("Items Manager up and running");},initItemContainers:function(){var self=this;semlibMyItems=new pundit.MyItems();_PUNDIT.myItems=semlibMyItems;self.itemContainers["MyItems"]=semlibMyItems;self.itemContainers["MyItems"].onItemAdded(function(){self.refreshAll();});self.itemContainers["MyItems"].onItemRemoved(function(){self.refreshAll();});semlibItems=new pundit.PageItems();_PUNDIT.pageItems=semlibItems;self.itemContainers["PageItems"]=semlibItems;self.itemContainers["PageItems"].onItemAdded(function(){self.refreshAll();});self.itemContainers["PageItems"].onItemRemoved(function(){self.refreshAll();});},refreshAll:function(){var self=this;for(var i in self.itemContainers){self.itemContainers[i].refreshItems();}},refreshItemsNumber:function(){var self=this;for(var i in self.itemContainers){self.itemContainers[i].refreshItemsNumber();}},getItemByUri:function(uri){var self=this;for(var i in self.itemContainers){var item=self.itemContainers[i].getItemFromUri(uri);if(typeof item!=="undefined"){return item;}}return undefined;},getItemsFromParentItem:function(_72a){var self=this,ret=[];for(var i in self.itemContainers){var p=self.itemContainers[i].getItemsFromParentItem(_72a);ret=ret.concat(p);}return ret;},getItemsByType:function(type){var self=this,_72b=[],item;for(var i in self.itemContainers){for(var id in self.itemContainers[i].itemsDnD.map){if(_4.indexOf(self.itemContainers[i].itemsDnD.map[id].data.rdftype,type)!==-1){item=self.itemContainers[i].itemsDnD.map[id].data;if(!_4.indexOf(_72b,item)){_72b.push(item);}}}}return _72b;},hideAllItems:function(){var self=this;for(var i in self.itemContainers){self.itemContainers[i].hideAllItems();}},showAllItems:function(){var self=this;for(var i in self.itemContainers){self.itemContainers[i].showAllItems();}},getItemsWhereFieldTest:function(){var self=this,ret=[];for(var i in self.itemContainers){ret=ret.concat(self.itemContainers[i].getItemsWhereFieldTest.apply(self.itemContainers[i],arguments));}return ret;},isTerm:function(item){if(_4.indexOf(item.rdftype,ns.fragments.text)!==-1||_4.indexOf(item.rdftype,ns.fragments.image)!==-1||_4.indexOf(item.rdftype,ns.image)!==-1){return false;}else{return true;}}});}if(!_4._hasResource["pundit.Literals"]){_4._hasResource["pundit.Literals"]=true;_4.provide("pundit.Literals");_4.declare("pundit.Literals",pundit.BaseComponent,{constructor:function(_72c){},createLiteralItem:function(_72d){var item={},_72e=_72d;if(typeof (_72d)!=="undefined"){if(_72e.length>20){_72e=_72d.substring(0,20)+"...";}item.type=["object"];item.value=_72d;item.rdftype=[ns.rdfs_literal];item.rdfData=[];item.label=_72e;previewer.buildPreviewForItem(item);return item;}}});}if(!_4._hasResource["pundit.DbpediaSpotlight"]){_4._hasResource["pundit.DbpediaSpotlight"]=true;_4.provide("pundit.DbpediaSpotlight");_4.declare("pundit.DbpediaSpotlight",pundit.BaseComponent,{opts:{"confidence":0.15,"support":20},constructor:function(_72f){var self=this;self.createCallback(["getTagsFromSpotlight","getInfoFromDBpedia","error","textLookup","lookupError"]);self.log("DBPedia Spotlight up and running");},getEntities:function(lang,text,_730,_731){var self=this;self.getTagsInfoFromDbpediaSpotlight(lang,text,_730,_731);},getTagsInfoFromDbpediaSpotlight:function(lang,text,_732,_733){var self=this;self.reqs=[];var args={url:ns.annotationServerVocabProxy+"?url="+encodeURIComponent(ns.dbpediaSpotlightAnnotate+encodeURIComponent(text)+"&confidence="+self.opts.confidence+"&support="+self.opts.support),handleAs:"json",headers:{"Accept":"application/json"},failOk:true,load:function(g){self.tags=self.getTagItems(g);self.requests={};if(self.tags.length===0){_733();}for(var i=self.tags.length;i--;){if(typeof self.requests[self.tags[i].uri]==="undefined"){self.requests[self.tags[i].uri]="pending",self.reqs.push(self.getInfoFromDBpedia(self.tags[i].uri,function(uri,item){self.requests[uri]="completed";for(var j=self.tags.length;j--;){if(self.tags[j].uri===uri){self.tags[j]["pundit-items"]=[item];}}if(self.requestsCompleted()){_732(self.tags);}},function(uri){self.requests[uri]="error";for(var j=self.tags.length-1;j>=0;j--){if(self.tags[j].uri===uri){self.tags.splice(j,1);}}if(self.requestsCompleted()){_732(self.tags);}}));}}},error:function(_734){if(_734.dojoType==="cancel"){for(var i=self.reqs.length;i--;){self.reqs[i].cancel();}return;}self.log(_734);_733();}};return requester.xGet(args);},requestsCompleted:function(){var self=this;for(var i in self.requests){if(self.requests[i]==="pending"){return false;}}return true;},getTagItems:function(_735){var _736=[];if(typeof (_735.Resources)!=="undefined"){for(var i=_735.Resources.length-1;i>=0;i--){var _737=_735.Resources[i]["@types"].replace(/Schema:/g,"http://schema.org/").replace(/DBpedia:/g,"http://dbpedia.org/ontology/").replace(/Freebase\:/g,"http://www.freebase.com/schema").split(",");if(_737[0]===""){_737[0]=ns.rdfs_resource;}_736.push({uri:_735.Resources[i]["@URI"],match:_735.Resources[i]["@surfaceForm"],length:_735.Resources[i]["@surfaceForm"].length,offset:_735.Resources[i]["@offset"]});}}return _736;},getInfoFromDBpedia:function(_738,f,fErr){var self=this,_739="PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>";_739+="SELECT ?comment, ?depiction, ?label, ?type ";_739+="WHERE {<"+_738+"> rdfs:comment ?comment. ";_739+="<"+_738+"> rdfs:label ?label. ";_739+="OPTIONAL { <"+_738+"> rdf:type ?type. }";_739+="OPTIONAL { <"+_738+"><http://dbpedia.org/ontology/thumbnail> ?depiction. }";_739+="FILTER ( lang(?label) = \"en\") ";_739+="FILTER ( lang(?comment) = \"en\")} ";var args={url:ns.annotationServerVocabProxy+"?url="+encodeURIComponent("http://dbpedia.org/sparql?query="+encodeURIComponent(_739)+"&output=json"),handleAs:"json",headers:{"Accept":"application/sparql-results+json"},failOk:true,id:_738,load:function(r){var item={},_73a=[],_73b=r.results.bindings,i=_73b[0];if(typeof i!=="undefined"){item.description=i.comment.value;item.label=i.label.value;if(typeof (i.depiction)!=="undefined"){item.image=i.depiction.value;}for(var j=_73b.length;j--;){if(typeof _73b[j].type!=="undefined"){_73a.push(_73b[j].type.value);}}if(_73a.length===0){_73a=[ns.rdfs_resource];}item.rdftype=_73a;item.value=_738;item.type=["subject"];f(_738,item);}else{fErr(_738);}},error:function(_73c){if(_73c.dojoType==="cancel"){return;}console.log("Dbpediaspotlight request error:"+_73c);self.log(_73c);fErr(_738);}};return requester.xGet(args);},getYouTubeVideoInfoById:function(_73d){_4.io.script.get({callbackParamName:"callback",url:"http://gdata.youtube.com/feeds/api/videos/"+_73d+"?alt=json",load:function(r){console.log(r);},error:function(_73e,_73f){self.log("getSuggestionsForTerm got an error :(");self.setLoading(false);}});}});}if(!_4._hasResource["pundit.DataTxt"]){_4._hasResource["pundit.DataTxt"]=true;_4.provide("pundit.DataTxt");_4.declare("pundit.DataTxt",pundit.BaseComponent,{constructor:function(_740){var self=this;self.apiRoot="http://spaziodati.eu/datatxt/v3/";self.appId="75293d0d";self.appKey="1866e488198ecbb656e7df03d56aba7f";self.rho=0.2;self.dbpedia=true;self.lang="en";self.callback="jsonp";self.createCallback(["getTagsFromSpotlight","getInfoFromDBpedia","error","textLookup","lookupError"]);self.log("DataTXT up and running");},getEntities:function(_741,text,_742,_743){var self=this;self.getEntitiesFromDataTxt(_741,text,_742,_743);},getEntitiesFromDataTxt:function(_744,text,_745,_746){var self=this;self.reqs=[];if(typeof (_744)==="undefined"||_744===""){_744=self.lang;}_4.io.script.get({url:self.apiRoot+"?app_id="+self.appId+"&app_key="+self.appKey+"&rho="+self.rho+"&dbpedia="+self.dbpedia+"&lang="+_744+"&text="+text,callbackParamName:"_callback",load:function(g){self.tags=self.getTagItems(g);if(self.tags.length===0){_745(self.tags);}self.requests={};for(var i=self.tags.length;i--;){if(typeof self.requests[self.tags[i].uri]==="undefined"){self.requests[self.tags[i].uri]="pending",self.reqs.push(self.getInfoFromDBpedia(self.tags[i].uri,function(uri,item){self.requests[uri]="completed";for(var j=self.tags.length;j--;){if(self.tags[j].uri===uri){self.tags[j]["pundit-items"]=[item];}}if(self.requestsCompleted()){_745(self.tags);}},function(uri){self.requests[uri]="error";for(var j=self.tags.length-1;j>=0;j--){if(self.tags[j].uri===uri){self.tags.splice(j,1);}}if(self.requestsCompleted()){_745(self.tags);}},_744));}}},error:function(_747){if(_747.dojoType==="cancel"){for(var i=self.reqs.length;i--;){self.reqs[i].cancel();}return;}self.log(_747);_746();}});},requestsCompleted:function(){var self=this;for(var i in self.requests){if(self.requests[i]==="pending"){return false;}}return true;},getTagItems:function(_748){var _749=[];if(typeof (_748.annotations)!=="undefined"){for(var i=_748.annotations.length-1;i>=0;i--){_749.push({uri:_748.annotations[i].ref[1].dbpedia,match:_748.annotations[i].spot,length:_748.annotations[i].end-_748.annotations[i].start,offset:_748.annotations[i].start});}}return _749;},getInfoFromDBpedia:function(_74a,f,fErr,_74b){var self=this;var _74c="";var _74d="";if(_74b==="en"){_74c+="PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>";_74c+="SELECT ?comment, ?depiction, ?label, ?type ";_74c+="WHERE {<"+_74a+"> rdfs:comment ?comment. ";_74c+="<"+_74a+"> rdfs:label ?label. ";_74c+="OPTIONAL { <"+_74a+"> rdf:type ?type. }";_74c+="OPTIONAL { <"+_74a+"><http://dbpedia.org/ontology/thumbnail> ?depiction. }";_74c+="FILTER ( lang(?label) = \"en\") ";_74c+="FILTER ( lang(?comment) = \"en\")} ";_74d="http://dbpedia.org/sparql";}else{if(_74b==="it"){_74c+="PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>";_74c+="SELECT ?comment, ?depiction, ?label, ?type ";_74c+="WHERE {<"+_74a+"> rdfs:comment ?comment. ";_74c+="<"+_74a+"> rdfs:label ?label. ";_74c+="OPTIONAL { <"+_74a+"> rdf:type ?type. }";_74c+="OPTIONAL { <"+_74a+"><http://dbpedia.org/ontology/thumbnail> ?depiction. }";_74c+="FILTER ( lang(?label) = \"it\") ";_74c+="FILTER ( lang(?comment) = \"it\")} ";_74d="http://it.dbpedia.org/sparql";}}var args={url:ns.annotationServerVocabProxy+"?url="+encodeURIComponent(_74d+"?query="+encodeURIComponent(_74c)+"&output=json"),handleAs:"json",headers:{"Accept":"application/sparql-results+json"},failOk:true,id:_74a,load:function(r){var item={},_74e=[],_74f=r.results.bindings,i=_74f[0];if(typeof i!=="undefined"){item.description=i.comment.value;item.label=i.label.value;if(typeof (i.depiction)!=="undefined"){item.image=i.depiction.value;}for(var j=_74f.length;j--;){if(typeof _74f[j].type!=="undefined"){_74e.push(_74f[j].type.value);}}if(_74e.length===0){_74e=[ns.rdfs_resource];}item.rdftype=_74e;item.value=_74a;item.type=["subject"];f(_74a,item);}else{fErr(_74a);}},error:function(_750){if(_750.dojoType==="cancel"){return;}console.log("Dbpediaspotlight request error:"+_750);self.log(_750);fErr(_74a);}};return requester.xGet(args);}});}if(!_4._hasResource["pundit.Civet"]){_4._hasResource["pundit.Civet"]=true;_4.provide("pundit.Civet");_4.declare("pundit.Civet",pundit.BaseComponent,{constructor:function(_751){var self=this;self.apiRoot="http://civet.knowledgehives.com/synonimy/searchKeywords";self.callback="jsonp";self.lang="en";self.createCallback(["getInfoFromDBpedia","error","textLookup","lookupError"]);self.log("DataTXT up and running");},getEntities:function(_752,text,_753,_754){var self=this;self.getEntitiesFromCivet(_752,text,_753,_754);},getEntitiesFromCivet:function(_755,text,_756,_757){var self=this;self.reqs=[];if(typeof (_755)==="undefined"||_755===""){_755=self.lang;}var _758=_4.xhrPost({url:self.apiRoot,postData:"url=&text="+encodeURI(text)+"&override=true&url=&title=",handleAs:"json",load:function(g){self.tags=self.getTagItems(g);if(self.tags.length===0){_756(self.tags);}self.requests={};for(var i=self.tags.length;i--;){if(typeof self.requests[self.tags[i].uri]==="undefined"){self.requests[self.tags[i].uri]="pending",self.reqs.push(self.getInfoFromDBpedia(self.tags[i].uri,self.tags[i].match,function(uri,item){self.requests[uri]="completed";for(var j=self.tags.length;j--;){if(self.tags[j].uri===uri){self.tags[j]["pundit-items"]=[item];}}if(self.requestsCompleted()){_756(self.tags);}},function(uri){self.requests[uri]="error";for(var j=self.tags.length-1;j>=0;j--){if(self.tags[j].uri===uri){self.tags.splice(j,1);}}if(self.requestsCompleted()){_756(self.tags);}},_755));}}},error:function(_759){if(_759.dojoType==="cancel"){for(var i=self.reqs.length;i--;){self.reqs[i].cancel();}return;}self.log(_759);_757();}});},requestsCompleted:function(){var self=this;for(var i in self.requests){if(self.requests[i]==="pending"){return false;}}return true;},getTagItems:function(_75a){var self=this;var _75b=[];if(typeof (_75a.keyphrases)!=="undefined"){for(var i=_75a.keyphrases.length-1;i>=0;i--){var offs=self.getOffsets(_75a.keyphrases[i]);var url=self.getBestRatedMeaningURL(_75a.keyphrases[i]);var _75c=_75a.keyphrases[i].label;for(var k=0;k<offs.length;k++){_75b.push({uri:url,match:_75c,length:offs[k].end-offs[k].start,offset:offs[k].start});}}}if(typeof (_75a.keywords)!=="undefined"){for(var i=_75a.keywords.length-1;i>=0;i--){var offs=self.getOffsets(_75a.keywords[i]);var url=self.getBestRatedMeaningURL(_75a.keywords[i]);var _75c=_75a.keywords[i].label;for(var k=0;k<offs.length;k++){_75b.push({uri:url,match:_75c,length:offs[k].end-offs[k].start,offset:offs[k].start});}}}return _75b;},getBestRatedMeaningURL:function(_75d){var _75e;var _75f;for(var i=0;i<_75d.meanings.length;i++){if(typeof (_75e)==="undefined"||_75d.meanings[i].weight>_75e){_75e=_75d.meanings[i].weight;_75f=_75d.meanings[i].uri;}}return _75f;},getOffsets:function(_760){var offs=_760.offsets.split(" ");var _761=[];for(var i=0;i<offs.length;i=i+2){var res={};res["start"]=offs[i];res["end"]=offs[i+1];_761.push(res);}return _761;},getInfoFromDBpedia:function(_762,_763,f,fErr,_764){var self=this;var _765="";var _766="";if(_764==="en"){_765+="PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>";_765+="SELECT ?comment, ?depiction, ?label, ?type ";_765+="WHERE {<"+_762+"> rdfs:comment ?comment. ";_765+="<"+_762+"> rdfs:label ?label. ";_765+="OPTIONAL { <"+_762+"> rdf:type ?type. }";_765+="OPTIONAL { <"+_762+"><http://dbpedia.org/ontology/thumbnail> ?depiction. }";_765+="FILTER ( lang(?label) = \"en\") ";_765+="FILTER ( lang(?comment) = \"en\")} ";_766="http://dbpedia.org/sparql";}else{if(_764==="it"){_765+="PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>";_765+="SELECT ?comment, ?depiction, ?label, ?type ";_765+="WHERE {<"+_762+"> rdfs:comment ?comment. ";_765+="<"+_762+"> rdfs:label ?label. ";_765+="OPTIONAL { <"+_762+"> rdf:type ?type. }";_765+="OPTIONAL { <"+_762+"><http://dbpedia.org/ontology/thumbnail> ?depiction. }";_765+="FILTER ( lang(?label) = \"it\") ";_765+="FILTER ( lang(?comment) = \"it\")} ";_766="http://it.dbpedia.org/sparql";}}var args={url:ns.annotationServerVocabProxy+"?url="+encodeURIComponent(_766+"?query="+encodeURIComponent(_765)+"&output=json"),handleAs:"json",headers:{"Accept":"application/sparql-results+json"},failOk:true,id:_762,load:function(r){var item={},_767=[],_768=r.results.bindings,i=_768[0];if(typeof i!=="undefined"){item.description=i.comment.value;item.label=i.label.value;if(typeof (i.depiction)!=="undefined"){item.image=i.depiction.value;}for(var j=_768.length;j--;){if(typeof _768[j].type!=="undefined"){_767.push(_768[j].type.value);}}if(_767.length===0){_767=[ns.rdfs_resource];}item.rdftype=_767;item.value=_762;item.type=["subject"];f(_762,item);}else{var item={},_767=[];item.description=_763;item.label=_763;item.rdftype=[ns.rdfs_resource];item.value=_762;item.type=["subject"];f(_762,item);}},error:function(_769){if(_769.dojoType==="cancel"){return;}console.log("Civet request error:"+_769);self.log(_769);fErr(_762);}};return requester.xGet(args);}});}if(!_4._hasResource["pundit.ResourcesPanel"]){_4._hasResource["pundit.ResourcesPanel"]=true;_4.provide("pundit.ResourcesPanel");_4.declare("pundit.ResourcesPanel",pundit.BasePanel,{constructor:function(_76a){var self=this;self._lastKeyword="";self.previewTimer=null;self.keywordMinimumLength=3;self.keyInputTimerLength=500;self.maxShownItems=_76a.maxShownItems||4;self.suggestionPanels=_76a.suggestionPanels||{myitems:{label:"My Items",expanded:true},pageitems:{label:"Page Items"},properties:{label:"Properties",expanded:true}};self.namedEntitiesSources=_76a.namedEntitiesSources||{wikidataItemsSelector:{label:"Wikidata Items"},wikidataPropertiesSelector:{label:"Wikidata Properties"},};self.panels={};for(var _76b in self.suggestionPanels){self.panels[_76b]=self.suggestionPanels[_76b];}for(var _76b in self.namedEntitiesSources){self.panels[_76b]=self.namedEntitiesSources[_76b];}self.searchType=_76a.searchType||"filter";if(_PUNDIT.config.vocabularies.length!==0){_PUNDIT["vocab"].onVocabsLoaded(function(){self.log("Vocab loaded. Init HTML Resource panel");for(var i in _PUNDIT.vocab.vocabs){self.suggestionPanels[i]={label:_PUNDIT.vocab.vocabs[i].label};self.panels[i]=i;}self.initHTML();self.initDnD();self.initContextMenu();self.initBehaviors();});}else{self.initHTML();self.initDnD();self.initContextMenu();self.initBehaviors();}self.createCallback("itemAdded");self.log("Resource Panel up and running");_4.behavior.apply();},initHTML:function(){var self=this;self.log("Init HTML Resource Panel");self.log("Resource Panel Contructor");self.expandedClass;var c="              <div class=\"pundit-rp-literal-panel pundit-hidden\">";c+="                  <div class=\"pundit-rp-container-literal\">";c+="                      <span class=\"class=\"pundit-pane-title\" pundit-rp-subtitle\">Insert text:</span>";c+="                      <section contenteditable=\"true\" class=\"pundit-rp-literal-text pundit-stop-wheel-propagation\" ></section>";c+="                      <div class=\"pundit-rp-literal-panel-buttons\">";c+="                          <button class=\"pundit-rp-panel-close\" value=\"Close\">Close</button><button class=\"pundit-rp-literal-panel-done\" disabled=\"true\">Done</button>";c+="                      </div>";c+="                  </div>";c+="              </div>";c+="              <div class=\"pundit-rp-date-panel pundit-hidden\">";c+="                  <div class=\"puntid-rp-container-date\">";c+="                      <span class=\"class=\"pundit-pane-title\" pundit-rp-subtitle\">Date in \"YYYY-MM-DD\" format: </span><br/>";c+="                      <input type=\"text\" class=\"pundit-rp-date-input\" required pattern=\"[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-9])|(?:(?!02)(?:0[1-9]|1[0-2])-(?:30))|(?:(?:0[13578]|1[02])-31))\"/>";c+="                      <div class=\"pundit-rp-date-validation\"></div>";c+="                      <div class=\"pundit-rp-panel-buttons\">";c+="                          <button class=\"pundit-rp-panel-close\" value=\"Close\">Close</button><button class=\"pundit-rp-date-panel-done\" disabled=\"true\">Done</button>";c+="                      </div>";c+="                  </div>";c+="              </div>";c+="              <div class=\"pundit-rp-search-panel\">";c+="                  <div class=\"pundit-rp-container-search\">";c+="                      <span class=\"pundit-pane-title pundit-rp-subtitle\">Search:</span>";c+="                      <div>";c+="                          <input class=\"pundit-rp-search-input pundit-dialog-input\" row=\"1\" placeholder=\"...type here\" value=\"\" type=\"text\"/>";c+="                          &nbsp; <button class=\"pundit-rp-add-literal\" >Literal</button>";c+="                          <button class=\"pundit-rp-add-date\">Date</button>";if(_PUNDIT.config.isModuleActive("pundit.ng.EntityEditorHelper")&&self.opts.field!=="predicate"){c+="                          <button class=\"pundit-rp-korbo\">Korbo</button>";}c+="                      </div>";c+="                      <div class=\"pundit-rp-suggestions\"></div>";c+="                  </div>";c+="              </div>";self.addHTMLContent(c);for(var i in self.suggestionPanels){self.expandedClass="";if(self.suggestionPanels[i].expanded){self.expandedClass="pundit-expanded";}c="          <div id=\""+self._id+"-container-suggestions-"+i+"\" class=\"pundit-rp-container-suggestions pundit-suggestions fillheight "+self.expandedClass+"\">";c+="              <div><span class=\"pundit-icon-collapse pundit-fp-collapsed\"></span><span class=\"pundit-fp-source-name\">"+self.suggestionPanels[i].label+"</span><span class=\"pundit-items-number\">(0)</span></div>";c+="              <ul id=\""+self._id+"-suggestions-list-"+i+"\" class=\"pundit-rp-suggestions-list pundit-view-list pundit-items list pundit-item-add-button pundit-stop-wheel-propagation\"></ul>";c+="          </div>";_4.query("#"+self._id+" .pundit-rp-suggestions").append(c);}for(var i in self.namedEntitiesSources){self.expandedClass="";if(self.namedEntitiesSources[i].expanded){self.expandedClass="pundit-expanded";}c="          <div id=\""+self._id+"-container-suggestions-"+i+"\" class=\"pundit-rp-container-suggestions pundit-items-container pundit-lookup pundit-visible fillheight  "+self.expandedClass+"\">";c+="              <div><span class=\"pundit-icon-collapse pundit-fp-collapsed\"></span><span class=\"pundit-fp-source-name\">"+self.namedEntitiesSources[i].label+"</span><span class=\"pundit-items-number\">(0)</span></div>";c+="              <ul id=\""+self._id+"-suggestions-list-"+i+"\" class=\"pundit-rp-suggestions-list pundit-view-list pundit-items list pundit-item-add-button pundit-stop-wheel-propagation\"></ul>";c+="              <span class=\"pundit-error-message\">"+self.namedEntitiesSources[i].label+" is not responding</span>";c+="          </div>";_4.query("#"+self._id+" .pundit-rp-suggestions").append(c);}},initDnD:function(){var self=this;for(var i in self.suggestionPanels){self["itemsDnD"+i]=new _4.dnd.Source(self._id+"-suggestions-list-"+i,{copyOnly:true,creator:semlibItems.itemNodeCreator,checkAcceptance:function(){return false;}});}for(var i in self.namedEntitiesSources){self["itemsDnD"+i]=new _4.dnd.Source(self._id+"-suggestions-list-"+i,{copyOnly:true,creator:semlibItems.itemNodeCreator,checkAcceptance:function(){return false;}});}},performSearch:function(_76c){var self=this;_PUNDIT.ga.track("search","resources-panel-search","term="+_76c);if(_76c!==self._lastKeyword){self._lastKeyword=_76c;if(self.searchType==="filter"){self.filterItemsByTerm(_76c);}else{if(self.searchType==="search"){self.searchItemsByTerm(_76c);}}self.searchNamedEntities(_76c);}},initBehaviors:function(){var self=this;if(_PUNDIT.config.isModuleActive("pundit.ng.EntityEditorHelper")&&self.opts.field!=="predicate"){_4.connect(_4.query("#"+self._id+" .pundit-rp-korbo")[0],"onclick",function(e){var _76d=_4.query("#"+self._id+" .pundit-rp-search-input")[0].value;_PUNDIT.ngEE.openEE(_76d,self.opts.field);});}_4.connect(_4.query("body")[0],(!_4.isMozilla?"onmousewheel":"DOMMouseScroll"),function(e){if(e.target.id==="pundit-tc-triples-container"&&self.inShowing){self.hide();_4.stopEvent(e);}});_4.connect(_4.query("#"+self._id+" .pundit-rp-search-input")[0],"onkeyup",function(e){clearTimeout(self.keyInputTimer);var _76e=_4.query("#"+self._id+" .pundit-rp-search-input")[0].value;self.keyInputTimer=setTimeout(function(){self.performSearch(_76e);},self.keyInputTimerLength);});_4.connect(_4.query("#"+self._id+" .pundit-rp-add-literal")[0],"onclick",function(e){_PUNDIT.ga.track("gui-button","click","resources-panel-add-literal");self.showLiteralPanel(true,false);});_4.connect(_4.query("#"+self._id+" .pundit-rp-add-date")[0],"onclick",function(e){_PUNDIT.ga.track("gui-button","click","resources-panel-add-date");self.showDatePanel(true,false);});_4.connect(_4.query("#"+self._id+" .pundit-rp-date-input")[0],"onkeyup",function(e){self.checkDate(e);});_4.connect(_4.query("#"+self._id+" .pundit-rp-literal-text")[0],"onkeyup",function(e){if(_4.query(e.target)[0].innerHTML.replace(/<(?:.|\n)*?>/gm,"")!==""){_4.attr(_4.query("#"+self._id+" .pundit-rp-literal-panel-done")[0],"disabled",false);}else{_4.attr(_4.query("#"+self._id+" .pundit-rp-literal-panel-done")[0],"disabled",true);}});_4.connect(_4.query("#"+self._id+" .pundit-rp-panel-close")[0],"onclick",function(){_PUNDIT.ga.track("gui-button","click","resources-panel-close-literal-panel");self.showLiteralPanel(false,false);});_4.connect(_4.query("#"+self._id+" .pundit-rp-panel-close")[1],"onclick",function(){_PUNDIT.ga.track("gui-button","click","resources-panel-close-literal-panel");self.showLiteralPanel(false,false);});_4.connect(_4.query("#"+self._id+" .pundit-rp-literal-panel-done")[0],"onclick",function(){_PUNDIT.ga.track("gui-button","click","resources-panel-done-literal-panel");self.createLiteralItem();});_4.connect(_4.query("#"+self._id+" .pundit-rp-date-panel-done")[0],"onclick",function(){_PUNDIT.ga.track("gui-button","click","resources-panel-done-literal-panel");self.createDateItem();});var beh={};for(var i in self.panels){(function(_76f){beh["#"+self._id+" span.pundit-icon-collapse"]={"onclick":function(e){var _770=_4.query(e.target).parent().parent()[0];if(_4.hasClass(_770,"pundit-expanded")){_4.removeClass(_770,"pundit-expanded");_4.style(_4.query(_770).children("ul")[0],"height","0px");self.adjustPreviewHeight();}else{_4.addClass(_770,"pundit-expanded");self.adjustPanelsHeight();}}};beh["#"+self._id+"-suggestions-list-"+_76f+" li.dojoDndItem"]={"onmouseover":function(e){var img="",node,_771;if(e.target.nodeName==="LI"){node=_4.query(e.target);}else{node=_4.query(_4.query(e.target).parent()[0]);}_771=self["itemsDnD"+_76f].getItem(node[0].id).data.value;self.showPreview(_771);},"onclick":function(e){var _772=e.target;while(!_4.hasClass(_4.query(_772)[0],"dojoDndItem")){_772=_4.query(_772).parent()[0];}var id=_772.id;self["itemsDnD"+_76f].selectNone();self["itemsDnD"+_76f].selection[id]=1;}};beh["#"+self._id+"-suggestions-list-"+_76f+" li.dojoDndItem span.pundit-item-label"]={"onclick":function(e){_PUNDIT.ga.track("items","add","resources-panel-add-from-label");var item,node;if(e.target.nodeName==="LI"){node=_4.query(e.target);}else{node=_4.query(_4.query(e.target).parent()[0]);}item=self["itemsDnD"+_76f].getItem(node[0].id);self.fireOnItemAdded(item.data);}};beh["#"+self._id+"-suggestions-list-"+_76f+" li.dojoDndItem span.pundit-item-add-button"]={"onclick":function(e){_PUNDIT.ga.track("items","add","resources-panel-add-from-button");var item,node;if(e.target.nodeName==="LI"){node=_4.query(e.target);}else{node=_4.query(_4.query(e.target).parent()[0]);}item=self["itemsDnD"+_76f].getItem(node[0].id);self.fireOnItemAdded(item.data);}};beh["#"+self._id+"-suggestions-list-"+_76f+" li.dojoDndItem span.pundit-icon-context-button"]={"onclick":function(e){var node=_4.query(_4.query(e.target).parent()[0]),uri=self["itemsDnD"+_76f].getItem(node[0].id).data.value;cMenu.show(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset,uri,"resourceItem");}};})(i);}_4.behavior.add(beh);_4.behavior.apply();},searchNamedEntities:function(_773){var self=this;if(typeof _773!=="undefined"){if(_773!==""){_4.query("#"+self._id+" .pundit-rp-search-input")[0].value=_773;self.namedEntitiesLookup(_773);}}self.adjustPanelsHeight();},initContextMenu:function(){var self=this;cMenu.addAction({type:["resourceItem"],name:"openResourceItemWebPage",label:"Open Web page",showIf:function(uri){var item=_PUNDIT.items.getItemByUri(uri);if(typeof item!=="undefined"){if(_PUNDIT.items.isTerm(item)){return true;}else{return false;}}else{item=_PUNDIT.vocab.getItemsForTerm(uri);if(typeof item!=="undefined"){return true;}else{return false;}}},onclick:function(uri){_PUNDIT.ga.track("cmenu","click","resources-panel-open-web-page");window.open(uri,"SemLibOpenedWebPage");return true;}});cMenu.addAction({type:["resourceItem"],name:"openSemlibResourceWebPage",label:"Show in origin page",showIf:function(xp){var item=_PUNDIT.items.getItemByUri(xp);if((typeof item!=="undefined")&&(typeof tooltip_viewer.xpointersAnnotationsId[xp]==="undefined")&&((_4.indexOf(item.rdftype,ns.fragments.text)!==-1)||(_4.indexOf(item.rdftype,ns.image)!==-1))){return !tooltip_viewer.xpointersClasses[xp];}return false;},onclick:function(xp){_PUNDIT.ga.track("cmenu","click","resources-panel-show-in-origin-page");var item=_PUNDIT.items.getItemByUri(xp),_774=xp.split("#")[1],uri=item.pageContext+"#"+_774;window.open(uri,"SemLibOpenedWebPage");self.log("Opened a new window to URL "+uri);return true;}});},clearPanel:function(){var self=this;self.lastSearchedTerm="";for(var i in self.namedEntitiesSources){_PUNDIT[i].cancelRequests();self.setLoading(self._id+"-container-suggestions-"+i,false);}_4.query("#"+self._id+" div.pundit-rp-container-suggestions.pundit-suggestions").forEach(function(item){_4.removeClass(item,"pundit-visible");});if(typeof _4.query("#"+self._id+" input.pundit-rp-search-input")[0]!=="undefined"){_4.query("#"+self._id+" input.pundit-rp-search-input")[0].value="";}for(var i in self.suggestionPanels){_4.empty(_4.byId(self._id+"-suggestions-list-"+i));self["itemsDnD"+i].clearItems();}},load:function(_775){var self=this;self.clearPanel();for(var i in _775){if(_775[i].items.length>0){_4.addClass(_4.byId(self._id+"-container-suggestions-"+i),"pundit-visible");for(var j=_775[i].items.length;j--;){self["itemsDnD"+i].insertNodes(false,[_775[i].items[j]]);}_4.query("#"+self._id+"-container-suggestions-"+i+" span.pundit-items-number")[0].innerHTML="("+self["itemsDnD"+i].getAllNodes().length+")";}}},show:function(x,y,_776){this.inherited(arguments);var self=this;self._lastKeyword="";_4.style(self._id,"top",y+15+"px");_4.style(self._id,"left",x+"px");_5.focus(_4.query("#"+self._id+" .pundit-rp-search-input")[0]);if(typeof _776!=="undefined"){if(typeof _776.literalMode!=="undefined"){if(_776.literalMode==="literalEnabled"){self.enableLiteralButton(true);}else{if(_776.literalMode==="literalOnly"){self.showLiteralPanel(true,true);}else{if(_776.literalMode==="dateOnly"){self.showDatePanel(true,true);}}}}else{self.enableLiteralButton(false);self.showLiteralPanel(false,false);}if(typeof _776.title!=="undefined"){_4.query("#"+self._id+" .pundit-fp-title")[0].innerHTML=_776.title;}if(typeof _776.arrow!=="undefined"){if(_776.arrow==="left"){_4.removeClass(_4.query("#"+self._id+".pundit-fp")[0],["pundit-arrow-right","pundit-arrow-center"]);_4.addClass(_4.query("#"+self._id+".pundit-fp")[0],"pundit-arrow-left");}else{if(_776.arrow==="right"){_4.removeClass(_4.query("#"+self._id+".pundit-fp")[0],["pundit-arrow-left","pundit-arrow-center"]);_4.addClass(_4.query("#"+self._id+".pundit-fp")[0],"pundit-arrow-right");}else{if(_776.arrow==="center"){_4.removeClass(_4.query("#"+self._id+".pundit-fp")[0],["pundit-arrow-left","pundit-arrow-right"]);_4.addClass(_4.query("#"+self._id+".pundit-fp")[0],"pundit-arrow-center");}}}}}_4.behavior.apply();self.adjustPanelsHeight();},hide:function(){this.inherited(arguments);var self=this;if(self.inShowing){self.inShowing=false;self.showLiteralPanel(false,false);_4.empty(_4.query("#"+self._id+" .pundit-rp-literal-text")[0]);self._lastKeyword="";}self.lastSearchedTerm="";for(var i in self.namedEntitiesSources){_PUNDIT[i].cancelRequests();self.setLoading(self._id+"-container-suggestions-"+i,false);}},reset:function(){var self=this;_4.addClass(_4.query("#"+self._id+" .pundit-rp-literal-panel")[0],"pundit-hidden");_4.addClass(_4.query("#"+self._id+" .pundit-rp-date-panel")[0],"pundit-hidden");_4.removeClass(_4.query("#"+self._id+" .pundit-rp-search-panel")[0],"pundit-hidden");_4.empty(_4.query("#"+self._id+" .pundit-rp-literal-text")[0]);_4.query("#"+self._id+" .pundit-rp-date-input")[0].value="";_4.empty(_4.query("#"+self._id+" .pundit-rp-literal-text")[0]);self._lastKeyword="";},filterItemsByTerm:function(_777){var self=this;if(_777===""){for(var i in self.suggestionPanels){var _778=_4.query("#"+self._id+"-suggestions-list-"+i+" li");_778.forEach(function(node){_4.removeClass(node,"pundit-hidden");});}}else{for(var i in self.suggestionPanels){self.rankItems(self["itemsDnD"+i],_777);}}for(var i in self.suggestionPanels){_4.query("#"+self._id+"-container-suggestions-"+i+" span.pundit-items-number")[0].innerHTML="("+self.getShownItemsNumber(self["itemsDnD"+i])+")";}self.adjustPanelsHeight();},searchItemsByTerm:function(term){var self=this,_779=self.createItemsObject(term);self.clearPanel();self.load(_779,term);},createItemsObject:function(term){var _77a=term.split(" "),_77b={},_77c=semlibMyItems.getItemsFromTerm(_77a,[],[ns.fragments.text,ns.image]),_77d=semlibItems.getItemsFromTerm(_77a,[],[ns.fragments.text,ns.image]);_77b={myitems:{label:"My Items",items:_77c},pageitems:{label:"Page Items",items:_77d}};for(var v in _PUNDIT["vocab"].vocabs){var _77e=_PUNDIT["vocab"].getItemsForTermInVocab(term,v);_77b[v]={label:v,items:_77e};}return _77b;},getShownItemsNumber:function(_77f){var n=0;_77f.getAllNodes().forEach(function(item){if(_4.style(item,"display")!=="none"){n++;}});return n;},enableLiteralButton:function(_780){var self=this;if(_780){_4.addClass(_4.query("#"+self._id+" .pundit-rp-add-date")[0],"pundit-literal-enabled");_4.addClass(_4.query("#"+self._id+" .pundit-rp-add-literal")[0],"pundit-literal-enabled");}else{_4.removeClass(_4.query("#"+self._id+" .pundit-rp-add-date")[0],"pundit-literal-enabled");_4.removeClass(_4.query("#"+self._id+" .pundit-rp-add-literal")[0],"pundit-literal-enabled");}_4.addClass(_4.query("#"+self.Id+" ."));},showLiteralPanel:function(_781,_782){var self=this;if(_781){_4.addClass(_4.query("#"+self._id+" .pundit-rp-search-panel")[0],"pundit-hidden");_4.addClass(_4.query("#"+self._id+" .pundit-rp-date-panel")[0],"pundit-hidden");_4.removeClass(_4.query("#"+self._id+" .pundit-rp-literal-panel")[0],"pundit-hidden");_5.focus(_4.query("#"+self._id+" .pundit-rp-literal-text")[0]);}else{_4.addClass(_4.query("#"+self._id+" .pundit-rp-literal-panel")[0],"pundit-hidden");_4.addClass(_4.query("#"+self._id+" .pundit-rp-date-panel")[0],"pundit-hidden");_4.removeClass(_4.query("#"+self._id+" .pundit-rp-search-panel")[0],"pundit-hidden");}if(_782){_4.addClass(_4.query("#"+self._id+" .pundit-rp-panel-close")[0],"pundit-hidden");}else{_4.removeClass(_4.query("#"+self._id+" .pundit-rp-panel-close")[0],"pundit-hidden");}},checkDate:function(e){var self=this;if(_4.query("#"+self._id+" .pundit-rp-date-input")[0].checkValidity()){_4.attr(_4.query("#"+self._id+" .pundit-rp-date-panel-done")[0],"disabled",false);}else{_4.attr(_4.query("#"+self._id+" .pundit-rp-date-panel-done")[0],"disabled",true);}},showDatePanel:function(_783,_784){var self=this;if(_783){_4.addClass(_4.query("#"+self._id+" .pundit-rp-search-panel")[0],"pundit-hidden");_4.addClass(_4.query("#"+self._id+" .pundit-rp-literal-panel")[0],"pundit-hidden");_4.removeClass(_4.query("#"+self._id+" .pundit-rp-date-panel")[0],"pundit-hidden");_5.focus(_4.query("#"+self._id+" .pundit-rp-date-input")[0]);}},createDateItem:function(){var self=this,_785=_4.query("#"+self._id+" .pundit-rp-date-input")[0].value,_786=semlibLiterals.createLiteralItem(_785);self.fireOnItemAdded(_786);self.hide();},createLiteralItem:function(){var self=this,_787=_4.query("#"+self._id+" .pundit-rp-literal-text")[0].innerHTML,_788=semlibLiterals.createLiteralItem(_787);self.fireOnItemAdded(_788);self.hide();},adjustPanelsHeight:function(){var self=this,_789,_78a=0;for(var i in self.suggestionPanels){_789=_4.query("#"+self._id+"-container-suggestions-"+i)[0];if(_4.hasClass(_789,"pundit-expanded")){_78a=self.getShownItemsNumber(self["itemsDnD"+i]);if(_78a<self.maxShownItems){_4.style(_4.query(_789).children("ul")[0],"height",_78a*27+1+"px");}else{_4.style(_4.query(_789).children("ul")[0],"height",self.maxShownItems*27+1+"px");}}}for(var i in self.namedEntitiesSources){_789=_4.query("#"+self._id+"-container-suggestions-"+i)[0];if(_4.hasClass(_789,"pundit-expanded")){_78a=self.getShownItemsNumber(self["itemsDnD"+i]);if(_78a<self.maxShownItems){_4.style(_4.query(_789).children("ul")[0],"height",_78a*27+1+"px");}else{_4.style(_4.query(_789).children("ul")[0],"height",self.maxShownItems*27+1+"px");}}}self.adjustPreviewHeight();},namedEntitiesLookup:function(term){var self=this;self.lastSearchedTerm=term;if(self._id=="pundit-fp-pred-suggestions"){var i="wikidataPropertiesSelector";}else{var i="wikidataItemsSelector";}self.setLoading(self._id+"-container-suggestions-"+i,true);_PUNDIT[i].getItemsForTerm(term,(function(_78b){return function(_78c,term){if(self.lastSearchedTerm===term){_4.removeClass(self._id+"-container-suggestions-"+_78b,"pundit-lookup-error");for(var j=_78c.length;j--;){previewer.buildPreviewForItem(_78c[j]);}_4.empty(_4.query("#"+self._id+"-container-suggestions-"+_78b+" ul"));self["itemsDnD"+_78b].selectAll();self["itemsDnD"+_78b].deleteSelectedNodes();self["itemsDnD"+_78b].sync();if(_78c.length===0){self.setLoading(self._id+"-container-suggestions-"+_78b,false);_4.query("#"+self._id+"-container-suggestions-"+_78b+" span.pundit-items-number").html("("+self.getShownItemsNumber(self["itemsDnD"+_78b])+")");}else{self["itemsDnD"+_78b].sync();self["itemsDnD"+_78b].insertNodes(false,_78c);_4.query("#"+self._id+"-container-suggestions-"+_78b+" span.pundit-items-number").html("("+self.getShownItemsNumber(self["itemsDnD"+_78b])+")");self.setLoading(self._id+"-container-suggestions-"+_78b,false);_4.behavior.apply();}self.adjustPanelsHeight();}};})(i),(function(_78d){return function(){self.setLoading(self._id+"-container-suggestions-"+_78d,false);_4.query("#"+self._id+"-container-suggestions-"+_78d+" span.pundit-items-number").html("("+0+")");_4.addClass(self._id+"-container-suggestions-"+_78d,"pundit-lookup-error");};})(i));},setLoading:function(_78e,v){var self=this,r=_4.query("#"+_78e),c="pundit-panel-loading";return (v)?r.addClass(c):r.removeClass(c);},rankItems:function(_78f,word){var _790=[];for(var i in _78f.map){_790.push([i,_78f.map[i].data.label.score(word)]);}_790.sort((function(a,b){return b[1]-a[1];}));for(var i=0;i<_790.length;i++){var node=_4.byId(_790[i][0]);_4.destroy(_790[i][0]);_4.query("#"+_78f.node.id).append(node);if(_790[i][1]===0){_4.addClass(_790[i][0],"pundit-hidden");}else{_4.removeClass(_790[i][0],"pundit-hidden");}}},adjustPreviewHeight:function(){var self=this;clearTimeout(self.previewTimer);self.previewTimer=setTimeout(function(){var h=_4.position(_4.query("#"+self._id+" .pundit-fp-content-list")[0]).h-10;_4.style(_4.query("#"+self._id+" .pundit-fp-preview")[0],"height",h+"px");},1200);}});}if(!_4._hasResource["pundit.RecognizerPanel"]){_4._hasResource["pundit.RecognizerPanel"]=true;_4.provide("pundit.RecognizerPanel");_4.declare("pundit.RecognizerPanel",pundit.ResourcesPanel,{constructor:function(_791){var self=this;self.saver=new pundit.AnnotationWriter({debug:self.opts.debug});self.saver.onSaveItems(function(_792){self.log("onSaveItems: Saver answered with "+_792);self.saved=true;self.hide();tooltip_viewer.refreshAnnotations();});self.saver.onSave(function(m){self.log("onSave: Saver answered with "+m);self.saveItems(m);});self.onItemAdded(self.addItem);},initHTML:function(){this.inherited(arguments);var self=this;var c="<div class=\"pundit-rp-panel-tags-container pundit-rp-container-suggestions pundit-visible pundit-expanded pundit-floating-panel-container\">";c+="      <div>";c+="          <span class=\"pundit-pane-title pundit-rp-title\">Selected Entities:</span>";c+="          <div class=\"pundit-pane\"><ul class=\"pundit-rp-tags pundit-items pundit-view-list showsRemoveButton pundit-stop-wheel-propagation\"></ul></div>";c+="      </div>";c+="   </div>";c+="   <div class=\"pundit-rp-button-container\">";c+="   <span class=\"pundit-rp-save-button pundit-gui-button pundit-button-disabled\">Save</span></div>";_4.query("#"+self._id+" .pundit-rp-container-search").prepend(c);},initDnD:function(){this.inherited(arguments);var self=this;self.tagsDnD=new _4.dnd.Target(_4.query("#"+self._id+" .pundit-rp-tags")[0],{copyOnly:true,creator:semlibItems.itemNodeCreator,checkAcceptance:function(_793,_794){if(self.acceptSource(_793)){for(var i=_794.length;i--;){if(self.uriInItems(_793.getItem(_794[i].id).data.value)){return false;}else{return true;}}return true;}else{return false;}}});},initBehaviors:function(){this.inherited(arguments);var self=this;_4.connect(_4.query("#"+self._id+" .pundit-rp-save-button")[0],"onclick",function(e){_PUNDIT.ga.track("gui-button","click",self._id+"-pundit-rp-save-button");if(!_4.hasClass(_4.query("#"+self._id+" .pundit-rp-save-button")[0],"pundit-button-disabled")){self.saveTriples();}else{console.log("Not saving.");}});var beh={};beh["#"+self._id+" .pundit-rp-tags li.dojoDndItem span.pundit-item-remove-button"]={"onclick":function(e){self.removeTag(e);}};beh["#"+self._id+" .pundit-rp-tags"+" li.dojoDndItem"]={"onmouseover":function(e){self.onItemMouseOver(e);},"onmouseout":function(e){self.onItemMouseOut(e);}};_4.behavior.add(beh);_4.behavior.apply();_4.subscribe("/dnd/drop",function(_795,_796,copy,_797){if(_797===self.tagsDnD){setTimeout(function(){self.updateSaveBtn();},100);}});},saveTriples:function(){var self=this;var _798=_PUNDIT.tripleComposer.getSafePageContext(),b=new pundit.TriplesBucket();for(var j in self.tagsDnD.map){var item=self.tagsDnD.map[j];b.addTriple(self.target,ns.rdfs_seeAlso,item.data.value,"uri");}if(!b.isEmpty()){self.log("Saving triples json: "+_4.toJson(b.getTalisJson()));self.saver.writeAnnotationContent(b,[self.target],_798);}else{self.log("Empty bucket in saveTriples??!");}},saveItems:function(_799){var self=this,b=new pundit.TriplesBucket(),_79a=[],item=_PUNDIT.items.getItemByUri(self.target);_79a.push(item.rdfData);self.tagsDnD.forInItems(function(item){_79a.push(item.data.rdfData);});for(var i=_79a.length;i--;){b.concatBucket(_79a[i]);}b.addTriple(ns.rdfs_seeAlso,ns.rdf_type,ns.rdf_property,"uri");b.addTriple(ns.rdfs_seeAlso,ns.rdfs_label,"see also","literal");if(!b.isEmpty()){self.log("Posting "+_79a.length+" items with "+b.bucket.length+" triples..");self.saver.writeAnnotationItems(_799,_4.toJson(b.getTalisJson()));}else{self.log("saveItems with an empty bucket??!");}},acceptSource:function(_79b){var self=this;for(var i in self.panels){if(_79b===self["itemsDnD"+i]){return true;}}return false;},uriInItems:function(uri){var self=this,_79c=false;self.tagsDnD.forInItems(function(item){if(item.data.value===uri){_79c=true;return;}});return _79c;},show:function(x,y,_79d){this.inherited(arguments);var self=this,item;self.tempItemAdded=false;self.saved=false;self.target=_79d.target.value;item=_79d.target;self.updateSaveBtn();if(!semlibItems.uriInItems(self.target)){semlibItems.addItem(item);self.tempItemAdded=true;previewer.buildPreviewForItem(item);}if(!tooltip_viewer.isTempXpointer(self.target)){if(self.target!==_PUNDIT.tripleComposer.getSafePageContext()){tooltip_viewer.tempXpointers.push(self.target);}tooltip_viewer.consolidate();}tooltip_viewer.highlightByXpointer(self.target);},hide:function(){this.inherited(arguments);var self=this;_4.empty(_4.query("#"+self._id+" ul.pundit-rp-tags"));self.tagsDnD.selectAll();self.tagsDnD.deleteSelectedNodes();self.tagsDnD.sync();tooltip_viewer.removeHighlightByXpointer(self.target);tooltip_viewer.removeTempXpointer(self.target);if(!self.saved){semlibItems.removeItemFromUri(self.target);tooltip_viewer.consolidate();}},addItem:function(item){var self=this;if(!self.uriInItems(item.value)){self.tagsDnD.insertNodes(false,[item]);}self.updateSaveBtn();_4.behavior.apply();},removeTag:function(e){var self=this,node=_4.query(_4.query(e.target).parent()[0]),uri=self.tagsDnD.getItem(node[0].id).data.value;self.tagsDnD.deleteSelectedNodes();_4.destroy(node);_4.behavior.apply();self.updateSaveBtn();},onItemMouseOver:function(e){var self=this,node,_79e;if(e.target.nodeName==="LI"){node=_4.query(e.target);}else{node=_4.query(_4.query(e.target).parent()[0]);}_79e=self.tagsDnD.getItem(node[0].id).data.value;self.showPreview(_79e);},onItemMouseOut:function(e){}});}if(!_4._hasResource["dojox.xml.DomParser"]){_4._hasResource["dojox.xml.DomParser"]=true;_4.provide("dojox.xml.DomParser");_6.xml.DomParser=new (function(){var _79f={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9};var _7a0=/<([^>\/\s+]*)([^>]*)>([^<]*)/g;var _7a1=/([^=]*)=(("([^"]*)")|('([^']*)'))/g;var _7a2=/<!ENTITY\s+([^"]*)\s+"([^"]*)">/g;var _7a3=/<!\[CDATA\[([\u0001-\uFFFF]*?)\]\]>/g;var _7a4=/<!--([\u0001-\uFFFF]*?)-->/g;var trim=/^\s+|\s+$/g;var _7a5=/\s+/g;var egt=/\&gt;/g;var elt=/\&lt;/g;var _7a6=/\&quot;/g;var _7a7=/\&apos;/g;var eamp=/\&amp;/g;var dNs="_def_";function _7a8(){return new (function(){var all={};this.nodeType=_79f.DOCUMENT;this.nodeName="#document";this.namespaces={};this._nsPaths={};this.childNodes=[];this.documentElement=null;this._add=function(obj){if(typeof (obj.id)!="undefined"){all[obj.id]=obj;}};this._remove=function(id){if(all[id]){delete all[id];}};this.byId=this.getElementById=function(id){return all[id];};this.byName=this.getElementsByTagName=_7a9;this.byNameNS=this.getElementsByTagNameNS=_7aa;this.childrenByName=_7ab;this.childrenByNameNS=_7ac;})();};function _7a9(name){function _7ad(node,name,arr){_4.forEach(node.childNodes,function(c){if(c.nodeType==_79f.ELEMENT){if(name=="*"){arr.push(c);}else{if(c.nodeName==name){arr.push(c);}}_7ad(c,name,arr);}});};var a=[];_7ad(this,name,a);return a;};function _7aa(name,ns){function _7ae(node,name,ns,arr){_4.forEach(node.childNodes,function(c){if(c.nodeType==_79f.ELEMENT){if(name=="*"&&c.ownerDocument._nsPaths[ns]==c.namespace){arr.push(c);}else{if(c.localName==name&&c.ownerDocument._nsPaths[ns]==c.namespace){arr.push(c);}}_7ae(c,name,ns,arr);}});};if(!ns){ns=dNs;}var a=[];_7ae(this,name,ns,a);return a;};function _7ab(name){var a=[];_4.forEach(this.childNodes,function(c){if(c.nodeType==_79f.ELEMENT){if(name=="*"){a.push(c);}else{if(c.nodeName==name){a.push(c);}}}});return a;};function _7ac(name,ns){var a=[];_4.forEach(this.childNodes,function(c){if(c.nodeType==_79f.ELEMENT){if(name=="*"&&c.ownerDocument._nsPaths[ns]==c.namespace){a.push(c);}else{if(c.localName==name&&c.ownerDocument._nsPaths[ns]==c.namespace){a.push(c);}}}});return a;};function _7af(v){return {nodeType:_79f.TEXT,nodeName:"#text",nodeValue:v.replace(_7a5," ").replace(egt,">").replace(elt,"<").replace(_7a7,"'").replace(_7a6,"\"").replace(eamp,"&")};};function _7b0(name){for(var i=0;i<this.attributes.length;i++){if(this.attributes[i].nodeName==name){return this.attributes[i].nodeValue;}}return null;};function _7b1(name,ns){for(var i=0;i<this.attributes.length;i++){if(this.ownerDocument._nsPaths[ns]==this.attributes[i].namespace&&this.attributes[i].localName==name){return this.attributes[i].nodeValue;}}return null;};function _7b2(name,val){var old=null;for(var i=0;i<this.attributes.length;i++){if(this.attributes[i].nodeName==name){old=this.attributes[i].nodeValue;this.attributes[i].nodeValue=val;break;}}if(name=="id"){if(old!=null){this.ownerDocument._remove(old);}this.ownerDocument._add(this);}};function _7b3(name,val,ns){for(var i=0;i<this.attributes.length;i++){if(this.ownerDocument._nsPaths[ns]==this.attributes[i].namespace&&this.attributes[i].localName==name){this.attributes[i].nodeValue=val;return;}}};function prev(){var p=this.parentNode;if(p){for(var i=0;i<p.childNodes.length;i++){if(p.childNodes[i]==this&&i>0){return p.childNodes[i-1];}}}return null;};function next(){var p=this.parentNode;if(p){for(var i=0;i<p.childNodes.length;i++){if(p.childNodes[i]==this&&(i+1)<p.childNodes.length){return p.childNodes[i+1];}}}return null;};this.parse=function(str){var root=_7a8();if(str==null){return root;}if(str.length==0){return root;}if(str.indexOf("<!ENTITY")>0){var _7b4,eRe=[];if(_7a2.test(str)){_7a2.lastIndex=0;while((_7b4=_7a2.exec(str))!=null){eRe.push({entity:"&"+_7b4[1].replace(trim,"")+";",expression:_7b4[2]});}for(var i=0;i<eRe.length;i++){str=str.replace(new RegExp(eRe[i].entity,"g"),eRe[i].expression);}}}var _7b5=[],_7b6;while((_7b6=_7a3.exec(str))!=null){_7b5.push(_7b6[1]);}for(var i=0;i<_7b5.length;i++){str=str.replace(_7b5[i],i);}var _7b7=[],_7b8;while((_7b8=_7a4.exec(str))!=null){_7b7.push(_7b8[1]);}for(i=0;i<_7b7.length;i++){str=str.replace(_7b7[i],i);}var res,obj=root;while((res=_7a0.exec(str))!=null){if(res[2].charAt(0)=="/"&&res[2].replace(trim,"").length>1){if(obj.parentNode){obj=obj.parentNode;}var text=(res[3]||"").replace(trim,"");if(text.length>0){obj.childNodes.push(_7af(text));}}else{if(res[1].length>0){if(res[1].charAt(0)=="?"){var name=res[1].substr(1);var _7b9=res[2].substr(0,res[2].length-2);obj.childNodes.push({nodeType:_79f.PROCESSING_INSTRUCTION,nodeName:name,nodeValue:_7b9});}else{if(res[1].charAt(0)=="!"){if(res[1].indexOf("![CDATA[")==0){var val=parseInt(res[1].replace("![CDATA[","").replace("]]",""));obj.childNodes.push({nodeType:_79f.CDATA_SECTION,nodeName:"#cdata-section",nodeValue:_7b5[val]});}else{if(res[1].substr(0,3)=="!--"){var val=parseInt(res[1].replace("!--","").replace("--",""));obj.childNodes.push({nodeType:_79f.COMMENT,nodeName:"#comment",nodeValue:_7b7[val]});}}}else{var name=res[1].replace(trim,"");var o={nodeType:_79f.ELEMENT,nodeName:name,localName:name,namespace:dNs,ownerDocument:root,attributes:[],parentNode:null,childNodes:[]};if(name.indexOf(":")>-1){var t=name.split(":");o.namespace=t[0];o.localName=t[1];}o.byName=o.getElementsByTagName=_7a9;o.byNameNS=o.getElementsByTagNameNS=_7aa;o.childrenByName=_7ab;o.childrenByNameNS=_7ac;o.getAttribute=_7b0;o.getAttributeNS=_7b1;o.setAttribute=_7b2;o.setAttributeNS=_7b3;o.previous=o.previousSibling=prev;o.next=o.nextSibling=next;var attr;while((attr=_7a1.exec(res[2]))!=null){if(attr.length>0){var name=attr[1].replace(trim,"");var val=(attr[4]||attr[6]||"").replace(_7a5," ").replace(egt,">").replace(elt,"<").replace(_7a7,"'").replace(_7a6,"\"").replace(eamp,"&");if(name.indexOf("xmlns")==0){if(name.indexOf(":")>0){var ns=name.split(":");root.namespaces[ns[1]]=val;root._nsPaths[val]=ns[1];}else{root.namespaces[dNs]=val;root._nsPaths[val]=dNs;}}else{var ln=name;var ns=dNs;if(name.indexOf(":")>0){var t=name.split(":");ln=t[1];ns=t[0];}o.attributes.push({nodeType:_79f.ATTRIBUTE,nodeName:name,localName:ln,namespace:ns,nodeValue:val});if(ln=="id"){o.id=val;}}}}root._add(o);if(obj){obj.childNodes.push(o);o.parentNode=obj;if(res[2].charAt(res[2].length-1)!="/"){obj=o;}}var text=res[3];if(text.length>0){obj.childNodes.push(_7af(text));}}}}}}for(var i=0;i<root.childNodes.length;i++){var e=root.childNodes[i];if(e.nodeType==_79f.ELEMENT){root.documentElement=e;break;}}return root;};})();}if(!_4._hasResource["pundit.CommentTagPanel"]){_4._hasResource["pundit.CommentTagPanel"]=true;_4.provide("pundit.CommentTagPanel");_4.declare("pundit.CommentTagPanel",pundit.RecognizerPanel,{opts:{enableEntitiesExtraction:true,entityExtractor:"data-txt",},constructor:function(_7ba){var self=this;self.saveComment=true;self.tagItems=[];self.lastTagInfoRequests=[];self.lastSearchedComment="";self.tagListItemSelected=false;self.enableSemanticExpansion;if(self.opts.enableEntitiesExtraction){if(self.opts.entityExtractor==="dbpedia-spotlight"){self.entityExtractor=new pundit.DbpediaSpotlight();}else{if(self.opts.entityExtractor==="data-txt"){self.entityExtractor=new pundit.DataTxt();}else{if(self.opts.entityExtractor==="civet"){self.entityExtractor=new pundit.Civet();}}}}},initHTML:function(){this.inherited(arguments);var self=this,c="<div class=\"pundit-rp-comment-container\">";c+="      <div class=\"pundit-container-header\">";c+="          <span id=\"pundit-ctp-textarea-title\" class=\"pundit-pane-title\" >Comment:</span>";if(self.opts.enableEntitiesExtraction){c+="          <span class=\"pundit-gui-button\" id=\"pundit-ctp-extract-tags\" disabled=\"true\" style=\"float:right;margin-right:5px;\">Extract Tags</span>";}c+="          <span style=\"float:right;margin-right:5px;\">Language: ";c+="          <select dojotype=\"dijit.form.ComboBox\" id=\"pundit-ctp-language\"></span>";c+="              <option selected>en</option>";c+="              <option>it</option>";c+="          </select>";c+="      </div>";c+="      <div class=\"pundit-ctp-comment-input\">";c+="          <section contenteditable=\"true\" id=\"pundit-ctp-comment-input\" class=\"pundit-stop-wheel-propagation\"></section>";c+="      </div>";c+="   </div>";_4.query("#"+self._id+" .pundit-rp-search-panel").prepend(c);_4.query("#"+self._id+" .pundit-rp-title")[0].innerHTML="Tags";},initContextMenu:function(){this.inherited(arguments);var self=this;cMenu.addAction({type:["textSelectionHelper","annotatedtextfragment","bookmarkedtextfragment"],name:"NewAddCommentTagToText",label:"Add Comment or Tags",showIf:function(item){return true;},onclick:function(item){_PUNDIT.ga.track("cmenu","click","add-comment-or-tags");self.initPanel(item,"Comment and tags");self.saveComment=true;return true;}});if(self.opts.enableEntitiesExtraction){cMenu.addAction({type:["textSelectionHelper"],name:"extractEntities",label:"Extract entities",showIf:function(item){return true;},onclick:function(item){_PUNDIT.ga.track("cmenu","click","extract-entities");self.initPanel(item,"Extract entitites");_4.byId("pundit-ctp-textarea-title").innerHTML="Selected text:";_4.html.set("pundit-ctp-comment-input",item.description);self.saveComment=false;self.extractTags(_4.byId("pundit-ctp-language").value);return true;}});}},initBehaviors:function(){this.inherited(arguments);var self=this;_4.connect(_4.byId("pundit-ctp-comment-input"),"onclick",function(){var _7bb=_4.byId("pundit-ctp-comment-input").innerHTML.replace(/<(?:.|\n)*?>/gm,"");self.cancelPendingSpotlightRequests();_4.query("#"+self._id+" .pundit-pane").removeClass("pundit-panel-loading");self.updateSaveBtn();});_4.connect(_4.byId("pundit-ctp-comment-input"),"onkeyup",function(){self.updateSaveBtn();});if(self.opts.enableEntitiesExtraction){_4.connect(_4.byId("pundit-ctp-extract-tags"),"onclick",function(evt){if(!_4.hasClass(_4.byId("pundit-ctp-extract-tags"),"pundit-button-disabled")){self.extractTags(_4.byId("pundit-ctp-language").value);}});}_4.behavior.add({"#pundit-ctp-comment-input a":{"onmouseover":function(e){var uri=_4.attr(e.target,"about");self.showPreview(uri);for(var i in self.tagsDnD.map){if(self.tagsDnD.map[i].data.value===uri){_4.addClass(i,"pundit-item-selected");}}}}});},extractTags:function(_7bc){var self=this,tags=[];var _7bd=unescape(_4.byId("pundit-ctp-comment-input").innerHTML.replace(/<(?:.|\n)*?>/gm,"").replace(/&nbsp;/g," "));if(_7bd!==""){self.cancelPendingSpotlightRequests();self.tagsDnD.selectNone();_4.query("#"+self._id+" .pundit-rp-tags li.dojoDndItem").forEach(function(tag){if(typeof (self.tagsDnD.map[tag.id].data.suggested)!=="undefined"){self.tagsDnD.selection[tag.id]=1;self.removeItemFromUri(self.tagsDnD.map[tag.id].data.value);}});self.tagsDnD.deleteSelectedNodes();if(self.tagListItemSelected){self.tagListItemSelected=false;}_4.query("#"+self._id+" .pundit-pane").addClass("pundit-panel-loading");self.enableSemanticExpansion=self.entityExtractor.getEntities(_7bc,_7bd,function(tags){for(var i=tags.length;i--;){self.tagItems.push(tags[i]);tags[i]["pundit-items"][0].suggested=true;tags[i]["pundit-items"][0].rdfData=semlibItems.createBucketForVocabItem(tags[i]["pundit-items"][0]).bucket;if(!self.uriInItems(tags[i]["pundit-items"][0].value)){self.tagsDnD.insertNodes(false,[tags[i]["pundit-items"][0]]);previewer.buildPreviewForItem(tags[i]["pundit-items"][0]);}}self.markupText(tags);_4.query("#"+self._id+" .pundit-pane").removeClass("pundit-panel-loading");_4.behavior.apply();},function(){_4.query("#"+self._id+" .pundit-pane").removeClass("pundit-panel-loading");});self.lastSearchedComment=_7bd;if(self.opts.enableEntitiesExtraction){_4.query("#pundit-ctp-extract-tags").attr("disabled",true);}self.tagItems=[];self.updateSaveBtn();}},saveTriples:function(){var self=this,_7be=_PUNDIT.tripleComposer.getSafePageContext(),_7bf=self.parseInputText(_4.byId("pundit-ctp-comment-input")),b=new pundit.TriplesBucket();if(self.saveComment&&_7bf!==""){b.addTriple(self.target,ns.pundit_hasComment,_7bf,"literal");}for(var j in self.tagsDnD.map){var item=self.tagsDnD.map[j];b.addTriple(self.target,ns.pundit_hasTag,item.data.value,"uri");}if(!b.isEmpty()){self.log("Saving triples json: "+_4.toJson(b.getTalisJson()));var _7c0=[self.target];var _7c1=_PUNDIT.items.getItemByUri(self.target);if(_7c1.rdftype.indexOf(ns.fragments.image)!==-1){var _7c2=semlibImageFragmentHandler.getParentImageXpointer(_7c1.value);_7c0.push(_7c2);}self.saver.writeAnnotationContent(b,_7c0,_7be);}else{self.log("Empty bucket in saveTriples??!");}},saveItems:function(_7c3){var self=this,b=new pundit.TriplesBucket(),_7c4=[],item=_PUNDIT.items.getItemByUri(self.target);_7c4.push(item.rdfData);self.tagsDnD.forInItems(function(item){_7c4.push(item.data.rdfData);});for(var i=_7c4.length;i--;){b.concatBucket(_7c4[i]);}if(!b.isEmpty()){self.log("Posting "+_7c4.length+" items with "+b.bucket.length+" triples..");self.saver.writeAnnotationItems(_7c3,_4.toJson(b.getTalisJson()));}else{self.log("saveItems with an empty bucket??!");}},updateSaveBtn:function(){var self=this,_7c5=_4.byId("pundit-ctp-comment-input").innerHTML.replace(/<(?:.|\n)*?>/gm,""),sbtn=_4.query("#"+self._id+" .pundit-rp-save-button")[0],ebtn=_4.byId("pundit-ctp-extract-tags");if(_7c5===""&&(self.tagsDnD.getAllNodes().length===0)){_4.addClass(sbtn,"pundit-button-disabled");if(self.opts.enableEntitiesExtraction){_4.addClass(ebtn,"pundit-button-disabled");}}else{_4.removeClass(sbtn,"pundit-button-disabled");if(self.opts.enableEntitiesExtraction){_4.removeClass(ebtn,"pundit-button-disabled");}}},parseInputText:function(text){return unescape(text.innerHTML.replace(/&nbsp;/g," "));},markupText:function(tags){var self=this,a,tag,_7c6,_7c7,text=unescape(_4.byId("pundit-ctp-comment-input").innerHTML.replace(/<(?:.|\n)*?>/gm,"").replace(/&nbsp;/g," ")),_7c8=self.getTagsSortedByOffset(tags);for(var i=0;i<_7c8.length;i++){_7c6=parseInt(_7c8[i][0]);if(typeof (_7c7)!=="undefined"&&((_7c6===_7c7)||(_7c6+tag.length>=_7c7))){continue;}tag=_7c8[i][1];a="<a about=\""+tag.uri+"\" href=\""+tag.uri+"\" target=\"_blank\">"+tag.match+"</a>";text=text.substring(0,_7c6)+a+text.substring(_7c6+parseInt(tag.length),text.length);_7c7=_7c6;}_4.html.set("pundit-ctp-comment-input",text);},cancelPendingSpotlightRequests:function(){var self=this;if(typeof (self.enableSemanticExpansion)!=="undefined"){self.enableSemanticExpansion.cancel();}},itemIndex:function(uri){var self=this;for(var i=self.tagItems.length-1;i>=0;i--){if(self.tagItems[i].uri===uri){return i;}}return -1;},uriInItems:function(uri){var self=this,_7c9=false;self.tagsDnD.forInItems(function(item){if(item.data.value===uri){_7c9=true;return;}});return _7c9;},hide:function(){this.inherited(arguments);var self=this;self.cancelPendingRequests();self.lastSearchedComment="";_4.empty(_4.byId("pundit-ctp-comment-input"));},show:function(){this.inherited(arguments);_4.query("#pundit-ctp-extract-tags").attr("disabled",true);},removeTag:function(e){var self=this,node=_4.query(_4.query(e.target).parent()[0]),uri=self.tagsDnD.getItem(node[0].id).data.value;self.tagsDnD.deleteSelectedNodes();_4.behavior.apply();self.removeItemFromUri(uri);self.updateMarkup();self.updateSaveBtn();return true;},removeItemFromUri:function(uri){var self=this,_7ca=this.itemIndex(uri);for(var i=self.tagItems.length-1;i>=0;i--){if(self.tagItems[i].uri===uri){self.tagItems.splice(i,1);}}_4.destroy(_4.query("#pundit-ctp-tag-list li[about="+uri+"]")[0]);},updateMarkup:function(){var self=this;self.markupText(self.tagItems);},cancelPendingRequests:function(){var self=this;self.cancelPendingSpotlightRequests();if(typeof (self.lastTagRequest)!=="undefined"){self.lastTagRequest.cancel();}},onItemMouseOver:function(e){var self=this,node,_7cb;if(e.target.nodeName==="LI"){node=_4.query(e.target);}else{node=_4.query(_4.query(e.target).parent()[0]);}_7cb=self.tagsDnD.getItem(node[0].id).data.value;_4.query("#pundit-ctp-comment-input a[about=\""+_7cb+"\"]").forEach(function(node,i){_4.addClass(node,"pundit-selected");});self.showPreview(_7cb);},onItemMouseOut:function(e){var self=this,node,_7cc;if(e.target.nodeName==="LI"){node=_4.query(e.target);}else{node=_4.query(_4.query(e.target).parent()[0]);}_7cc=self.tagsDnD.getItem(node[0].id).data.value;_4.query("#pundit-ctp-comment-input a[about=\""+_7cc+"\"]").forEach(function(node,i){_4.removeClass(node,"pundit-selected");});},initPanel:function(item,_7cd){var self=this,_7ce={},_7cf=semlibMyItems.getItemsFromTerm("",[],[ns.fragments.text,ns.image]),_7d0=semlibItems.getItemsFromTerm("",[],[ns.fragments.text,ns.image]);_7ce={myitems:{label:"My Items",items:_7cf},pageitems:{label:"Page Items",items:_7d0}};for(var v in _PUNDIT["vocab"].vocabs){var _7d1=_PUNDIT["vocab"].getItemsForTermInVocab("",v);_7ce[v]={label:v,items:_7d1};}self.load(_7ce,"");self.show(200,100,{title:_7cd,target:item});_4.byId("pundit-ctp-comment-input").focus();return true;},getTagsSortedByOffset:function(tags){var self=this,_7d2=[];for(var i=0;i<tags.length;i++){_7d2.push([parseInt(tags[i].offset),tags[i]]);}_7d2.sort((function(a,b){return b[0]-a[0];}));return _7d2;}});}if(!_4._hasResource["pundit.AuthenticatedRequests"]){_4._hasResource["pundit.AuthenticatedRequests"]=true;_4.provide("pundit.AuthenticatedRequests");_4.declare("pundit.AuthenticatedRequests",pundit.BaseComponent,{opts:{loginTimerMS:500,loginAutomaticHideMS:2000},blockedRequests:[],constructor:function(_7d3){var self=this;self.redirectURL=null;self.initLoginDialog();self.createCallback(["login","logout"]);self.log("Authenticated requests component up and running!");},initLoginDialog:function(){var self=this,h="<div id='pundit-login-popup-content' class='off tundra'>";h+="<div class='off'><p>To view annotations and push them to Wikidata on this page you must log in.</p></div>";h+="<div class='waiting'><p>Please complete the process in the login window</p></div>";h+="<div class='logged'><p>You are logged in as:</p> <span class='username'>XYZ</span></div>";h+="<div id='pundit-login-popup-buttons'>";h+="<span id='pundit-login-close-button'>Close</span>";h+="<span id='pundit-login-open-button'>Open the login window</span>";h+="</div>";h+="</div>";self.dialog=new _5.Dialog({style:"width: 400px"});_4.addClass(_4.byId(self.dialog.id),"tundra");_4.destroy(self.dialog.closeButtonNode);self.dialog.attr("content",h);_4.connect(_4.byId("pundit-login-open-button"),"onclick",function(){_PUNDIT.ga.track("gui-button","click","#pundit-login-open-button");self.openLoginPopUp();});_4.connect(_4.byId("pundit-login-close-button"),"onclick",function(){_PUNDIT.ga.track("gui-button","click","#pundit-login-close-button");self.dialog.hide();clearTimeout(self.loginTimer);});},xGet:function(_7d4){return _4.xhrGet(this.setWrappingCallParams(_7d4));},xPost:function(_7d5){_4.xhrPost(this.setWrappingCallParams(_7d5));},xPut:function(_7d6){_4.xhrPut(this.setWrappingCallParams(_7d6));},xDelete:function(_7d7){_4.xhrDelete(this.setWrappingCallParams(_7d7));},showLoginForm:function(_7d8){this.redirectURL=_7d8;this.dialog.attr("title","You are not logged in!");_4.query("#pundit-login-popup-content").removeClass("logged").removeClass("waiting");this.dialog.show();},openLoginPopUp:function(){var self=this;window.open(self.redirectURL,"loginpopup","left=260,top=120,width=480,height=360");_4.query("#pundit-login-popup-content").removeClass("off").addClass("waiting");self.loginTimer=setTimeout(function(){self.checkLogin();},self.opts.loginTimerMS);},checkLogin:function(f){var self=this;var args={url:ns.annotationServerUsersCurrent,handleAs:"json",headers:{"Accept":"application/json",},load:function(data){if(typeof (data)==="undefined"||typeof (data.loginStatus)==="undefined"){data={loginStatus:0};}if(typeof (f)==="function"){f(data);return;}else{if(data.loginStatus==0){self.log("Not logged in.. yet...");self.loginTimer=setTimeout(function(){self.checkLogin();},self.opts.loginTimerMS);return;}}self.login(data);},error:function(_7d9){}};self.xGet(args);},login:function(data){var self=this;self.dialog.attr("title","You are now logged in!!");_4.query("#pundit-login-popup-content span.username").html(data.fullName+" ("+data.email+")");_4.query("#pundit-login-popup-content").removeClass("waiting").addClass("logged");for(var i=self.blockedRequests.length;i--;){self.xGet(self.blockedRequests[i]);}self.fireOnLogin(data);setTimeout(function(){self.dialog.hide();},self.opts.loginAutomaticHideMS);},logout:function(f){var self=this;clearTimeout(self.loginTimer);var args={url:ns.annotationServerUsersLogout,handleAs:"json",headers:{"Accept":"application/json"},load:function(data){var msg;if(typeof (data)!=="undefined"&&typeof (data.logout)!=="undefined"){data.msg=(data.logout==1)?"Logged out succesfully":"You werent logged in.. and you still arent.";if(typeof (f)==="function"){f(data);}self.fireOnLogout(data);}},error:function(_7da){console.log(_7da);}};self.xGet(args);},setWrappingCallParams:function(_7db){var self=this,_7dc={"withCredentials":true},key;for(key in _7db){if(key!=="load"){_7dc[key]=_7db[key];}else{_7dc[key]=function(r){if(r&&typeof (r.redirectTo)!=="undefined"){self.blockedRequests.push(_7dc);self.showLoginForm(r.redirectTo);}else{_7db.load(r);}};}}return _7dc;}});}if(!_4._hasResource["dijit.form._FormWidget"]){_4._hasResource["dijit.form._FormWidget"]=true;_4.provide("dijit.form._FormWidget");_4.declare("dijit.form._FormWidget",[_5._Widget,_5._Templated,_5._CssStateMixin],{name:"",alt:"",value:"",type:"text",tabIndex:"0",disabled:false,intermediateChanges:false,scrollOnFocus:true,attributeMap:_4.delegate(_5._Widget.prototype.attributeMap,{value:"focusNode",id:"focusNode",tabIndex:"focusNode",alt:"focusNode",title:"focusNode"}),postMixInProperties:function(){this.nameAttrSetting=this.name?("name=\""+this.name.replace(/'/g,"&quot;")+"\""):"";this.inherited(arguments);},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"onmousedown","_onMouseDown");},_setDisabledAttr:function(_7dd){this._set("disabled",_7dd);_4.attr(this.focusNode,"disabled",_7dd);if(this.valueNode){_4.attr(this.valueNode,"disabled",_7dd);}_5.setWaiState(this.focusNode,"disabled",_7dd);if(_7dd){this._set("hovering",false);this._set("active",false);var _7de="tabIndex" in this.attributeMap?this.attributeMap.tabIndex:"focusNode";_4.forEach(_4.isArray(_7de)?_7de:[_7de],function(_7df){var node=this[_7df];if(_4.isWebKit||_5.hasDefaultTabStop(node)){node.setAttribute("tabIndex","-1");}else{node.removeAttribute("tabIndex");}},this);}else{if(this.tabIndex!=""){this.focusNode.setAttribute("tabIndex",this.tabIndex);}}},setDisabled:function(_7e0){_4.deprecated("setDisabled("+_7e0+") is deprecated. Use set('disabled',"+_7e0+") instead.","","2.0");this.set("disabled",_7e0);},_onFocus:function(e){if(this.scrollOnFocus){_4.window.scrollIntoView(this.domNode);}this.inherited(arguments);},isFocusable:function(){return !this.disabled&&this.focusNode&&(_4.style(this.domNode,"display")!="none");},focus:function(){if(!this.disabled){_5.focus(this.focusNode);}},compare:function(val1,val2){if(typeof val1=="number"&&typeof val2=="number"){return (isNaN(val1)&&isNaN(val2))?0:val1-val2;}else{if(val1>val2){return 1;}else{if(val1<val2){return -1;}else{return 0;}}}},onChange:function(_7e1){},_onChangeActive:false,_handleOnChange:function(_7e2,_7e3){if(this._lastValueReported==undefined&&(_7e3===null||!this._onChangeActive)){this._resetValue=this._lastValueReported=_7e2;}this._pendingOnChange=this._pendingOnChange||(typeof _7e2!=typeof this._lastValueReported)||(this.compare(_7e2,this._lastValueReported)!=0);if((this.intermediateChanges||_7e3||_7e3===undefined)&&this._pendingOnChange){this._lastValueReported=_7e2;this._pendingOnChange=false;if(this._onChangeActive){if(this._onChangeHandle){clearTimeout(this._onChangeHandle);}this._onChangeHandle=setTimeout(_4.hitch(this,function(){this._onChangeHandle=null;this.onChange(_7e2);}),0);}}},create:function(){this.inherited(arguments);this._onChangeActive=true;},destroy:function(){if(this._onChangeHandle){clearTimeout(this._onChangeHandle);this.onChange(this._lastValueReported);}this.inherited(arguments);},setValue:function(_7e4){_4.deprecated("dijit.form._FormWidget:setValue("+_7e4+") is deprecated.  Use set('value',"+_7e4+") instead.","","2.0");this.set("value",_7e4);},getValue:function(){_4.deprecated(this.declaredClass+"::getValue() is deprecated. Use get('value') instead.","","2.0");return this.get("value");},_onMouseDown:function(e){if(!e.ctrlKey&&_4.mouseButtons.isLeft(e)&&this.isFocusable()){var _7e5=this.connect(_4.body(),"onmouseup",function(){if(this.isFocusable()){this.focus();}this.disconnect(_7e5);});}}});_4.declare("dijit.form._FormValueWidget",_5.form._FormWidget,{readOnly:false,attributeMap:_4.delegate(_5.form._FormWidget.prototype.attributeMap,{value:"",readOnly:"focusNode"}),_setReadOnlyAttr:function(_7e6){_4.attr(this.focusNode,"readOnly",_7e6);_5.setWaiState(this.focusNode,"readonly",_7e6);this._set("readOnly",_7e6);},postCreate:function(){this.inherited(arguments);if(_4.isIE<9||(_4.isIE&&_4.isQuirks)){this.connect(this.focusNode||this.domNode,"onkeydown",this._onKeyDown);}if(this._resetValue===undefined){this._lastValueReported=this._resetValue=this.value;}},_setValueAttr:function(_7e7,_7e8){this._handleOnChange(_7e7,_7e8);},_handleOnChange:function(_7e9,_7ea){this._set("value",_7e9);this.inherited(arguments);},undo:function(){this._setValueAttr(this._lastValueReported,false);},reset:function(){this._hasBeenBlurred=false;this._setValueAttr(this._resetValue,true);},_onKeyDown:function(e){if(e.keyCode==_4.keys.ESCAPE&&!(e.ctrlKey||e.altKey||e.metaKey)){var te;if(_4.isIE){e.preventDefault();te=document.createEventObject();te.keyCode=_4.keys.ESCAPE;te.shiftKey=e.shiftKey;e.srcElement.fireEvent("onkeypress",te);}}},_layoutHackIE7:function(){if(_4.isIE==7){var _7eb=this.domNode;var _7ec=_7eb.parentNode;var _7ed=_7eb.firstChild||_7eb;var _7ee=_7ed.style.filter;var _7ef=this;while(_7ec&&_7ec.clientHeight==0){(function ping(){var _7f0=_7ef.connect(_7ec,"onscroll",function(e){_7ef.disconnect(_7f0);_7ed.style.filter=(new Date()).getMilliseconds();setTimeout(function(){_7ed.style.filter=_7ee;},0);});})();_7ec=_7ec.parentNode;}}}});}if(!_4._hasResource["dijit._HasDropDown"]){_4._hasResource["dijit._HasDropDown"]=true;_4.provide("dijit._HasDropDown");_4.declare("dijit._HasDropDown",null,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:true,forceWidth:false,maxHeight:0,dropDownPosition:["below","above"],_stopClickEvents:true,_onDropDownMouseDown:function(e){if(this.disabled||this.readOnly){return;}_4.stopEvent(e);this._docHandler=this.connect(_4.doc,"onmouseup","_onDropDownMouseUp");this.toggleDropDown();},_onDropDownMouseUp:function(e){if(e&&this._docHandler){this.disconnect(this._docHandler);}var _7f1=this.dropDown,_7f2=false;if(e&&this._opened){var c=_4.position(this._buttonNode,true);if(!(e.pageX>=c.x&&e.pageX<=c.x+c.w)||!(e.pageY>=c.y&&e.pageY<=c.y+c.h)){var t=e.target;while(t&&!_7f2){if(_4.hasClass(t,"dijitPopup")){_7f2=true;}else{t=t.parentNode;}}if(_7f2){t=e.target;if(_7f1.onItemClick){var _7f3;while(t&&!(_7f3=_5.byNode(t))){t=t.parentNode;}if(_7f3&&_7f3.onClick&&_7f3.getParent){_7f3.getParent().onItemClick(_7f3,e);}}return;}}}if(this._opened&&_7f1.focus&&_7f1.autoFocus!==false){window.setTimeout(_4.hitch(_7f1,"focus"),1);}},_onDropDownClick:function(e){if(this._stopClickEvents){_4.stopEvent(e);}},buildRendering:function(){this.inherited(arguments);this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var _7f4={"after":this.isLeftToRight()?"Right":"Left","before":this.isLeftToRight()?"Left":"Right","above":"Up","below":"Down","left":"Left","right":"Right"}[this.dropDownPosition[0]]||this.dropDownPosition[0]||"Down";_4.addClass(this._arrowWrapperNode||this._buttonNode,"dijit"+_7f4+"ArrowButton");},postCreate:function(){this.inherited(arguments);this.connect(this._buttonNode,"onmousedown","_onDropDownMouseDown");this.connect(this._buttonNode,"onclick","_onDropDownClick");this.connect(this.focusNode,"onkeypress","_onKey");this.connect(this.focusNode,"onkeyup","_onKeyUp");},destroy:function(){if(this.dropDown){if(!this.dropDown._destroyed){this.dropDown.destroyRecursive();}delete this.dropDown;}this.inherited(arguments);},_onKey:function(e){if(this.disabled||this.readOnly){return;}var d=this.dropDown,_7f5=e.target;if(d&&this._opened&&d.handleKey){if(d.handleKey(e)===false){_4.stopEvent(e);return;}}if(d&&this._opened&&e.charOrCode==_4.keys.ESCAPE){this.closeDropDown();_4.stopEvent(e);}else{if(!this._opened&&(e.charOrCode==_4.keys.DOWN_ARROW||((e.charOrCode==_4.keys.ENTER||e.charOrCode==" ")&&((_7f5.tagName||"").toLowerCase()!=="input"||(_7f5.type&&_7f5.type.toLowerCase()!=="text"))))){this._toggleOnKeyUp=true;_4.stopEvent(e);}}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp;this.toggleDropDown();var d=this.dropDown;if(d&&d.focus){setTimeout(_4.hitch(d,"focus"),1);}}},_onBlur:function(){var _7f6=_5._curFocus&&this.dropDown&&_4.isDescendant(_5._curFocus,this.dropDown.domNode);this.closeDropDown(_7f6);this.inherited(arguments);},isLoaded:function(){return true;},loadDropDown:function(_7f7){_7f7();},toggleDropDown:function(){if(this.disabled||this.readOnly){return;}if(!this._opened){if(!this.isLoaded()){this.loadDropDown(_4.hitch(this,"openDropDown"));return;}else{this.openDropDown();}}else{this.closeDropDown();}},openDropDown:function(){var _7f8=this.dropDown,_7f9=_7f8.domNode,_7fa=this._aroundNode||this.domNode,self=this;if(!this._preparedNode){this._preparedNode=true;if(_7f9.style.width){this._explicitDDWidth=true;}if(_7f9.style.height){this._explicitDDHeight=true;}}if(this.maxHeight||this.forceWidth||this.autoWidth){var _7fb={display:"",visibility:"hidden"};if(!this._explicitDDWidth){_7fb.width="";}if(!this._explicitDDHeight){_7fb.height="";}_4.style(_7f9,_7fb);var _7fc=this.maxHeight;if(_7fc==-1){var _7fd=_4.window.getBox(),_7fe=_4.position(_7fa,false);_7fc=Math.floor(Math.max(_7fe.y,_7fd.h-(_7fe.y+_7fe.h)));}if(_7f8.startup&&!_7f8._started){_7f8.startup();}_5.popup.moveOffScreen(_7f8);var mb=_4._getMarginSize(_7f9);var _7ff=(_7fc&&mb.h>_7fc);_4.style(_7f9,{overflowX:"hidden",overflowY:_7ff?"auto":"hidden"});if(_7ff){mb.h=_7fc;if("w" in mb){mb.w+=16;}}else{delete mb.h;}if(this.forceWidth){mb.w=_7fa.offsetWidth;}else{if(this.autoWidth){mb.w=Math.max(mb.w,_7fa.offsetWidth);}else{delete mb.w;}}if(_4.isFunction(_7f8.resize)){_7f8.resize(mb);}else{_4.marginBox(_7f9,mb);}}var _800=_5.popup.open({parent:this,popup:_7f8,around:_7fa,orient:_5.getPopupAroundAlignment((this.dropDownPosition&&this.dropDownPosition.length)?this.dropDownPosition:["below"],this.isLeftToRight()),onExecute:function(){self.closeDropDown(true);},onCancel:function(){self.closeDropDown(true);},onClose:function(){_4.attr(self._popupStateNode,"popupActive",false);_4.removeClass(self._popupStateNode,"dijitHasDropDownOpen");self._opened=false;}});_4.attr(this._popupStateNode,"popupActive","true");_4.addClass(self._popupStateNode,"dijitHasDropDownOpen");this._opened=true;return _800;},closeDropDown:function(_801){if(this._opened){if(_801){this.focus();}_5.popup.close(this.dropDown);this._opened=false;}}});}if(!_4._hasResource["dijit.form.Button"]){_4._hasResource["dijit.form.Button"]=true;_4.provide("dijit.form.Button");_4.declare("dijit.form.Button",_5.form._FormWidget,{label:"",showLabel:true,iconClass:"",type:"button",baseClass:"dijitButton",templateString:_4.cache("dijit.form","templates/Button.html","<span class=\"dijit dijitReset dijitInline\"\n\t><span class=\"dijitReset dijitInline dijitButtonNode\"\n\t\tdojoAttachEvent=\"ondijitclick:_onButtonClick\"\n\t\t><span class=\"dijitReset dijitStretch dijitButtonContents\"\n\t\t\tdojoAttachPoint=\"titleNode,focusNode\"\n\t\t\trole=\"button\" aria-labelledby=\"${id}_label\"\n\t\t\t><span class=\"dijitReset dijitInline dijitIcon\" dojoAttachPoint=\"iconNode\"></span\n\t\t\t><span class=\"dijitReset dijitToggleButtonIconChar\">&#x25CF;</span\n\t\t\t><span class=\"dijitReset dijitInline dijitButtonText\"\n\t\t\t\tid=\"${id}_label\"\n\t\t\t\tdojoAttachPoint=\"containerNode\"\n\t\t\t></span\n\t\t></span\n\t></span\n\t><input ${!nameAttrSetting} type=\"${type}\" value=\"${value}\" class=\"dijitOffScreen\" tabIndex=\"-1\"\n\t\tdojoAttachPoint=\"valueNode\"\n/></span>\n"),attributeMap:_4.delegate(_5.form._FormWidget.prototype.attributeMap,{value:"valueNode"}),_onClick:function(e){if(this.disabled){return false;}this._clicked();return this.onClick(e);},_onButtonClick:function(e){if(this._onClick(e)===false){e.preventDefault();}else{if(this.type=="submit"&&!(this.valueNode||this.focusNode).form){for(var node=this.domNode;node.parentNode;node=node.parentNode){var _802=_5.byNode(node);if(_802&&typeof _802._onSubmit=="function"){_802._onSubmit(e);break;}}}else{if(this.valueNode){this.valueNode.click();e.preventDefault();}}}},buildRendering:function(){this.inherited(arguments);_4.setSelectable(this.focusNode,false);},_fillContent:function(_803){if(_803&&(!this.params||!("label" in this.params))){this.set("label",_803.innerHTML);}},_setShowLabelAttr:function(val){if(this.containerNode){_4.toggleClass(this.containerNode,"dijitDisplayNone",!val);}this._set("showLabel",val);},onClick:function(e){return true;},_clicked:function(e){},setLabel:function(_804){_4.deprecated("dijit.form.Button.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",_804);},_setLabelAttr:function(_805){this._set("label",_805);this.containerNode.innerHTML=_805;if(this.showLabel==false&&!this.params.title){this.titleNode.title=_4.trim(this.containerNode.innerText||this.containerNode.textContent||"");}},_setIconClassAttr:function(val){var _806=this.iconClass||"dijitNoIcon",_807=val||"dijitNoIcon";_4.replaceClass(this.iconNode,_807,_806);this._set("iconClass",val);}});_4.declare("dijit.form.DropDownButton",[_5.form.Button,_5._Container,_5._HasDropDown],{baseClass:"dijitDropDownButton",templateString:_4.cache("dijit.form","templates/DropDownButton.html","<span class=\"dijit dijitReset dijitInline\"\n\t><span class='dijitReset dijitInline dijitButtonNode'\n\t\tdojoAttachEvent=\"ondijitclick:_onButtonClick\" dojoAttachPoint=\"_buttonNode\"\n\t\t><span class=\"dijitReset dijitStretch dijitButtonContents\"\n\t\t\tdojoAttachPoint=\"focusNode,titleNode,_arrowWrapperNode\"\n\t\t\trole=\"button\" aria-haspopup=\"true\" aria-labelledby=\"${id}_label\"\n\t\t\t><span class=\"dijitReset dijitInline dijitIcon\"\n\t\t\t\tdojoAttachPoint=\"iconNode\"\n\t\t\t></span\n\t\t\t><span class=\"dijitReset dijitInline dijitButtonText\"\n\t\t\t\tdojoAttachPoint=\"containerNode,_popupStateNode\"\n\t\t\t\tid=\"${id}_label\"\n\t\t\t></span\n\t\t\t><span class=\"dijitReset dijitInline dijitArrowButtonInner\"></span\n\t\t\t><span class=\"dijitReset dijitInline dijitArrowButtonChar\">&#9660;</span\n\t\t></span\n\t></span\n\t><input ${!nameAttrSetting} type=\"${type}\" value=\"${value}\" class=\"dijitOffScreen\" tabIndex=\"-1\"\n\t\tdojoAttachPoint=\"valueNode\"\n/></span>\n"),_fillContent:function(){if(this.srcNodeRef){var _808=_4.query("*",this.srcNodeRef);_5.form.DropDownButton.superclass._fillContent.call(this,_808[0]);this.dropDownContainer=this.srcNodeRef;}},startup:function(){if(this._started){return;}if(!this.dropDown&&this.dropDownContainer){var _809=_4.query("[widgetId]",this.dropDownContainer)[0];this.dropDown=_5.byNode(_809);delete this.dropDownContainer;}if(this.dropDown){_5.popup.hide(this.dropDown);}this.inherited(arguments);},isLoaded:function(){var _80a=this.dropDown;return (!!_80a&&(!_80a.href||_80a.isLoaded));},loadDropDown:function(){var _80b=this.dropDown;if(!_80b){return;}if(!this.isLoaded()){var _80c=_4.connect(_80b,"onLoad",this,function(){_4.disconnect(_80c);this.openDropDown();});_80b.refresh();}else{this.openDropDown();}},isFocusable:function(){return this.inherited(arguments)&&!this._mouseDown;}});_4.declare("dijit.form.ComboButton",_5.form.DropDownButton,{templateString:_4.cache("dijit.form","templates/ComboButton.html","<table class=\"dijit dijitReset dijitInline dijitLeft\"\n\tcellspacing='0' cellpadding='0' role=\"presentation\"\n\t><tbody role=\"presentation\"><tr role=\"presentation\"\n\t\t><td class=\"dijitReset dijitStretch dijitButtonNode\" dojoAttachPoint=\"buttonNode\" dojoAttachEvent=\"ondijitclick:_onButtonClick,onkeypress:_onButtonKeyPress\"\n\t\t><div id=\"${id}_button\" class=\"dijitReset dijitButtonContents\"\n\t\t\tdojoAttachPoint=\"titleNode\"\n\t\t\trole=\"button\" aria-labelledby=\"${id}_label\"\n\t\t\t><div class=\"dijitReset dijitInline dijitIcon\" dojoAttachPoint=\"iconNode\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitInline dijitButtonText\" id=\"${id}_label\" dojoAttachPoint=\"containerNode\" role=\"presentation\"></div\n\t\t></div\n\t\t></td\n\t\t><td id=\"${id}_arrow\" class='dijitReset dijitRight dijitButtonNode dijitArrowButton'\n\t\t\tdojoAttachPoint=\"_popupStateNode,focusNode,_buttonNode\"\n\t\t\tdojoAttachEvent=\"onkeypress:_onArrowKeyPress\"\n\t\t\ttitle=\"${optionsTitle}\"\n\t\t\trole=\"button\" aria-haspopup=\"true\"\n\t\t\t><div class=\"dijitReset dijitArrowButtonInner\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitArrowButtonChar\" role=\"presentation\">&#9660;</div\n\t\t></td\n\t\t><td style=\"display:none !important;\"\n\t\t\t><input ${!nameAttrSetting} type=\"${type}\" value=\"${value}\" dojoAttachPoint=\"valueNode\"\n\t\t/></td></tr></tbody\n></table>\n"),attributeMap:_4.mixin(_4.clone(_5.form.Button.prototype.attributeMap),{id:"",tabIndex:["focusNode","titleNode"],title:"titleNode"}),optionsTitle:"",baseClass:"dijitComboButton",cssStateNodes:{"buttonNode":"dijitButtonNode","titleNode":"dijitButtonContents","_popupStateNode":"dijitDownArrowButton"},_focusedNode:null,_onButtonKeyPress:function(evt){if(evt.charOrCode==_4.keys[this.isLeftToRight()?"RIGHT_ARROW":"LEFT_ARROW"]){_5.focus(this._popupStateNode);_4.stopEvent(evt);}},_onArrowKeyPress:function(evt){if(evt.charOrCode==_4.keys[this.isLeftToRight()?"LEFT_ARROW":"RIGHT_ARROW"]){_5.focus(this.titleNode);_4.stopEvent(evt);}},focus:function(_80d){if(!this.disabled){_5.focus(_80d=="start"?this.titleNode:this._popupStateNode);}}});_4.declare("dijit.form.ToggleButton",_5.form.Button,{baseClass:"dijitToggleButton",checked:false,attributeMap:_4.mixin(_4.clone(_5.form.Button.prototype.attributeMap),{checked:"focusNode"}),_clicked:function(evt){this.set("checked",!this.checked);},_setCheckedAttr:function(_80e,_80f){this._set("checked",_80e);_4.attr(this.focusNode||this.domNode,"checked",_80e);_5.setWaiState(this.focusNode||this.domNode,"pressed",_80e);this._handleOnChange(_80e,_80f);},setChecked:function(_810){_4.deprecated("setChecked("+_810+") is deprecated. Use set('checked',"+_810+") instead.","","2.0");this.set("checked",_810);},reset:function(){this._hasBeenBlurred=false;this.set("checked",this.params.checked||false);}});}if(!_4._hasResource["dijit.form.DropDownButton"]){_4._hasResource["dijit.form.DropDownButton"]=true;_4.provide("dijit.form.DropDownButton");}if(!_4._hasResource["dijit._KeyNavContainer"]){_4._hasResource["dijit._KeyNavContainer"]=true;_4.provide("dijit._KeyNavContainer");_4.declare("dijit._KeyNavContainer",_5._Container,{tabIndex:"0",_keyNavCodes:{},connectKeyNavHandlers:function(_811,_812){var _813=(this._keyNavCodes={});var prev=_4.hitch(this,this.focusPrev);var next=_4.hitch(this,this.focusNext);_4.forEach(_811,function(code){_813[code]=prev;});_4.forEach(_812,function(code){_813[code]=next;});_813[_4.keys.HOME]=_4.hitch(this,"focusFirstChild");_813[_4.keys.END]=_4.hitch(this,"focusLastChild");this.connect(this.domNode,"onkeypress","_onContainerKeypress");this.connect(this.domNode,"onfocus","_onContainerFocus");},startupKeyNavChildren:function(){_4.forEach(this.getChildren(),_4.hitch(this,"_startupChild"));},addChild:function(_814,_815){_5._KeyNavContainer.superclass.addChild.apply(this,arguments);this._startupChild(_814);},focus:function(){this.focusFirstChild();},focusFirstChild:function(){var _816=this._getFirstFocusableChild();if(_816){this.focusChild(_816);}},focusLastChild:function(){var _817=this._getLastFocusableChild();if(_817){this.focusChild(_817);}},focusNext:function(){var _818=this._getNextFocusableChild(this.focusedChild,1);this.focusChild(_818);},focusPrev:function(){var _819=this._getNextFocusableChild(this.focusedChild,-1);this.focusChild(_819,true);},focusChild:function(_81a,last){if(this.focusedChild&&_81a!==this.focusedChild){this._onChildBlur(this.focusedChild);}_81a.set("tabIndex",this.tabIndex);_81a.focus(last?"end":"start");this._set("focusedChild",_81a);},_startupChild:function(_81b){_81b.set("tabIndex","-1");this.connect(_81b,"_onFocus",function(){_81b.set("tabIndex",this.tabIndex);});this.connect(_81b,"_onBlur",function(){_81b.set("tabIndex","-1");});},_onContainerFocus:function(evt){if(evt.target!==this.domNode){return;}this.focusFirstChild();_4.attr(this.domNode,"tabIndex","-1");},_onBlur:function(evt){if(this.tabIndex){_4.attr(this.domNode,"tabIndex",this.tabIndex);}this.inherited(arguments);},_onContainerKeypress:function(evt){if(evt.ctrlKey||evt.altKey){return;}var func=this._keyNavCodes[evt.charOrCode];if(func){func();_4.stopEvent(evt);}},_onChildBlur:function(_81c){},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1);},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1);},_getNextFocusableChild:function(_81d,dir){if(_81d){_81d=this._getSiblingOfChild(_81d,dir);}var _81e=this.getChildren();for(var i=0;i<_81e.length;i++){if(!_81d){_81d=_81e[(dir>0)?0:(_81e.length-1)];}if(_81d.isFocusable()){return _81d;}_81d=this._getSiblingOfChild(_81d,dir);}return null;}});}if(!_4._hasResource["dijit.MenuItem"]){_4._hasResource["dijit.MenuItem"]=true;_4.provide("dijit.MenuItem");_4.declare("dijit.MenuItem",[_5._Widget,_5._Templated,_5._Contained,_5._CssStateMixin],{templateString:_4.cache("dijit","templates/MenuItem.html","<tr class=\"dijitReset dijitMenuItem\" dojoAttachPoint=\"focusNode\" role=\"menuitem\" tabIndex=\"-1\"\n\t\tdojoAttachEvent=\"onmouseenter:_onHover,onmouseleave:_onUnhover,ondijitclick:_onClick\">\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitIcon dijitMenuItemIcon\" dojoAttachPoint=\"iconNode\"/>\n\t</td>\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" dojoAttachPoint=\"containerNode\"></td>\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" dojoAttachPoint=\"accelKeyNode\"></td>\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">\n\t\t<div dojoAttachPoint=\"arrowWrapper\" style=\"visibility: hidden\">\n\t\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuExpand\"/>\n\t\t\t<span class=\"dijitMenuExpandA11y\">+</span>\n\t\t</div>\n\t</td>\n</tr>\n"),attributeMap:_4.delegate(_5._Widget.prototype.attributeMap,{label:{node:"containerNode",type:"innerHTML"},iconClass:{node:"iconNode",type:"class"}}),baseClass:"dijitMenuItem",label:"",iconClass:"",accelKey:"",disabled:false,_fillContent:function(_81f){if(_81f&&!("label" in this.params)){this.set("label",_81f.innerHTML);}},buildRendering:function(){this.inherited(arguments);var _820=this.id+"_text";_4.attr(this.containerNode,"id",_820);if(this.accelKeyNode){_4.attr(this.accelKeyNode,"id",this.id+"_accel");_820+=" "+this.id+"_accel";}_5.setWaiState(this.domNode,"labelledby",_820);_4.setSelectable(this.domNode,false);},_onHover:function(){this.getParent().onItemHover(this);},_onUnhover:function(){this.getParent().onItemUnhover(this);this._set("hovering",false);},_onClick:function(evt){this.getParent().onItemClick(this,evt);_4.stopEvent(evt);},onClick:function(evt){},focus:function(){try{if(_4.isIE==8){this.containerNode.focus();}_5.focus(this.focusNode);}catch(e){}},_onFocus:function(){this._setSelected(true);this.getParent()._onItemFocus(this);this.inherited(arguments);},_setSelected:function(_821){_4.toggleClass(this.domNode,"dijitMenuItemSelected",_821);},setLabel:function(_822){_4.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",_822);},setDisabled:function(_823){_4.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",_823);},_setDisabledAttr:function(_824){_5.setWaiState(this.focusNode,"disabled",_824?"true":"false");this._set("disabled",_824);},_setAccelKeyAttr:function(_825){this.accelKeyNode.style.display=_825?"":"none";this.accelKeyNode.innerHTML=_825;_4.attr(this.containerNode,"colSpan",_825?"1":"2");this._set("accelKey",_825);}});}if(!_4._hasResource["dijit.PopupMenuItem"]){_4._hasResource["dijit.PopupMenuItem"]=true;_4.provide("dijit.PopupMenuItem");_4.declare("dijit.PopupMenuItem",_5.MenuItem,{_fillContent:function(){if(this.srcNodeRef){var _826=_4.query("*",this.srcNodeRef);_5.PopupMenuItem.superclass._fillContent.call(this,_826[0]);this.dropDownContainer=this.srcNodeRef;}},startup:function(){if(this._started){return;}this.inherited(arguments);if(!this.popup){var node=_4.query("[widgetId]",this.dropDownContainer)[0];this.popup=_5.byNode(node);}_4.body().appendChild(this.popup.domNode);this.popup.startup();this.popup.domNode.style.display="none";if(this.arrowWrapper){_4.style(this.arrowWrapper,"visibility","");}_5.setWaiState(this.focusNode,"haspopup","true");},destroyDescendants:function(){if(this.popup){if(!this.popup._destroyed){this.popup.destroyRecursive();}delete this.popup;}this.inherited(arguments);}});}if(!_4._hasResource["dijit.CheckedMenuItem"]){_4._hasResource["dijit.CheckedMenuItem"]=true;_4.provide("dijit.CheckedMenuItem");_4.declare("dijit.CheckedMenuItem",_5.MenuItem,{templateString:_4.cache("dijit","templates/CheckedMenuItem.html","<tr class=\"dijitReset dijitMenuItem\" dojoAttachPoint=\"focusNode\" role=\"menuitemcheckbox\" tabIndex=\"-1\"\n\t\tdojoAttachEvent=\"onmouseenter:_onHover,onmouseleave:_onUnhover,ondijitclick:_onClick\">\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\" dojoAttachPoint=\"iconNode\"/>\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\n\t</td>\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" dojoAttachPoint=\"containerNode,labelNode\"></td>\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" dojoAttachPoint=\"accelKeyNode\"></td>\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&nbsp;</td>\n</tr>\n"),checked:false,_setCheckedAttr:function(_827){_4.toggleClass(this.domNode,"dijitCheckedMenuItemChecked",_827);_5.setWaiState(this.domNode,"checked",_827);this._set("checked",_827);},onChange:function(_828){},_onClick:function(e){if(!this.disabled){this.set("checked",!this.checked);this.onChange(this.checked);}this.inherited(arguments);}});}if(!_4._hasResource["dijit.MenuSeparator"]){_4._hasResource["dijit.MenuSeparator"]=true;_4.provide("dijit.MenuSeparator");_4.declare("dijit.MenuSeparator",[_5._Widget,_5._Templated,_5._Contained],{templateString:_4.cache("dijit","templates/MenuSeparator.html","<tr class=\"dijitMenuSeparator\">\n\t<td class=\"dijitMenuSeparatorIconCell\">\n\t\t<div class=\"dijitMenuSeparatorTop\"></div>\n\t\t<div class=\"dijitMenuSeparatorBottom\"></div>\n\t</td>\n\t<td colspan=\"3\" class=\"dijitMenuSeparatorLabelCell\">\n\t\t<div class=\"dijitMenuSeparatorTop dijitMenuSeparatorLabel\"></div>\n\t\t<div class=\"dijitMenuSeparatorBottom\"></div>\n\t</td>\n</tr>\n"),buildRendering:function(){this.inherited(arguments);_4.setSelectable(this.domNode,false);},isFocusable:function(){return false;}});}if(!_4._hasResource["dijit.Menu"]){_4._hasResource["dijit.Menu"]=true;_4.provide("dijit.Menu");_4.declare("dijit._MenuBase",[_5._Widget,_5._Templated,_5._KeyNavContainer],{parentMenu:null,popupDelay:500,startup:function(){if(this._started){return;}_4.forEach(this.getChildren(),function(_829){_829.startup();});this.startupKeyNavChildren();this.inherited(arguments);},onExecute:function(){},onCancel:function(_82a){},_moveToPopup:function(evt){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled){this.focusedChild._onClick(evt);}else{var _82b=this._getTopMenu();if(_82b&&_82b._isMenuBar){_82b.focusNext();}}},_onPopupHover:function(evt){if(this.currentPopup&&this.currentPopup._pendingClose_timer){var _82c=this.currentPopup.parentMenu;if(_82c.focusedChild){_82c.focusedChild._setSelected(false);}_82c.focusedChild=this.currentPopup.from_item;_82c.focusedChild._setSelected(true);this._stopPendingCloseTimer(this.currentPopup);}},onItemHover:function(item){if(this.isActive){this.focusChild(item);if(this.focusedChild.popup&&!this.focusedChild.disabled&&!this.hover_timer){this.hover_timer=setTimeout(_4.hitch(this,"_openPopup"),this.popupDelay);}}if(this.focusedChild){this.focusChild(item);}this._hoveredChild=item;},_onChildBlur:function(item){this._stopPopupTimer();item._setSelected(false);var _82d=item.popup;if(_82d){this._stopPendingCloseTimer(_82d);_82d._pendingClose_timer=setTimeout(function(){_82d._pendingClose_timer=null;if(_82d.parentMenu){_82d.parentMenu.currentPopup=null;}_5.popup.close(_82d);},this.popupDelay);}},onItemUnhover:function(item){if(this.isActive){this._stopPopupTimer();}if(this._hoveredChild==item){this._hoveredChild=null;}},_stopPopupTimer:function(){if(this.hover_timer){clearTimeout(this.hover_timer);this.hover_timer=null;}},_stopPendingCloseTimer:function(_82e){if(_82e._pendingClose_timer){clearTimeout(_82e._pendingClose_timer);_82e._pendingClose_timer=null;}},_stopFocusTimer:function(){if(this._focus_timer){clearTimeout(this._focus_timer);this._focus_timer=null;}},_getTopMenu:function(){for(var top=this;top.parentMenu;top=top.parentMenu){}return top;},onItemClick:function(item,evt){if(typeof this.isShowingNow=="undefined"){this._markActive();}this.focusChild(item);if(item.disabled){return false;}if(item.popup){this._openPopup();}else{this.onExecute();item.onClick(evt);}},_openPopup:function(){this._stopPopupTimer();var _82f=this.focusedChild;if(!_82f){return;}var _830=_82f.popup;if(_830.isShowingNow){return;}if(this.currentPopup){this._stopPendingCloseTimer(this.currentPopup);_5.popup.close(this.currentPopup);}_830.parentMenu=this;_830.from_item=_82f;var self=this;_5.popup.open({parent:this,popup:_830,around:_82f.domNode,orient:this._orient||(this.isLeftToRight()?{"TR":"TL","TL":"TR","BR":"BL","BL":"BR"}:{"TL":"TR","TR":"TL","BL":"BR","BR":"BL"}),onCancel:function(){self.focusChild(_82f);self._cleanUp();_82f._setSelected(true);self.focusedChild=_82f;},onExecute:_4.hitch(this,"_cleanUp")});this.currentPopup=_830;_830.connect(_830.domNode,"onmouseenter",_4.hitch(self,"_onPopupHover"));if(_830.focus){_830._focus_timer=setTimeout(_4.hitch(_830,function(){this._focus_timer=null;this.focus();}),0);}},_markActive:function(){this.isActive=true;_4.replaceClass(this.domNode,"dijitMenuActive","dijitMenuPassive");},onOpen:function(e){this.isShowingNow=true;this._markActive();},_markInactive:function(){this.isActive=false;_4.replaceClass(this.domNode,"dijitMenuPassive","dijitMenuActive");},onClose:function(){this._stopFocusTimer();this._markInactive();this.isShowingNow=false;this.parentMenu=null;},_closeChild:function(){this._stopPopupTimer();var _831=this.focusedChild&&this.focusedChild.from_item;if(this.currentPopup){if(_5._curFocus&&_4.isDescendant(_5._curFocus,this.currentPopup.domNode)){this.focusedChild.focusNode.focus();}_5.popup.close(this.currentPopup);this.currentPopup=null;}if(this.focusedChild){this.focusedChild._setSelected(false);this.focusedChild._onUnhover();this.focusedChild=null;}},_onItemFocus:function(item){if(this._hoveredChild&&this._hoveredChild!=item){this._hoveredChild._onUnhover();}},_onBlur:function(){this._cleanUp();this.inherited(arguments);},_cleanUp:function(){this._closeChild();if(typeof this.isShowingNow=="undefined"){this._markInactive();}}});_4.declare("dijit.Menu",_5._MenuBase,{constructor:function(){this._bindings=[];},templateString:_4.cache("dijit","templates/Menu.html","<table class=\"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable\" role=\"menu\" tabIndex=\"${tabIndex}\" dojoAttachEvent=\"onkeypress:_onKeyPress\" cellspacing=\"0\">\n\t<tbody class=\"dijitReset\" dojoAttachPoint=\"containerNode\"></tbody>\n</table>\n"),baseClass:"dijitMenu",targetNodeIds:[],contextMenuForWindow:false,leftClickToOpen:false,refocus:true,postCreate:function(){if(this.contextMenuForWindow){this.bindDomNode(_4.body());}else{_4.forEach(this.targetNodeIds,this.bindDomNode,this);}var k=_4.keys,l=this.isLeftToRight();this._openSubMenuKey=l?k.RIGHT_ARROW:k.LEFT_ARROW;this._closeSubMenuKey=l?k.LEFT_ARROW:k.RIGHT_ARROW;this.connectKeyNavHandlers([k.UP_ARROW],[k.DOWN_ARROW]);},_onKeyPress:function(evt){if(evt.ctrlKey||evt.altKey){return;}switch(evt.charOrCode){case this._openSubMenuKey:this._moveToPopup(evt);_4.stopEvent(evt);break;case this._closeSubMenuKey:if(this.parentMenu){if(this.parentMenu._isMenuBar){this.parentMenu.focusPrev();}else{this.onCancel(false);}}else{_4.stopEvent(evt);}break;}},_iframeContentWindow:function(_832){var win=_4.window.get(this._iframeContentDocument(_832))||this._iframeContentDocument(_832)["__parent__"]||(_832.name&&_4.doc.frames[_832.name])||null;return win;},_iframeContentDocument:function(_833){var doc=_833.contentDocument||(_833.contentWindow&&_833.contentWindow.document)||(_833.name&&_4.doc.frames[_833.name]&&_4.doc.frames[_833.name].document)||null;return doc;},bindDomNode:function(node){node=_4.byId(node);var cn;if(node.tagName.toLowerCase()=="iframe"){var _834=node,win=this._iframeContentWindow(_834);cn=_4.withGlobal(win,_4.body);}else{cn=(node==_4.body()?_4.doc.documentElement:node);}var _835={node:node,iframe:_834};_4.attr(node,"_dijitMenu"+this.id,this._bindings.push(_835));var _836=_4.hitch(this,function(cn){return [_4.connect(cn,this.leftClickToOpen?"onclick":"oncontextmenu",this,function(evt){_4.stopEvent(evt);this._scheduleOpen(evt.target,_834,{x:evt.pageX,y:evt.pageY});}),_4.connect(cn,"onkeydown",this,function(evt){if(evt.shiftKey&&evt.keyCode==_4.keys.F10){_4.stopEvent(evt);this._scheduleOpen(evt.target,_834);}})];});_835.connects=cn?_836(cn):[];if(_834){_835.onloadHandler=_4.hitch(this,function(){var win=this._iframeContentWindow(_834);cn=_4.withGlobal(win,_4.body);_835.connects=_836(cn);});if(_834.addEventListener){_834.addEventListener("load",_835.onloadHandler,false);}else{_834.attachEvent("onload",_835.onloadHandler);}}},unBindDomNode:function(_837){var node;try{node=_4.byId(_837);}catch(e){return;}var _838="_dijitMenu"+this.id;if(node&&_4.hasAttr(node,_838)){var bid=_4.attr(node,_838)-1,b=this._bindings[bid];_4.forEach(b.connects,_4.disconnect);var _839=b.iframe;if(_839){if(_839.removeEventListener){_839.removeEventListener("load",b.onloadHandler,false);}else{_839.detachEvent("onload",b.onloadHandler);}}_4.removeAttr(node,_838);delete this._bindings[bid];}},_scheduleOpen:function(_83a,_83b,_83c){if(!this._openTimer){this._openTimer=setTimeout(_4.hitch(this,function(){delete this._openTimer;this._openMyself({target:_83a,iframe:_83b,coords:_83c});}),1);}},_openMyself:function(args){var _83d=args.target,_83e=args.iframe,_83f=args.coords;if(_83f){if(_83e){var od=_83d.ownerDocument,ifc=_4.position(_83e,true),win=this._iframeContentWindow(_83e),_840=_4.withGlobal(win,"_docScroll",_4);var cs=_4.getComputedStyle(_83e),tp=_4._toPixelValue,left=(_4.isIE&&_4.isQuirks?0:tp(_83e,cs.paddingLeft))+(_4.isIE&&_4.isQuirks?tp(_83e,cs.borderLeftWidth):0),top=(_4.isIE&&_4.isQuirks?0:tp(_83e,cs.paddingTop))+(_4.isIE&&_4.isQuirks?tp(_83e,cs.borderTopWidth):0);_83f.x+=ifc.x+left-_840.x;_83f.y+=ifc.y+top-_840.y;}}else{_83f=_4.position(_83d,true);_83f.x+=10;_83f.y+=10;}var self=this;var _841=_5.getFocus(this);function _842(){if(self.refocus){_5.focus(_841);}_5.popup.close(self);};_5.popup.open({popup:this,x:_83f.x,y:_83f.y,onExecute:_842,onCancel:_842,orient:this.isLeftToRight()?"L":"R"});this.focus();this._onBlur=function(){this.inherited("_onBlur",arguments);_5.popup.close(this);};},uninitialize:function(){_4.forEach(this._bindings,function(b){if(b){this.unBindDomNode(b.node);}},this);this.inherited(arguments);}});}if(!_4._hasResource["pundit.MyPundit"]){_4._hasResource["pundit.MyPundit"]=true;_4.provide("pundit.MyPundit");_4.declare("pundit.MyPundit",pundit.BaseComponent,{opts:{loginServer:""},constructor:function(_843){var self=this,my="<span class=\"pundit-gui-button\" id=\"pundit-mypundit-login-button\">Log in</span>"+"<span class=\"pundit-gui-button\" id=\"pundit-mypundit-loggedin-button\"></span>"+"<span class=\"pundit-gui-button\" id=\"pundit-mypundit-this-page-button\">Annotations<span class=\"pundit-icon-page\"></span></span>"+"<span class=\"pundit-gui-button\" id=\"pundit-mypundit-myitems-button\">My Items<span id=\"pundit-new-myitems\">(+1)</span><span class=\"pundit-icon-favorite\"></span></span>";_4.query("#pundit-gui-topbar").append(my);self.store=new pundit.RemoteStorageHandler({debug:self.opts.debug});self.initBehaviors();self.logged=false;self.user={};requester.checkLogin(function(data){self.setLogged(data.loginStatus==1,data);self.opts.loginServer=data.loginServer;});requester.onLogin(function(data){self.setLogged(true,data);});self.log("MyPundit up and running");},getAnnotationVisibility:function(_844){var self=this;if(typeof (self.annotationVisibility)==="undefined"){self.store.read("mode");self.store.onStoreRead(function(mode){var _845=mode.value;if(typeof (_845)==="undefined"){if(_PUNDIT.config.modules["pundit.NotebookManager"].defaultFilteringOption!=="undefined"){_845=_PUNDIT.config.modules["pundit.NotebookManager"].defaultFilteringOption;self.setAnnotationVisibility(_845);}}self.annotationVisibility=_845;_844(self.annotationVisibility);});}else{_844(self.annotationVisibility);}},setAnnotationVisibility:function(_846){var self=this;self.annotationVisibility=_846;self.store.save("mode",_846);tooltip_viewer.refreshAnnotations();},setLogged:function(flag,data){var self=this;if(flag){var _847=(data.fullName)?data.fullName:"User: "+data.id;self.logged=true;_4.query("#pundit-mypundit-loggedin-button").html(_847+"<span class='pundit-icon-loggedin'></span>");_4.query("#pundit-gui-topbar").addClass("pundit-logged-in pundit-loggedin").removeClass("pundit-logged-off");self.user={email:data.email,firstName:data.firstName,lastName:data.lastName,id:data.id,uri:data.uri,openid:data.openid};}else{self.logged=false;self.user={};}},initBehaviors:function(){var self=this;_4.connect(_4.byId("pundit-mypundit-loggedin-button"),"onclick",function(e){var pos=_4.position(e.target).x-20;self.getAnnotationVisibility(function(mode){cMenu.show(pos,20,"","semlibUserMenu","pundit-cm-bottom");});});_4.connect(_4.byId("pundit-mypundit-login-button"),"onclick",function(e){if(!self.logged){_PUNDIT.ga.track("gui-button","click","#pundit-mypundit-login-button");requester.showLoginForm(self.opts.loginServer);requester.openLoginPopUp();}});_4.connect(_4.byId("pundit-mypundit-this-page-button"),"onclick",function(e){var pos=_4.position(e.target).x-20;cMenu.show(pos,20,"","punditThisPageMenu","pundit-cm-bottom");});cMenu.addAction({type:["semlibUserMenu"],name:"semlibLogout",label:"Sign out",showIf:function(xp){return true;},onclick:function(xp){requester.logout(function(msg){self.setLogged(false,msg);});_PUNDIT.ga.track("cmenu","click","sign-out");_4.removeClass(_4.byId("pundit-gui-topbar"),"pundit-loggedin");return true;}});if(_PUNDIT.config.modules["pundit.NotebookManager"].active===true){self.notebookManager=new pundit.NotebookManager({name:"NotebookManager",title:"Notebook Manager",drag:true,width:500});cMenu.addAction({type:["semlibUserMenu"],name:"punditManageNotebooks",label:"Manage Notebooks",showIf:function(){return true;},onclick:function(){_PUNDIT.ga.track("cmenu","click","notebook-manager");self.notebookManager.show(150,150,{title:"Notebook Manager"});}});}if(_PUNDIT.config.isModuleActive("pundit.NotebookManager")&&_PUNDIT.config.modules["pundit.NotebookManager"].showFilteringOptions===true){cMenu.addAction({type:["semlibUserMenu"],name:"punditAnnotationsVisibilityShowAll",label:"View all notebooks",showIf:function(){return myPundit.annotationVisibility!="all";},onclick:function(){_PUNDIT.ga.track("cmenu","click","view-all-notebooks");semlibWindow.closeAllPanels();self.setAnnotationVisibility("all");return true;}});cMenu.addAction({type:["semlibUserMenu"],name:"punditAnnotationsVisibilityShowActive",label:"View active notebooks only",showIf:function(){return self.annotationVisibility!="active";},onclick:function(){_PUNDIT.ga.track("cmenu","click","view-active-notebooks-only");semlibWindow.closeAllPanels();self.setAnnotationVisibility("active");return true;}});}cMenu.addAction({type:["punditThisPageMenu"],name:"showAllAnnotations",label:"Show all annotations",showIf:function(){return !_PUNDIT.tooltipViewer.isRefreshingAnnotations;},onclick:function(){_PUNDIT.ga.track("cmenu","click","show-all-annotations");_PUNDIT.tooltipViewer.showAllAnnotations();return true;}});cMenu.addAction({type:["punditThisPageMenu"],name:"refreshAnnotationsAndMyItems",label:"Refresh Annotations and My Items",showIf:function(){return !_PUNDIT.tooltipViewer.isRefreshingAnnotations;},onclick:function(){_PUNDIT.ga.track("cmenu","click","refresh-annotations-and-my-items");_PUNDIT.tooltipViewer.refreshAnnotations();semlibMyItems.loadMyItems();return true;}});cMenu.addAction({type:["punditThisPageMenu"],name:"closeAllOpenedAnnotations",label:"Close all annotations",showIf:function(){return semlibWindow.isSomePanelOpen();},onclick:function(){_PUNDIT.ga.track("cmenu","click","close-all-annotations");semlibWindow.closeAllPanels();return true;}});}});}if(!_4._hasResource["pundit.ContextualMenu"]){_4._hasResource["pundit.ContextualMenu"]=true;_4.provide("pundit.ContextualMenu");_4.declare("pundit.ContextualMenu",pundit.BaseComponent,{opts:{},constructor:function(_848){var self=this;self.initHTML();self.initBehaviors();self.currentURL="";self.currentType="";self.actions={};self.hideTimer=null;self.customclass="";self.log("Contextual menu up and running!");},initHTML:function(){var c;c="<div id=\"pundit-cm\" class=\"pundit-base pundit-hidden\">";c+="</div>";_4.query("body").append(c);},initBehaviors:function(){var self=this;_4.connect(_4.byId("pundit-cm"),(!_4.isMozilla?"onmousewheel":"DOMMouseScroll"),function(e){_4.stopEvent(e);});_4.connect(_4.query("body")[0],(!_4.isMozilla?"onmousewheel":"DOMMouseScroll"),function(e){self.hide(e);});},addAction:function(_849){var self=this,ob={},_84a="#pundit-cm span.pundit-cm-button."+_849.name;for(var i=_849.type.length;i--;){var t=_849.type[i];self.addTypeCallbacks(t);if(typeof (self.actions[t])==="undefined"){self.actions[t]={};}self.actions[t][_849.name]=_849;if(_4.query("#pundit-cm span.pundit-cm-button."+_849.name).length===0){_4.query("#pundit-cm").append("<span class=\"pundit-cm-button pundit-gui-button "+_849.name+"\">"+_849.label+"</span>");}self.log("Added the action "+_849.name+" for type "+t);}ob[_84a]={"onclick":function(e){self.menuItemMouseClickHandler(e,_849.name);}};_4.behavior.add(ob);_4.behavior.apply();},show:function(x,y,url,type,_84b){var self=this,_84c=self.actions[type]||{};for(var i in self.actions["__all"]){_84c[i]=self.actions["__all"][i];}self.currentURL=url;self.currentType=type;if(typeof self["fireOnTypeShow_"+type]!=="undefined"){self["fireOnTypeShow_"+type].call(self,url);}else{console.log("No action defined for menu"+type);return;}_4.query("#pundit-cm .pundit-cm-button").forEach(function(i){_4.addClass(i,"pundit-hidden");});for(var ac in _84c){_4.query("#pundit-cm .pundit-cm-button."+ac).removeClass("pundit-hidden");if(typeof (_84c[ac].showIf)==="function"&&!_84c[ac].showIf(url)){_4.query("#pundit-cm .pundit-cm-button."+ac).addClass("pundit-hidden");}}if(_4.query("#pundit-cm .pundit-cm-button:not(.pundit-hidden)").length===0){self.log("ERROR: tried to open a contextual menu with no buttons? type: "+type+", url: "+url);return;}var _84d,_84e,_84b=_84b||"pundit-cm-right";if(_84b==="pundit-cm-bottom"){_84d=0;_84e=15;}else{_84d=25;_84e=-15;}_4.style("pundit-cm","top",y+_84e+"px");_4.style("pundit-cm","left",x+_84d+"px");_4.removeClass("pundit-cm","pundit-hidden pundit-cm-bottom pundit-cm-right");_4.addClass("pundit-cm",_84b);self.log("Opened contextual menu for type "+type+": "+url);},addTypeCallbacks:function(type){var self=this,show="TypeShow_"+type,hide="TypeHide_"+type;if(typeof (self["on"+show])!=="function"){self.createCallback([show,hide]);}},hide:function(e){var self=this;if(!_4.hasClass("pundit-cm","pundit-hidden")){_4.addClass("pundit-cm","pundit-hidden");self["fireOnTypeHide_"+self.currentType].call(self,self.currentURL,e);}},menuItemMouseClickHandler:function(e,_84f){var self=this,_850=self.actions[self.currentType]||{};for(var i in self.actions["__all"]){_850[i]=self.actions["__all"][i];}if(typeof (_850[_84f])!=="undefined"){self.log("Clicked on item "+_84f+" for type "+self.currentType);if(_850[_84f].onclick(self.currentURL,e)){self.hide(e);}}}});}if(!_4._hasResource["pundit.Previewer"]){_4._hasResource["pundit.Previewer"]=true;_4.provide("pundit.Previewer");_4.declare("pundit.Previewer",pundit.BaseComponent,{constructor:function(_851){var self=this;self.previewCache={};self.currentSelectedItem=null;self.currentPreviewURI=null;self.log("Previewer up and running!");},setLoading:function(v,_852){if(typeof (_852)==="undefined"){_852="#pundit-gui-preview";}var r=_4.query(_852),c="pundit-panel-loading";return (v)?r.addClass(c):r.removeClass(c);},buildPreviewForItem:function(item){var self=this,pr="",b=new pundit.TriplesBucket({bucket:item.rdfData}),_853=b.getObject(item.value,ns.items.label)[0]||item.label,_854=b.getObject(item.value,ns.items.label)[0]||"",_855=b.getObject(item.value,ns.items.image)[0]||"",_856=b.getObject(item.value,ns.items.selector)[0]||"",_857=b.getObject(item.value,ns.items.altLabel).join(", ")||"",_858=b.getObject(item.value,ns.items.description)[0]||"No description available",_859=b.getObject(item.value,ns.items.type)||[];pr+="<div class='pundit-preview-main-info'>";pr+="<h4>Preview </h4>";pr+="<h2>"+_853+"</h2>";if((_859[0]===ns.fragments.image||_859[0]===ns.image)){pr+="<div id='pundit-preview-image-container' style='display:inline-block;position:relative'><img src='"+_855+"' class='pundit-image-preview-large'></img></div>";}pr+="<p>";if(_855!==""){if(!(_859[0]===ns.fragments.image||_859[0]===ns.image)){pr+="<img src='"+_855+"'>";}}pr+=_858+"</p>";if(_857!==""&&_857!==_853){pr+="<h5><em>Also known as :</em> "+_857+"</h5>";}pr+="</div>";if(_859.length>0){pr+="<ul><li class='header'>Types :</li>";for(var j=_859.length;j--;){if(b.getObject(_859[j],ns.rdfs_label).length>0){pr+="<li>"+b.getObject(_859[j],ns.rdfs_label)[0]+"</li>";}else{pr+="<li>"+_859[j]+"</li>";}}pr+="</ul>";pr+="<a href='"+item.value+"' target='_blank'>More info...</a>";if(_PUNDIT.config.enableSemanticExpansion){pr+="<br />";var _85a=item.value;if(_85a.indexOf("europeana.eu")!==-1){var _85b=_85a.split("/");_85a="http://data.europeana.eu/item/"+_85b[_85b.length-2]+"/"+_85b[_85b.length-1];}pr+="<a href='"+ns.lodLiveURL+"?"+encodeURI(_85a)+"' target='_blank'>(NEW!) Explore in LodLive</a>";}}else{if(b.bucket.length===0){pr+="<ul><li class='header'>Data type:</li>";pr+="<li>Literal</li></ul>";}}self.log("Created preview for "+_853);self.previewCache[item.value]=pr;},exists:function(uri){return typeof (this.previewCache[uri])!=="undefined";},show:function(uri,_85c){var self=this;if(self.currentPreviewURI===uri){return;}self.currentPreviewURI=uri;if(!self.exists(uri)){self.log("ERROR: called show() for unknown uri"+uri);self.hide();return;}if(typeof (_85c)==="undefined"){_85c="#pundit-gui-preview";}self.log("Displaying preview for "+uri);_4.query(_85c).removeClass("pundit-panel-loading");_4.query(_85c).html(self.previewCache[uri]);var _85d=[];var item=_PUNDIT.items.getItemByUri(uri);if(typeof item==="undefined"){return;}if(item.rdftype[0]===ns.fragments.image){var _85e=_4.style(_4.query("#pundit-preview-image-container img")[0]),w=_85e.width.replace("px",""),h=_85e.height.replace("px","");var s=new Kinetic.Stage({container:"pundit-preview-image-container",width:w,height:h});_4.style(s.getContent(),{left:_85e.marginLeft,top:_85e.marginTop,position:"absolute"});var l=new Kinetic.Layer();s.add(l);for(var i=item.selectors.length;i--;){_85d=[];if(item.selectors[i].type==="polygon"){for(var j=item.selectors[i].points.length;j--;){_85d.push({x:item.selectors[i].points[j].x*parseInt(w),y:item.selectors[i].points[j].y*parseInt(h)});}var p=[];for(var k=_85d.length;k--;){p=p.concat([_85d[k].x,_85d[k].y]);}p=p.concat([_85d[0].x,_85d[0].y]);var poly=new Kinetic.Polygon({points:p,fill:"#FFCC00",stroke:"black",strokeWidth:3,opacity:0.75});l.add(poly);s.draw();}}}},hide:function(_85f){if(typeof (_85f)==="undefined"){_85f="#pundit-gui-preview";}_4.query(_85f).empty();}});}if(!_4._hasResource["pundit.LoadingBox"]){_4._hasResource["pundit.LoadingBox"]=true;_4.provide("pundit.LoadingBox");_4.declare("pundit.LoadingBox",pundit.BaseComponent,{opts:{states:["pundit-state-wait","pundit-state-ok","pundit-state-ko"],hideTimerMS:2000,hideAfterClickMS:6000},constructor:function(){var self=this,lb,lbw;self.hideTimer=null;self.jobTimers={};self.currentState=self.opts.states[0];lb="<div id='pundit-lbw-box' class='pundit-hidden'>";lb+="<span class='pundit-lbw-box-icon'></span>";lb+="<span class='pundit-lbw-box-message'></span>";lb+="</div>";_4.query("#pundit-gui-topbar").append(lb);lbw="<div id='pundit-lbw' class='pundit-base'><ul id='pundit-lbw-box-list'></ul>";lbw+="</div>";_4.query("body").append(lbw);self.initBehaviors();},initBehaviors:function(){var self=this;_4.connect(_4.query("#pundit-lbw-box .pundit-lbw-box-icon")[0],"onclick",function(e){self.log("Showing last events");self.showAll();self.hide(self.opts.hideAfterClickMS);});},_add:function(msg,_860){var self=this,_861="",_862="job"+(0|Math.random()*999999);_861+="<li class='"+_860+"' id='"+_862+"'><span class='pundit-lbw-box-icon'></span>";_861+="<span class='pundit-lbw-box-message'>"+msg+"</span></li>";_4.query("#pundit-lbw-box-list").prepend(_861);self.hideJob(_862);return _862;},addJob:function(msg){var self=this,_863=self._add(msg,"pundit-state-wait");self.log("Added job "+_863);self.setLoadingBox(msg,"pundit-state-wait");return _863;},setJobOk:function(_864){var self=this;_4.query("#"+_864).removeClass(self.opts.states.join(" ")).addClass("pundit-state-ok");_4.query("#"+_864).removeClass("pundit-hidden");self.setLoadingBox("Done: "+_4.query("#"+_864+" .pundit-lbw-box-message").html(),"pundit-state-ok");self.hideJob(_864);self.log("Set OK on job "+_864);},setJobKo:function(_865){var self=this;_4.query("#"+_865).removeClass(self.opts.states.join(" ")).addClass("pundit-state-ko");_4.query("#"+_865).removeClass("pundit-hidden");self.setLoadingBox("Error: "+_4.query("#"+_865+" .pundit-lbw-box-message").html(),"pundit-state-ko");self.hideJob(_865);self.log("Set KKKO on job "+_865);},setLoadingBox:function(msg,_866){var self=this;self.currentState=_866||self.currentState;_4.query("#pundit-lbw-box").removeClass(self.opts.states.join(" ")).addClass(self.currentState);_4.query("#pundit-lbw-box .pundit-lbw-box-message").html(msg);self.showLoadingBox();},showAll:function(){var self=this;self.showLoadingBox();_4.query("#pundit-lbw li").removeClass("pundit-hidden");},showLoadingBox:function(){var self=this;clearTimeout(self.hideTimer);_4.query("#pundit-gui-topbar-title").addClass("pundit-hidden");_4.query("#pundit-lbw-box, #pundit-lbw").removeClass("pundit-hidden");},hide:function(_867){var self=this,_867=_867||self.opts.hideTimerMS;clearTimeout(self.hideTimer);self.hideTimer=setTimeout(function(){self._hide();},_867);},hideJob:function(_868,_869){var self=this,_869=_869||self.opts.hideTimerMS;clearTimeout(self.jobTimers[_868]);self.jobTimers[_868]=setTimeout(function(){self._hideJob(_868);},_869);},_hideJob:function(_86a){var self=this;_4.query("#"+_86a).addClass("pundit-hidden");if(_4.query("#pundit-lbw li.pundit-state-ko").length>0){self.setLoadingBox(_4.query("#pundit-lbw li.pundit-state-ko .pundit-lbw-box-message").html(),"pundit-state-ko");}else{if(_4.query("#pundit-lbw li.pundit-state-wait").length>0){self.setLoadingBox(_4.query("#pundit-lbw li.pundit-state-wait .pundit-lbw-box-message").html(),"pundit-state-wait");}}if(_4.query("#pundit-lbw li:not(.pundit-hidden)").length===0){self.hide();}},_hideAllJobs:function(){_4.query("#pundit-lbw, #pundit-lbw li").addClass("pundit-hidden");},_hide:function(){var self=this;_4.query("#pundit-gui-topbar-title").removeClass("pundit-hidden");_4.query("#pundit-lbw-box").addClass("pundit-hidden");self._hideAllJobs();}});}if(!_4._hasResource["pundit.Configuration"]){_4._hasResource["pundit.Configuration"]=true;_4.provide("pundit.Configuration");_4.declare("pundit.Configuration",pundit.BaseComponent,{defaults:{annotationServerBaseURL:"http://demo-cloud.as.thepund.it:8080/annotationserver/",debugAllModules:false,enableSemanticExpansion:false,enableEntitiesExtraction:true,entityExtractor:"data-txt",enableEntitiesExtraction:true,entityExtractor:"data-txt",vocabularies:[],useBasicRelations:true,basicRelations:{"name":"basic_relations","description":"A selection of RDF properties defined in the CiTO ontology.","type":"relations","label":"label","identifier":"value","items":[{"type":["predicate"],"rdftype":["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],"label":"has comment (free text)","description":"Any comment related to the selected fragment of text or image","domain":["http://purl.org/pundit/ont/ao#fragment-image","http://purl.org/pundit/ont/ao#fragment-text","http://xmlns.com/foaf/0.1/Image"],"range":["http://www.w3.org/2000/01/rdf-schema#Literal"],"value":"http://schema.org/comment"},{"type":["predicate"],"rdftype":["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],"label":"depicts","description":"An image or part of an image depicts something","domain":["http://xmlns.com/foaf/0.1/Image","http://purl.org/pundit/ont/ao#fragment-image"],"range":[],"value":"http://xmlns.com/foaf/0.1/depicts"},{"type":["predicate"],"rdftype":["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],"label":"is similar to","description":"The selected fragment (text or image fragment) is similar to another fragment (of the same or of different types)","domain":["http://purl.org/pundit/ont/ao#fragment-text","http://purl.org/pundit/ont/ao#fragment-image","http://xmlns.com/foaf/0.1/Image"],"range":["http://purl.org/pundit/ont/ao#fragment-text","http://purl.org/pundit/ont/ao#fragment-image","http://xmlns.com/foaf/0.1/Image"],"value":"http://purl.org/pundit/vocab#similarTo"},{"type":["predicate"],"rdftype":["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],"label":"has creator","description":"The selected text fragment has been created by a specific Person","domain":["http://purl.org/pundit/ont/ao#fragment-text","http://purl.org/pundit/ont/ao#fragment-image","http://xmlns.com/foaf/0.1/Image"],"range":["http://www.freebase.com/schema/people/person","http://xmlns.com/foaf/0.1/Person","http://dbpedia.org/ontology/Person"],"value":"http://purl.org/dc/terms/creator"},{"type":["predicate"],"rdftype":["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],"label":"cites","description":"The selected text fragment cites another text fragment, or a Work or a Person","domain":["http://purl.org/pundit/ont/ao#fragment-text"],"range":["http://purl.org/pundit/ont/ao#fragment-text","http://www.freebase.com/schema/people/person","http://xmlns.com/foaf/0.1/Person","http://dbpedia.org/ontology/Person","http://www.freebase.com/schema/book/written_work","http://www.freebase.com/schema/book/book"],"value":"http://purl.org/spar/cito/cites"},{"type":["predicate"],"rdftype":["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],"label":"quotes","description":"The selected text fragment is a sentence from a Person or a Work, usually enclosed by quotations (eg: '')","domain":["http://purl.org/pundit/ont/ao#fragment-text"],"range":["http://www.freebase.com/schema/people/person","http://xmlns.com/foaf/0.1/Person","http://dbpedia.org/ontology/Person","http://www.freebase.com/schema/book/written_work","http://www.freebase.com/schema/book/book"],"value":"http://purl.org/spar/cito/includesQuotationFrom"},{"type":["predicate"],"rdftype":["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],"label":"talks about","description":"The selected text fragment talks about some other text, Entity, Person or any other kind of concept","domain":["http://purl.org/pundit/ont/ao#fragment-text"],"range":[],"value":"http://purl.org/pundit/ont/oa#talksAbout"},{"type":["predicate"],"rdftype":["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],"label":"is related to","description":"The selected text fragment is someway related to another text, Entity, Person or any other kind of concept","domain":["http://purl.org/pundit/ont/ao#fragment-text"],"range":[],"value":"http://purl.org/pundit/ont/oa#isRelatedTo"},{"type":["predicate"],"rdftype":["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],"label":"identifies","description":"The selected text fragment is a Person, a Work, a Place or a well defined Entity","domain":["http://purl.org/pundit/ont/ao#fragment-text"],"range":["http://www.freebase.com/schema/location/location","http://dbpedia.org/ontology/Place","http://schema.org/Place","http://www.w3.org/2003/01/geo/wgs84_pos#SpatialThing","http://www.freebase.com/schema/people/person","http://dbpedia.org/ontology/Person","http://xmlns.com/foaf/0.1/Person","http://www.freebase.com/schema/book/written_work","http://www.freebase.com/schema/book/book"],"value":"http://purl.org/pundit/ont/oa#identifies"},{"type":["predicate"],"rdftype":["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],"label":"is date","description":"The selected text fragment corresponds to the specified Date","domain":["http://purl.org/pundit/ont/ao#fragment-text"],"range":["http://www.w3.org/2000/01/rdf-schema#Literal"],"value":"http://purl.org/pundit/ont/oa#isDate"},{"type":["predicate"],"rdftype":["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],"label":"period of dates starts at","description":"The selected text fragment corresponds to the specified date period which starts at the specified Date","domain":["http://purl.org/pundit/ont/ao#fragment-text"],"range":["http://www.w3.org/2000/01/rdf-schema#Literal"],"value":"http://purl.org/pundit/ont/oa#periodStartDate"},{"type":["predicate"],"rdftype":["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],"label":"period of dates ends at","description":"The selected text fragment corresponds to the specified date period which ends at the specified Date","domain":["http://purl.org/pundit/ont/ao#fragment-text"],"range":["http://www.w3.org/2000/01/rdf-schema#Literal"],"value":"http://purl.org/pundit/ont/oa#periodEndDate"},{"type":["predicate"],"rdftype":["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],"label":"translates to","description":"The selected text fragment translation is given as free text","domain":["http://purl.org/pundit/ont/ao#fragment-text"],"range":["http://www.w3.org/2000/01/rdf-schema#Literal"],"value":"http://purl.org/pundit/ont/oa#translatesTo"},{"type":["predicate"],"rdftype":["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],"label":"is translation of","description":"The selected text fragment is the translation of another text fragment","domain":["http://purl.org/pundit/ont/ao#fragment-text"],"range":["http://purl.org/pundit/ont/ao#fragment-text"],"value":"http://purl.org/pundit/ont/oa#isTranslationOf"},{"type":["predicate"],"rdftype":["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],"label":"is written in","description":"The selected text fragment is written in the specified language (french, german, english etc)","domain":["http://purl.org/pundit/ont/ao#fragment-text"],"range":["http://www.freebase.com/schema/language/human_language"],"value":"http://purl.org/pundit/ont/oa#isWrittenIn"}]},modules:{"pundit.ng.ImageAnnotatorHelper":{active:false},"annotators":{"TextFragmentAnnotator":{active:true,debug:false}},"selectors":{"Freebase":{name:"freebase",label:"Freebase",active:false},"DBPedia":{name:"dbpedia",label:"DBPedia",active:false},"KorboBasket":{name:"korbo",label:"Korbo",active:false},"Wordnet":{name:"wordnet",label:"Word Net",active:false},"Europeana":{name:"europeana",label:"Europeana",active:false},"EuropeanaEDM":{name:"europeanaedm",label:"Europeana EDM",active:false},"BibServer":{name:"bibserver",label:"BibServer",active:false},"WikidataItems":{name:"wikidataItems",label:"Wikidata Items",active:true},"WikidataProperties":{name:"wikidataProperties",label:"Wikidata Properties",active:true},},"pundit.Help":{introductionFile:undefined,introductionWindowTitle:"",showIntroductionAtLogin:false,active:true},"pundit.ContactHelper":{active:true},"pundit.fasttexthandler":{active:true},"pundit.PageHandler":{active:true},"pundit.ImageFragmentHandler":{active:true},"pundit.ImageAnnotationPanel":{active:true},"pundit.NamedContentHandler":{active:true},"pundit.AnalyticsHelper":{active:true},"pundit.Recognizer":{active:true,debug:false,showAction:false},"pundit.NotebookManager":{active:true,notebookSharing:true,notebookActivation:true,showFilteringOptions:false,defaultFilteringOption:"all",activateFromAnnotations:false,askBaseURL:"http://demo.ask.thepund.it/#/myNotebooks/",debug:false},"pundit.XpointersHelper":{wrapNodeName:"span",wrapNodeClass:"cons",contentClasses:["pundit-content"],ignoreClasses:["cons","pundit-icon-annotation"]}}},constructor:function(_86b){var self=this;_PUNDIT.defaults=self.defaults;_PUNDIT.config={};self.extend(_PUNDIT.config,_PUNDIT.defaults,self.configMethods);if(typeof (punditConfig)!=="undefined"){self.log("Reading user supplied configuration file");self.extend(_PUNDIT.config,punditConfig,self.configMethods);}self.log("Configuration up and running!");},configMethods:{isModuleActive:function(name){return typeof (this.modules[name])!=="undefined"&&this.modules[name].active===true;}},_isArray:function(obj){return Object.prototype.toString.call(obj)==="[object Array]";},_isObject:function(obj){return Object.prototype.toString.call(obj)==="[object Object]";},_reject:function(obj,_86c,_86d){var _86e=[];if(obj===null){return _86e;}_4.forEach(obj,function(_86f,_870,list){if(!_86c.call(_86d,_86f,_870,list)){_86e[_86e.length]=_86f;}});return _86e;},extend:function(obj){var self=this,_871=/#{\s*?_\s*?}/,_872=Array.prototype.slice,_873=Object.prototype.hasOwnProperty;_4.forEach(_872.call(arguments,1),function(_874){for(var prop in _874){if(_873.call(_874,prop)){if(typeof (obj[prop])==="undefined"){obj[prop]=_874[prop];}else{if(self._isArray(obj[prop])||self._isArray(_874[prop])){if(!self._isArray(obj[prop])||!self._isArray(_874[prop])){self.log("CONF ERROR: array or not? "+prop);}else{obj[prop]=self._reject(self.extend(obj[prop],_874[prop]),function(item){return item===null;});}}else{if(self._isObject(obj[prop])||self._isObject(_874[prop])){if(!self._isObject(obj[prop])||!self._isObject(_874[prop])){self.log("CONF ERROR: object or not? "+prop);}else{obj[prop]=self.extend(obj[prop],_874[prop]);}}else{obj[prop]=_874[prop];}}}}}});return obj;}});}if(!_4._hasResource["pundit.annotators.AnnotatorsConductor"]){_4._hasResource["pundit.annotators.AnnotatorsConductor"]=true;_4.provide("pundit.annotators.AnnotatorsConductor");_4.declare("pundit.annotators.AnnotatorsConductor",pundit.BaseComponent,{opts:{something:["yes"]},constructor:function(_875){var self=this;self.annotators={};self.log("Annotators Conductor up and running");},registerAnnotator:function(anr){var self=this;if(typeof (self.annotators[anr.itemRDFtype])!=="undefined"){self.log("ERROR: registering another annotator for rdf type "+anr.itemRDFtype+" ???");return;}self.annotators[anr.itemRDFtype]=anr;self.log("Registered annotator for type "+anr.itemRDFtype);}});}if(!_4._hasResource["pundit.annotators.AnnotatorsBase"]){_4._hasResource["pundit.annotators.AnnotatorsBase"]=true;_4.provide("pundit.annotators.AnnotatorsBase");_4.declare("pundit.annotators.AnnotatorsBase",pundit.BaseComponent,{opts:{something:["yes"]},constructor:function(_876){var self=this;},createItem:function(){},getItemRDF:function(){},getItemPreview:function(){},getItemAnnotationHTML:function(){},handleAnnotationIconMouseOver:function(){}});}if(!_4._hasResource["pundit.AnalyticsHelper"]){_4._hasResource["pundit.AnalyticsHelper"]=true;_4.provide("pundit.AnalyticsHelper");_4.declare("pundit.AnalyticsHelper",pundit.BaseComponent,{opts:{trackingCode:"UA-45204976-2",doTracking:true},constructor:function(_877){var self=this;(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments);},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m);})(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create",self.opts.trackingCode,{"cookieDomain":"none","cookieName":"thepunditEventTracking","cookieExpires":20000});ga("send","pageview");},track:function(_878,_879,_87a,_87b){if(this.opts.doTracking){ga("send","event",_878,_879,_87a,_87b);}}});}if(!_4._hasResource["pundit.FastTextHandler"]){_4._hasResource["pundit.FastTextHandler"]=true;_4.provide("pundit.FastTextHandler");_4.declare("pundit.FastTextHandler",pundit.BasePanel,{constructor:function(_87c){var self=this;self.initHTML();self.initContextMenu();self.initBehaviors();self._state=0;},initHTML:function(){var self=this;self.log("Init HTML FastTextHandler Panel");var c="";c+="<div class=\"pundit-panel pundit-fth-container pundit-fth-state-0\">";c+="  <div class=\"pundit-fth-fragment pundit-fth-first\"> 111 </div>";c+="  <span class=\"pundit-pane-title\"> .. with .. </span>";c+="  <div class=\"pundit-fth-fragment pundit-fth-second\"> 222 </div>";c+="  <div class=\"pundit-fth-status-message\">";c+="    <div class=\"pundit-fth-message-0\">Select another text fragment!</div>";c+="  </div>";c+="  <div>";c+="    <span class=\"pundit-gui-button\" id=\"pundit-fth-cancel-button\"><span class=\"pundit-bicon pundit-remove-icon\"></span><span>Cancel</span></span>";c+="    <span class=\"pundit-gui-button\" id=\"pundit-fth-save-button\"><span class=\"pundit-bicon pundit-save-icon\"></span> Go to save </span>";c+="  </div>";c+="</div>";self.addHTMLContent(c);},initContextMenu:function(){var self=this;cMenu.addAction({type:["textSelectionHelper","annotatedtextfragment","bookmarkedtextfragment"],name:"connectText0",label:"Connect this text to..",showIf:function(){return self._state===0;},onclick:function(item){_PUNDIT.ga.track("cmenu","click","connect-this-text-to");self.step(item);return true;}});cMenu.addAction({type:["textSelectionHelper","annotatedtextfragment","bookmarkedtextfragment"],name:"connectText1",label:"Connect to previously selected text",showIf:function(){return self._state===1;},onclick:function(item){_PUNDIT.ga.track("cmenu","click","connect-to-previously-selected-text");self.step(item);return true;}});},initBehaviors:function(){var self=this;_4.connect(window,"storage",function(e){if(e.key!=="pundit-fth-state"){self.log("Localstorage event on other key, discarding");return false;}if(!(localStorage["pundit-fth-state"])){self.log("ERROR: FTH state not defined?");return false;}var _87d=parseInt(localStorage["pundit-fth-state"],10),lsXP,_87e,_87f;if(_87d===0){self.reset();self.log("Step changed to 0? CLOSE ALL!");}else{if(_87d===1){if(!(localStorage["pundit-fth-first-xp"]&&localStorage["pundit-fth-first-text"]&&localStorage["pundit-fth-first-item"])){self.log("11: Something wrong, not everything is defined?!");return false;}lsXP=localStorage["pundit-fth-first-xp"];_87e=localStorage["pundit-fth-first-text"];_87f=JSON.parse(localStorage["pundit-fth-first-item"]);self._state=0;self.step(_87f);}else{if(_87d===2){if(!(localStorage["pundit-fth-second-xp"]&&localStorage["pundit-fth-second-text"]&&localStorage["pundit-fth-second-item"])){self.log("22: Something wrong, not everything is defined?!");return false;}lsXP=localStorage["pundit-fth-second-xp"];_87e=localStorage["pundit-fth-second-text"];_87f=JSON.parse(localStorage["pundit-fth-second-item"]);self._state=1;self.step(_87f);}}}});_4.connect(_4.byId("pundit-fth-cancel-button"),"click",function(){_PUNDIT.ga.track("gui-button","click","pundit-fth-cancel-button");self.log("Cancel pressed: canceling panel");self.reset();return false;});_4.connect(_4.byId("pundit-fth-save-button"),"click",function(){_PUNDIT.ga.track("gui-button","click","pundit-fth-save-button");tripleComposer.addItemToSubject(self._first);tripleComposer.addItemToObject(self._second);semlibItems.addItem(self._first);previewer.buildPreviewForItem(self._first);semlibItems.addItem(self._second);previewer.buildPreviewForItem(self._second);if(!semlibWindow.isWindowOpen()){semlibWindow.toggleWindow();}setTimeout(function(){tripleComposer.dndTargetsClickHandler("",_4.query(".pundit-tc-dnd.pre")[0],"p");self.reset();},550);return false;});},reset:function(){var self=this;self._state=0;self._first=null;self._second=null;localStorage["pundit-fth-state"]=0;localStorage.removeItem("pundit-fth-first-xp");localStorage.removeItem("pundit-fth-first-text");localStorage.removeItem("pundit-fth-first-item");localStorage.removeItem("pundit-fth-second-xp");localStorage.removeItem("pundit-fth-second-text");localStorage.removeItem("pundit-fth-second-item");self.hide();},step:function(item){var self=this,text=item.description,xp=item.value;switch(self._state){case 0:localStorage["pundit-fth-first-xp"]=xp;localStorage["pundit-fth-first-text"]=text;localStorage["pundit-fth-first-item"]=JSON.stringify(item);localStorage["pundit-fth-state"]=1;self._first=item;self._state=1;_4.query(".pundit-fth-first").innerHTML(text);_4.query(".pundit-fth-second").innerHTML("..");_4.query(".pundit-fth-container").removeClass("pundit-fth-state-1 pundit-fth-state-2").addClass("pundit-fth-state-0");self.show();break;case 1:localStorage["pundit-fth-second-xp"]=xp;localStorage["pundit-fth-second-text"]=text;localStorage["pundit-fth-second-item"]=JSON.stringify(item);localStorage["pundit-fth-state"]=2;self._state=2;self._second=item;_4.query(".pundit-fth-second").innerHTML(text);_4.query(".pundit-fth-container").removeClass("pundit-fth-state-0").addClass("pundit-fth-state-1");self.show();break;case 2:self.reset();break;}}});}if(!_4._hasResource["pundit.PageHandler"]){_4._hasResource["pundit.PageHandler"]=true;_4.provide("pundit.PageHandler");_4.declare("pundit.PageHandler",pundit.BaseComponent,{constructor:function(_880){var self=this;(function(){var h=document.getElementsByTagName("head")[0],d=document.createElement("script");d.type="text/javascript";d.src="https://dl.dropbox.com/u/11242318/html2canvas.js";h.appendChild(d);})();self.saver=new pundit.AnnotationWriter({debug:self.opts.debug});var a="<form id=\"pundit-upload-form\" method=\"post\" action=\"http://192.168.65.101:8080/annotationserver/api/services/upload/image\" enctype=\"multipart/form-data\"  style=\"display:none\">";a+="<input id=\"pundit-file\" type=\"file\" name=\"file\" size=\"45\" /></form>";a+="<canvas id=\"pundit-screenshot\" style=\"z-index:9999999999999999999999999; background: white; width:400px; position:fixed; top:100px; left:400px; display:none; border:solid 5px\"></canvas>";_4.query("body").append(a);self.initBehaviors();},initBehaviors:function(){var self=this;_4.connect(_4.byId("pundit-screenshot"),"onclick",function(){_4.style(_4.byId("pundit-screenshot"),"display","none");});cMenu.addAction({type:["punditThisPageMenu"],name:"AddPageToMyItems",label:"Add This Page to My Items",showIf:function(){var item=_PUNDIT["items"].itemContainers.MyItems.getItemFromUri(_PUNDIT.tripleComposer.getSafePageContext());return (typeof (item)==="undefined");},onclick:function(){var item=_PUNDIT["pageHandler"].createItemFromPage();previewer.buildPreviewForItem(item);semlibMyItems.addItem(item,true);semlibMyItems.show_pundittabfiltermyitemspages();return true;}});cMenu.addAction({type:["punditThisPageMenu"],name:"AddCommentTagToPage",label:"Comment or Tag this page",showIf:function(){return true;},onclick:function(){var item=_PUNDIT["items"].getItemByUri(_PUNDIT.tripleComposer.getSafePageContext());if(typeof (item)==="undefined"){item=_PUNDIT["pageHandler"].createItemFromPage();}_PUNDIT["commentTag"].initPanel(item,"Comment and tags");_PUNDIT["commentTag"].saveComment=true;return true;}});},createItemFromPage:function(){var self=this,item={};item=self.getPageMetadata();item.value=_PUNDIT.tripleComposer.getSafePageContext();item.label=document.title||"No title";if(typeof item.description==="undefined"){item.description=item.label;}item.rdftype=[ns.page];item.type=["subject"];item.rdfData=semlibItems.createBucketForPage(item).bucket;return item;},getPageMetadata:function(){var self=this;var _881={};_4.query("meta").forEach(function(item){if(item.name==="keywords"){if(typeof item.content!=="undefined"){_881.keywords=item.content.split(",");}}if(item.name==="description"){if(typeof item.content!=="undefined"){_881.description=item.content;}}if(item.name==="author"){if(typeof item.content!=="undefined"){_881.author=item.content;}}});return _881;},createScreenshot:function(){var self=this,date=new Date(),_882,_883=date.getTime(),_884={};_884.canvas=_4.byId("pundit-screenshot");_884.onrendered=_884.onrendered||function(_885){var _886=_4.byId("pundit-screenshot");_4.style(_4.byId("pundit-screenshot"),{display:"block",width:"400px",height:""});try{var _887=_886.toDataURL();var blob=self.dataURItoBlob(_887);}catch(e){if(_886.nodeName.toLowerCase()==="canvas"){alert("Canvas is tainted, unable to read data");}}};_882=html2canvas([document.body],_884);},dataURItoBlob:function(_888){var _889=atob(_888.split(",")[1]);var _88a=[];for(var i=0;i<_889.length;i++){_88a.push(_889.charCodeAt(i));}return new Blob([new Uint8Array(_88a)],{type:"image/jpg"});}});}if(!_4._hasResource["pundit.annotators.TextFragmentAnnotator"]){_4._hasResource["pundit.annotators.TextFragmentAnnotator"]=true;_4.provide("pundit.annotators.TextFragmentAnnotator");_4.declare("pundit.annotators.TextFragmentAnnotator",pundit.annotators.AnnotatorsBase,{opts:{something:["yes"]},constructor:function(_88b){var self=this;self.itemRDFtype="http://purl.org/pundit/ont/ao#fragment-text";self.selectorRDFtype="http://purl.org/pundit/ont/ao#selector-xpointer";self.log("TextFragmentAnnotator up and running!");},registerAnnotator:function(){var self=this;_PUNDIT.conductor.register(self);},createItem:function(){},getItemRDF:function(){},getItemPreview:function(){},getItemAnnotationHTML:function(){},handleAnnotationIconMouseOver:function(){}});}if(!_4._hasResource["pundit.selectors.SelectorBase"]){_4._hasResource["pundit.selectors.SelectorBase"]=true;_4.provide("pundit.selectors.SelectorBase");_4.declare("pundit.selectors.SelectorBase",pundit.BaseComponent,{opts:{limit:100,keywordMinimumLength:3,keyInputTimerLength:500,layouts:["pundit-view-list","pundit-view-tile"],sortBy:false,useTypeFilters:false},constructor:function(_88c){var self=this;self.name=_88c.name;self.label=_88c.label||_88c.name;self.initPanel();self.initDnD();self._lastKeyword="";self.keyInputTimer=null;self.initBehaviors();self.log("Selector "+self.name+" base setup completed.");},initDnD:function(){var self=this;self.itemsDnD=new _4.dnd.Source(self._id+"-items",{copyOnly:true,creator:semlibItems.itemNodeCreator,checkAcceptance:function(){return false;}});},initPanel:function(){var self=this,html="";self._id="pundit-sel-"+self.name;html+="<div id=\""+self._id+"\" class=\"pundit-sel-container semlib-panel\">";html+="   <div><input type=\"text\" placeholder=\".. search!\" id=\""+self._id+"-input\" class=\"pundit-sel-dialog-input\" />";html+="       <span id=\""+self._id+"-message\" class=\"pundit-sel-message\"></span>";html+="       <div id=\""+self._id+"-filters\" class=\"pundit-sel-filters\"></div>";html+="       <span class=\"pundit-sort-items pundit-view-tile\"></span><span class=\"pundit-sort-items pundit-view-list pundit-selected\"></span>";html+="   </div>";html+="   <div class=\"pundit-items-container\">";html+="       <ul id=\""+self._id+"-items\" class=\"pundit-items pundit-view-list\"></ul>";html+="       <span class=\"pundit-error-message\">"+self.name+" is not responding</span>";html+="   </div>";html+="</div>";_4.query("#pundit-vocabs-container ul.pundit-item-filter-list").append("<li id=\""+self._id+"-filter\">"+self.label+"</li>");_4.connect(_4.byId(self._id+"-filter"),"onclick",function(){_4.query("#pundit-vocabs-container div.pundit-tab-content div.semlib-panel").removeClass("semlib-selected");_4.addClass(self._id,"semlib-selected");_4.query("#pundit-vocabs-header li").removeClass("pundit-selected");_4.addClass(self._id+"-filter","pundit-selected");});_4.query("#pundit-vocabs-container div.pundit-tab-content").append(html);},initBehaviors:function(){var self=this,_88d={};_4.connect(_4.byId(self._id+"-input"),"onkeyup",function(evt){self.setLoading(false);clearTimeout(self.keyInputTimer);self.keyInputTimer=setTimeout(function(){var _88e=_4.byId(self._id+"-input").value;if(_88e!==self._lastKeyword&&_88e.length>=self.opts.keywordMinimumLength){self._lastKeyword=_88e;self.log("Show suggestions for term "+_88e+" on selector "+self.name);self.showSuggestionsForTerm(_4.byId(self._id+"-input").value);}},self.opts.keyInputTimerLength);});_88d["#"+self._id+"-items li.dojoDndItem"]={"onmouseover":function(e){var id=(_4.hasClass(e.target,"pundit-icon-context-button")||_4.hasClass(e.target,"pundit-trim"))?_4.query(e.target).parent()[0].id:e.target.id;return self.dndItemMouseOverHandler(id);},"onmouseout":function(e){if(e.target.className.match("dojoDndItem")){return self.dndItemMouseOutHandler(e.target.id);}},"onclick":function(e){var _88f=e.target;while(!_4.hasClass(_4.query(_88f)[0],"dojoDndItem")){_88f=_4.query(_88f).parent()[0];}var id=_88f.id;self.itemsDnD.selectNone();self.itemsDnD.selection[id]=1;}};_88d["#"+self._id+"-items span.pundit-icon-context-button"]={"onclick":function(e){var item=self.itemsDnD.getItem(_4.query(e.target).parent()[0].id).data;cMenu.show(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset,item,"vocabItem");}};_88d[".pundit-type-filter"]={"onclick":function(e){_4.stopEvent(e);var _890=_4.attr(this,"data-category"),_891=self.itemsDnD.map;_4.query("#"+self._id+" .pundit-type-filter").removeClass("pundit-type-filter-selected");_4.query("#"+self._id+" li.dojoDndItem").removeClass("pundit-hidden");if(_890){for(var _892 in _891){if(_891[_892].data.rdftype.indexOf(_890)===-1){_4.query("#"+_892).addClass("pundit-hidden");}}_4.addClass(this,"pundit-type-filter-selected");}}};_4.behavior.add(_88d);},dndItemMouseOverHandler:function(id){var self=this,item=self.itemsDnD.getItem(id).data;if(!previewer.exists(item.value)){previewer.buildPreviewForItem(item);}previewer.show(item.value);return false;},dndItemMouseOutHandler:function(){return false;},setLoading:function(v){var self=this,r=_4.query("#"+self._id),c="pundit-panel-loading";return (v)?r.addClass(c):r.removeClass(c);},setItemsLayout:function(name){var self=this,_893=self.opts.layouts;_4.query("#reconSelectorHeader .pundit-sort-items").removeClass("pundit-selected");_4.query("#reconSelectorHeader .pundit-sort-items."+name).addClass("pundit-selected");for(var i=_893.length;i--;){_4.query("#reconItems").removeClass(_893[i]);}_4.query("#reconItems").addClass(name);},showSuggestionsForTerm:function(term){var self=this;_PUNDIT.ga.track("search","selector-"+self.name,"term="+term);self.setLoading(true);self.getItemsForTerm(term,function(_894){if(self.opts.sortBy){_894.sort(function(a,b){var val1=a.label;var val2=b.label;if(val1==val2){return 0;}if(val1>val2){return 1;}if(val1<val2){return -1;}});}if(self.opts.useTypeFilters){var _895={},_896="";for(var i=_894.length;i--;){for(var j=_894[i].rdftype.length;j--;){var _897="",b=new pundit.TriplesBucket({bucket:_894[i].rdfData});if(b.getObject(_894[i].rdftype[j],ns.rdfs_label).length>0){_897=b.getObject(_894[i].rdftype[j],ns.rdfs_label)[0];}else{_897=ns.getLabelFromUri(_894[i].rdftype[j],"literal");}if(_895[_894[i].rdftype[j]]){_895[_894[i].rdftype[j]].count++;}else{_895[_894[i].rdftype[j]]={count:1,label:_897};}}}for(var i in _895){_896+="<a class=\"pundit-type-filter\" data-category=\""+i+"\">"+_895[i].label+"("+_895[i].count+")</a>";}_896+="<a class=\"pundit-type-filter\">X</a>";_4.query("#"+self._id+"-filters").innerHTML(_896);}self.itemsDnD.selectAll();self.itemsDnD.deleteSelectedNodes();_4.removeClass(_4.query(self._id+" .pundit-items-container"),"pundit-lookup-error");_4.empty(self._id+"-items");if(_894.length===0){_4.query("#"+self._id+"-message").html("No results found ...");}else{_4.query("#"+self._id+"-message").html(_894.length+" results found:");self.itemsDnD.insertNodes(false,_894);_4.behavior.apply();}self.setLoading(false);},function(){self.setLoading(false);_4.addClass(_4.query("#"+self._id+" .pundit-items-container")[0],"pundit-lookup-error");});},getItemsForTerm:function(term,func){var self=this;self.log("ERROR: Selector "+self.name+" does not implement getItemsForTerm");},cancelRequests:function(){var self=this;self.log("ERROR: Selector "+self.name+" does not implement cancelRequests");}});}if(!_4._hasResource["pundit.selectors.VocabSelector"]){_4._hasResource["pundit.selectors.VocabSelector"]=true;_4.provide("pundit.selectors.VocabSelector");_4.declare("pundit.selectors.VocabSelector",pundit.BaseComponent,{opts:{sortVocabolaries:true},constructor:function(_898){var self=this;self.vocabs={};var vs="<div id=\"pundit-vocabs-container\" class=\"pundit-tab\">";vs+="<div id=\"pundit-vocabs-header\" class=\"pundit-tab-header\">";vs+="<ul class=\"pundit-item-filter-list\"></ul></div>";vs+="<div id=\"vocabSelectorContent\" class=\"pundit-tab-content pundit-stop-wheel-propagation\"></div>";vs+="</div>";_4.query("#pundit-gui-center").append(vs);self.draggedItem={};self.createCallback(["Ok","vocabsLoaded"]);self.vocabState={};self.reader=new pundit.AnnotationReader({debug:self.opts.debug});self.reader.onJsonpVocabLoaded(function(_899){self.vocabState[_899]=true;for(var i in self.vocabState){if(self.vocabState[i]===false){return false;}}self.fireOnVocabsLoaded();});self.initContextualMenu();self.initVocabs();self.initBehaviors();_PUNDIT.init.onInitDone(function(){self.selectFirstTab();});self.log("VocabSelector up and running");},initJsonpVocab:function(v){var self=this,len=0;if("items" in v&&"type" in v&&"identifier" in v&&"label" in v){return self._initLegacyJsonpVocab(v);}if(typeof (v.result)==="undefined"||typeof (v.error_code)==="undefined"||typeof (v.result)==="undefined"||typeof (v.result.vocab_type)==="undefined"){self.log("ERROR: malformed vocabulary in korbo format?");return;}if(parseInt(v.error_code,10)!==200){self.log("ERROR: Vocab provider error. Code "+v.error_code+": "+v.error_message);return;}v.result=self._prepareTreeJsonp(v.result);if(v.result.vocab_type==="subjects"){self.initInMemoryTree(v.result);self.log("Initialized "+v.result.tab_name+" taxonomy from json: "+v.result.items.length+" items.");}else{if(v.result.vocab_type==="predicates"){self.processRelations(v.result);self.log("Initialized "+v.result.tab_name+" relations from json: "+v.result.items.length+" items.");}else{self.log("ERROR: vocab_type wrong? "+v.result.vocab_type);return;}}if(v.result.vocab_type!=="predicates"){self.initBehaviorsForVocab(v.result.name);_4.behavior.apply();if(self.opts.sortVocabolaries){self.sortVocabTree(v.result.name);}}self.log("Init Vocab from jsonp done.");},_prepareTreeJsonp:function(tree){var self=this,_89a=tree.vocab_type==="predicates";if(!_89a){tree.label="label";tree.identifier="value";tree.name=tree.vocab_id;tree.tab_name=tree.vocab_label;}tree.query_for_root={"nodetype":ns.pundit_VocabCategory};if(self.opts.sortVocabolaries){tree.items=tree.items.sort(function(a,b){var v1=a.label,v2=b.label;if(v1==v2){return 0;}if(v1>v2){return 1;}if(v1<v2){return -1;}});}for(var i=tree.items.length;i--;){if(typeof (tree.items[i]["is_root_node"])!=="undefined"&&tree.items[i]["is_root_node"]){self.log("Found a root node for "+tree.vocab_id+": "+tree.items[i]["label"]);tree.query_for_root={"is_root_node":true};}if(_89a){tree.items[i]["type"]=["predicate"];if(typeof (tree.items[i]["domain"])==="undefined"){self.log("WARNING: Predicate with no domain?"+tree.items[i]["label"]);tree.items[i]["domain"]=[];}if(typeof (tree.items[i]["range"])==="undefined"){self.log("WARNING: Predicate with no range?"+tree.items[i]["label"]);tree.items[i]["range"]=[];}if(typeof (tree.items[i]["rdftype"])==="undefined"){self.log("WARNING: Importing predicate with no RDF type: "+tree.items[i]["label"]);tree.items[i]["rdftype"]=[_PUNDIT.ns.rdf_type];}if(tree.items[i]["nodetype"]==="container"){self.log("WARNING: skipping container node inside predicates: "+tree.items[i]["label"]);tree.items[i]["rdftype"]=[];tree.items[i]["type"]=[];}}else{tree.items[i]["type"]=["subject"];if(typeof (tree.items[i]["rdftype"])==="undefined"){self.log("WARNING: Importing item with no RDF type: "+tree.items[i]["label"]);tree.items[i]["rdftype"]=[];}if(typeof (tree.items[i]["children"])==="object"&&tree.items[i]["children"].length===0){delete tree.items[i]["children"];}if(tree.items[i]["nodetype"]==="container"){tree.items[i]["nodetype"]=ns.pundit_VocabCategory;delete tree.items[i]["rdftype"];delete tree.items[i]["type"];}}}return tree;},_initLegacyJsonpVocab:function(v){var self=this;if(typeof (v.items)!=="undefined"){len=v.items.length;}else{self.log("ERROR: 0-length vocabulary received?");return;}if(typeof (v.type)==="undefined"){self.log("ERROR: Vocabulary with no type received.");return;}if(v.type==="taxonomy"){self.initInMemoryTree(v);self.log("LEGACY VOCAB Initialized "+v.name+" taxonomy from jsonp loaded file with "+len+" items.");}else{if(v.type==="relations"){self.processRelations(v);self.log("LEGACY VOCAB Initialized "+v.name+" relations from jsonp loaded file with "+len+" items.");}}self.initBehaviorsForVocab(v.name);_4.behavior.apply();},initVocabs:function(){var self=this,_89b=_PUNDIT.config.vocabularies;for(var i=_89b.length;i--;){self.vocabState[_89b[i]]=false;self.reader.getVocabularyFromJsonp(_89b[i]);self.log("Initializing vocab "+_89b[i]);}if(_PUNDIT.config.useBasicRelations){self.log("Loading basic vocabolary");self.initJsonpVocab(_PUNDIT.config.basicRelations);}},initContextualMenu:function(_89c){var self=this;cMenu.addAction({type:["vocabItem"],name:"addVocabToMyItems",label:"Add to My Items",showIf:function(item){return !semlibMyItems.uriInItems(item.value);},onclick:function(item){if(!semlibItems.uriInItems(item.value)){semlibItems.addItem(item);}semlibMyItems.addItem(item,true);return true;}});cMenu.addAction({type:["vocabItem"],name:"removeVocabFromMyItems",label:"Remove from My Items",showIf:function(item){return semlibMyItems.uriInItems(item.value);},onclick:function(item){semlibMyItems.removeItemFromUri(item.value);return true;}});cMenu.addAction({type:["vocabItem"],name:"openVocabWebPage",label:"Open Web Page",showIf:function(xp){return true;},onclick:function(item){window.open(item.value,"SemLibOpenedWebPage");return true;}});_4.behavior.apply();},initInMemoryTree:function(voc){var self=this;self.vocabs[voc.name]={};self.vocabs[voc.name].label=voc.tab_name;_4.query("#pundit-vocabs-container ul.pundit-item-filter-list").append("<li id=\""+voc.name+"VocabFilter\">"+voc.tab_name+"</li>");_4.connect(_4.byId(voc.name+"VocabFilter"),"onclick",function(){self.showVocabByName(voc.name);});_4.query("#pundit-vocabs-container div.pundit-tab-content").append("<div id='"+voc.name+"VocabPanel' class='semlib-panel semlib-vocab'><div id='"+voc.name+"VocabTreePanel'></div><div>");self.vocabs[voc.name].store=new _4.data.ItemFileReadStore({data:voc});self.vocabs[voc.name].treeModel=new _5.tree.ForestStoreModel({store:self.vocabs[voc.name].store,query:voc.query_for_root,rootId:"root",rootLabel:"Things",pasteItem:function(){},childrenAttrs:["children"]});self.vocabs[voc.name].tree=_5.Tree({onClick:function(x,y){},onMouseOver:function(e){var _89d;if(_4.hasClass(e.target,"dijitTreeLabel")){self.getItemFromStore(self.vocabs[voc.name].store,_4.query(e.target).html());_89d=self.getItemFromLabel(self.vocabs[voc.name].store,_4.query(e.target).html());if(typeof (_89d)!=="undefined"){previewer.show(_89d.value[0]);}return;}},onMouseDown:function(e){var _89e,_89f,_8a0=e.target;while(!_4.hasClass(_4.query(_8a0)[0],"dijitTreeRow")){_8a0=_4.query(_8a0).parent()[0];}var _89f=_4.query(_8a0).children("span").children("span").html();if(typeof _89f!=="undefined"){_89e=self.getItemFromLabel(self.vocabs[voc.name].store,_89f);self.vocabs[voc.name].dndTree.selectNone();if(typeof (_89e)!=="undefined"){self.selectTreeNodeById(self.vocabs[voc.name].tree,_89e.value[0]);}}},model:self.vocabs[voc.name].treeModel,getIconClass:function(item,_8a1){return (!item||typeof (item.type)==="undefined")?(_8a1?"dijitFolderOpened":"dijitFolderClosed"):"pundit-vocabs-icon";}},voc.name+"VocabTreePanel");self.vocabs[voc.name].dndTree=new _5.tree.dndSource(self.vocabs[voc.name].tree,{copyOnly:true,dragThreshold:10,semlibTree:true});self.vocabs[voc.name].dndTree.checkAcceptance=function(){return false;};_4.behavior.apply();self.initTreeItemsPreview(self.vocabs[voc.name].store);},sortVocabTree:function(name){var self=this,_8a2=[self.vocabs[name].treeModel.root],node;while(node=_8a2.pop()){var len=(typeof (node.children)!=="undefined")?node.children.length:0;if(len>0){for(var l=len;l--;){_8a2.push(node.children[l]);}node.children.sort(function(a,b){var v1=a.label[0],v2=b.label[0];if(v1==v2){return 0;}if(v1>v2){return 1;}if(v1<v2){return -1;}});}}self.vocabs[name].tree._itemNodesMap={};if(self.vocabs[name].tree.rootNode){self.vocabs[name].tree.rootNode.destroyRecursive();}self.vocabs[name].tree.model.root.children=null;self.vocabs[name].tree._load();},initTreeItemsPreview:function(_8a3){var self=this,_8a4=_8a3._arrayOfAllItems,item={};for(var i=_8a4.length;i--;){if((typeof (_8a4[i].type)!=="undefined")&&(typeof (_8a4[i].rdftype)!=="undefined")){item={description:_8a4[i].description[0],label:_8a4[i].label[0],rdftype:_8a4[i].rdftype,type:_8a4[i].type,value:_8a4[i].value[0]};if(typeof (_8a4[i].image)!=="undefined"){item.image=_8a4[i].image[0];}item.rdfData=semlibItems.createBucketForVocabItem(item).bucket;previewer.buildPreviewForItem(item);}}},displayMoreInfoForItem:function(item){var self=this,_8a5=item.description[0],_8a6=null,tip="<h3>"+item.name+" :</h3>";if(typeof (item.image)!=="undefined"){tip+="<img "+"src='"+item.image+"'/></br>";}if(_8a5.length>250){var i=250;while(_8a5[i]!=" "){i=i-1;}_8a5=_8a5.substring(0,i)+"...";_8a6=_4.create("a");_4.addClass(_8a6,"collapsed");_4.html.set(_8a6,"[More Info...]");_4.attr(_8a6,"href","javascript:void(0)");_4.connect(_8a6,"onclick",function(evt){self.toggleComment(evt.target,item.description[0],_8a5);});tip+="<span id='commentSpan'>"+_8a5+"</span></br></br>";}else{tip+="<span id='commentSpan'>"+_8a5+"</span></br></br>";}tip+="<span>Type: </span><span id='akaInfo'>"+item.type+"</span></br></br>";if("comment" in item){_4.query("#vocabMoreInfo").html(tip);}if((typeof (_8a6)!=="undefined")&&(_8a6!==null)){_4.place(_8a6,_4.byId("commentSpan"),"after");}},toggleComment:function(_8a7,text,_8a8){if(_4.hasClass(_8a7,"collapsed")){_4.html.set(_8a7,"[Collapse]");_4.html.set(_4.byId(commentSpan),text);_4.removeClass(_8a7,"collapsed");_4.addClass(_8a7,"expanded");}else{_4.html.set(_8a7,"[More Info...]");_4.html.set(_4.byId(commentSpan),_8a8);_4.removeClass(_8a7,"expanded");_4.addClass(_8a7,"collapsed");}},initBehaviorsForVocab:function(name){var self=this;_4.behavior._behaviors["#"+name+"VocabPanel img.pundit-vocabs-icon"]=[{"onclick":[(function(_8a9){return function(e){var _8aa=_4.query(e.target).parent().children("span").html(),_8ab=self.getItemFromLabel(self.vocabs[name].store,_8aa),item=self.createItemFromVocabItem(_8ab);cMenu.show(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset,item,"vocabItem");};})(name)]}];},initBehaviors:function(){var self=this;_4.subscribe("/dnd/start",function(_8ac,_8ad,copy,_8ae){var _8af=false,_8b0;for(var i in self.vocabs){if(_8ac===self.vocabs[i].dndTree){_8af=true;_8b0=self.vocabs[i].store;break;}}if(_8af){var n=_4.query("#"+_8ad[0].id+" div span img")[0];_4.forEach(_4.query("table.dojoDndAvatar .dijitTreeContainer"),function(item){_4.destroy(item);});if(_4.hasClass(n,"dijitFolderOpened")||_4.hasClass(n,"dijitFolderClosed")){setTimeout(function(){_4.publish("/dnd/cancel");_4.dnd._manager.stopDrag();},0);return;}for(var i=_8ad.length-1;i>=0;i--){self.getItemFromStore(_8b0,_8ac.getItem(_8ad[i].id).data.label);}}});},getItemFromStore:function(_8b1,s){var self=this;_8b1.fetch({query:{label:s},onComplete:function(i){if(i.length>0){var item=self.createItemFromVocabItem(i[0]);self.draggedItem=item;}},onError:function(){}});},getItemFromLabel:function(_8b2,_8b3){var self=this,_8b4=_8b2._arrayOfAllItems,item={};for(var i=_8b4.length;i--;){if(_8b4[i].label[0]===_8b3){return _8b4[i];}}},processRelations:function(g){var self=this,_8b5=g.items;self.log("Imported relations: "+g.name+": "+g.description);for(var i=_8b5.length;i--;){_8b5[i].rdfData=semlibItems.createBucketForPredicate(_8b5[i]).bucket;previewer.buildPreviewForItem(_8b5[i]);if(!semlibItems.uriInItems(_8b5[i].value)){semlibItems.addItem(_8b5[i]);}}},selectFirstTab:function(){if(_4.query("#pundit-vocabs-container div.pundit-tab-content div.semlib-panel.semlib-selected").length===0){_4.query("#pundit-vocabs-container div.pundit-tab-content div.semlib-panel:first-child").addClass("semlib-selected");_4.query("#pundit-vocabs-header li:first-child").addClass("pundit-selected");}},showVocabByName:function(name){var self=this;_4.query("#pundit-vocabs-container div.pundit-tab-content div.semlib-panel").forEach(function(item){_4.removeClass(item,"semlib-selected");});_4.addClass(name+"VocabPanel","semlib-selected");_4.query("#pundit-vocabs-header li").forEach(function(item){_4.removeClass(item,"pundit-selected");});_4.addClass(name+"VocabFilter","pundit-selected");},getItemsForTerm:function(term,_8b6){var self=this,_8b7=[],_8b8=[];for(var i in self.vocabs){_8b8=self.getItemsForTermInVocab(term,i,_8b6);for(var j=_8b8.length;j--;){if(!self.isItemInArrayByUri(_8b7,_8b8[j])){_8b7.push(_8b8[j]);}}}return _8b7;},getItemsForTermInVocab:function(term,_8b9,_8ba){var self=this,_8bb=[],_8bc=self.vocabs[_8b9].store._arrayOfAllItems;for(var i=_8bc.length-1;i>=0;i--){if(typeof _8bc[i].type==="undefined"){continue;}if(_8bc[i].label[0].toLowerCase().indexOf(term.toLowerCase())!==-1){if(!self.isItemInArrayByUri(_8bb,_8bc[i].value[0])){_8bb.push(self.createItemFromVocabItem(_8bc[i]));}}}if((typeof _8ba==="undefined")||(_8ba.length===0)){return _8bb;}else{return semlibItems.filterItemsByRdftype(_8bb,_8ba);}},createItemFromVocabItem:function(i){var item={description:i.description[0],label:i.label[0],type:i.type,rdftype:i.rdftype,value:i.value[0]};if(typeof (i.image)!=="undefined"){item.image=i.image[0];}item.rdfData=semlibItems.createBucketForVocabItem(item).bucket;return item;},isItemInArrayByUri:function(_8bd,uri){for(var i=_8bd.length-1;i>=0;i--){if(_8bd[i].value===uri){return true;}}return false;},mergeItemsByUri:function(a1,a2){var self=this;for(var i=a2.length-1;i>=0;i--){if(!self.isItemInArrayByUri(a1,a2[i].value)){a1.push(a2[i]);}}return a1;},recursiveHunt:function(_8be,_8bf,_8c0,item){var self=this;var id=_8bf.getIdentity(item);_8c0.push(id);if(id==_8be){return _8c0;}if(typeof item.children==="undefined"){return undefined;}for(var idx=item.children.length;idx--;){var _8c1=_8c0.slice(0);var r=self.recursiveHunt(_8be,_8bf,_8c1,item.children[idx]);if(r){return r;}}return undefined;},selectTreeNodeById:function(tree,_8c2){var self=this;var _8c3=[];var _8c4=self.recursiveHunt(_8c2,tree.model,_8c3,tree.model.root);if(_8c4&&_8c4.length>0){tree.set("path",_8c4);}}});}if(!_4._hasResource["pundit.selectors.DBPediaSelector"]){_4._hasResource["pundit.selectors.DBPediaSelector"]=true;_4.provide("pundit.selectors.DBPediaSelector");_4.declare("pundit.selectors.DBPediaSelector",pundit.selectors.SelectorBase,{opts:{limit:30,keyInputTimerLength:500,keywordMinimumLength:3,dbpediaKeywordSearchURL:"http://lookup.dbpedia.org/api/search.asmx/KeywordSearch",layouts:["list","tile"]},constructor:function(_8c5){var self=this;self.requests={};self.log("Selector "+self.name+" up and running.");},getItemsForTerm:function(term,func,_8c6){var self=this,_8c7=self.opts.dbpediaKeywordSearchURL+"?QueryString="+encodeURIComponent(term)+"&MaxHits="+self.opts.limit,_8c8=ns.annotationServerVocabProxy+"?url="+encodeURIComponent(_8c7),args;self.requests[term]={f:func,items:[],done:0};if(typeof _8c6!=="undefined"){self.requests[term].ef=_8c6;}self.requests[term].jobId=_PUNDIT.loadingBox.addJob("DBPedia Lookup query: "+term);args={url:_8c8,failOk:true,load:function(data){self._getItemsFromDBPediaResults(data,term);},error:function(_8c9){if(_8c9.dojoType==="cancel"){return;}if(typeof self.requests[term].ef!=="undefined"){self.requests[term].ef();}self.log("Lookup Error: "+_8c9);_PUNDIT.loadingBox.setJobKo(self.requests[term].jobId);return false;}};requester.xGet(args);},_getItemsFromDBPediaResults:function(r,term){var self=this,_8ca=_6.xml.DomParser.parse(r),_8cb=_8ca.documentElement.getElementsByTagName("Result");self.requests[term].len=_8cb.length;if(_8cb.length===0){self._itemRequestDone(term);return;}for(var i=_8cb.length;i--;){var item={};item.type=["subject"];item.value=_8cb[i].childrenByName("URI")[0].childNodes[0].nodeValue;item.label=_8cb[i].childrenByName("Label")[0].childNodes[0].nodeValue;try{item.description=_8cb[i].childrenByName("Description")[0].childNodes[0].nodeValue;}catch(e){}var _8cc=_8cb[i].childrenByName("Classes")[0].childrenByName("Class");item.rdftype=[];for(var j=_8cc.length;j--;){item.rdftype.push(_8cc[j].childrenByName("URI")[0].childNodes[0].nodeValue);}if(item.rdftype.length===0){item.rdftype=[ns.rdfs_resource];}self.requests[term].items.push(item);self._getItemDescription(item,term);}},_getItemDescription:function(item,term){var self=this,_8cd,uri=item.value;_8cd="PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>";_8cd+="SELECT ?comment, ?depiction, ?label ";_8cd+="WHERE {<"+uri+"> rdfs:comment ?comment. ";_8cd+="<"+uri+"> rdfs:label ?label. ";_8cd+="OPTIONAL { <"+uri+"><http://dbpedia.org/ontology/thumbnail> ?depiction. }";_8cd+="FILTER ( lang(?label) = \"en\") ";_8cd+="FILTER ( lang(?comment) = \"en\")} ";var args={url:ns.annotationServerVocabProxy+"?url="+encodeURIComponent("http://dbpedia.org/sparql?query="+encodeURIComponent(_8cd)+"&output=json"),handleAs:"json",headers:{"Accept":"application/sparql-results+json"},failOk:true,id:uri,load:function(data){if(data.results.bindings.length>0){var foo=data.results.bindings[0];if(typeof (foo.comment)!=="undefined"){item.description=foo.comment.value;}if(typeof (foo.depiction)!=="undefined"){item.image=foo.depiction.value;}}item.rdfData=semlibItems.createBucketForItem(item).bucket;self._itemRequestDone(term);},error:function(_8ce){if(_8ce.dojoType==="cancel"){return;}console.log("GETITEMDESC request error:"+_8ce);}};requester.xGet(args);},_itemRequestDone:function(term){var self=this,req=self.requests[term];if(typeof req.canceled!=="undefined"){return;}req.done+=1;self.log("query: "+term+", done: "+req.done+"/"+req.len);if(req.done<req.len){return;}self.log("Done loading items for term "+term+".. calling the function.");req.f(req.items,term);_PUNDIT.loadingBox.setJobOk(req.jobId);},cancelRequests:function(){var self=this,reqs=self.requests;for(var i in reqs){reqs[i].len=0;self._itemRequestDone(i);reqs[i].canceled=true;}}});}if(!_4._hasResource["pundit.selectors.FreebaseSelector"]){_4._hasResource["pundit.selectors.FreebaseSelector"]=true;_4.provide("pundit.selectors.FreebaseSelector");_4.declare("pundit.selectors.FreebaseSelector",pundit.selectors.SelectorBase,{opts:{limit:30,keyInputTimerLength:500,keywordMinimumLength:3,freebaseSearchURL:"https://www.googleapis.com/freebase/v1/search",freebaseSchemaBaseURL:"http://www.freebase.com/schema",freebaseImagesBaseURL:"https://usercontent.googleapis.com/freebase/v1/image",freebaseTopicURL:"https://www.googleapis.com/freebase/v1/topic",freebaseMQLReadURL:"https://www.googleapis.com/freebase/v1/mqlread",freebaseItemsBaseURL:"http://www.freebase.com",freebaseAPIKey:"AIzaSyCJjAj7Nd2wKsZ8d7XQ9ZvUwN5SF0tZBsE",layouts:["list","tile"]},constructor:function(_8cf){var self=this;self.requests={};self.log("Selector "+self.name+" up and running.");},getItemsForTerm:function(term,func,_8d0){var self=this;self.requests[term]={f:func,items:[],done:0};if(typeof (_8d0)!=="undefined"){self.requests[term].ef=_8d0;}self.requests[term].jobId=_PUNDIT.loadingBox.addJob("Freebase query: "+term);_4.io.script.get({callbackParamName:"callback",url:self.opts.freebaseSearchURL,content:{key:self.opts.freebaseAPIKey,query:term,limit:self.opts.limit},load:function(r){self.requests[term].len=r.result.length;if(r.hits===0){_PUNDIT.loadingBox.setJobOk(self.requests[term].jobId);self._itemRequestDone(term);}else{self._getItemsFromFreebaseResults(r,term);}},error:function(_8d1,_8d2){self.log(self.name+" getItemsForTerm got an error :(");if(typeof self.requests[term].ef!=="undefined"){self.requests[term].ef();}func([]);_PUNDIT.loadingBox.setJobKo(req.jobId);}});},_getItemsFromFreebaseResults:function(r,term){var self=this,len,ar;if(typeof (self.requests[term])==="undefined"){return;}ar=r.result;len=ar.length;self.log("Getting details for "+len+"items");for(var i=0;i<len;i++){var item={type:["subject"],label:ar[i].name,mid:ar[i].mid,freebaseId:ar[i].id,image:self.opts.freebaseImagesBaseURL+ar[i].mid,description:-1,value:-1};self.requests[term].items.push(item);self._getItemDetails(item,term);}},_getItemDetails:function(item,term){var self=this;_4.io.script.get({callbackParamName:"callback",url:self.opts.freebaseMQLReadURL,content:{query:_4.toJson({"id":null,"mid":item.mid,"type":[{}],}),limit:self.opts.limit,key:self.opts.freebaseAPIKey},load:function(r){self.log("MQL read for "+item.mid+" done");item.value=self.opts.freebaseItemsBaseURL+r.result.mid;item.typeLabels=[];item.rdftype=[];for(var l=r.result.type.length;l--;){var o=r.result.type[l],uri=self.opts.freebaseSchemaBaseURL+o.id;item.rdftype.push(uri);item.typeLabels.push({uri:uri,label:o.name});}if(item.description!==-1){self.log("MQL was last, calling itemRequestDone for item "+item.label);item.rdfData=self._finalizeBucket(item);self._itemRequestDone(term);}}});_4.io.script.get({callbackParamName:"callback",url:self.opts.freebaseTopicURL+item.mid,content:{key:self.opts.freebaseAPIKey,filter:"/common/topic/description"},failOk:false,load:function(r){self.log("TOPIC description for "+item.mid+" done");if(typeof (r.property)!=="undefined"&&r.property["/common/topic/description"].values.length>0){item.description=r.property["/common/topic/description"].values[0].value;}else{item.description=item.label;}if(item.value!==-1){self.log("TOPIC was last, calling itemRequestDone for item "+item.label);item.rdfData=self._finalizeBucket(item);self._itemRequestDone(term);}},error:function(e){item.description=item.label;if(item.value!==-1){item.rdfData=self._finalizeBucket(item);self._itemRequestDone(term);}return false;}});},_finalizeBucket:function(item){var b=semlibItems.createBucketForItem(item);for(var l=item.typeLabels.length;l--;){b.updateTripleObject(item.typeLabels[l].uri,ns.items.label,item.typeLabels[l].label,"literal");}return b.bucket;},_itemRequestDone:function(term){var self=this,req=self.requests[term];if(typeof (req.canceled)!=="undefined"){self.log("Request was canceled, returning");return;}req.done+=1;self.log("Query: "+term+", done: "+req.done+"/"+req.len);if(req.done<req.len){return;}self.log("Done loading items for term "+term+".. calling the function.");req.f(req.items,term);_PUNDIT.loadingBox.setJobOk(req.jobId);},cancelRequests:function(){var self=this,reqs=self.requests;for(var i in reqs){reqs[i].len=0;self._itemRequestDone(i);reqs[i].canceled=true;}}});}if(!_4._hasResource["pundit.selectors.KorboBasketSelector"]){_4._hasResource["pundit.selectors.KorboBasketSelector"]=true;_4.provide("pundit.selectors.KorboBasketSelector");_4.declare("pundit.selectors.KorboBasketSelector",pundit.selectors.SelectorBase,{opts:{limit:30,keyInputTimerLength:500,keywordMinimumLength:3,korboBasketReconURL:"http://manager.korbo.org/api.php/basket/reconcile/",korboBasketMetadataURL:"http://manager.korbo.org/",korboItemsBaseURL:"http://purl.org/net7/korbo",korboSchemaBaseURL:"http://purl.org/net7/korbo/type/",baskets:[16],layouts:["pundit-view-list","pundit-view-tile"]},constructor:function(_8d3){var self=this;self.requests={};self.log("Selector "+self.name+" up and running.");},getItemsForTerm:function(term,func){var self=this;self.requests[term]={f:func,items:[],done:0};self.requests[term].jobId=_PUNDIT.loadingBox.addJob("Korbo query: "+term);_4.io.script.get({callbackParamName:"jsonp",url:self.opts.korboBasketReconURL+self.opts.baskets[0],content:{query:_4.toJson({query:term})},load:function(r){self.requests[term].len=r.result.length;self.log("Loaded search term "+term+": "+self.requests[term].len+" items");if(self.requests[term].len===0){_PUNDIT.loadingBox.setJobOk(self.requests[term].jobId);self._itemRequestDone(term);}else{self._getItemsFromKorboResults(r.result,term);}},error:function(_8d4,_8d5){self.log(self.name+" getItemsForTerm got an error :(");console.log("ACF korbo ERRORz",_8d4,_8d5);_PUNDIT.loadingBox.setJobKo(req.jobId);self.setLoading(false);func([]);}});},_getItemsFromKorboResults:function(r,term){var self=this,len=r.length,_8d6=[];for(var i=0;i<len;i++){var _8d7=r[i],item;item={type:["subject"],label:_8d7.name,value:_8d7.resource_url};self._getItemMetadata(item,term);self.requests[term].items.push(item);_8d6.push(item);}},_getItemMetadata:function(item,term){var self=this;_4.io.script.get({callbackParamName:"jsonp",url:self.opts.korboBasketMetadataURL+self.opts.baskets[0],content:{url:item.value},load:function(r){var o=r.result,_8d8=[];self.log("Loading metadata for item "+item.value);if("image" in o){item.image=o.image;}if("description" in o){item.description=o.description;}if(("rdftype" in o)&&("length" in o.rdftype)){for(var j=o.rdftype.length;j--;){if(typeof (o.rdftype[j])==="string"){_8d8.push(o.rdftype[j]);}else{self.log("ERROR: Weird type is weird? "+typeof (o.rdftype[j])+": "+o.rdftype[j]);}}}item.rdftype=_8d8;item.rdfData=semlibItems.createBucketForItem(item).bucket;self._itemRequestDone(term);}});},_itemRequestDone:function(term){var self=this,req=self.requests[term];if(typeof (req.canceled)!=="undefined"){return;}req.done+=1;self.log("Query: "+term+", done: "+req.done+"/"+req.len);if(req.done<req.len){return;}self.log("Done loading items for term "+term+".. calling the function.");req.f(req.items,term);_PUNDIT.loadingBox.setJobOk(req.jobId);},cancelRequests:function(){var self=this,reqs=self.requests;for(var i in reqs){reqs[i].len=0;self._itemRequestDone(i);reqs[i].canceled=true;}}});}if(!_4._hasResource["pundit.selectors.MurucaSelector"]){_4._hasResource["pundit.selectors.MurucaSelector"]=true;_4.provide("pundit.selectors.MurucaSelector");_4.declare("pundit.selectors.MurucaSelector",pundit.selectors.SelectorBase,{opts:{limit:30,keyInputTimerLength:500,keywordMinimumLength:3,murucaReconURL:"http://demo2.galassiaariosto.netseven.it/reconcile",queryType:"",queryProperties:{},layouts:["pundit-view-list","pundit-view-tile"]},constructor:function(_8d9){var self=this;self.requests={};self.log("Selector "+self.name+" up and running.");},getItemsForTerm:function(term,func){var self=this;self.requests[term]={f:func,items:[],done:0};self.requests[term].jobId=_PUNDIT.loadingBox.addJob("Muruca query: "+term);_4.io.script.get({callbackParamName:"jsonp",url:self.opts.murucaReconURL,content:{query:_4.toJson({query:term,type:self.opts.queryType,properties:self.opts.queryProperties}),},load:function(r){self.requests[term].len=r.result.length;self.log("Loaded search term "+term+": "+self.requests[term].len+" items");if(self.requests[term].len===0){_PUNDIT.loadingBox.setJobOk(self.requests[term].jobId);self._itemRequestDone(term);}else{self._getItemsFromMurucaResults(r.result,term);}},error:function(_8da,_8db){self.log(self.name+" getItemsForTerm got an error :(");console.log("ACF muruca ERRORz",_8da,_8db);_PUNDIT.loadingBox.setJobKo(req.jobId);self.setLoading(false);func([]);}});},_getItemsFromMurucaResults:function(r,term){var self=this,len=r.length,_8dc=[];for(var i=0;i<len;i++){var _8dd=r[i],item,_8de=[];item={type:["subject"],label:_8dd.name,value:_8dd.resource_url};self.log("Loading metadata for item "+item.value);if("description" in _8dd){item.description=_8dd.description;}if(("type" in _8dd)&&("length" in _8dd.type)){for(var j=_8dd.type.length;j--;){if(typeof (_8dd.type[j])==="string"){_8de.push(_8dd.type[j]);}else{self.log("ERROR: Weird type is weird? "+typeof (_8dd.type[j])+": "+_8dd.type[j]);}}}item.rdftype=_8de;item.rdfData=semlibItems.createBucketForItem(item).bucket;self.requests[term].items.push(item);_8dc.push(item);self._itemRequestDone(term);}},_itemRequestDone:function(term){var self=this,req=self.requests[term];if(typeof (req.canceled)!=="undefined"){return;}req.done+=1;self.log("Query: "+term+", done: "+req.done+"/"+req.len);if(req.done<req.len){return;}self.log("Done loading items for term "+term+".. calling the function.");req.f(req.items,term);_PUNDIT.loadingBox.setJobOk(req.jobId);},cancelRequests:function(){var self=this,reqs=self.requests;for(var i in reqs){reqs[i].len=0;self._itemRequestDone(i);reqs[i].canceled=true;}}});}if(!_4._hasResource["pundit.selectors.WordnetSelector"]){_4._hasResource["pundit.selectors.WordnetSelector"]=true;_4.provide("pundit.selectors.WordnetSelector");_4.declare("pundit.selectors.WordnetSelector",pundit.selectors.SelectorBase,{opts:{limit:30,keyInputTimerLength:500,keywordMinimumLength:3,layouts:["list","tile"]},constructor:function(_8df){var self=this;self.requests={};self.log("Selector "+self.name+" up and running.");},getItemsForTerm:function(term,func,_8e0,_8e1){var self=this;if(typeof (self.limit)==="undefined"){_8e1=10;}else{_8e1=self.limit;}self.requests[term]={f:func,items:[],done:0};if(typeof _8e0!=="undefined"){self.requests[term].ef=_8e0;}self.requests[term].jobId=_PUNDIT.loadingBox.addJob("Wordnet query: "+term);var _8e2="PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> ";_8e2+="PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> ";_8e2+="PREFIX owl:  <http://www.w3.org/2002/07/owl#> ";_8e2+="PREFIX wordnet: <http://www.w3.org/2006/03/wn/wn20/schema/> ";_8e2+="SELECT ?uri ?s, ?label, ?description ";_8e2+="WHERE { ";_8e2+="?s rdfs:label ?label ";_8e2+="filter regex(?label, \"^"+term+"\"). ";_8e2+="?s rdf:type wordnet:NounSynset. ";_8e2+="?s owl:sameAs ?uri. ";_8e2+="?s wordnet:gloss ?description} LIMIT "+_8e1;var args={url:ns.annotationServerVocabProxy+"?url="+encodeURIComponent("http://wordnet.rkbexplorer.com/sparql/?format=json&query="+encodeURIComponent(_8e2)),handleAs:"json",headers:{"Accept":"application/sparql-results+json"},load:function(r){r=r.results.bindings;self.requests[term].len=r.length;if(r.length===0){self._itemRequestDone(term);return;}for(var i=r.length;i--;){var item={};item.type=["subject"];item.value=r[i].uri.value;item.label=r[i].label.value;try{item.description=r[i].description.value;}catch(e){}item.rdftype=[ns.rdfs_resource];item.rdfData=semlibItems.createBucketForItem(item).bucket;self.requests[term].items.push(item);}self._itemRequestDone(term);},error:function(_8e3){self.log(_8e3);func([]);_PUNDIT.loadingBox.setJobKo(self.requests[term].jobId);if(typeof self.requests[term].ef!=="undefined"){self.requests[term].ef();}}};var _8e4=requester.xGet(args);},_itemRequestDone:function(term){var self=this,req=self.requests[term];if(typeof req.canceled!=="undefined"){return;}self.log("Done loading items for term "+term+".. calling the function.");req.f(req.items,term);_PUNDIT.loadingBox.setJobOk(req.jobId);},cancelRequests:function(){var self=this,reqs=self.requests;for(var i in reqs){reqs[i].len=0;self._itemRequestDone(i);reqs[i].canceled=true;}}});}if(!_4._hasResource["pundit.selectors.EuropeanaSelector"]){_4._hasResource["pundit.selectors.EuropeanaSelector"]=true;_4.provide("pundit.selectors.EuropeanaSelector");_4.declare("pundit.selectors.EuropeanaSelector",pundit.selectors.SelectorBase,{opts:{keyInputTimerLength:500,keywordMinimumLength:3,europeanaKey:"DGEQTCYXDE",europeanaSearchURL:"http://api.europeana.eu/api/opensearch.json",europeanaSchemaBaseURL:"http://thepund.it/fake-namespace/europeana/",europeanaPagesToQuery:8,layouts:["list","tile"]},constructor:function(_8e5){var self=this;self.requests={};self.log("Selector "+self.name+" up and running.");},getItemsForTerm:function(term,func,_8e6){var self=this;self.requests[term]={f:func,items:[],done:0};if(typeof _8e6!=="undefined"){self.requests[term].ef=_8e6;}self.requests[term].jobId=_PUNDIT.loadingBox.addJob("Europeana query: "+term);for(var j=0;j<self.opts.europeanaPagesToQuery;j++){_4.io.script.get({callbackParamName:"callback",url:self.opts.europeanaSearchURL,content:{"searchTerms":term,"wskey":self.opts.europeanaKey,"startPage":j},load:function(r){self.requests[term].len=r["items"].length;if(r["items"].length===0){_PUNDIT.loadingBox.setJobOk(self.requests[term].jobId);self._itemRequestDone(term);}else{self._getItemsFromEuropeanaResults(r,term);}},error:function(_8e7,_8e8){self.log(self.name+" getItemsForTerm got an error :(");if(typeof self.requests[term].ef!=="undefined"){self.requests[term].ef();}func([]);_PUNDIT.loadingBox.setJobKo(req.jobId);}});}},_getItemsFromEuropeanaResults:function(r,term){var self=this,len=r.items.length;console.log("r 1: ",r,r.items);for(var i=0;i<len;i++){var _8e9=[],item;item={type:["subject"],rdftype:[],label:"",value:"",description:"",altLabel:"",image:""};self.requests[term].items.push(item);self._getItemDescription(item,term,r.items[i].link);}},_getItemDescription:function(item,term,URL){var self=this;_4.io.script.get({callbackParamName:"callback",url:URL,content:{},load:function(r){item.value=r["europeana:uri"];item.label=r["dc:title"]||r["dcterms:alternative"];if(typeof (r["dc:description"])==="string"){item.description=r["dc:description"];}else{if(typeof (r["dc:description"])==="object"){item.description=r["dc:description"].join("<br/>");}else{item.description="No desc :(";}}item.altLabel="From: "+r["europeana:dataProvider"];if(r["europeana:object"]){item.image=r["europeana:object"];}else{if(r["europeana:isShownAt"]){item.image=r["europeana:isShownAt"];}}item.rdftype=[];var _8ea=[],_8eb;if(typeof (r["dc:type"])==="string"){_8eb=self.opts.europeanaSchemaBaseURL+encodeURI(r["dc:type"]);item.rdftype.push(_8eb);_8ea.push({uri:_8eb,label:r["dc:type"]});}else{if(typeof (r["dc:type"].length)!=="undefined"&&r["dc:type"].length>0){for(var t=r["dc:type"].length;t--;){_8eb=self.opts.europeanaSchemaBaseURL+encodeURI(r["dc:type"][t]);item.rdftype.push(_8eb);_8ea.push({uri:_8eb,label:r["dc:type"][t]});}}}var _8ec=semlibItems.createBucketForItem(item);for(var l=_8ea.length;l--;){_8ec.updateTripleObject(_8ea[l].uri,ns.items.label,_8ea[l].label,"literal");}item.rdfData=_8ec.bucket;self._itemRequestDone(term);}});},_itemRequestDone:function(term){var self=this,req=self.requests[term];req.done+=1;self.log("query: "+term+", done: "+req.done+"/"+req.len);if(req.done<req.len){return;}self.log("Done loading items for term "+term+".. calling the function.");req.f(req.items,term);_PUNDIT.loadingBox.setJobOk(req.jobId);}});}if(!_4._hasResource["pundit.selectors.EuropeanaEDMSelector"]){_4._hasResource["pundit.selectors.EuropeanaEDMSelector"]=true;_4.provide("pundit.selectors.EuropeanaEDMSelector");_4.declare("pundit.selectors.EuropeanaEDMSelector",pundit.selectors.SelectorBase,{opts:{keyInputTimerLength:500,keywordMinimumLength:3,europeanaKey:"RjMQqtwpP",europeanaSearchURL:"http://www.europeana.eu/api/v2/search.json?",europeanaPortalURL:"http://europeana.eu/portal/record/",europeanaPortalFileExt:".html",europeanaSchemaBaseURL:"http://thepund.it/fake-namespace/europeana/",limit:35,layouts:["list","tile"]},constructor:function(_8ed){var self=this;self.requests={};self.log("Selector "+self.name+" up and running.");},getItemsForTerm:function(term,func,_8ee){var self=this;self.requests[term]={f:func,items:[],done:0};if(typeof _8ee!=="undefined"){self.requests[term].ef=_8ee;}self.requests[term].jobId=_PUNDIT.loadingBox.addJob("Europeana EDM query: "+term);_4.io.script.get({callbackParamName:"callback",url:self.opts.europeanaSearchURL,content:{"query":term,"wskey":self.opts.europeanaKey,"start":1,"rows":self.opts.limit},load:function(r){self.requests[term].len=r["itemsCount"];if(self.requests[term].len===0){_PUNDIT.loadingBox.setJobOk(self.requests[term].jobId);self._itemRequestDone(term);}else{self._getItemsFromEuropeanaResults(r,term);}},error:function(_8ef,_8f0){self.log(self.name+" getItemsForTerm got an error :(");if(typeof self.requests[term].ef!=="undefined"){self.requests[term].ef();}func([]);_PUNDIT.loadingBox.setJobKo(req.jobId);}});},_getItemsFromEuropeanaResults:function(r,term){var self=this,len=r.items.length;for(var i=0;i<len;i++){var _8f1=[],item;item={type:["subject"],rdftype:[],label:"",value:"",description:"",altLabel:"",image:""};self.requests[term].items.push(item);self._getItemDescription(item,term,r.items[i].link);}},_getItemDescription:function(item,term,URL){var self=this;_4.io.script.get({callbackParamName:"callback",url:URL,content:{},load:function(r){item.value=self.opts.europeanaPortalURL+r.object.about+self.opts.europeanaPortalFileExt;item.label=r.object.title[0]||"Untitled item";if(typeof (r.object.proxies)!=="undefined"&&r.object.proxies.length>0){for(var p=0;p<r.object.proxies.length;p++){if(typeof (r.object.proxies[p].dcDescription)!=="undefined"){item.description=r.object.proxies[p].dcDescription[0];}else{if(typeof (r.object.proxies[p].dcSubject)!=="undefined"&&typeof (r.object.proxies[p].dcSubject.def)!=="undefined"){item.description=[];for(var s=0;s<r.object.proxies[p].dcSubject.def.length;s++){item.description.push(r.object.proxies[p].dcSubject.def[s]);}}}}}if(typeof (item.description)==="object"){item.description=item.description.join("<br/>");}self.log("Extracted desc");if(typeof (r.object.aggregations)!=="undefined"&&r.object.aggregations.length>0){for(var ag=0;ag<r.object.aggregations.length;ag++){if(typeof (r.object.aggregations[ag].edmObject)!=="undefined"){item.image=r.object.aggregations[ag].edmObject;}}}self.log("Extracted image");item.rdftype=[];var _8f2=[],_8f3;if(typeof (r.object.proxies)!=="undefined"&&r.object.proxies.length>0){var pr=0;if(r.object.proxies[pr].dcType&&r.object.proxies[pr].dcType.def.length>0){for(ind=0;ind<r.object.proxies[pr].dcType.def.length;ind++){var _8f4=r.object.proxies[pr].dcType.def[ind];if(_8f4.match(/^http:*/)){self.log("Found an URI inside dcType: "+_8f4);}_8f3=self.opts.europeanaSchemaBaseURL+encodeURI(_8f4);item.rdftype.push(_8f3);_8f2.push({uri:_8f3,label:_8f4});}}}if(item.rdftype.length===0){self.log("Ops, "+item.label+" does not have any RDF type. Trying to fix at least one.");_8f3=self.opts.europeanaSchemaBaseURL+encodeURI(r.object.type);item.rdftype.push(_8f3);_8f2.push(r.object.type);}self.log("extracted types");var _8f5=semlibItems.createBucketForItem(item);for(var l=_8f2.length;l--;){_8f5.updateTripleObject(_8f2[l].uri,ns.items.label,_8f2[l].label,"literal");}item.rdfData=_8f5.bucket;self.log("Done with this item");self._itemRequestDone(term);},error:function(){self.log("JSONP And error functions dont get along that well...",arguments);}});},_itemRequestDone:function(term){var self=this,req=self.requests[term];req.done+=1;self.log("query: "+term+", done: "+req.done+"/"+req.len);if(req.done<req.len){return;}self.log("Done loading items for term "+term+".. calling the function.");req.f(req.items,term);_PUNDIT.loadingBox.setJobOk(req.jobId);}});}if(!_4._hasResource["pundit.selectors.BibServerSelector"]){_4._hasResource["pundit.selectors.BibServerSelector"]=true;_4.provide("pundit.selectors.BibServerSelector");_4.declare("pundit.selectors.BibServerSelector",pundit.selectors.SelectorBase,{opts:{limit:30,keyInputTimerLength:500,keywordMinimumLength:3,bibServerSearchURL:"http://big.bibsoup.net/search/?",bibServerSchemaBaseURL:"http://thepund.it/fake-namespace/bibserver/",bibServerItemRDFType:"http://thepund.it/fake-namespace/bibserver/item",layouts:["list","tile"]},constructor:function(_8f6){var self=this;self.requests={};self.log("Selector "+self.name+" up and running.");},getItemsForTerm:function(term,func,_8f7){var self=this;self.requests[term]={f:func,items:[],done:0};if(typeof _8f7!=="undefined"){self.requests[term].ef=_8f7;}self.requests[term].jobId=_PUNDIT.loadingBox.addJob("BibServer query: "+term);_4.io.script.get({callbackParamName:"callback",url:self.opts.bibServerSearchURL,timeout:10000,content:{"q":term,"format":"json"},load:function(r){self.requests[term].len=r.length;if(r.length===0){_PUNDIT.loadingBox.setJobOk(self.requests[term].jobId);self._itemRequestDone(term);}else{self._getItemsFromBibServerResults(r,term);}},error:function(_8f8,_8f9){self.log(self.name+" getItemsForTerm got an error :(");if(typeof self.requests[term].ef!=="undefined"){self.requests[term].ef();}func([]);_PUNDIT.loadingBox.setJobKo(req.jobId);}});},_getItemsFromBibServerResults:function(r,term){var self=this,len=r.length,_8fa;for(var i=0;i<len;i++){var _8fb=[],item,desc;desc="Authors: ";for(var a in r[i]["author"]){desc+=r[i]["author"][a].name;}desc+="<br/><br />";if(r[i]["journal"]){desc+="Journal: "+r[i]["journal"].name+", vol. "+r[i]["journal"].volume+"<br />";}_8fa=self.opts.bibServerSchemaBaseURL+encodeURI(r[i]["identifier"][0]["type"])+"/"+encodeURI(r[i]["identifier"][0]["id"]);item={type:["subject"],rdftype:[self.opts.bibServerItemRDFType],label:r[i]["title"],value:_8fa,description:desc,altLabel:"",image:""};self.requests[term].items.push(item);item.rdfData=semlibItems.createBucketForItem(item).bucket;self._itemRequestDone(term);}},_itemRequestDone:function(term){var self=this,req=self.requests[term];req.done+=1;self.log("query: "+term+", done: "+req.done+"/"+req.len);if(req.done<req.len){return;}self.log("Done loading items for term "+term+".. calling the function.");req.f(req.items,term);_PUNDIT.loadingBox.setJobOk(req.jobId);}});}if(!_4._hasResource["pundit.selectors.DandelionGeoSelector"]){_4._hasResource["pundit.selectors.DandelionGeoSelector"]=true;_4.provide("pundit.selectors.DandelionGeoSelector");_4.declare("pundit.selectors.DandelionGeoSelector",pundit.selectors.SelectorBase,{opts:{limit:30,keyInputTimerLength:500,keywordMinimumLength:3,layouts:["list","tile"],sortBy:true,dandelionBaseURL:"https://dandelion.eu/api/v1/datagem/26/data.json",basePOICategory:["http://www.freebase.com/schema/location/location","http://dbpedia.org/ontology/Place","http://schema.org/Place","http://www.w3.org/2003/01/geo/wgs84_pos#SpatialThing"],GeoCategoryLevels:{"0":"http://dandelion.eu/ontologies/GEO/v1#Country","1":"http://dandelion.eu/ontologies/GEO/v1#MacroRegion","2":"http://dandelion.eu/ontologies/GEO/v1#Region","3":"http://dandelion.eu/ontologies/GEO/v1#Province","4":"http://dandelion.eu/ontologies/GEO/v1#Municipality"}},constructor:function(_8fc){var self=this;self.requests={};self.log("Selector "+self.name+" up and running.");},getItemsForTerm:function(term,func,_8fd,_8fe){var self=this;if(typeof (self.limit)==="undefined"){_8fe=10;}else{_8fe=self.limit;}self.requests[term]={f:func,items:[],done:0};if(typeof _8fd!=="undefined"){self.requests[term].ef=_8fd;}self.requests[term].jobId=_PUNDIT.loadingBox.addJob("DandelionGeo query: "+term);var args={url:self.opts.dandelionBaseURL,callbackParamName:"callback",timeout:2000,failOk:true,content:{"$limit":self.opts.limit,"$where":"fulltext(\""+term+"\")","$order":"localCode"},load:function(r){self.requests[term].len=r.length;if(r.length===0){self._itemRequestDone(term);return;}for(var i=r.length;i--;){var item={};item.type=["subject"];item.value=r[i].acheneID;switch(r[i].level){case 0:item.label=r[i].country;break;case 1:item.label=r[i].macroregion;break;case 2:item.label=r[i].region;break;case 3:item.label=r[i].province;break;default:item.label=r[i].municipality;}item.description=r[i].municipality+"<br/>"+r[i].province+"<br/>"+r[i].region;item.rdftype=[self.opts.GeoCategoryLevels[r[i].level]];for(var j=self.opts.basePOICategory.length;j--;){item.rdftype.push(self.opts.basePOICategory[j]);}item.rdfData=semlibItems.createBucketForItem(item).bucket;self.requests[term].items.push(item);}self._itemRequestDone(term);},error:function(_8ff){self.log(_8ff);func([]);_PUNDIT.loadingBox.setJobKo(self.requests[term].jobId);if(typeof self.requests[term].ef!=="undefined"){self.requests[term].ef();}return false;}};var _900=_4.io.script.get(args);},_itemRequestDone:function(term){var self=this,req=self.requests[term];if(typeof req.canceled!=="undefined"){return;}self.log("Done loading items for term "+term+".. calling the function.");req.f(req.items,term);_PUNDIT.loadingBox.setJobOk(req.jobId);},cancelRequests:function(){var self=this,reqs=self.requests;for(var i in reqs){reqs[i].len=0;self._itemRequestDone(i);reqs[i].canceled=true;}}});}if(!_4._hasResource["pundit.selectors.DandelionPOISelector"]){_4._hasResource["pundit.selectors.DandelionPOISelector"]=true;_4.provide("pundit.selectors.DandelionPOISelector");_4.declare("pundit.selectors.DandelionPOISelector",pundit.selectors.SelectorBase,{opts:{limit:30,keyInputTimerLength:500,keywordMinimumLength:3,layouts:["list","tile"],dandelionBaseURL:"https://dandelion.eu/api/v1/datagem/25/data.json",basePOICategory:["http://www.freebase.com/schema/location/location","http://dbpedia.org/ontology/Place","http://schema.org/Place","http://www.w3.org/2003/01/geo/wgs84_pos#SpatialThing"]},constructor:function(_901){var self=this;self.requests={};self.log("Selector "+self.name+" up and running.");},getItemsForTerm:function(term,func,_902,_903){var self=this;if(typeof (self.limit)==="undefined"){_903=10;}else{_903=self.limit;}self.requests[term]={f:func,items:[],done:0};if(typeof _902!=="undefined"){self.requests[term].ef=_902;}self.requests[term].jobId=_PUNDIT.loadingBox.addJob("DandelionPOI query: "+term);var args={url:self.opts.dandelionBaseURL,callbackParamName:"callback",timeout:2000,failOk:true,content:{"$limit":self.opts.limit,"$where":"icontains(name, \""+term+"\")","$order":"name"},load:function(r){self.requests[term].len=r.length;if(r.length===0){self._itemRequestDone(term);return;}for(var i=r.length;i--;){var item={};item.type=["subject"];item.value=r[i].acheneID;item.label=r[i].name;item.description=r[i].municipality+" ("+r[i].province+")";item.rdftype=[r[i].category];for(var j=self.opts.basePOICategory.length;j--;){item.rdftype.push(self.opts.basePOICategory[j]);}item.rdfData=semlibItems.createBucketForItem(item).bucket;self.requests[term].items.push(item);}self._itemRequestDone(term);},error:function(_904){self.log(_904);func([]);_PUNDIT.loadingBox.setJobKo(self.requests[term].jobId);if(typeof self.requests[term].ef!=="undefined"){self.requests[term].ef();}return false;}};var _905=_4.io.script.get(args);},_itemRequestDone:function(term){var self=this,req=self.requests[term];if(typeof req.canceled!=="undefined"){return;}self.log("Done loading items for term "+term+".. calling the function.");req.f(req.items,term);_PUNDIT.loadingBox.setJobOk(req.jobId);},cancelRequests:function(){var self=this,reqs=self.requests;for(var i in reqs){reqs[i].len=0;self._itemRequestDone(i);reqs[i].canceled=true;}}});}if(!_4._hasResource["pundit.selectors.WikidataItemsSelector"]){_4._hasResource["pundit.selectors.WikidataItemsSelector"]=true;_4.provide("pundit.selectors.WikidataItemsSelector");_4.declare("pundit.selectors.WikidataItemsSelector",pundit.selectors.SelectorBase,{opts:{limit:30,keyInputTimerLength:500,keywordMinimumLength:3,url:"https://www.wikidata.org/w/api.php",lang:"en",layouts:["list","tile"]},constructor:function(_906){var self=this;self.requests={};self.log("Selector "+self.name+" up and running.");},getItemsForTerm:function(term,func,_907){var self=this;self.requests[term]={f:func,items:[],done:0};if(typeof errofunc!="undefined"){self.requests[term].ef=_907;}self.requests[term].jobId=_PUNDIT.loadingBox.addJob("Wikidata Lookup query: "+term);var _908={action:"wbsearchentities",type:"item",format:"json",language:this.opts.lang,search:term,limit:this.opts.limit,};_4.io.script.get({url:self.opts.url,handleAs:"json",content:_908,callbackParamName:"callback",load:function(_909){if(_909.success==1){self.requests[term].len=_909.search.length;self.log("Loaded search term "+term+": "+self.requests[term].len+" items");if(self.requests[term].len==0){_PUNDIT.loadingBox.setJobOk(self.requests[term].jobId);self._itemRequestDone(term);}else{self._getItemsFromWikidataResults(_909.search,term);}}},error:function(_90a,_90b){self.log(self.name+" getItemsForTerm got an error");_PUNDIT.loadingBox.setJobKo(self.requests[term].jobId);self.setLoading(false);func([]);}});},_getItemsFromWikidataResults:function(_90c,term){var self=this,len=_90c.length;result=[];for(var i=0;i<len;i++){var _90d=_90c[i],item;item={type:["subject"],label:_90d.label,value:_90d.url,id:_90d.id,description:_90d.description};self.requests[term].items.push(item);item.rdftype=[ns.rdfs_resource];item.rdfData=semlibItems.createBucketForItem(item).bucket;self._itemRequestDone(term);result.push(item);}},_getItemDetails:function(item,term){var self=this;},_itemRequestDone:function(term){var self=this,req=self.requests[term];if(typeof (req.canceled)!=="undefined"){self.log("Request was canceled, returning");return;}req.done+=1;self.log("Query: "+term+", done: "+req.done+"/"+req.len);if(req.done<req.len){return;}self.log("Done loading items for term "+term+".. calling the function.");req.f(req.items,term);_PUNDIT.loadingBox.setJobOk(req.jobId);},basicCall:function(_90e,cb,ecb){var _90f=this;_4.io.script.get({url:_90f.opts.url,handleAs:"json",content:_90e,callbackParamName:"callback",load:function(_910){if(_910.success==1){cb(_910);}},});},searchEntities:function(type,_911,cb){var _912={action:"wbsearchentities",type:type,format:"json",language:this.opts.lang,search:_911,};this.basicCall(_912,cb);},searchItems:function(_913,cb){this.searchEntities("item",_913,cb);},searchProperties:function(_914,cb){this.searchEntities("property",_914,cb);},searchValues:function(_915,cb){this.searchEntities("item",_915,cb);},getEntities:function(id,cb){var _916={action:"wbgetentities",ids:id,format:"json",};this.basicCall(_916,cb);},cancelRequests:function(){var self=this,reqs=self.requests;for(var i in reqs){reqs[i].len=0;self._itemRequestDone(i);reqs[i].canceled=true;}}});}if(!_4._hasResource["pundit.selectors.WikidataPropertiesSelector"]){_4._hasResource["pundit.selectors.WikidataPropertiesSelector"]=true;_4.provide("pundit.selectors.WikidataPropertiesSelector");_4.declare("pundit.selectors.WikidataPropertiesSelector",pundit.selectors.SelectorBase,{opts:{limit:30,keyInputTimerLength:500,keywordMinimumLength:3,url:"https://www.wikidata.org/w/api.php",lang:"en",layouts:["list","tile"]},constructor:function(_917){var self=this;self.requests={};self.log("Selector "+self.name+" up and running.");},getItemsForTerm:function(term,func,_918){var self=this;self.requests[term]={f:func,items:[],done:0};if(typeof errofunc!="undefined"){self.requests[term].ef=_918;}self.requests[term].jobId=_PUNDIT.loadingBox.addJob("Wikidata Lookup query: "+term);var _919={action:"wbsearchentities",type:"property",format:"json",language:this.opts.lang,search:term,limit:this.opts.limit,};_4.io.script.get({url:self.opts.url,handleAs:"json",content:_919,callbackParamName:"callback",load:function(_91a){if(_91a.success==1){self.requests[term].len=_91a.search.length;self.log("Loaded search term "+term+": "+self.requests[term].len+" properties");if(self.requests[term].len==0){_PUNDIT.loadingBox.setJobOk(self.requests[term].jobId);self._itemRequestDone(term);}else{self._getItemsFromWikidataResults(_91a.search,term);}}},error:function(_91b,_91c){self.log(self.name+" getItemsForTerm got an error");_PUNDIT.loadingBox.setJobKo(self.requests[term].jobId);self.setLoading(false);func([]);}});},_getItemsFromWikidataResults:function(_91d,term){var self=this,len=_91d.length;result=[];for(var i=0;i<len;i++){var _91e=_91d[i],item;item={type:["predicate"],label:_91e.label,value:_91e.url,id:_91e.id,description:_91e.description,range:[],domain:[]};self.requests[term].items.push(item);item.rdftype=[ns.rdfs_resource];item.rdfData=semlibItems.createBucketForItem(item).bucket;self._itemRequestDone(term);result.push(item);}},_getItemDetails:function(item,term){var self=this;},_itemRequestDone:function(term){var self=this,req=self.requests[term];if(typeof (req.canceled)!=="undefined"){self.log("Request was canceled, returning");return;}req.done+=1;self.log("Query: "+term+", done: "+req.done+"/"+req.len);if(req.done<req.len){return;}self.log("Done loading items for term "+term+".. calling the function.");req.f(req.items,term);_PUNDIT.loadingBox.setJobOk(req.jobId);},basicCall:function(_91f,cb,ecb){var _920=this;_4.io.script.get({url:_920.opts.url,handleAs:"json",content:_91f,callbackParamName:"callback",load:function(_921){if(_921.success==1){cb(_921);}},});},searchEntities:function(type,_922,cb){var _923={action:"wbsearchentities",type:type,format:"json",language:this.opts.lang,search:_922,};this.basicCall(_923,cb);},searchItems:function(_924,cb){this.searchEntities("item",_924,cb);},searchProperties:function(_925,cb){this.searchEntities("property",_925,cb);},searchValues:function(_926,cb){this.searchEntities("item",_926,cb);},getEntities:function(id,cb){var _927={action:"wbgetentities",ids:id,format:"json",};this.basicCall(_927,cb);},cancelRequests:function(){var self=this,reqs=self.requests;for(var i in reqs){reqs[i].len=0;self._itemRequestDone(i);reqs[i].canceled=true;}}});}if(!_4._hasResource["pundit.ImageFragmentHandler"]){_4._hasResource["pundit.ImageFragmentHandler"]=true;_4.provide("pundit.ImageFragmentHandler");_4.declare("pundit.ImageFragmentHandler",pundit.BaseComponent,{constructor:function(_928){var self=this;self.baloonEnabled=true;self.contextualMenuVisible=false;self.inBaloon=false;self.inImage=false;self.isOutTimer=null;self.helper=new pundit.XpointersHelper();self.initImageSelectionHelper();self.initBehaviours();_PUNDIT.init.onInitDone(function(){cMenu.onTypeHide_imageSelectionHelper(function(uri,e){self.contextualMenuVisible=false;self.isOut();});semlibWindow.onWindowAnnotationResize(function(){self.baloonEnabled=false;if((self.imgAnn!==null)||(typeof (self.imgAnn)!=="undefined")){self.destroyBaloon();}});semlibWindow.onWindowClose(function(){self.baloonEnabled=false;if((self.imgAnn!==null)||(typeof (self.imgAnn)!=="undefined")){self.destroyBaloon();}});semlibWindow.onResizeEnd(function(){self.baloonEnabled=true;self.isOut();});});self.log("Image FragmentHandler up and running");},initImageSelectionHelper:function(){var self=this;cMenu.addAction({type:["imageSelectionHelper"],name:"AddImageToMyItems",label:"Add this image to My Items",showIf:function(item){if(typeof semlibMyItems.getItemFromUri(item.value)!=="undefined"){return false;}else{return true;}},onclick:function(item){if(!semlibMyItems.uriInItems(item.value)){item.rdfData=semlibItems.createBucketForImageFragment(item).bucket;previewer.buildPreviewForItem(item);semlibMyItems.addItem(item,true);semlibMyItems.show_pundittabfiltermyitemsimages();}if(!semlibItems.uriInItems(item.value)){semlibItems.addItem(item);}if(!tooltip_viewer.isTempXpointer(item.value)){tooltip_viewer.tempXpointers.push(item.value);tooltip_viewer.consolidate();}tooltip_viewer.highlightByXpointer(item.value);_PUNDIT.ga.track("cmenu","click","add-image-to-my-items");return true;}});cMenu.addAction({type:["imageSelectionHelper"],name:"removeImageFromMyItems",label:"Remove from My Items",showIf:function(item){if(typeof semlibMyItems.getItemFromUri(item.value)!=="undefined"){return true;}else{return false;}},onclick:function(item){semlibMyItems.removeItemFromUri(item.value);tooltip_viewer.removeTempXpointer(item.value);tooltip_viewer.consolidate();_PUNDIT.ga.track("cmenu","click","remove-image-from-myitems");return true;}});cMenu.addAction({type:["imageSelectionHelper"],name:"AnnotateImageWithTripleComposer",label:"Annotate this image",showIf:function(item){return true;},onclick:function(item){tripleComposer.addItemToSubject(item);previewer.buildPreviewForItem(item);if(!_PUNDIT.GUI.isWindowOpen()){_PUNDIT.GUI.toggleWindow();}_PUNDIT.ga.track("cmenu","click","annotate-this-image");return true;}});cMenu.addAction({type:["imageSelectionHelper"],name:"AddCommentToImage",label:"Comment or tag this image",showIf:function(item){return true;},onclick:function(item){_PUNDIT["commentTag"].initPanel(item,"Comment and tags");_PUNDIT["commentTag"].saveComment=true;_PUNDIT.ga.track("cmenu","click","comment-or-tag-this-image");}});},initBehaviours:function(){var self=this;_4.query("img").connect("onmouseenter",function(e){var _929=true,_92a=e.target;while(_92a.tagName.toLowerCase()!=="body"){if(_4.hasClass(_92a,"pundit-disable-annotation")){_929=false;break;}_92a=_4.query(_92a).parent()[0];}if(!_929){return;}self.inImage=true;if(e.target!==self.thisIm){self.destroyBaloon();}self.thisIm=e.target;if(!self.baloonEnabled){return;}else{self.showBaloon();}});_4.query("img").connect("onmouseleave",function(e){self.inImage=false;var pos=_4.position(e.target,true);if(self.isOut(pos,e.pageX,e.pageY)){self.destroyBaloon();}});},hideImg:function(pos,x,y){var self=this;if(self.isOut(pos,x,y)){self.destroyBaloon();}},isOut:function(pos,x,y){var self=this;clearTimeout(self.isOutTimer);self.isOutTimer=setTimeout(function(){if((!self.inBaloon)&&(!self.inImage)){self.onIsOut();}else{self.onIsIn();}},100);},onIsOut:function(){var self=this;if((self.imgAnn!==null)&&(typeof (self.imgAnn)!=="undefined")){if(!self.contextualMenuVisible){self.destroyBaloon();}}},onIsIn:function(){var self=this;self.showBaloon();},createItemFromImage:function(_92b){var self=this,xp=self.helper.getXpFromNode(_92b),_92c=self.helper.extractContentFromNode(_92b),src=_92b.src,_92d=_PUNDIT.tripleComposer.getSafePageContext();if(_92d.indexOf("#xpointer")!==-1){_92d=_92d.substring(0,_92d.indexOf("#"));}var item={type:["subject"],rdftype:[ns.image],label:_92c,description:_92c,value:xp,image:src,isPartOf:xp.split("#")[0],pageContext:_92d};item.rdfData=semlibItems.createBucketForImageFragment(item).bucket;return item;},destroyBaloon:function(){var self=this;_4.destroy(self.imgAnn);self.imgAnn=null;},showBaloon:function(){var self=this;if((self.imgAnn===null)||(typeof (self.imgAnn)==="undefined")){self.imgAnn=_4.create("span");self.pos=_4.position(self.thisIm,true);var x=self.pos.x-10,y=self.pos.y-10;_4.style(self.imgAnn,{position:"absolute",top:y+"px",left:x+"px"});_4.addClass(self.imgAnn,"pundit-ifh-annotate-image");_4.connect(self.imgAnn,"onmouseleave",function(e){self.inBaloon=false;self.isOut();});_4.connect(self.imgAnn,"onmouseenter",function(e){self.inBaloon=true;});_4.connect(self.imgAnn,"onclick",function(e){var item=self.createItemFromImage(self.thisIm);item._originalNode=self.thisIm;cMenu.show(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset,item,"imageSelectionHelper");self.contextualMenuVisible=true;});_4.query("body").append(self.imgAnn);}},getParentImageXpointer:function(_92e){var _92f=_PUNDIT.items.getItemByUri(_92e);if(typeof (_92f)!=="undefined"&&typeof (_92f.rdftype)!=="undefined"){for(var si=0;si<_92f.rdftype.length;si++){if(_92f.rdftype[si]===ns.fragments.image){var _930=_92f.isPartOf;var imgs=_4.query("img");for(var ii=0;ii<imgs.length;ii++){if(imgs[ii].src===_930){var _931=new pundit.XpointersHelper();var _932=_931.getXpFromNode(imgs[ii]);return _932;}}}}}}});}if(!_4._hasResource["pundit.NotebookManager"]){_4._hasResource["pundit.NotebookManager"]=true;_4.provide("pundit.NotebookManager");_4.declare("pundit.NotebookManager",pundit.BasePanel,{constructor:function(_933){var self=this;self.ownedNotebooksIds=[];self.activeNotebooksIds=[];self.notebooks={};self.othersNotebooks={};self.requests={};self.initHTML();self.initContextMenu();self.initBehaviors();self.reader=new pundit.AnnotationReader();self.reader.onError(function(){console.log("An error occurred reading notebook information. ;(");self.setPanelLoading(false,"owned");self.setPanelLoading(false,"others");});self.writer=new pundit.AnnotationWriter();self.writer.onError(function(){console.log("An error occurred writing notebook information. ;(");self.setPanelLoading(false,"owned");self.setPanelLoading(false,"others");});tooltip_viewer.onNotebookActivationChanged(function(){if(self.isVisible()){self.updateOtherNotebook();}});self.notebookSharePanel=new pundit.BasePanel({drag:true,title:"Share Notebook",name:"notebook-sharePanel"});},initHTML:function(){var self=this;self.log("Init HTML Notebook Panel");var c="<div class=\"pundit-panel\"><span>Your annotations are written in the current notebook.</br>Your current notebook is: &nbsp;</span><span id=\"pundit-current-notebook-name\"></span></div>";c+="<div class=\"pundit-rp-notebook-creation pundit-panel\" style=\"width:390px;\">";c+="   <span class=\"pundit-pane-title\">Create a new Notebook</span></br>";c+="   <span>Notebook Name:</span><input type=\"text\" id=\"pundit-notebook-name-input\" style=\"width:200px;margin-left:10px;\"></input><input id=\"pundit-create-notebook-button\" type=\"button\" value=\"Create\" disabled=\"true\" style=\"margin-left:10px;\"></input></br>";c+="</div>";c+="<div class=\"pundit-rp-notebooks pundit-panel pundit-panel-loading\" style=\"margin-top:5px;\">";c+="   <span class=\"pundit-pane-title\">Your notebooks</span>";c+="    <ul id=\"pundit-notebook-list\" class=\"pundit-items pundit-view-list pundit-stop-wheel-propagation\" style=\"max-height:240px;overflow-y:auto\"></ul>";c+="</div>";c+="<div id=\"pundit-others-notebooks-div\" class=\"pundit-display-none pundit-rp-others-notebooks pundit-panel pundit-panel-loading\" style=\"margin-top:5px;\">";c+="   <span class=\"pundit-pane-title\" >Notebooks you are watching</span>";c+="    <ul id=\"pundit-other-notebook-list\" class=\"pundit-items pundit-view-list pundit-stop-wheel-propagation\" style=\"max-height:240px;overflow-y:auto\"></ul>";c+="</div>";self.addHTMLContent(c);},initContextMenu:function(){var self=this;if(_PUNDIT.config.modules["pundit.NotebookManager"].notebookActivation===true){cMenu.addAction({type:["notebookItem"],name:"punditNotebookDisactivate",label:"Deactivate Notebook",showIf:function(id){if(self.notebooks[id].activated&&!self.notebooks[id].current){return true;}else{return false;}},onclick:function(id){self.setPanelLoading(true,"owned");self.activateNotebook(id,"0",function(id,_934){semlibWindow.closeAllPanels();self.updateNotebookActivation(id,_934);_PUNDIT["myPundit"].getAnnotationVisibility(function(mode){if(mode==="active"){tooltip_viewer.refreshAnnotations();}});});_PUNDIT.ga.track("cmenu","click","deactivate-notebook");return true;}});cMenu.addAction({type:["notebookItem"],name:"punditNotebookActivate",label:"Activate Notebook",showIf:function(id){if(!self.notebooks[id].activated){return true;}else{return false;}},onclick:function(id){self.setPanelLoading(true,"owned");self.activateNotebook(id,"1",function(id,_935){semlibWindow.closeAllPanels();self.updateNotebookActivation(id,_935);_PUNDIT["myPundit"].getAnnotationVisibility(function(mode){if(mode==="active"){tooltip_viewer.refreshAnnotations();}});});_PUNDIT.ga.track("cmenu","click","activate-notebook");return true;}});cMenu.addAction({type:["otherNotebookItem"],name:"punditOtherNotebookDisactivate",label:"Deactivate Notebook",showIf:function(id){if(self.othersNotebooks[id].activated){return true;}else{return false;}},onclick:function(id){self.setPanelLoading(true,"others");self.activateNotebook(id,"0",function(id,_936){semlibWindow.closeAllPanels();self.updateNotebookActivation(id,_936,"others");_PUNDIT["myPundit"].getAnnotationVisibility(function(mode){if(mode==="active"){tooltip_viewer.refreshAnnotations();}});});_PUNDIT.ga.track("cmenu","click","deactivate-other-notebook");return true;}});cMenu.addAction({type:["otherNotebookItem"],name:"punditOtherNotebookActivate",label:"Activate Notebook",showIf:function(id){if(!self.othersNotebooks[id].activated){return true;}else{return false;}},onclick:function(id){self.setPanelLoading(true,"others");self.activateNotebook(id,"1",function(id,_937){semlibWindow.closeAllPanels();self.updateNotebookActivation(id,_937,"others");_PUNDIT["myPundit"].getAnnotationVisibility(function(mode){if(mode==="active"){tooltip_viewer.refreshAnnotations();}});});_PUNDIT.ga.track("cmenu","click","activate-other-notebook");return true;}});}cMenu.addAction({type:["notebookItem"],name:"punditNotebookSetPublic",label:"Set Public",showIf:function(id){if(self.notebooks[id].visibility!=="public"){return true;}else{return false;}},onclick:function(id){self.setPanelLoading(true,"owned");self.writer.setNotebookVisibility(id,"public",function(id,_938){self.updateNotebookVisibility(id,_938);});_PUNDIT.ga.track("cmenu","click","set-notebook-public");return true;}});cMenu.addAction({type:["notebookItem"],name:"punditNotebookSetPrivate",label:"Set Private",showIf:function(id){if(self.notebooks[id].visibility!=="private"){return true;}else{return false;}},onclick:function(id){self.setPanelLoading(true,"owned");self.writer.setNotebookVisibility(id,"private",function(id,_939){self.updateNotebookVisibility(id,_939);});_PUNDIT.ga.track("cmenu","click","set-notebook-private");return true;}});cMenu.addAction({type:["notebookItem"],name:"punditNotebookCurrent",label:"Set as Current Notebook",showIf:function(id){if(!self.notebooks[id].current){return true;}else{return false;}},onclick:function(id){self.setPanelLoading(true,"owned");self.writer.setNotebookCurrent(id,self.updateCurrentNotebook(id));_PUNDIT.ga.track("cmenu","click","set-notebook-current");return true;}});cMenu.addAction({type:["notebookItem"],name:"punditNotebookViewInAsk",label:"View in Ask the Pundit",showIf:function(){return true;},onclick:function(id){_PUNDIT.ga.track("cmenu","click","view-in-ask-the-pundit");window.open(self.opts.askBaseURL+id);return true;}});if(_PUNDIT.config.modules["pundit.NotebookManager"].notebookSharing===true){cMenu.addAction({type:["notebookItem"],name:"punditShareNotebook",label:"Share Notebook",showIf:function(id){if(self.notebooks[id].activated&&self.notebooks[id].visibility==="public"){return true;}else{return false;}},onclick:function(id){_PUNDIT.ga.track("cmenu","click","share-notebook");self.notebookSharePanel.emptyContent();var html="<div class=\"pundit-panel\"><span class=\"pundit-pane-title\">This url is all you need to share your notebook:</span><br>";html+="<textarea style=\"width:390px;height:40px;margin-bottom:5px;margin-top:5px\">http://metasound.dibet.univpm.it/release_bot/build-development/pages/activate.html?id="+id+"</textarea><br></div>";self.notebookSharePanel.addHTMLContent(html);var wdim=_4.window.getBox();self.notebookSharePanel.show((wdim.w-400)/2,(wdim.h-200)/2);return true;}});}},initBehaviors:function(){var self=this,beh={};_4.connect(_4.byId("pundit-create-notebook-button"),"onclick",function(e){self.setPanelLoading(true,"owned");self.writer.createNotebook(_4.byId("pundit-notebook-name-input").value,function(id){self.getNotebookInfo(id,"owned");});_PUNDIT.ga.track("gui-button","click","pundit-create-notebook-button");});_4.connect(_4.byId("pundit-notebook-name-input"),"onkeyup",function(e){if(e.target.value!==""){self.updateCreateBtn(true);}else{self.updateCreateBtn(false);}});beh["#"+self._id+" div.pundit-rp-notebooks li span.pundit-icon-context-button"]={"onclick":function(e){var _93a=_4.query(e.target).parent()[0],id=_4.attr(_93a,"about");cMenu.show(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset,id,"notebookItem");}};if(_PUNDIT.config.modules["pundit.NotebookManager"].notebookActivation===true){beh["#"+self._id+" div.pundit-rp-others-notebooks li span.pundit-icon-context-button"]={"onclick":function(e){var _93b=_4.query(e.target).parent()[0],id=_4.attr(_93b,"about");cMenu.show(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset,id,"otherNotebookItem");}};}_4.behavior.add(beh);},show:function(){this.inherited(arguments);var self=this;_4.byId("pundit-current-notebook-name").innerHTML="";self.activesCompleted=false;self.ownedCompleted=false;self.reader.getActiveNotebooks(function(ids){self.activeNotebooksIds=ids;self.activeCompleted=true;self.onNotebookIdsReceived();});self.reader.getOwnedNotebooks(function(ids){self.ownedNotebooksIds=ids;self.ownedCompleted=true;self.onNotebookIdsReceived();});self.setPanelLoading("owned",true);self.setPanelLoading("others",true);},onNotebookInfoLoaded:function(){var self=this;self.requests={};self.setPanelLoading(false,"others");self.reader.getCurrentNotebookId(function(id){_4.addClass(_4.query("#"+self._id+" li[about = "+id+"]")[0],"pundit-current");_4.removeClass(_4.query("#"+self._id+" .pundit-rp-notebooks")[0],"pundit-panel-loading");self.notebooks[id].current=true;_4.byId("pundit-current-notebook-name").innerHTML=self.notebooks[id].label;});_4.behavior.apply();},activateNotebook:function(id,flag,cb){var self=this;self.writer.setNotebookActive(id,flag,cb);},updateNotebookActivation:function(id,_93c,type){var self=this,_93d;if(_93c==="1"){_93d=true;_4.removeClass(_4.query("#"+self._id+" li[about = "+id+"]")[0],"pundit-disactivated");_4.addClass(_4.query("#"+self._id+" li[about = "+id+"]")[0],"pundit-activated");}else{_93d=false;_4.removeClass(_4.query("#"+self._id+" li[about = "+id+"]")[0],"pundit-activated");_4.addClass(_4.query("#"+self._id+" li[about = "+id+"]")[0],"pundit-disactivated");}if(typeof (type)!=="undefined"){if(type==="others"){self.othersNotebooks[id].activated=_93d;self.setPanelLoading(false,"others");}}else{self.notebooks[id].activated=_93d;self.setPanelLoading(false,"owned");}},updateCurrentNotebook:function(id){var self=this;for(var i in self.notebooks){self.notebooks[i].current=false;}self.notebooks[id].current=true;_4.query("#"+self._id+" .pundit-rp-notebooks li").forEach(function(item){_4.removeClass(item,"pundit-current");});_4.addClass(_4.query("#"+self._id+" li[about = "+id+"]")[0],"pundit-current");_4.byId("pundit-current-notebook-name").innerHTML=self.notebooks[id].label;self.setPanelLoading(false,"owned");},updateNotebookVisibility:function(id,_93e){var self=this;if(_93e==="public"){_4.removeClass(_4.query("#"+self._id+" li[about = "+id+"]")[0],"pundit-private");_4.addClass(_4.query("#"+self._id+" li[about = "+id+"]")[0],"pundit-public");self.notebooks[id].visibility="public";}if(_93e==="private"){_4.addClass(_4.query("#"+self._id+" li[about = "+id+"]")[0],"pundit-private");_4.removeClass(_4.query("#"+self._id+" li[about = "+id+"]")[0],"pundit-public");self.notebooks[id].visibility="private";}self.setPanelLoading(false,"owned");},setPanelLoading:function(s,type){var self=this;if(s===true){if(type==="owned"){_4.addClass(_4.query("#"+self._id+" .pundit-rp-notebooks")[0],"pundit-panel-loading");}else{_4.addClass(_4.query("#"+self._id+" .pundit-rp-others-notebooks")[0],"pundit-panel-loading");}}else{if(type==="owned"){_4.removeClass(_4.query("#"+self._id+" .pundit-rp-notebooks")[0],"pundit-panel-loading");}else{_4.removeClass(_4.query("#"+self._id+" .pundit-rp-others-notebooks")[0],"pundit-panel-loading");}}},hide:function(){this.inherited(arguments);var self=this;self.notebooks={};self.othersnotebooks={};self.ownedNotebooksIds=[];self.activeNotebooksIds=[];_4.empty(_4.query("#"+self._id+" .pundit-rp-notebooks ul")[0]);},updateCreateBtn:function(_93f){if(_93f){_4.attr(_4.byId("pundit-create-notebook-button"),"disabled",false);}else{_4.attr(_4.byId("pundit-create-notebook-button"),"disabled",true);}},onNotebookIdsReceived:function(){var self=this;if(self.ownedCompleted&&self.activeCompleted){self.setOtherNotebooks();self.getNotebooksInfo();}},setOtherNotebooks:function(){var self=this;for(var i=self.ownedNotebooksIds.length;i--;){var _940=_4.indexOf(self.activeNotebooksIds,self.ownedNotebooksIds[i]);if(_940!==-1){self.activeNotebooksIds.splice(_940,1);}}},getNotebooksInfo:function(){var self=this;for(var i=self.activeNotebooksIds.length;i--;){self.getNotebookInfo(self.activeNotebooksIds[i],"others");}for(var i=self.ownedNotebooksIds.length;i--;){self.getNotebookInfo(self.ownedNotebooksIds[i],"owned");}},getNotebookInfo:function(_941,type){var self=this;self.requests[_941]=false;self.reader.getNotebookMetadata(_941,(function(_942){return function(id,_943){var meta={};for(var _944 in _943){meta=_943[_944];}var _945={visibility:meta[ns.notebooks.visibility][0].value,created:meta[ns.notebooks.created][0].value,creator:meta[ns.notebooks.creator][0].value,creatorName:meta[ns.notebooks.creatorName][0].value,id:meta[ns.notebooks.id][0].value,includes:meta[ns.notebooks.includes],type:meta[ns.notebooks.type][0].value,label:meta[ns.notebooks.label][0].value};self.reader.checkNotebook(_945.id,function(id,_946){var _947=true;if(_946==="0"){_945.activated=false;}else{_945.activated=true;}if(_942==="owned"){self.notebooks[id]=_945;}else{self.othersNotebooks[id]=_945;}self.requests[id]=true;self.addNotebookItem(_945,_942);for(var j in self.requests){if(!self.requests[j]){_947=false;break;}}if(_947){self.onNotebookInfoLoaded();}});};})(type));},addNotebookItem:function(_948,type){var self=this,c="<li about=\""+_948.id+"\" class=\"dojoDndItem pundit-shown\">";c+="   <span class=\"pundit-icon-context-button\"></span>";c+="   <span>"+_948.label+" (id:"+_948.id+")</span>";c+="   <span class=\"pundit-item-visibility\"></span>";if(_PUNDIT.config.modules["pundit.NotebookManager"].notebookActivation===true){c+="   <span class=\"pundit-item-activation pundit-disactivated\"></span>";}c+="   <span class=\"pundit-item-editability\"></span>";c+="   <span class=\"pundit-trim pundit-notebook-creator\">"+_948.creatorName+"</span>";c+="</li>";if(type==="owned"){_4.query("#pundit-notebook-list").append(c);}else{_4.removeClass("pundit-others-notebooks-div","pundit-display-none");_4.query("#pundit-other-notebook-list").append(c);}if(_948.visibility==="public"){_4.removeClass(_4.query("#"+self._id+" li[about = "+_948.id+"]")[0],"pundit-private");_4.addClass(_4.query("#"+self._id+" li[about = "+_948.id+"]")[0],"pundit-public");}if(_948.visibility==="private"){_4.addClass(_4.query("#"+self._id+" li[about = "+_948.id+"]")[0],"pundit-private");_4.removeClass(_4.query("#"+self._id+" li[about = "+_948.id+"]")[0],"pundit-public");}if(_948.activated){_4.addClass(_4.query("#"+self._id+" li[about = "+_948.id+"]")[0],"pundit-activated");_4.removeClass(_4.query("#"+self._id+" li[about = "+_948.id+"]")[0],"pundit-disactivated");}else{_4.addClass(_4.query("#"+self._id+" li[about = "+_948.id+"]")[0],"pundit-disactivated");_4.removeClass(_4.query("#"+self._id+" li[about = "+_948.id+"]")[0],"pundit-activated");}},updateOtherNotebook:function(){var self=this;self.setPanelLoading(true,"others");_4.empty("pundit-other-notebook-list");self.othersnotebooks={};self.activeNotebooksIds=[];self.reader.getActiveNotebooks(function(ids){self.activeNotebooksIds=ids;self.setOtherNotebooks();for(var i=self.activeNotebooksIds.length;i--;){self.getNotebookInfo(self.activeNotebooksIds[i],"others");}});}});}if(!_4._hasResource["pundit.Recognizer"]){_4._hasResource["pundit.Recognizer"]=true;_4.provide("pundit.Recognizer");_4.declare("pundit.Recognizer",pundit.BaseComponent,{constructor:function(){var self=this;self.initContextualMenu();self.initBehaviors();self.recognizerPanel=new pundit.RecognizerPanel({name:"recognize",preview:true,drag:true,searchType:"search",namedEntitiesSources:_PUNDIT.config.activeEntitySources});self.log("Recognizer up and running!");},init:function(_949){},initGUI:function(){},initBehaviors:function(){},initContextualMenu:function(){var self=this;if(_PUNDIT.config.modules["pundit.Recognizer"].showAction){cMenu.addAction({type:["textSelectionHelper"],name:"recognizeSelection",label:"Recognize selection",showIf:function(item){return true;},onclick:function(item){_PUNDIT.ga.track("cmenu","click","recognize-selection");var term=fragmentHandler.getLastSelectedContent();self.recognizerPanel.performSearch(term);self.recognizerPanel.show(150,150,{title:"Recognizer",target:item});}});}},});}if(!_4._hasResource["pundit.ImageAnnotationPanel"]){_4._hasResource["pundit.ImageAnnotationPanel"]=true;_4.provide("pundit.ImageAnnotationPanel");_4.declare("pundit.ImageAnnotationPanel",pundit.BasePanel,{constructor:function(_94a){var self=this;(function(){var h=document.getElementsByTagName("head")[0],d=document.createElement("script");d.type="text/javascript",d.src="http://thepund.it/lib/kinetic/kinetic-v4.5.1.min.js";h.appendChild(d);})();self.deltaScale=0.1;self.dotRadius=5;self.strokeWidth=10;self.lineStrokeWidth=3;self.dashArray=[10,5,1,5];self.crypto=new pundit.Crypto();self.createdShapes=[];self.selectedShape=null;self.containerSize={w:480,h:360};cMenu.addAction({type:["imageSelectionHelper"],name:"AnnotateImage",label:"Annotate a part of this image",showIf:function(item){return true;},onclick:function(item){_PUNDIT.ga.track("cmenu","click","annotate-a-part-of-this-image");self.initialize(item.image);return true;}});},initialize:function(_94b){var self=this;self.createdShapes=[];if(typeof (Kinetic)==="undefined"){alert("Kinetic Lib not loaded Yet... Try again! :P");return;}self.imageSrc=_94b;self.initHTML();self.initBehavior();self.initAnnotationCanvas();self.show();_4.behavior.apply();},initHTML:function(){var self=this;self.log("Init HTML Resource Panel");self.log("Resource Panel Contructor");var c="<ul id =\""+self._id+"-image-ann-container\" class=\"pundit-horizontal-list\">";c+="  <li style=\"width:100px\">";c+="      <span id=\"pundit-image-annotation-zoom\" class=\"pundit-zoom-in-icon\" style=\"display:block;width:25px;height:25px;margin-left:auto;margin-right:auto;\"></span><span style=\"display:block;text-align:center;\">Zoom in</span></br>";c+="      <span id=\"pundit-image-annotation-pan\" class=\"pundit-zoom-out-icon\" style=\"display:block;width:25px;height:25px;margin-left:auto;margin-right:auto;\"></span><span style=\"display:block;text-align:center;\">Zoom out</span></br>";c+="      <span id=\"pundit-image-annotation-polygon\" class=\"pundit-draw-polygon-icon\" style=\"display:block;width:25px;height:25px;margin-left:auto;margin-right:auto;\"></span><span style=\"display:block;text-align:center;\">Draw Polygon</span></br>";c+="      <span id=\"pundit-image-annotation-delete\" class=\"pundit-delete-icon\" style=\"display:block;width:25px;height:25px;margin-left:auto;margin-right:auto;\"></span><span style=\"display:block;text-align:center;\">Delete Selected</span></br>";c+="      <span id=\"pundit-image-annotation-myitem\" class=\"pundit-favorite-icon\" style=\"display:block;width:25px;height:25px;margin-left:auto;margin-right:auto;\"></span><span style=\"display:block;text-align:center;\">Add to My Item</span></br>";c+="      <span id=\"pundit-image-annotation-add-comment\"\" class=\"pundit-tag-icon\" style=\"display:block;width:25px;height:25px;margin-left:auto;margin-right:auto;\"></span><span style=\"display:block;text-align:center;\">Add Comment/Tag</span></br>";c+="  </li>";c+="  <li>";c+="      <div id=\""+self._id+"-image-annotation-container\" class=\"pundit-stop-wheel-propagation pundit-rp-image-annotation-container\" style=\"width:480px;height:360px;overflow:auto;z-index:1000000000;background:lightGrey\"></div>";c+="</li></ul>";self.addHTMLContent(c);},initAnnotationCanvas:function(_94c){var self=this,_94d=new Image();self.stage=new Kinetic.Stage({container:self._id+"-image-annotation-container"});self.layer=new Kinetic.Layer({});self.isDrawing=true;self.layer.drawingNewLine=false;self.layer.finishedDrawingNewLine=false;self.newDots=[];_4.connect(self.stage.getContent(),"onclick",function(e){if(!self.isDrawing){return;}if(self.layer.finishedDrawingNewLine){return;}var pos=self.stage.getMousePosition(),_94e=self.stage.getScale(),len,_94f,_950=[];len=self.newDots.length;self.newDots[len]=self.buildAnchor(self.layer,(pos.x-self.stage.getX())/_94e.x,(pos.y-self.stage.getY())/_94e.y);_94f=self.strokeWidth/self.stage.getScale().x;for(var i=self.dashArray.length;i--;){_950.push(self.dashArray[i]/self.stage.getScale().x);}self.layer.newLine=new Kinetic.Line({dashArray:_950,strokeWidth:self.lineStrokeWidth,stroke:"#f00",lineCap:"round",alpha:1,name:"tempLine"});self.layer.add(self.layer.newLine);self.layer.draw();self.layer.drawingNewLine=true;});self.stage.on("click",function(){self.deselectShape();self.layer.draw();});self.stage.on("mousemove",function(evt){if(!self.layer.drawingNewLine){return;}self.stage.draw();});self.layer.on("beforeDraw",function(){if(self.layer.newLine){self.updateNewLine(self.layer);}if(self.selectedShape!==null){self.updatePoly(self.selectedShape);}});_94d.onload=function(){var _951=1,_952=new Kinetic.Image({x:0,y:0,image:_94d}),iw=_94d.width,ih=_94d.height;self.iw=iw;self.ih=ih;self.layer.background=_952;self.layer.add(_952);_952.moveToBottom();_951=Math.min(self.containerSize.w/iw,self.containerSize.h/ih);self.stage.setWidth(parseInt(iw*_951));self.stage.setHeight(parseInt(ih*_951));self.stage.setScale({x:_951,y:_951});if(iw>ih){self.isPanImg=true;if(iw<self.containerSize.w){_4.style(_4.query(self.stage.getContent())[0],{left:parseInt(0.5*(self.containerSize.w-iw*_951)),top:parseInt(0.5*(self.containerSize.h-ih*_951)),width:parseInt(iw*_951),height:parseInt(ih*_951)});}else{self.centerCanvasContainer();}}else{self.isPanImg=false;if(ih<self.containerSize.h){_4.style(_4.query(self.stage.getContent())[0],{left:parseInt(0.5*(self.containerSize.w-iw*_951)),top:parseInt(0.5*(self.containerSize.h-ih*_951)),width:parseInt(iw*_951),height:parseInt(ih*_951)});}else{self.centerCanvasContainer();}}self.stage.draw();};_94d.src=self.imageSrc;self.stage.add(self.layer);self.stage.draw();},initBehavior:function(){var self=this;_4.connect(_4.byId("pundit-image-annotation-zoom"),"onclick",function(){self.zoomIn();_PUNDIT.ga.track("gui-button","click","pundit-image-annotation-zoom");});_4.connect(_4.byId("pundit-image-annotation-pan"),"onclick",function(){var _953=null;_953=self.stage.getScale();_953.x=_953.x-self.deltaScale;_953.y=_953.y-self.deltaScale;self.stage.setWidth(parseInt(self.stage.getWidth()*(1-self.deltaScale)));self.stage.setHeight(parseInt(self.stage.getHeight()*(1-self.deltaScale)));self.stage.setScale({x:self.stage.getWidth()/self.iw,y:self.stage.getHeight()/self.ih});self.centerCanvasContainer();self.updateShapeRendering(_953.x);self.stage.draw();_PUNDIT.ga.track("gui-button","click","pundit-image-annotation-pan");});_4.connect(_4.byId("pundit-image-annotation-polygon"),"onclick",function(){if(self.isDrawing){return;}else{if(self.createdShapes.length>0){return;}self.isDrawing=true;self.layer.finishedDrawingNewLine=false;self.deselectShape();}_PUNDIT.ga.track("gui-button","click","pundit-image-annotation-polygon");});_4.connect(_4.byId("pundit-image-annotation-delete"),"onclick",function(){if(self.selectedShape!==null){self.isDrawing=false;var dots=self.stage.get(".dot-"+self.selectedShape.getId());for(var i=dots.length;i--;){dots[i].remove();}self.selectedShape.remove();for(var i=self.createdShapes.length;i--;){if(self.createdShapes[i].getId()===self.selectedShape.getId()){self.createdShapes.splice(i,1);}}self.selectedShape=null;self.layer.finishedDrawingNewLine=true;self.stage.draw();_PUNDIT.ga.track("gui-button","click","pundit-image-annotation-delete");}});_4.connect(_4.byId("pundit-image-annotation-myitem"),"onclick",function(){if(self.createdShapes.length>0){var item=self.createItemFromCreatedShape();if(!semlibMyItems.uriInItems(item.value)){item.rdfData=semlibItems.createBucketForImageRegionFragment(item).bucket;previewer.buildPreviewForItem(item);semlibMyItems.addItem(item,true);semlibMyItems.show_pundittabfiltermyitemsimagesfragment();}self.selectedShape=null;self.hide();_PUNDIT.ga.track("gui-button","click","pundit-image-annotation-myitem");}});_4.connect(_4.byId("pundit-image-annotation-add-comment"),"onclick",function(){if(self.createdShapes.length>0){var item=self.createItemFromCreatedShape();item.rdfData=semlibItems.createBucketForImageRegionFragment(item).bucket;self.selectedShape=null;_PUNDIT["commentTag"].initPanel(item,"Comment and tags");_PUNDIT.ga.track("gui-button","click","pundit-image-annotation-add-comment");}else{}});},updateNewLine:function(_954){var self=this,pos=self.stage.getMousePosition(),len=self.newDots.length,_955=[];if(typeof pos==="undefined"){return false;}for(var i=0;i<len;i++){_955=_955.concat([self.newDots[i].attrs.x,self.newDots[i].attrs.y]);}if(_954.drawingNewLine){_955=_955.concat((pos.x-self.stage.getX())/self.stage.getScale().x,(pos.y-self.stage.getY())/self.stage.getScale().y);}else{_955=_955.concat([self.newDots[0].attrs.x,self.newDots[0].attrs.y]);}_954.newLine.setPoints(_955);_954.newLine.setZIndex(1);},buildAnchor:function(_956,x,y){var self=this,len,_957=self.dotRadius/self.stage.getScale().x,_958=self.strokeWidth/self.stage.getScale().x,_959=new Kinetic.Circle({x:x,y:y,radius:_957,stroke:"#666",fill:"#fc0",strokeWidth:_958,draggable:false,name:"dot"});len=self.newDots.length;if(len===0){_959.on("mouseover",function(evt){document.body.style.cursor="pointer";this.setStrokeWidth((self.strokeWidth+1)/self.stage.getScale().x);});_959.on("mouseout",function(){document.body.style.cursor="default";this.setStrokeWidth(self.strokeWidth/self.stage.getScale().x);_956.draw();});_959.on("click",function(evt){var len=self.newDots.length,_958,_95a,id,_95b=[],_95c,poly,dots;self.layer.finishedDrawingNewLine=true;self.newDots[0].off("click");self.layer.drawingNewLine=false;self.layer.draw();evt.cancelBubble=true;_95b=[];for(var i=0;i<len;i++){_95b=_95b.concat([self.newDots[i].attrs.x,self.newDots[i].attrs.y]);}_95b.concat([self.newDots[0].attrs.x,self.newDots[0].attrs.y]);_958=self.strokeWidth/self.stage.getScale().x;poly=new Kinetic.Polygon({points:_95b,fill:"#ff0000",stroke:"black",strokeWidth:self.lineStrokeWidth,opacity:0.3});_95a=new Date().getTime();id="poly"+self.crypto.hex_md5(self.imageSrc+_95a+_4.toJson(_95b));poly.setId(id);dots=self.newDots;for(var i=dots.length;i--;){dots[i].remove();}self.newDots=[];_95c=self.stage.get(".tempLine");for(var i=_95c.length;i--;){_95c[i].remove();}poly.on("click",function(e){e.cancelBubble=true;if(typeof self.selectedShape==="undefined"||self.selectedShape!==this){self.selectShape(this);}self.layer.draw();});poly.on("dragstart",function(){self.selectedShape=null;var dots=self.stage.get(".dot-"+this.getId());for(var i=dots.length;i--;){dots[i].remove();}self.layer.draw();});poly.on("dragend",function(){self.selectedShape=this;var pos=this.getPosition(),dots=this.getPoints();for(var i=dots.length;i--;){self.dragPoints.push(self.buildTempAnchor(self.layer,this.getId(),dots[i].x+pos.x,dots[i].y+pos.y));}this.setPosition({x:0,y:0});self.updatePoly(this);self.layer.draw();});self.createdShapes.push(poly);self.layer.add(poly);self.layer.newLine=null;self.layer.drawingNewLine=false;self.isDrawing=false;self.layer.draw();return;});}_956.add(_959);return _959;},updatePoly:function(pol){var self=this,_95d=pol.shapeType;if(_95d==="Polygon"){var dots=self.layer.get(".dot-"+pol.getId()),len=dots.length,_95e=[];for(var i=0;i<len;i++){_95e=_95e.concat([dots[i].attrs.x,dots[i].attrs.y]);}_95e.concat([dots[0].attrs.x,dots[0].attrs.y]);pol.setPoints(_95e);}},buildTempAnchor:function(_95f,_960,x,y){var self=this,_961=self.dotRadius/self.stage.getScale().x,_962=self.strokeWidth/self.stage.getScale().x,_963=new Kinetic.Circle({x:x,y:y,radius:_961,stroke:"#fc0",fill:"#ff0000",strokeWidth:_962,draggable:true,name:"dot-"+_960});_963.on("mouseover",function(evt){document.body.style.cursor="pointer";this.setStrokeWidth((self.strokeWidth+1)/self.stage.getScale().x);_95f.draw();});_963.on("mouseout",function(){document.body.style.cursor="default";this.setStrokeWidth(_962);_95f.draw();});_95f.add(_963);return _963;},hide:function(){this.inherited(arguments);var self=this;_4.destroy(self._id+"-image-ann-container");},createItemFromCreatedShape:function(){var self=this,_964=new Date().getTime(),_965,_966=self.stage.getScale(),sw=self.stage.getWidth(),sh=self.stage.getHeight(),_967=[],item;for(var i=self.createdShapes.length;i--;){if(self.createdShapes[i].shapeType==="Polygon"){_965=self.createdShapes[i].getPoints();for(var j=_965.length;j--;){_965[j].x=((_965[j].x*_966.x)/sw);_965[j].y=((_965[j].y*_966.y)/sh);}var _968={type:self.createdShapes[i].shapeType.toLowerCase(),points:_965};_967.push(_968);}}var _969;var imgs=_4.query("img");for(var ii=0;ii<imgs.length;ii++){if(imgs[ii].src===self.imageSrc&&(imgs[ii].getAttribute("class")==null||imgs[ii].getAttribute("class").indexOf("pundit-")===-1)){var _96a=new pundit.XpointersHelper();_969=_96a.getXpFromNode(imgs[ii]);}}item={type:["subject"],rdftype:[ns.fragments.image],label:"Fragment of "+self.imageSrc.substring(self.imageSrc.lastIndexOf("/")+1,self.imageSrc.length),description:"This fragment represents a part of the image "+self.imageSrc.substring(self.imageSrc.lastIndexOf("/")+1,self.imageSrc.length),value:ns.fragmentBaseUri+"image/"+self.crypto.hex_md5(self.imageSrc+_964+_4.toJson(_967)),image:self.imageSrc,parentItemXP:_969,isPartOf:self.imageSrc,pageContext:_PUNDIT.tripleComposer.getSafePageContext(),selectors:_967};console.log("Ara che item DELLA MADONNA",item);item_pippo=item;return item;},selectShape:function(_96b){var self=this;self.deselectShape();if(_96b.shapeType==="Polygon"){var dots=_96b.getPoints();self.dragPoints=[];for(var i=dots.length;i--;){self.dragPoints.push(self.buildTempAnchor(self.layer,_96b.getId(),dots[i].x,dots[i].y));}_96b.setDraggable(true);}self.selectedShape=_96b;},deselectShape:function(){var self=this;if(self.selectedShape===null){return;}if(self.selectedShape.shapeType==="Polygon"){var _96c=self.layer.get(".dot-"+self.selectedShape.getId());for(var i=_96c.length;i--;){_96c[i].remove();}self.selectedShape.setDraggable(false);}self.selectedShape=null;self.stage.draw();},updateShapeRendering:function(_96d){var self=this,_96e=self.layer.getChildren();for(var i=_96e.length;i--;){var _96f=_96e[i];if(typeof _96f.attrs["strokeWidth"]!=="undefined"){_96f.setStrokeWidth(self.strokeWidth/_96d);}if(typeof _96f.attrs["radius"]!=="undefined"){_96f.setRadius(self.dotRadius/_96d);}if(typeof _96f.attrs["dashArray"]!=="undefined"){var _970=[];for(var j=self.dashArray.length;j--;){_970.push(self.dashArray/_96d);}_96f.attrs["dashArray"]=_970;}}},centerCanvasContainer:function(){var self=this;if(self.stage.getWidth()<self.containerSize.w){_4.style(_4.query(self.stage.getContent())[0],{left:0.5*(self.containerSize.w-self.stage.getWidth())});}else{_4.style(_4.query(self.stage.getContent())[0],{left:0});}if(self.stage.getHeight()<self.containerSize.h){_4.style(_4.query(self.stage.getContent())[0],{top:0.5*(self.containerSize.h-self.stage.getHeight())});}else{_4.style(_4.query(self.stage.getContent())[0],{top:0});}},zoomIn:function(){var self=this;var _971=self.stage.getScale();_971.x+=self.deltaScale;_971.y+=self.deltaScale;self.stage.setWidth(parseInt(self.stage.getWidth()*(1+self.deltaScale)));self.stage.draw();self.stage.setHeight(parseInt(self.stage.getHeight()*(1+self.deltaScale)));self.stage.setScale({x:self.stage.getWidth()/self.iw,y:self.stage.getHeight()/self.ih});self.centerCanvasContainer();self.updateShapeRendering(_971.x);self.stage.draw();}});}if(!_4._hasResource["pundit.Help"]){_4._hasResource["pundit.Help"]=true;_4.provide("pundit.Help");_4.declare("pundit.Help",pundit.BaseComponent,{opts:{introductionFile:undefined,showIntroductionAtLogin:false,introductionWindowTitle:"Welcome :)"},constructor:function(){var self=this;self._initHTML();self._initBehaviors();if(typeof (self.opts.introductionFile)!=="undefined"){self._initIntroduction();}},_initHTML:function(){var self=this;help="";help+="<span class=\"pundit-gui-button\" id=\"pundit-help-button\"><span class=\"pundit-bicon pundit-lifebuoy-icon\"></span> Help</span>";_4.query("#pundit-gui-topbar").append(help);},_initIntroduction:function(){var self=this,_972="";self.introductionDialog=new _5.Dialog({style:"width: 600px"});_4.addClass(_4.byId(self.introductionDialog.id),"tundra pundit-disable-annotation");_972+="<div class=\"pundit-dialog-top\">";_972+="<iframe class=\"pundit-dialog-content\" src=\""+self.opts.introductionFile+"\"></iframe>";_972+="</div>";_972+="<div class=\"pundit-dialog-bottom\">";_972+="<span id=\"pundit-intro-close-button\" class=\"pundit-gui-button\">Close</span>";_972+="<input type=\"checkbox\" id=\"pundit-intro-dont-open-again\" />";_972+="<span class=\"pundit-intro-dont-open-label\">Don't show me this introduction next time.</span>";_972+="</div>";self.introductionDialog.attr("content",_972);self.introductionDialog.attr("title",self.opts.introductionWindowTitle);_PUNDIT.requester.checkLogin(function(data){if(data.loginStatus!==1){return;}_PUNDIT.remoteStore.get("show-introduction",function(v){self.log("Initializing dont-open-again checkbox to "+!v.value);_4.byId("pundit-intro-dont-open-again").checked=!v.value;});});self._initIntroductionBehaviors();},_initIntroductionBehaviors:function(){var self=this;_4.connect(_4.byId("pundit-intro-close-button"),"onclick",function(e){self.introductionDialog.hide();});_4.connect(_4.byId("pundit-intro-dont-open-again"),"onchange",function(e){if(!_PUNDIT.myPundit.logged){self.log("Trying to modify users preferences while user is not logged in, ignoring.");return false;}_PUNDIT.ga.track("gui-button","click","pundit-intro-dont-open-again");self.log("Setting remote show-introduction to "+!this.checked);_PUNDIT.remoteStore.set("show-introduction",!this.checked);});_PUNDIT.cMenu.addAction({type:["helpMenu"],name:"showIntroduction",label:"Show introduction",showIf:function(){return true;},onclick:function(){_PUNDIT.ga.track("cmenu","click","show-introduction");self.showIntroduction();return true;}});if(self.opts.showIntroductionAtLogin){_PUNDIT.requester.onLogin(function(){_PUNDIT.remoteStore.get("show-introduction",function(res){if(res.length===0){self.log("Perfectly virgin show-introduction: initializing");_PUNDIT.remoteStore.set("show-introduction",true);res={value:true};}if(res.value){self.log("Remote show-introduction is true, showing introduction.");self.showIntroduction();}self.log("After login initializing dont-open-again checkbox to "+!res.value);_4.byId("pundit-intro-dont-open-again").checked=!res.value;},function(){self.log("ERROR: reading remote show-introduction??");});});}},_initBehaviors:function(){var self=this;_4.connect(_4.byId("pundit-help-button"),"onclick",function(e){var x=_4.position(_4.byId("pundit-help-button")).x-50;_PUNDIT.cMenu.show(x,21,undefined,"helpMenu","pundit-cm-bottom");});},showIntroduction:function(){var self=this;self.log("Opening introduction dialog.");self.introductionDialog.show();}});}if(!_4._hasResource["pundit.NamedContentHandler"]){_4._hasResource["pundit.NamedContentHandler"]=true;_4.provide("pundit.NamedContentHandler");_4.declare("pundit.NamedContentHandler",pundit.BaseComponent,{opts:{moreInfoTag:"span",moreInfoAttribute:"rel",moreInfoURL:"http://purl.org/pundit/ont/json-metadata",consolidateNamedContents:true},constructor:function(_973){var self=this;self._checkedIdentifiers=[];self.xphelper=new pundit.XpointersHelper();_PUNDIT.init.onInitDone(function(){setTimeout(function(){},1000);tooltip_viewer.onConsolidate(function(){});});self.loadJobId=_PUNDIT.init.waitBeforeInit();(function(){var h=document.getElementsByTagName("head")[0],d=document.createElement("script");d.type="text/javascript";d.src="https://cdn.rawgit.com/digitalbazaar/jsonld.js/master/js/jsonld.js";h.appendChild(d);d.onload=function(){self.log("Loaded JSONLD library: checking for named content");_PUNDIT.init.doneBeforeInit(self.loadJobId);self.checkForNamedContent();};})();},checkForNamedContent:function(){var self=this,uris={},num=0,_974=false;for(var i=self.xphelper.opts.contentClasses.length-1;i>=0;i--){_4.query("."+self.xphelper.opts.contentClasses[i]).forEach(function(node){var u=_4.attr(node,"about"),item=self.createItemForNode(node);var _975=node.getElementsByTagName("SPAN");if(typeof (_975)!=="undefined"&&_975.length>0){var _976=_975[0];}if(typeof (_976)==="undefined"||typeof (_976.getAttribute("rel"))==="undefined"||_976.getAttribute("rel")!=="http://purl.org/pundit/ont/json-metadata"){self.log("Skipping named content. No JSON metadata for"+item.value);return;}if(_4.indexOf(self._checkedIdentifiers,u)!==-1){self.log("Skipping "+item.value);return;}self._checkedIdentifiers.push(u);num++;uris[u]={node:node,item:item};self.log("checkForNamedContent adding: "+u);});}self.log("checkForNamedContent: "+num+" new named contents found");for(var k in uris){var _977=_PUNDIT.tooltipViewer,_978=_4.query(self.opts.moreInfoTag+"[rel=\"http://purl.org/pundit/ont/json-metadata\"]",uris[k].node);if(_978.length>0){var res=_4.attr(_978[0],"resource");self.log("Getting more info from "+res);_4.io.script.get({callbackParamName:"jsonp",url:res,load:(function(item){return function(ld){var _979=jsonld.getValues(ld,"http://www.w3.org/2000/01/rdf-schema#label")[0],_97a=jsonld.getValues(ld,"@type"),_97b=jsonld.getValues(ld,"http://purl.org/dc/elements/1.1/description")[0],_97c=jsonld.getValues(ld,"http://xmlns.com/foaf/0.1/depiction")[0];for(var l=_97a.length;l--;){item.rdftype.push(_97a[l]);}item.label=_979;item.description=_97b;item.image=_97c;item.rdfData=semlibItems.createBucketForNamedContent(item).bucket;semlibItems.addItem(item,true);previewer.buildPreviewForItem(item);self.log("Created item from rest service: "+item.label);};})(uris[k].item),error:function(_97d,_97e){self.log("Error :| zomg.");}});}else{uris[k].item.rdfData=semlibItems.createBucketForNamedContent(uris[k].item).bucket;semlibItems.addItem(uris[k].item,true);previewer.buildPreviewForItem(uris[k].item);self.log("Created item with no additional info: "+uris[k].item.label);}if(self.opts.consolidateNamedContents){if(!_977.isTempXpointer(uris[k].item.value)&&(_977.contentURIs.indexOf(uris[k].item.isPartOf)!==-1)){_977.tempXpointers.push(uris[k].item.value);_974=true;self.log("Added named content item to temp xpointers");}}}if(_974){}},createItemForNode:function(node){var self=this,_97f,_980,_981=_PUNDIT.tripleComposer.getSafePageContext(),item,_982=_4.attr(node,"about"),xp;xp=self.xphelper.getXpFromChildNodes(node);_97f=self.xphelper.extractContentFromNode(node);_97f=_97f.replace(/(\r\n|\n|\r)/gm,"").replace(/\s+/g," ");_980=_97f.length>50?_97f.substr(0,50)+" ..":_97f;if(_981.indexOf("#xpointer")!==-1){_981=_981.substring(0,_981.indexOf("#"));}item={type:["subject"],rdftype:[ns.fragments.named,ns.fragments.text],label:_980,description:_97f,value:xp,isPartOf:xp.split("#")[0],pageContext:_981};return item;},});}if(!_4._hasResource["pundit.ContactHelper"]){_4._hasResource["pundit.ContactHelper"]=true;_4.provide("pundit.ContactHelper");_4.declare("pundit.ContactHelper",pundit.BaseComponent,{opts:{postAutomaticHideMS:2000},constructor:function(){var self=this;self._dialogs={};self._instances={};for(var i in self.opts.instances){var id="form_"+i;self._instances[id]=self.opts.instances[i];self.log("Initializing contact form with title "+self._instances[id].title);self._initContactForm(id);}},_initContactForm:function(id){var self=this,_983=self._instances[id],_984="";_PUNDIT.cMenu.addAction({type:["helpMenu"],name:"showContactForm_"+id,label:_983.title,showIf:function(){return true;},onclick:function(){_PUNDIT.ga.track("cmenu","click","show-contact-form");self._showForm(id);return true;}});self._dialogs[id]=new _5.Dialog({style:"width: 500px"});_4.addClass(_4.byId(self._dialogs[id].id),"tundra pundit-disable-annotation");self._instances[id].contentNode=_4.query("#"+self._dialogs[id].id+" .dijitDialogPaneContent")[0];_984+="<div class=\"pundit-dialog-top pundit-contact-form\">";_984+="  <div class=\"pundit-dialog-errors\"></div>";_984+="  <div class=\"pundit-dialog-content\">";_984+="  <p>"+_983.comment+"</p>";_984+="    <form id=\"pundit-contact-"+id+"\">";_984+="      <label>Subject *</label><input type=\"text\" name=\"subject\" class=\"pundit-contact-subject\" /><br />";_984+="      <label>From</label> <input type=\"text\" name=\"name\" class=\"pundit-contact-from\" /><br />";_984+="      <label>Email</label> <input type=\"email\" name=\"email\" class=\"pundit-contact-email\" /><br />";_984+="      <label>Message *</label> <textarea name=\"text\" class=\"pundit-contact-text\"></textarea><br />";_984+="      <input type=\"hidden\" name=\"identifier\" value=\""+_983.list+"\" />";_984+="    <form>";_984+="</div></div>";_984+="<div class=\"pundit-dialog-bottom\">";_984+="  <span id=\"pundit-contact-close-button-"+id+"\" class=\"pundit-gui-button\">Cancel</span>";_984+="  <span id=\"pundit-contact-submit-button-"+id+"\" class=\"pundit-gui-button\">Submit</span>";_984+="</div>";self._dialogs[id].attr("content",_984);self._dialogs[id].attr("title",_983.title);self._initFormBehaviors(id);},_initFormBehaviors:function(id){var self=this;_4.connect(_4.byId("pundit-contact-close-button-"+id),"onclick",function(e){if(_4.hasClass(self._instances[id].contentNode,"pundit-panel-loading")){self.log("Contact window is still loading, cancel canceled");return;}self._dialogs[id].hide();self._clearForm(id);});_4.connect(_4.byId("pundit-contact-submit-button-"+id),"onclick",function(e){if(_4.hasClass(self._instances[id].contentNode,"pundit-panel-loading")){self.log("Contact window is still loading, post canceled");return;}self.log("Submitting contact form "+id);self._post(id);});},_post:function(id){var self=this;self._instances[id].jobId=_PUNDIT.loadingBox.addJob("Sending form "+self._instances[id].title);_4.addClass(self._instances[id].contentNode,"pundit-panel-loading");var post={url:ns.annotationServerContact,form:_4.byId("pundit-contact-"+id),load:function(data){self.log("Correctly sent contact form "+id);_4.removeClass(self._instances[id].contentNode,"pundit-panel-loading");_4.addClass(self._instances[id].contentNode,"pundit-panel-done");setTimeout(function(){self._hideForm(id);},self.opts.postAutomaticHideMS);_PUNDIT.loadingBox.setJobOk(self._instances[id].jobId);},error:function(_985){self.log("Error sending form "+id);_4.removeClass(self._instances[id].contentNode,"pundit-panel-loading");_PUNDIT.loadingBox.setJobKo(self._instances[id].jobId);}};_PUNDIT.requester.xPost(post);},_showForm:function(id){var self=this;if(self._dialogs[id].open){self.log("Form "+id+" is already open.");return;}self.log("Showing form "+id);_4.removeClass(self._instances[id].contentNode,"pundit-panel-done");_4.removeClass(self._instances[id].contentNode,"pundit-panel-loading");self._clearForm(id);self._dialogs[id].show();},_hideForm:function(id){var self=this;self._dialogs[id].hide();},_clearForm:function(id){var self=this,_986=self._dialogs[id].id;_4.query("#"+_986+" input:not([type=hidden]), #"+_986+" textarea").val("");}});}if(!_4._hasResource["pundit.ng.ImageAnnotatorHelper"]){_4._hasResource["pundit.ng.ImageAnnotatorHelper"]=true;_4.provide("pundit.ng.ImageAnnotatorHelper");_4.declare("pundit.ng.ImageAnnotatorHelper",pundit.BaseComponent,{opts:{debug:true},constructor:function(_987){var self=this;self.currentImage=null;self.initIA();self.initMenus();self.log("Angular image annotator helper up and running");},createItemFromPolygon:function(poly){var self=this,_988=new pundit.XpointersHelper(),_989=_988.getXpFromNode(self.currentNode),_98a="This fragment represents a part of the image "+self.currentImage.substring(self.currentImage.lastIndexOf("/")+1,self.currentImage.length),uri,_98b=[{points:poly.points,type:"polygon"}],_98c=new pundit.Crypto();uri=ns.fragmentBaseUri+"image/"+_98c.hex_md5(self.currentImage+new Date().getTime()+_4.toJson(_98b));item={type:["subject"],rdftype:[ns.fragments.image],label:poly.name,description:_98a,value:uri,image:self.currentImage,parentItemXP:_989,isPartOf:self.currentImage,pageContext:_PUNDIT.tripleComposer.getSafePageContext(),selectors:_98b};item.rdfData=semlibItems.createBucketForImageRegionFragment(item).bucket;return item;},initMenus:function(){var self=this;_PUNDIT.cMenu.addAction({type:["imageSelectionHelper"],name:"NGAnnotateImage",label:"Annotate a part of this image (NEW)",showIf:function(){return true;},onclick:function(item){_PUNDIT.ga.track("cmenu","click","annotate-a-part-of-this-image-NEW");self.log("Annotating a part of image "+item.image);if(self.currentImage!==item.image){self.currentImage=item.image;self.currentNode=item._originalNode;IA.callSetImg(item.image);}IA.callOpen();return true;}});},initIA:function(){var self=this;window["PunditIAConf"]={useOnlyCallbacks:true,img:"http://upload.wikimedia.org/wikipedia/commons/a/a4/Dante-alighieri.jpg",onLoad:function(){self.log("IA is fully loaded");},actions:[{label:"Annotate this fragment",action:function(poly){self.log("Using a polygon as subject ");var item=self.createItemFromPolygon(poly);tripleComposer.addItemToSubject(item);previewer.buildPreviewForItem(item);if(!_PUNDIT.GUI.isWindowOpen()){_PUNDIT.GUI.toggleWindow();}IA.callClose();_PUNDIT.ga.track("cmenu","click","ng-IA-annotate-this-fragment");},showIf:function(poly){return poly.closed;}}]};_4.place("<div ng-app=\"ImageAnnotator\"><image-annotator conf-name=\"PunditIAConf\"></image-annotator></div>",_4.query("body")[0],"first");if(typeof (IA)==="undefined"){angular.bootstrap(document,["ImageAnnotator"]);}}});}if(!_4._hasResource["pundit.ng.EntityEditorHelper"]){_4._hasResource["pundit.ng.EntityEditorHelper"]=true;_4.provide("pundit.ng.EntityEditorHelper");_4.declare("pundit.ng.EntityEditorHelper",pundit.BaseComponent,{opts:{debug:true,endpoint:"http://demo-cloud.api.korbo.org/v1",basketID:1,globalObjectName:"EE",providers:{korbo:true,freebase:false,dbpedia:false},useAutocompleteWithSearch:false,useTafonyCompatibility:false,copyToKorboBeforeUse:false,types:[{label:"Schema.org place",state:false,URI:"http://schema.org/Place"},{label:"FOAF person",state:false,URI:"http://xmlns.com/foaf/0.1/Person"},{label:"W3 Spatial thing",state:false,URI:"http://www.w3.org/2003/01/geo/wgs84_pos#SpatialThing"}]},constructor:function(_98d){var self=this;self.initEE();self.log("Angular entity editor helper up and running");},initEE:function(){var self=this;window["PunditEEConf"]={endpoint:self.opts.endpoint,basketID:self.opts.basketID,globalObjectName:self.opts.globalObjectName,useOnlyCallback:true,useAutocompleteWithSearch:self.opts.useAutocompleteWithSearch,useTafonyCompatibility:self.opts.useTafonyCompatibility,copyToKorboBeforeUse:self.opts.copyToKorboBeforeUse,onLoad:function(){self.log("Entity Editor fully loaded");self.registerCallbacks();},providers:self.opts.providers,type:self.opts.types};_4.place("<div ng-app=\"KorboEE\"><korbo-entity-editor conf-name=\"PunditEEConf\"></korbo-entity-editor></div>",_4.query("body")[0],"first");if(typeof (window[self.opts.globalObjectName])==="undefined"){angular.bootstrap(document,["KorboEE"]);self.log("Bootstrapping the korbo EE app");}else{self.log("Korbo EE ng app is already bootstrapped");}},openEE:function(_98e,_98f){var self=this,ee=window[self.opts.globalObjectName];self.log("Opening entity editor search window, keyword="+_98e+", field="+_98f);self._lastField=_98f;if(_PUNDIT.GUI.isWindowOpen()){_PUNDIT.GUI.toggleWindow();}if(_PUNDIT.GUI.isAnnotationWindowOpen()){_PUNDIT.GUI.toggleAnnotationWindow();}ee.callClearForm();ee.callOpenSearch(_98e);},registerCallbacks:function(){var self=this,ee=window[self.opts.globalObjectName];ee.onSave(function(_990){self.log("Saving "+_990.label);var item={type:["subject"],label:_990.label,value:_990.value,image:_990.image||null,description:_990.description,rdftype:[]};for(var t in _990.type){item.rdftype.push(_990.type[t]);}item.rdfData=semlibItems.createBucketForItem(item).bucket;previewer.buildPreviewForItem(item);if(self._lastField==="subject"){tripleComposer.addItemToSubject(item);}else{if(self._lastField==="object"){tripleComposer.addItemToObject(item);}}if(!_PUNDIT.GUI.isWindowOpen()){_PUNDIT.GUI.toggleWindow();}});ee.onCancel(function(){self.log("Window closed by cancel.");});self.log("Callbacks registered");}});}if(!_4._hasResource["pundit.Init"]){_4._hasResource["pundit.Init"]=true;_4.provide("pundit.Init");_4.declare("pundit.Init",pundit.BaseComponent,{opts:{liveNamespace:"punditLive"},constructor:function(_991){var self=this,p;self.log("Initializing Pundit...");self.addScoreFunction();if(typeof (window[self.opts.liveNamespace])==="undefined"){window[self.opts.liveNamespace]={};}p=window[self.opts.liveNamespace];window["_PUNDIT"]=window[self.opts.liveNamespace];window["PunditLiveNamespaceName"]=self.opts.liveNamespace;self.log("Registered '"+self.opts.liveNamespace+"' variable: pundit global namespace object. Also known as '_PUNDIT'.");p["init"]=self;p["configuration"]=new pundit.Configuration();self.createCallback(["initDone"]);self.loadJobs=[];ns=new pundit.NamespaceHelper();p["ns"]=ns;if(p.config.isModuleActive("pundit.AnalyticsHelper")){p["ga"]=new pundit.AnalyticsHelper();}previewer=new pundit.Previewer();p["previewer"]=previewer;cMenu=new pundit.ContextualMenu();p["cMenu"]=cMenu;requester=new pundit.AuthenticatedRequests();p["requester"]=requester;semlibWindow=new pundit.GUI();p["GUI"]=semlibWindow;p["loadingBox"]=new pundit.LoadingBox();p["items"]=new pundit.ItemContainerManager();fragmentHandler=new pundit.TextFragmentHandler();p["fragmentHandler"]=fragmentHandler;if(p.config.isModuleActive("pundit.fasttexthandler")){p["fasttexthandler"]=new pundit.FastTextHandler({name:"fast-text-handler",title:"Connect text",drag:true});}if(p.config.isModuleActive("pundit.PageHandler")){p["pageHandler"]=new pundit.PageHandler({debug:false});}if(false){}var _992=_4.require;p["conductor"]=new pundit.annotators.AnnotatorsConductor();for(var an in p.config.modules.annotators){var conf=p.config.modules.annotators[an];if(conf.active===true){self.log("Loading annotator "+an);_992("pundit.annotators."+an);p.conductor.registerAnnotator(new pundit.annotators[an](conf));}}p["vocab"]=new pundit.selectors.VocabSelector();if(false){}p.config.activeSelectorsName=[];for(var se in p.config.modules.selectors){var conf=p.config.modules.selectors[se];_992("pundit.selectors."+se+"Selector");if(p.configuration._isArray(conf)){self.log("Loading multiple instances of selector "+se);for(var l=conf.length;l-->0;){var _993=conf[l];if(_993.active===true){p[_993.name+"Selector"]=new pundit.selectors[se+"Selector"](_993);p.config.activeSelectorsName.push({selector:se,name:_993.name,label:_993.label});}}}else{if(conf.active===true){self.log("Loading selector "+se);p[conf.name+"Selector"]=new pundit.selectors[se+"Selector"](conf);p.config.activeSelectorsName.push({selector:se,name:conf.name,label:conf.label});}}}if(p.config.isModuleActive("pundit.ImageFragmentHandler")){semlibImageFragmentHandler=new pundit.ImageFragmentHandler();}if(p.config.isModuleActive("pundit.NotebookManager")){}semlibLiterals=new pundit.Literals();p["literals"]=semlibLiterals;p.config.activeEntitySources={};for(var k=p.config.activeSelectorsName.length;k--;){var ob=p.config.activeSelectorsName[k],se=ob.selector,name=ob.name,_994=ob.label;p.config.activeEntitySources[name+"Selector"]={label:_994};}if(p.config.isModuleActive("pundit.Recognizer")){p["recognizer"]=new pundit.Recognizer();}p["commentTag"]=new pundit.CommentTagPanel({name:"commentTag",preview:true,drag:true,searchType:"search",namedEntitiesSources:p.config.activeEntitySources});if(p.config.isModuleActive("pundit.ImageAnnotationPanel")){p["imageAnnotationPanel"]=new pundit.ImageAnnotationPanel({name:"imageAnnotationPanel",title:"Image Annotation Panel",width:600,height:400,drag:true});}tripleComposer=new pundit.TripleComposer();p["tripleComposer"]=tripleComposer;tooltip_viewer=new pundit.TooltipAnnotationViewer();p["tooltipViewer"]=tooltip_viewer;myPundit=new pundit.MyPundit();p["myPundit"]=myPundit;p["remoteStore"]=new pundit.RemoteStorageHandler();if(p.config.isModuleActive("pundit.Help")){p["help"]=new pundit.Help();}if(p.config.isModuleActive("pundit.NamedContentHandler")){p["namedContentHandler"]=new pundit.NamedContentHandler();}if(p.config.isModuleActive("pundit.ContactHelper")){p["contact"]=new pundit.ContactHelper();}if(p.config.isModuleActive("pundit.ng.ImageAnnotatorHelper")){p["ngIA"]=new pundit.ng.ImageAnnotatorHelper();}if(p.config.isModuleActive("pundit.ng.EntityEditorHelper")){p["ngEE"]=new pundit.ng.EntityEditorHelper();}_4.style(_4.query("html")[0],"position","static");_4.style(_4.query("body")[0],"position","static");_4.addClass(_4.query("body")[0],"tundra");self.checkBeforeInit();self.log("Pundit suite components initialization completed!");},waitBeforeInit:function(){var self=this,_995="job"+(0|Math.random()*999999);self.loadJobs.push(_995);self.log("A component is asking to wait for him. Job "+_995);return _995;},doneBeforeInit:function(_996){var self=this;if(self.loadJobs.indexOf(_996)!==-1){self.log("Job "+_996+" is done. ("+self.loadJobs.indexOf(_996)+")");self.loadJobs.splice(self.loadJobs.indexOf(_996),1);}else{self.log("Non-existent job "+_996+" is done. Cool.");}self.checkBeforeInit();},checkBeforeInit:function(){var self=this;if(self.loadJobs.length===0){self.log("No Load Jobs to wait for: Asynchronous component initialization is done!");self.fireOnInitDone();}else{self.log("Still "+self.loadJobs.length+" jobs to wait for ...");}},addScoreFunction:function(){String.prototype.score=function(_997,_998){if(this===_997){return 1;}if(_997===""){return 0;}var _999=0,_99a=_997.length,_99b=this,_99c=_99b.length,_99d,_99e,_99f=1,_9a0;for(var i=0,_9a1,_9a2,c,_9a3,_9a4,_9a5;i<_99a;++i){c=_997.charAt(i);_9a3=_99b.indexOf(c.toLowerCase());_9a4=_99b.indexOf(c.toUpperCase());_9a5=Math.min(_9a3,_9a4);_9a2=(_9a5>-1)?_9a5:Math.max(_9a3,_9a4);if(_9a2===-1){if(_998){_99f+=1-_998;continue;}else{return 0;}}else{_9a1=0.1;}if(_99b[_9a2]===c){_9a1+=0.1;}if(_9a2===0){_9a1+=0.6;if(i===0){_99d=1;}}else{if(_99b.charAt(_9a2-1)===" "){_9a1+=0.8;}}_99b=_99b.substring(_9a2+1,_99c);_999+=_9a1;}_99e=_999/_99a;_9a0=((_99e*(_99a/_99c))+_99e)/2;_9a0=_9a0/_99f;if(_99d&&(_9a0+0.15<1)){_9a0+=0.15;}return _9a0;};}});_4.ready(function(){var init=new pundit.Init();});}}};});
